{"version":3,"sources":["webpack:///barchart-ds.js","webpack:///webpack/bootstrap 4862b932129e86e0f2ec","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/template.html"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_component","_component2","obj","default","VERSION_INFO","version","build","BarChartDS","Vizabi","Tool","extend","init","placeholder","external_model","this","components","component","model","Component","_super","validate","entities","state","keys","show","length","dim","entities_geodomain","skipFilter","entities_side","entities_age","default_model","marker_tags","ui","chart","stacked","inpercent","flipSides","buttons","dialogs","popup","sidebar","moreoptions","presentation","locale","versionInfo","_toConsumableArray","arr","Array","isArray","arr2","from","_Vizabi","utils","axisSmart","helpers","iconQuestion","iconset","question","config","context","template","model_expects","type","_this","model_binds","change:time.value","evt","_readyOnce","time","step","snapped","playing","dragging","next","d3","bisectLeft","timeSteps","prev","snapTime","Date","marker","getFrame","frame","frameAxisX","axis_x","marker_order","frameOrder","hook_order","_reorderBars","_updateEntities","updateBarsOpacity","change:marker","path","indexOf","ready","change:marker.select","someSelected","select","nonSelectedOpacityZero","change:marker.highlight","_highlightBars","change:marker.opacitySelectDim","change:marker.opacityRegular","change:marker.color.palette","change:marker.color.scaleType","change:marker.color.which","stackDim","color","use","colorConcept","getConceptprops","concept_type","domain","which","sideConcept","side","setWhich","concept","geoDomainDimension","SIDEDIM","set","entities_allpossible","change:marker.side.which","sideDim","STACKDIM","clearSideState","clearShow","change:entities.show","isEmpty","forEach","getFilteredEntities","isShown","showEntity","change:entities_side.show","doReturn","_entitiesSameDimWithSide","_space","h","_name","_updateIndicators","_updateLimits","resize","change:ui.chart.inpercent","change:ui.chart.flipSides","switchSideState","xScale","yScale","cScale","xAxis","xAxisLeft","yAxis","xScales","totalFieldName","checkDimensions","colorUseNotProperty","stackSkip","geoLess","AGEDIM","sideSkip","readyOnce","el","element","interaction","_interaction","graph","yAxisEl","xAxisEl","xAxisLeftEl","xTitleEl","xInfoEl","yTitleEl","barsCrop","labelsCrop","bars","labels","attr","title","titleRight","year","getDimension","geoDomainDefaultValue","on","_attributeUpdaters","_newWidth","width","PREFIXEDSIDEDIM","PREFIXEDSTACKDIM","total","width_","_newX","prevSbl","previousSibling","prevSblDatum","datum","x_","_this2","_ready","getAllSteps","shiftScale","scaleLinear","range","KEYS","unique","_getAllDimensions","exceptType","label_side","getEntity","stack","label_stack","age","axis_y","SHIFTEDAGEDIM","TIMEDIM","groupBy","grouping","updateUIStrings","_createLimits","markers","getKeys","translator","getTFunction","xTitle","selectAll","data","enter","append","parent","findChildByName","markerID","alignX","isRTL","alignY","updateView","toggle","conceptPropsX","setIcon","style","Number","Boolean","description","sourceLink","pin","rect","getBBox","coord","makeAbsoluteContext","farthestViewportElement","x","y","height","toolRect","root","getBoundingClientRect","chartRect","node","setHook","setPos","left","hide","_this3","duration","delayAnimations","getScale","tickFormat","getTickFormatter","ageDim","ages","ageKeys","map","shiftedAgeKeys","sideItems","getItems","sideKeys","sideFiltered","filter","f","sortFunc","ascending","descending","sort","push","stacks","stackKeys","without","dataWithTotal","sortedStackKeys","getPalette","reduce","val","stackItems","twoSided","classed","xScaleLeft","copy","text","a","b","result","axisX","sideKeysNF","getNestedItems","limits","getLimitsByDimensions","concat","timeKeys","getUnique","totals","inpercentMaxLimits","maxLimits","ageSum","sideMaxLimits","stackSum","max","maxSideLimit","Math","apply","zero","scaleType","domainMin","domainMax","_interpolateBetweenTotals","nextStep","fraction","reorder","prefixedSideDim","prefixedStackDim","shiftedAgeDim","ageBars","slice","entityBars","exit","remove","barHeight","oneBarHeight","firstBarOffsetY","merge","sideBars","r","activeProfile","centerWidth","stackBars","highlighted","mouseover","mouseout","click","onTap","tap","order","transition","ease","easeLinear","interrupt","_setYear","formatDate","timeValue","formattedTime","isTouchDevice","highlightMarker","clearHighlighted","selectMarker","event","stopPropagation","someHighlighted","highlight","_showLabel","formatter","format","label","bar","textData","label_age","getValueMD","presentationProfileChanges","medium","margin","right","bottom","infoElHeight","large","top","profiles","small","titlesSpacing","getActiveProfile","parseInt","warn","maxRange","scale","tickValues","tickSizeInner","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","toolMargin","limitMaxTickNumber","translateX","rangePoints","zeroTickEl","empty","zeroTickWidth","tickNodes","nodes","titleBBox","t","transform","hTranslate","translateY","OPACITY_HIGHLT_DIM","opacityHighlightDim","OPACITY_SELECT","opacityRegular","OPACITY_REGULAR","OPACITY_SELECT_DIM","opacitySelectDim","isHighlighted","isSelected"],"mappings":"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","file":"barchart-ds.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 4);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n__webpack_require__(2);\n\nvar _component = __webpack_require__(1);\n\nvar _component2 = _interopRequireDefault(_component);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar VERSION_INFO = { version: \"1.0.8\", build: 1503504728251 };\n\n//BAR CHART TOOL\nvar BarChartDS = Vizabi.Tool.extend(\"BarChartDS\", {\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init: function init(placeholder, external_model) {\n\n    this.name = \"barchartds\";\n\n    //specifying components\n    this.components = [{\n      component: _component2.default,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"state.marker_order\", \"state.entities\", \"state.entities_side\", \"state.entities_allpossible\", \"state.entities_geodomain\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n  validate: function validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    //validate on first model set only\n    if (!this.model) {\n      var entities = model.state.entities;\n      if (Object.keys(entities.show).length > 0) {\n        var show = {};\n        if (entities.show[entities.dim] && Object.keys(entities.show).length !== 1) {\n          show[entities.dim] = entities.show[entities.dim];\n        }\n        if (!entities.show[entities.dim] || !(Object.keys(entities.show).length == 1)) {\n          entities.show = show;\n        }\n      }\n\n      var entities_geodomain = model.state.entities_geodomain;\n      entities_geodomain.skipFilter = model.state.entities.dim === entities_geodomain.dim || model.state.entities_side.dim === entities_geodomain.dim || model.state.entities_age.dim === entities_geodomain.dim;\n    }\n  },\n\n\n  default_model: {\n    state: {\n      marker_tags: {}\n    },\n    ui: {\n      chart: {\n        stacked: true,\n        inpercent: false,\n        flipSides: true\n      },\n      \"buttons\": [\"colors\", \"inpercent\", \"find\", \"side\", \"moreoptions\", \"fullscreen\"],\n      \"dialogs\": {\n        \"popup\": [\"timedisplay\", \"colors\", \"find\", \"side\", \"moreoptions\"],\n        \"sidebar\": [\"timedisplay\", \"colors\", \"find\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"colors\", \"side\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    },\n    locale: {}\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexports.default = BarChartDS;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar _Vizabi = Vizabi,\n    utils = _Vizabi.utils,\n    Component = _Vizabi.Component,\n    axisSmart = _Vizabi.helpers[\"d3.axisWithLabelPicker\"],\n    iconQuestion = _Vizabi.iconset.question;\n\n// POP BY AGE CHART COMPONENT\n\nvar BarChartDS = Component.extend(\"barchartds\", {\n\n  /**\n   * Initializes the component (Bar Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init: function init(config, context) {\n    this.name = \"barchartds\";\n    this.template = __webpack_require__(3);\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"model\"\n    }, {\n      name: \"marker_order\",\n      type: \"model\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"entities_side\",\n      type: \"entities\"\n    }, {\n      name: \"entities_allpossible\",\n      type: \"entities\"\n    }, {\n      name: \"entities_geodomain\",\n      type: \"entities\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    var _this = this;\n    this.model_binds = {\n      \"change:time.value\": function changeTimeValue(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.step != 1 && !_this.snapped && !_this.model.time.playing && !_this.model.time.dragging) {\n          var next = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          if (next != 0 && _this.timeSteps[next] - _this.model.time.value) {\n            _this.snapped = true;\n            var time = _this.model.time.value;\n            var prev = _this.timeSteps[next - 1];\n            next = _this.timeSteps[next];\n            var snapTime = time - prev < next - time ? prev : next;\n            _this.model.time.value = new Date(snapTime);\n          }\n        }\n        if (!_this.snapped) {\n          //          if (_this.timeSteps.filter(t => (t - _this.model.time.value) == 0).length) {\n          _this.model.marker.getFrame(_this.model.time.value, function (frame) {\n            _this.frame = frame;\n            _this.frameAxisX = frame.axis_x;\n            _this.model.marker_order.getFrame(_this.model.time.value, function (frameOrder) {\n              _this.frameOrder = frameOrder.hook_order;\n\n              _this._reorderBars();\n              _this._updateEntities(true);\n              _this.updateBarsOpacity();\n            });\n          });\n          // } else {\n          //   const nextIndex = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          //   const prevFrameTime = _this.timeSteps[nextIndex - 1];\n          //   const nextFrameTime = _this.timeSteps[nextIndex];\n          //   const fraction = (_this.model.time.value - prevFrameTime) / (nextFrameTime - prevFrameTime);\n          //   _this.model.marker.getFrame(nextFrameTime, nValues => {\n          //     _this.model.marker.getFrame(prevFrameTime, pValues => {\n          //       _this.frameAxisX = _this.interpolateDiagonal(pValues.axis_x, nValues.axis_x, fraction);\n          //       _this._updateEntities();\n          //       _this.updateBarsOpacity();\n          //     });\n          //   });\n          // }\n        }\n        _this.snapped = false;\n      },\n      \"change:marker\": function changeMarker(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n      },\n      \"change:marker.select\": function changeMarkerSelect(evt) {\n        _this.someSelected = _this.model.marker.select.length > 0;\n        _this.nonSelectedOpacityZero = false;\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.highlight\": function changeMarkerHighlight(evt, path) {\n        if (!_this._readyOnce) return;\n        _this._highlightBars();\n      },\n      \"change:marker.opacitySelectDim\": function changeMarkerOpacitySelectDim() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.opacityRegular\": function changeMarkerOpacityRegular() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.color.palette\": function changeMarkerColorPalette(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.scaleType\": function changeMarkerColorScaleType(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.which\": function changeMarkerColorWhich(evt) {\n        if (!_this._readyOnce) return;\n        var stackDim = void 0;\n        var show = {};\n        if (_this.model.marker.color.use == \"constant\") {\n          stackDim = null;\n        } else {\n          var colorConcept = _this.model.marker.color.getConceptprops();\n          if (colorConcept.concept_type == \"entity_set\") {\n            stackDim = colorConcept.domain;\n            show[\"is--\" + _this.model.marker.color.which] = true;\n            var sideConcept = _this.model.marker.side.getConceptprops();\n            if (sideConcept.concept_type == \"entity_set\" && stackDim == sideConcept.domain && _this.model.marker.side.which !== _this.model.marker.color.which) {\n              _this.model.marker.side.setWhich({ \"concept\": _this.model.marker.color.which });\n            }\n          } else {\n            stackDim = _this.model.marker.color.which;\n          }\n        }\n        _this.model.entities_geodomain.skipFilter = stackDim === _this.geoDomainDimension || _this.SIDEDIM === _this.geoDomainDimension;\n        _this.model.entities.set(\"show\", show);\n        _this.model.entities.set(\"dim\", stackDim);\n        _this.model.entities_allpossible.set(\"dim\", _this.model.marker.color.which);\n      },\n      \"change:marker.side.which\": function changeMarkerSideWhich(evt) {\n        if (!_this._readyOnce) return;\n        var sideDim = void 0;\n        if (_this.model.marker.side.use == \"constant\") {\n          sideDim = null;\n        } else {\n          var sideConcept = _this.model.marker.side.getConceptprops();\n          if (sideConcept.concept_type == \"entity_set\") {\n            sideDim = sideConcept.domain;\n            var colorConcept = _this.model.marker.color.getConceptprops();\n            if (colorConcept.concept_type == \"entity_set\" && sideDim == colorConcept.domain && _this.model.marker.color.which !== _this.model.marker.side.which) {\n              _this.model.marker.color.setWhich({ \"concept\": _this.model.marker.side.which });\n            }\n          } else {\n            sideDim = _this.model.marker.side.which;\n          }\n        }\n        //        const sideDim = _this.model.marker.side.use == \"constant\" ? null : _this.model.marker.side.which;\n        _this.model.entities_geodomain.skipFilter = sideDim === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension;\n        _this.model.marker.side.clearSideState();\n        _this.model.entities_side.clearShow();\n        _this.model.entities_side.set(\"dim\", sideDim);\n      },\n      \"change:entities.show\": function changeEntitiesShow(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.entities.dim === _this.model.entities_side.dim && !utils.isEmpty(_this.model.entities.show) && _this.model.entities.show[_this.model.entities.dim] && !utils.isEmpty(_this.model.entities_side.show)) {\n          utils.forEach(_this.model.entities_side.getFilteredEntities(), function (s) {\n            if (!_this.model.entities.isShown(s)) {\n              _this.model.marker.side.clearSideState();\n              _this.model.entities_side.showEntity(s);\n            }\n          });\n        }\n      },\n      \"change:entities_side.show\": function changeEntities_sideShow(evt) {\n        if (!_this._readyOnce) return;\n\n        var doReturn = false;\n        var _entitiesSameDimWithSide = null;\n        utils.forEach(_this.model.marker.side._space, function (h) {\n          if (h.dim === _this.model.entities_side.dim && h._name !== _this.model.entities_side._name && h._name !== _this.model.entities_geodomain._name) {\n            _entitiesSameDimWithSide = h;\n          }\n        });\n        if (_entitiesSameDimWithSide && !utils.isEmpty(_entitiesSameDimWithSide.show) && _entitiesSameDimWithSide.show[_entitiesSameDimWithSide.dim]) {\n          utils.forEach(_this.model.entities_side.getFilteredEntities(), function (s) {\n            if (!_entitiesSameDimWithSide.isShown(s)) {\n              _entitiesSameDimWithSide.showEntity(s);\n              doReturn = true;\n            }\n          });\n        }\n        if (doReturn) return;\n\n        _this._updateIndicators();\n        if (!_this.model.ready || !_this.frame) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.inpercent\": function changeUiChartInpercent(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.flipSides\": function changeUiChartFlipSides(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.side.switchSideState();\n        _this._updateIndicators();\n        _this.resize();\n        _this._updateEntities();\n      }\n    };\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.xAxisLeft = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n    this.xScales = [];\n    //this.SHIFTEDAGEDIM = \"s_age\";\n\n    this.totalFieldName = \"Total\";\n  },\n\n\n  // afterPreload: function() {\n  //   var obj = {};\n  //   obj[\"which\"] = this.model.marker.axis_x.which;\n  //   obj[\"use\"] = this.model.marker.axis_x.use;\n  //   this.model.marker_side.hook_total.set(obj);\n  // },\n\n  checkDimensions: function checkDimensions() {\n    var stackDim = this.model.entities.dim;\n    var sideDim = this.model.entities_side.dim;\n\n    this.colorUseNotProperty = this.model.marker.color.use == \"constant\" || this.model.marker.color.use == \"indicator\";\n    this.stackSkip = this.colorUseNotProperty || stackDim == sideDim;\n    this.geoLess = stackDim !== this.geoDomainDimension && sideDim !== this.geoDomainDimension && this.AGEDIM !== this.geoDomainDimension;\n    this.sideSkip = this.model.marker.side.use == \"constant\";\n  },\n\n\n  /**\n   * DOM is ready\n   */\n  readyOnce: function readyOnce() {\n    var _this = this;\n    this.el = this.el ? this.el : d3.select(this.element);\n    this.element = this.el;\n\n    this.interaction = this._interaction();\n\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisEl = this.graph.select(\".vzb-bc-axis-y\");\n    this.xAxisEl = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisLeftEl = this.graph.select(\".vzb-bc-axis-x-left\");\n    this.xTitleEl = this.element.select(\".vzb-bc-axis-x-title\");\n    this.xInfoEl = this.element.select(\".vzb-bc-axis-x-info\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.barsCrop = this.graph.select(\".vzb-bc-bars-crop\");\n    this.labelsCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bars = this.graph.select(\".vzb-bc-bars\");\n    this.labels = this.graph.select(\".vzb-bc-labels\");\n    this.labels.select(\".vzb-bc-age\").attr(\"y\", -10);\n\n    this.title = this.element.select(\".vzb-bc-title\");\n    this.titleRight = this.element.select(\".vzb-bc-title-right\");\n    this.year = this.element.select(\".vzb-bc-year\");\n\n    this.geoDomainDimension = this.model.entities_geodomain.getDimension();\n    this.geoDomainDefaultValue = this.model.entities_geodomain.show[this.geoDomainDimension][\"$in\"][0];\n\n    _this.someSelected = _this.model.marker.select.length > 0;\n    _this.nonSelectedOpacityZero = false;\n\n    this.on(\"resize\", function () {\n      _this._updateEntities();\n    });\n\n    this._attributeUpdaters = {\n      _newWidth: function _newWidth(d, i) {\n        d[\"x_\"] = 0;\n        var width = void 0;\n        if (_this.geoLess && _this.stackSkip && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.geoLess && _this.stackSkip) {\n          width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? (_this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue] : 0;\n        } else if (_this.geoLess && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.stackSkip) {\n          width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? _this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : 0;\n        } else if (_this.sideSkip) {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]];\n        } else {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]];\n        }\n        d[\"width_\"] = width ? _this.xScale(width) : 0;\n        if (_this.ui.chart.inpercent) {\n          d[\"width_\"] /= _this.total[d[_this.PREFIXEDSIDEDIM]];\n        }\n        return d.width_;\n      },\n      _newX: function _newX(d, i) {\n        var prevSbl = this.previousSibling;\n        if (prevSbl) {\n          var prevSblDatum = d3.select(prevSbl).datum();\n          d[\"x_\"] = prevSblDatum.x_ + prevSblDatum.width_;\n        } else {\n          d[\"x_\"] = 0;\n        }\n        return d.x_;\n      }\n    };\n  },\n\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready: function ready() {\n    var _this2 = this;\n\n    //TODO: get component ready if some submodel doesn't ready ??????\n    if (!this.model.marker._ready) return;\n\n    var _this = this;\n\n    this.timeSteps = this.model.time.getAllSteps();\n\n    this.shiftScale = d3.scaleLinear().domain([this.timeSteps[0], this.timeSteps[this.timeSteps.length - 1]]).range([0, this.timeSteps.length - 1]);\n\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.side = this.model.marker.label_side.getEntity();\n    this.SIDEDIM = this.side.getDimension();\n    this.PREFIXEDSIDEDIM = \"side_\" + this.SIDEDIM;\n    this.stack = this.model.marker.label_stack.getEntity();\n    this.STACKDIM = this.stack.getDimension() || this.model.marker.color.which;\n    this.PREFIXEDSTACKDIM = \"stack_\" + this.STACKDIM;\n    this.age = this.model.marker.axis_y.getEntity();\n    this.AGEDIM = this.SHIFTEDAGEDIM = this.age.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n    this.groupBy = this.age.grouping || 1;\n    this.checkDimensions();\n    this.updateUIStrings();\n    this._updateIndicators();\n\n    this.frame = null;\n    this.model.marker.getFrame(_this.model.time.value, function (frame) {\n      _this.frame = frame;\n      _this.frameAxisX = frame.axis_x;\n      _this.model.marker_order.getFrame(_this.model.time.value, function (frameOrder) {\n        _this.frameOrder = frameOrder.hook_order;\n        _this._createLimits();\n        _this._updateLimits();\n\n        _this._reorderBars();\n        _this.markers = _this2.model.marker.getKeys(_this.AGEDIM);\n\n        _this.resize();\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n      });\n    });\n  },\n  updateUIStrings: function updateUIStrings() {\n    var _this = this;\n    this.translator = this.model.locale.getTFunction();\n\n    var xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-treemenu\").markerID(\"axis_x\").alignX(_this.model.locale.isRTL() ? \"right\" : \"left\").alignY(\"top\").updateView().toggle();\n    });\n\n    var conceptPropsX = this.model.marker.axis_x.getConceptprops();\n    utils.setIcon(this.xInfoEl, iconQuestion).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\").style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n    this.xInfoEl.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function () {\n      if (_this.model.time.dragging) return;\n      var rect = this.getBBox();\n      var coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      var toolRect = _this.root.element.getBoundingClientRect();\n      var chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", function () {\n      if (_this.model.time.dragging) return;\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n    // var titleStringY = this.model.marker.axis_y.getConceptprops().name;\n\n    // var yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    // yTitle.enter().append(\"text\");\n    // yTitle\n    //   .attr(\"y\", \"-6px\")\n    //   .attr(\"x\", \"-9px\")\n    //   .attr(\"dx\", \"-0.72em\")\n    //   .text(titleStringY);\n  },\n\n\n  /**\n   * Changes labels for indicators\n   */\n  _updateIndicators: function _updateIndicators() {\n    var _this3 = this;\n\n    var _this = this;\n    this.duration = this.model.time.delayAnimations;\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n    this.xAxisLeft.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n\n    var sideDim = this.SIDEDIM;\n    var stackDim = this.STACKDIM;\n    var ageDim = this.AGEDIM;\n    var groupBy = this.groupBy;\n\n    var ages = this.model.marker.getKeys(ageDim);\n    var ageKeys = [];\n    ageKeys = ages.map(function (m) {\n      return m[ageDim];\n    });\n    this.shiftedAgeKeys = this.ageKeys = ageKeys;\n\n    //this.shiftedAgeKeys = this.timeSteps.map((m, i) => -i * groupBy).slice(1).reverse().concat(ageKeys);\n\n    var sideItems = this.model.marker.label_side.getItems();\n    //var sideKeys = Object.keys(sideItems);\n    var sideKeys = [];\n    if (!utils.isEmpty(sideItems)) {\n      var sideFiltered = !!this.model.marker.side.getEntity().show[sideDim];\n      var sides = this.model.marker.getKeys(sideDim).filter(function (f) {\n        return !sideFiltered || _this3.model.marker.side.getEntity().isShown(f);\n      });\n      sideKeys = sides.map(function (m) {\n        return m[sideDim];\n      });\n\n      if (sideKeys.length > 2) sideKeys.length = 2;\n      if (sideKeys.length > 1) {\n        var sortFunc = this.ui.chart.flipSides ? d3.ascending : d3.descending;\n        sideKeys.sort(sortFunc);\n      }\n    }\n    if (!sideKeys.length) sideKeys.push(\"undefined\");\n    this.sideKeys = sideKeys;\n\n    var stacks = this.model.marker.color.use == \"indicator\" ? [] : this.model.marker.getKeys(stackDim);\n    var stackKeys = utils.without(stacks.map(function (m) {\n      if (m[stackDim] == _this.totalFieldName) _this.dataWithTotal = true;\n      return m[stackDim];\n    }), this.totalFieldName);\n\n    var sortedStackKeys = utils.keys(this.model.marker.color.getPalette()).reduce(function (arr, val) {\n      if (stackKeys.indexOf(val) != -1) arr.push(val);\n      return arr;\n    }, []);\n\n    if (sortedStackKeys.length != stackKeys.length) {\n      sortedStackKeys = stackKeys.reduce(function (arr, val) {\n        if (arr.indexOf(val) == -1) arr.push(val);\n        return arr;\n      }, sortedStackKeys);\n    }\n    this.stackKeys = sortedStackKeys;\n    this.stackItems = this.model.marker.label_stack.getItems();\n\n    this.stacked = this.ui.chart.stacked && this.model.marker.color.use != \"constant\" && this.stack.getDimension();\n\n    this.twoSided = this.sideKeys.length > 1;\n    this.titleRight.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.xScaleLeft = this.xScale.copy();\n      this.title.text(sideItems[this.sideKeys[1]]);\n      this.titleRight.text(sideItems[this.sideKeys[0]]);\n    } else {\n      var title = this.sideKeys.length && sideItems[this.sideKeys[0]] ? sideItems[this.sideKeys[0]] : \"\";\n      this.title.text(title);\n    }\n\n    this.cScale = this.model.marker.color.getScale();\n  },\n  _reorderBars: function _reorderBars() {\n    var _this = this;\n    var domain = this.yScale.domain();\n    var sideKeys = this.sideKeys;\n    domain.sort(function (a, b) {\n      var result = d3.ascending(_this.frameOrder[a] || 0, _this.frameOrder[b] || 0);\n      return result !== 0 ? result : d3.ascending(_this.frameAxisX[sideKeys[0]][a] || 0, _this.frameAxisX[sideKeys[0]][b] || 0);\n    });\n    this.yScale.domain(domain);\n  },\n  _createLimits: function _createLimits() {\n    var _this = this;\n    var axisX = this.model.marker.axis_x;\n\n    //const sideKeysNF = Object.keys(this.model.marker.side.getItems());\n    var sideKeysNF = Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));\n    if (!sideKeysNF.length) sideKeysNF.push(\"undefined\");\n\n    var keys = this.stackSkip && this.sideSkip ? [] : this.sideSkip ? [this.STACKDIM] : this.stackSkip ? [this.SIDEDIM] : [this.STACKDIM, this.SIDEDIM];\n    var limits = axisX.getLimitsByDimensions(keys.concat([this.AGEDIM, this.TIMEDIM]));\n    var timeKeys = axisX.getUnique();\n    var totals = {};\n    var inpercentMaxLimits = {};\n    var maxLimits = {};\n    sideKeysNF.forEach(function (s) {\n      maxLimits[s] = [];\n      inpercentMaxLimits[s] = [];\n    });\n\n    if (_this.stackSkip && _this.sideSkip) {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        var ageSum = 0;\n        var sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, function (age) {\n          var stackSum = 0;\n          if (limits[age] && limits[age][time]) {\n            stackSum += limits[age][time].max;\n            ageSum += stackSum;\n          }\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.sideSkip) {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        var ageSum = 0;\n        var sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, function (age) {\n          var stackSum = 0;\n          utils.forEach(_this.stackKeys, function (stack) {\n            if (limits[stack] && limits[stack][age] && limits[stack][age][time]) {\n              stackSum += limits[stack][age][time].max;\n              ageSum += stackSum;\n            }\n          });\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.stackSkip) {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, function (side) {\n          var ageSum = 0;\n          var sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, function (age) {\n            var stackSum = 0;\n            if (limits[side] && limits[side][age] && limits[side][age][time]) {\n              stackSum += limits[side][age][time].max;\n              ageSum += stackSum;\n            }\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    } else {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, function (side) {\n          var ageSum = 0;\n          var sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, function (age) {\n            var stackSum = 0;\n            utils.forEach(_this.stackKeys, function (stack) {\n              if (limits[stack][side] && limits[stack][side][age] && limits[stack][side][age][time]) {\n                stackSum += limits[stack][side][age][time].max;\n                ageSum += stackSum;\n              }\n            });\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    }\n\n    this.maxLimits = {};\n    this.inpercentMaxLimits = {};\n    sideKeysNF.forEach(function (s) {\n      _this.maxLimits[s] = Math.max.apply(Math, _toConsumableArray(maxLimits[s]));\n      _this.inpercentMaxLimits[s] = Math.max.apply(Math, _toConsumableArray(inpercentMaxLimits[s]));\n    });\n    this.totals = totals;\n  },\n  _updateLimits: function _updateLimits() {\n    var _this = this;\n    var axisX = this.model.marker.axis_x;\n    var zero = axisX.scaleType == \"log\" ? 0.01 : 0;\n    var domain = void 0;\n    if (this.ui.chart.inpercent) {\n      domain = [zero * 0.01, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n        return _this.inpercentMaxLimits[s];\n      })))];\n    } else {\n      domain = axisX.domainMin != null && axisX.domainMax != null ? [+axisX.domainMin, +axisX.domainMax] : [zero, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n        return _this.maxLimits[s];\n      })))];\n    }\n    this.xScale.domain(domain);\n    if (this.xScaleLeft) this.xScaleLeft.domain(this.xScale.domain());\n  },\n  _interpolateBetweenTotals: function _interpolateBetweenTotals(timeSteps, totals, time) {\n    var nextStep = d3.bisectLeft(timeSteps, time);\n    var fraction = (time - timeSteps[nextStep - 1]) / (timeSteps[nextStep] - timeSteps[nextStep - 1]);\n    var total = {};\n    utils.forEach(this.sideKeys, function (side) {\n      total[side] = totals[timeSteps[nextStep]][side] * fraction + totals[timeSteps[nextStep - 1]][side] * (1 - fraction);\n    });\n    return total;\n  },\n\n\n  /**\n   * Updates entities\n   */\n  _updateEntities: function _updateEntities(reorder) {\n\n    var _this = this;\n    var time = this.model.time;\n    var sideDim = this.SIDEDIM;\n    var prefixedSideDim = this.PREFIXEDSIDEDIM;\n    var ageDim = this.AGEDIM;\n    var stackDim = this.STACKDIM;\n    var prefixedStackDim = this.PREFIXEDSTACKDIM;\n    var timeDim = this.TIMEDIM;\n    var duration = time.playing ? time.delayAnimations : 0;\n    var total = void 0;\n\n    var groupBy = this.groupBy;\n    //var group_offset = this.model.marker.group_offset ? Math.abs(this.model.marker.group_offset % groupBy) : 0;\n\n    if (this.ui.chart.inpercent) {\n      this.total = this.totals[time.value] ? this.totals[time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals, time.value);\n    }\n\n    var domain = this.yScale.domain();\n\n    //this.model.age.setVisible(markers);\n\n    //const nextStep = d3.bisectLeft(this.timeSteps, time.value);\n\n    var shiftedAgeDim = this.SHIFTEDAGEDIM;\n\n    //   const markers = this.markers.map(data => {\n    //       const o = {};\n    //   o[ageDim] = o[shiftedAgeDim] = +data[ageDim];\n    //   o[ageDim] -= nextStep * groupBy;\n    //   return o;\n    // });\n\n    var ageBars = this.markers.slice(0);\n\n    // const outAge = {};\n    // outAge[shiftedAgeDim] = markers.length * groupBy;\n    // outAge[ageDim] = outAge[shiftedAgeDim] - nextStep * groupBy;\n\n    //this.ageShift = 0;//= nextStep * groupBy;\n\n    // if (nextStep) ageBars.push(outAge);\n\n    this.entityBars = this.bars.selectAll(\".vzb-bc-bar\").data(ageBars, function (d) {\n      return d[ageDim];\n    });\n    //exit selection\n    this.entityBars.exit().remove();\n\n    var oneBarHeight = this.oneBarHeight;\n    var barHeight = this.barHeight;\n    var firstBarOffsetY = this.firstBarOffsetY;\n\n    //enter selection -- init bars\n    this.entityBars = this.entityBars.enter().append(\"g\").attr(\"class\", function (d) {\n      return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim];\n    }\n    //  .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - groupBy) * oneBarHeight) + \")\")\n    ).attr(\"transform\", function (d, i) {\n      return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\";\n    }).merge(this.entityBars);\n\n    // this.entityBars.attr(\"class\", function(d) {\n    //     return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim];\n    //   })\n\n\n    this.sideBars = this.entityBars.selectAll(\".vzb-bc-side\").data(function (d) {\n      return _this.sideKeys.map(function (m) {\n        var r = {};\n        r[ageDim] = d[ageDim];\n        r[shiftedAgeDim] = d[shiftedAgeDim];\n        r[prefixedSideDim] = m;\n        r[sideDim] = m;\n        return r;\n      });\n    }, function (d) {\n      return d[prefixedSideDim];\n    });\n\n    this.sideBars.exit().remove();\n    this.sideBars = this.sideBars.enter().append(\"g\").attr(\"class\", function (d, i) {\n      return \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\");\n    }).merge(this.sideBars);\n\n    if (reorder) {\n      this.sideBars.attr(\"transform\", function (d, i) {\n        return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n      });\n    }\n\n    var _attributeUpdaters = this._attributeUpdaters;\n\n    this.stackBars = this.sideBars.selectAll(\".vzb-bc-stack\").data(function (d, i) {\n      var stacks = _this.stacked ? _this.stackKeys : [_this.totalFieldName];\n      return stacks.map(function (m) {\n        var r = {};\n        r[ageDim] = d[ageDim];\n        r[shiftedAgeDim] = d[shiftedAgeDim];\n        r[sideDim] = d[sideDim];\n        r[stackDim] = m;\n        r[prefixedSideDim] = d[prefixedSideDim];\n        r[prefixedStackDim] = m;\n        return r;\n      });\n    }, function (d) {\n      return d[prefixedStackDim];\n    });\n\n    this.stackBars.exit().remove();\n    this.stackBars = this.stackBars.enter().append(\"rect\").attr(\"class\", function (d, i) {\n      return \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\");\n    }).attr(\"y\", 0).attr(\"height\", barHeight).attr(\"fill\", function (d) {\n      return _this.cScale(_this.colorUseNotProperty ? _this.frame.color[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : d[prefixedStackDim]);\n    }).attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX).on(\"mouseover\", _this.interaction.mouseover).on(\"mouseout\", _this.interaction.mouseout).on(\"click\", _this.interaction.click).onTap(_this.interaction.tap).merge(this.stackBars);\n\n    if (reorder) this.stackBars.attr(\"fill\", function (d) {\n      return _this.cScale(_this.colorUseNotProperty ? _this.frame.color[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : d[prefixedStackDim]);\n    }).order();\n\n    var stepShift = ageBars[0][shiftedAgeDim] - ageBars[0][ageDim] - this.shiftScale(time.value) * groupBy;\n\n    if (duration) {\n      var transition = d3.transition().duration(duration).ease(d3.easeLinear);\n\n      this.entityBars\n      //.transition(transition)\n      .attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\";\n      });\n      //        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\");\n      this.stackBars.transition(transition).attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX);\n    } else {\n      this.entityBars.interrupt().attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\";\n      });\n      //        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\");\n      this.stackBars.interrupt().attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX);\n    }\n\n    // this.entityLabels = this.labels.selectAll(\".vzb-bc-label\")\n    //   .data(this.markers, d => d[ageDim]);\n    // //exit selection\n    // this.entityLabels.exit().remove();\n\n    // const entityLabels = this.entityLabels.enter().append(\"g\")\n    //   .attr(\"class\", \"vzb-bc-label\")\n    //   .attr(\"id\", d => \"vzb-bc-label-\" + d[shiftedAgeDim] + \"-\" + _this._id)\n    // entityLabels.append(\"text\")\n    //   .attr(\"class\", \"vzb-bc-age\")\n    //   .attr(\"y\", (d, i) => firstBarOffsetY - _this.yScale(d[shiftedAgeDim]) - 10);\n\n    // this.entityLabels = entityLabels.merge(this.entityLabels);\n    // // .style(\"fill\", function(d) {\n    // //   var color = _this.cScale(values.color[d[ageDim]]);\n    // //   return d3.rgb(color).darker(2);\n    // // });\n\n    // if (reorder) this.entityLabels.selectAll(\".vzb-bc-age\").attr(\"y\", (d, i) => firstBarOffsetY - _this.yScale(d[shiftedAgeDim]) - 10);\n\n    if (duration) {\n      this.year.transition().duration(duration).ease(d3.easeLinear).on(\"end\", this._setYear(time.value));\n    } else {\n      this.year.interrupt().text(time.formatDate(time.value)).transition();\n    }\n  },\n  _setYear: function _setYear(timeValue) {\n    var formattedTime = this.model.time.formatDate(timeValue);\n    return function () {\n      d3.select(this).text(formattedTime);\n    };\n  },\n  _interaction: function _interaction() {\n    var _this = this;\n    return {\n      mouseover: function mouseover(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.highlightMarker(d);\n        //_this._showLabel(d);\n      },\n      mouseout: function mouseout(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n      },\n      click: function click(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.selectMarker(d);\n      },\n      tap: function tap(d) {\n        d3.event.stopPropagation();\n        _this.model.marker.selectMarker(d);\n      }\n    };\n  },\n  _highlightBars: function _highlightBars(d) {\n    var _this = this;\n\n    _this.someHighlighted = _this.model.marker.highlight.length > 0;\n\n    _this.updateBarsOpacity();\n\n    if (!_this.someHighlighted) {\n      //hide labels\n      _this.labels.selectAll(\".vzb-hovered\").classed(\"vzb-hovered\", false);\n    } else {\n      _this._showLabel(_this.model.marker.highlight[0]);\n    }\n  },\n  _showLabel: function _showLabel(d) {\n    var _this = this;\n    var formatter = _this.ui.chart.inpercent ? d3.format(\".1%\") : _this.model.marker.axis_x.getTickFormatter();\n    var sideDim = _this.SIDEDIM;\n    var ageDim = _this.AGEDIM;\n    var stackDim = _this.STACKDIM;\n    var KEYS = this.KEYS;\n\n    var left = _this.sideKeys.indexOf(d[sideDim]);\n    var label = _this.labels.select(\".vzb-bc-label\");\n    var bar = _this.bars.select(\".vzb-bc-bar-\" + d[ageDim]);\n    //const label = _this.labels.select(\"#vzb-bc-label-\" + d[ageDim] + \"-\" + _this._id);\n    label.attr(\"transform\", bar.attr(\"transform\")).select(\".vzb-bc-age\").text(function (textData) {\n      //var total = _this.ui.chart.inpercent ? _this.totalValues[d[sideDim]] : 1;\n      var text = _this.stackKeys.length > 1 ? _this.stackItems[d[stackDim]] : _this.frame.label_age[d[ageDim]];\n      text = _this.twoSided ? text : text + \" \" + _this.stackItems[d[stackDim]];\n      var value = utils.getValueMD(d, _this.frameAxisX, KEYS); //_this.xScale.invert(d[\"width_\"]);\n      //var value = (_this.dataWithTotal || _this.stacked) ? _this.values1.axis_x[d[shiftedAgeDim]][d[sideDim]][d[stackDim]] / total : _this.xScale.invert(d[\"width_\"]);\n      return text + \": \" + formatter(value);\n    }).attr(\"x\", (left ? -1 : 1) * (_this.activeProfile.centerWidth * 0.5 + 7)).classed(\"vzb-text-left\", left);\n\n    label.classed(\"vzb-hovered\", true);\n  },\n\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n\n  presentationProfileChanges: {\n    medium: {\n      margin: { right: 80, bottom: 80 },\n      infoElHeight: 32\n    },\n    large: {\n      margin: { top: 100, right: 100, left: 100, bottom: 80 },\n      infoElHeight: 32\n    }\n  },\n\n  profiles: {\n    \"small\": {\n      margin: {\n        top: 70,\n        right: 20,\n        left: 40,\n        bottom: 40\n      },\n      infoElHeight: 16,\n      centerWidth: 2,\n      titlesSpacing: 5\n    },\n    \"medium\": {\n      margin: {\n        top: 80,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 20,\n      centerWidth: 2,\n      titlesSpacing: 10\n    },\n    \"large\": {\n      margin: {\n        top: 100,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 22,\n      centerWidth: 2,\n      titlesSpacing: 20\n    }\n  },\n\n  resize: function resize() {\n\n    var _this = this;\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    //this.activeProfile = this.profiles[this.getLayoutProfile()];\n    var margin = this.activeProfile.margin;\n    var infoElHeight = this.activeProfile.infoElHeight;\n\n    //stage\n    this.height = parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom || 0;\n    this.width = parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right || 0;\n\n    if (this.height <= 0 || this.width <= 0) return utils.warn(\"Pop by age resize() abort: vizabi container is too little or has display:none\");\n\n    this.graph.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    this.barsCrop.attr(\"width\", this.width).attr(\"height\", Math.max(0, this.height));\n\n    this.labelsCrop.attr(\"width\", this.width).attr(\"height\", Math.max(0, this.height));\n\n    var groupBy = this.groupBy;\n\n    var domain = this.yScale.domain();\n    this.oneBarHeight = this.model.marker.axis_y.scaleType == \"ordinal\" ? this.height / domain.length : this.height / (domain[1] - domain[0]);\n    var barHeight = this.barHeight = this.oneBarHeight * groupBy; // height per bar is total domain height divided by the number of possible markers in the domain\n    this.firstBarOffsetY = this.height - this.barHeight;\n\n    if (this.stackBars) this.stackBars.attr(\"height\", barHeight);\n\n    if (this.sideBars) this.sideBars.attr(\"transform\", function (d, i) {\n      return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n    });\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n\n    var maxRange = this.twoSided ? (this.width - this.activeProfile.centerWidth) * 0.5 : this.width;\n\n    this.xScale.range([0, maxRange]);\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale).tickValues([]).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width, 0).labelerOptions({\n      scaleType: this.model.marker.axis_y.scaleType,\n      toolMargin: margin,\n      limitMaxTickNumber: 1\n    });\n\n    var format = this.ui.chart.inpercent ? d3.format((groupBy > 3 ? \"\" : \".1\") + \"%\") : this.model.marker.axis_x.getTickFormatter();\n\n    this.xAxis.scale(this.xScale).tickFormat(format).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height, 0).labelerOptions({\n      scaleType: this.model.marker.axis_x.scaleType,\n      toolMargin: margin,\n      limitMaxTickNumber: 6\n    });\n\n    var translateX = this.twoSided ? (this.width + _this.activeProfile.centerWidth) * 0.5 : 0;\n\n    this.xAxisEl.attr(\"transform\", \"translate(\" + translateX + \",\" + this.height + \")\").call(this.xAxis);\n\n    this.yAxisEl.attr(\"transform\", \"translate(\" + 0 + \",0)\").call(this.yAxis);\n    //this.xAxisEl.call(this.xAxis);\n    this.xAxisLeftEl.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n        this.xScaleLeft.range([(this.width - this.activeProfile.centerWidth) * 0.5, 0]);\n      } else {\n        this.xScaleLeft.rangePoints([(this.width - this.activeProfile.centerWidth) * 0.5, 0]).range();\n      }\n\n      this.xAxisLeft.scale(this.xScaleLeft).tickFormat(format).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height, 0).labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6\n      });\n\n      this.xAxisLeftEl.attr(\"transform\", \"translate(0,\" + this.height + \")\").call(this.xAxisLeft);\n      var zeroTickEl = this.xAxisEl.select(\".tick text\");\n      if (!zeroTickEl.empty()) {\n        var zeroTickWidth = zeroTickEl.node().getBBox().width;\n        zeroTickEl.attr(\"dx\", -(this.activeProfile.centerWidth + zeroTickWidth) * 0.5);\n      }\n      this.xAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n\n      //hide left axis zero tick\n      var tickNodes = this.xAxisLeftEl.selectAll(\".tick\").nodes();\n      d3.select(tickNodes[tickNodes.length - 1]).classed(\"vzb-hidden\", true);\n    }\n\n    var isRTL = this.model.locale.isRTL();\n\n    this.bars.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n    this.labels.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n\n    this.title.attr(\"x\", margin.left + (this.twoSided ? translateX - this.activeProfile.titlesSpacing : 0)).style(\"text-anchor\", this.twoSided ? \"end\" : \"\").attr(\"y\", margin.top * 0.7);\n    this.titleRight.attr(\"x\", margin.left + translateX + this.activeProfile.titlesSpacing).attr(\"y\", margin.top * 0.7);\n\n    this.xTitleEl.style(\"font-size\", infoElHeight + \"px\").attr(\"transform\", \"translate(\" + (isRTL ? this.width : margin.left * 0.4) + \",\" + margin.top * 0.4 + \")\");\n    this.xTitleEl.select(\"text\").text(this.model.marker.axis_x.getConceptprops().name);\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      var titleBBox = this.xTitleEl.node().getBBox();\n      var t = utils.transform(this.xTitleEl.node());\n      var hTranslate = isRTL ? titleBBox.x + t.translateX - infoElHeight * 1.4 : titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4;\n\n      this.xInfoEl.select(\"svg\").attr(\"width\", infoElHeight + \"px\").attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\" + hTranslate + \",\" + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this.year.attr(\"x\", this.width + margin.left).attr(\"y\", margin.top * 0.4);\n  },\n  updateBarsOpacity: function updateBarsOpacity(duration) {\n    var _this = this;\n    //if(!duration)duration = 0;\n\n    var OPACITY_HIGHLT = 1.0;\n    var OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    var OPACITY_SELECT = this.model.marker.opacityRegular;\n    var OPACITY_REGULAR = this.model.marker.opacityRegular;\n    var OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.stackBars\n    //.transition().duration(duration)\n    .style(\"opacity\", function (d) {\n\n      if (_this.someHighlighted) {\n        //highlight or non-highlight\n        if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n      }\n\n      if (_this.someSelected) {\n        //selected or non-selected\n        return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n      }\n\n      if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n      return OPACITY_REGULAR;\n    });\n\n    this.stackBars.style(\"stroke\", function (d) {\n      return _this.model.marker.isSelected(d) ? \"#333\" : null;\n    });\n\n    var nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.stackBars.style(\"pointer-events\", function (d) {\n        return !_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d) ? \"visible\" : \"none\";\n      });\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n});\n\nexports.default = BarChartDS;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports) {\n\nmodule.exports = \"<!-- BarChartDS Component -->\\n<svg class=\\\"vzb-barchartds\\\">\\n    <g class=\\\"vzb-bc-header\\\">\\n        <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n        <text class=\\\"vzb-bc-title\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-right\\\"></text>\\n        <text class=\\\"vzb-bc-year\\\"></text>\\n    </g>\\n    <g class=\\\"vzb-bc-graph\\\">\\n\\n        <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n\\n        <g class=\\\"vzb-bc-axis-y\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-bars-crop\\\">\\n            <g class=\\\"vzb-bc-bars\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-x\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x vzb-bc-axis-x-left\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-labels-crop\\\">\\n            <g class=\\\"vzb-bc-labels\\\">\\n                <g class=\\\"vzb-bc-label\\\"><text class=\\\"vzb-bc-age\\\"></text></g>\\n            </g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-labels\\\">\\n            <!-- <text class=\\\"vzb-x_label\\\">Lifespan</text>\\n                  <text class=\\\"vzb-y_label\\\">Lifespan</text> -->\\n        </g>\\n    </g>\\n</svg>\\n\";\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(0);\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// barchart-ds.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4862b932129e86e0f2ec","import \"./styles.scss\";\nimport component from \"./component\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\n//BAR CHART TOOL\nconst BarChartDS = Vizabi.Tool.extend(\"BarChartDS\", {\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"barchartds\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"state.marker_order\", \"state.entities\", \"state.entities_side\", \"state.entities_allpossible\", \"state.entities_geodomain\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n  validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    //validate on first model set only\n    if (!this.model) {\n      const entities = model.state.entities;\n      if (Object.keys(entities.show).length > 0) {\n        const show = {};\n        if (entities.show[entities.dim] && Object.keys(entities.show).length !== 1) {\n          show[entities.dim] = entities.show[entities.dim];\n        }\n        if (!entities.show[entities.dim] || !(Object.keys(entities.show).length == 1)) {\n          entities.show = show;\n        }\n      }\n\n      const entities_geodomain = model.state.entities_geodomain;\n      entities_geodomain.skipFilter = model.state.entities.dim === entities_geodomain.dim ||\n        model.state.entities_side.dim === entities_geodomain.dim || model.state.entities_age.dim === entities_geodomain.dim;\n    }\n  },\n\n  default_model: {\n    state: {\n      marker_tags: {}\n    },\n    ui: {\n      chart: {\n        stacked: true,\n        inpercent: false,\n        flipSides: true\n      },\n      \"buttons\": [\"colors\", \"inpercent\", \"find\", \"side\", \"moreoptions\", \"fullscreen\"],\n      \"dialogs\": {\n        \"popup\": [\"timedisplay\", \"colors\", \"find\", \"side\", \"moreoptions\"],\n        \"sidebar\": [\"timedisplay\", \"colors\", \"find\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"colors\", \"side\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    },\n    locale: { }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexport default BarChartDS;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const {\n  utils,\n  Component,\n  helpers: {\n    \"d3.axisWithLabelPicker\": axisSmart\n  },\n  iconset: {\n    question: iconQuestion\n  },\n} = Vizabi;\n\n// POP BY AGE CHART COMPONENT\nconst BarChartDS = Component.extend(\"barchartds\", {\n\n  /**\n   * Initializes the component (Bar Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n    this.name = \"barchartds\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"model\"\n    }, {\n      name: \"marker_order\",\n      type: \"model\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"entities_side\",\n      type: \"entities\"\n    }, {\n      name: \"entities_allpossible\",\n      type: \"entities\"\n    }, {\n      name: \"entities_geodomain\",\n      type: \"entities\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    const _this = this;\n    this.model_binds = {\n      \"change:time.value\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.step != 1 && !_this.snapped && !_this.model.time.playing && !_this.model.time.dragging) {\n          let next = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          if (next != 0 && (_this.timeSteps[next] - _this.model.time.value)) {\n            _this.snapped = true;\n            const time = _this.model.time.value;\n            const prev = _this.timeSteps[next - 1];\n            next = _this.timeSteps[next];\n            const snapTime = (time - prev) < (next - time) ? prev : next;\n            _this.model.time.value = new Date(snapTime);\n          }\n        }\n        if (!_this.snapped) {\n//          if (_this.timeSteps.filter(t => (t - _this.model.time.value) == 0).length) {\n            _this.model.marker.getFrame(_this.model.time.value, frame => {\n              _this.frame = frame;\n              _this.frameAxisX = frame.axis_x;\n              _this.model.marker_order.getFrame(_this.model.time.value, frameOrder => {\n                _this.frameOrder = frameOrder.hook_order;\n\n                _this._reorderBars();\n                _this._updateEntities(true);\n                _this.updateBarsOpacity();\n              });\n            });\n          // } else {\n          //   const nextIndex = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          //   const prevFrameTime = _this.timeSteps[nextIndex - 1];\n          //   const nextFrameTime = _this.timeSteps[nextIndex];\n          //   const fraction = (_this.model.time.value - prevFrameTime) / (nextFrameTime - prevFrameTime);\n          //   _this.model.marker.getFrame(nextFrameTime, nValues => {\n          //     _this.model.marker.getFrame(prevFrameTime, pValues => {\n          //       _this.frameAxisX = _this.interpolateDiagonal(pValues.axis_x, nValues.axis_x, fraction);\n          //       _this._updateEntities();\n          //       _this.updateBarsOpacity();\n          //     });\n          //   });\n          // }\n        }\n        _this.snapped = false;\n      },\n      \"change:marker\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n      },\n      \"change:marker.select\": function(evt) {\n        _this.someSelected = (_this.model.marker.select.length > 0);\n        _this.nonSelectedOpacityZero = false;\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.highlight\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        _this._highlightBars();\n      },\n      \"change:marker.opacitySelectDim\": function() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.opacityRegular\": function() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.color.palette\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.scaleType\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        let stackDim;\n        const show = {};\n        if (_this.model.marker.color.use == \"constant\") {\n          stackDim = null;\n        } else {\n          const colorConcept = _this.model.marker.color.getConceptprops();\n          if (colorConcept.concept_type == \"entity_set\") {\n            stackDim = colorConcept.domain;\n            show[\"is--\" + _this.model.marker.color.which] = true;\n            const sideConcept = _this.model.marker.side.getConceptprops();\n            if (sideConcept.concept_type == \"entity_set\" && stackDim == sideConcept.domain && _this.model.marker.side.which !== _this.model.marker.color.which) {\n              _this.model.marker.side.setWhich({\"concept\" : _this.model.marker.color.which});\n            }          \n          } else {\n            stackDim = _this.model.marker.color.which;\n          }\n        }\n        _this.model.entities_geodomain.skipFilter = stackDim === _this.geoDomainDimension || _this.SIDEDIM === _this.geoDomainDimension;\n        _this.model.entities.set(\"show\", show);\n        _this.model.entities.set(\"dim\", stackDim);\n        _this.model.entities_allpossible.set(\"dim\", _this.model.marker.color.which);\n      },\n      \"change:marker.side.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        let sideDim;\n        if (_this.model.marker.side.use == \"constant\") {\n          sideDim = null;\n        } else {\n          const sideConcept = _this.model.marker.side.getConceptprops();\n          if (sideConcept.concept_type == \"entity_set\") {\n            sideDim = sideConcept.domain;\n            const colorConcept = _this.model.marker.color.getConceptprops();\n            if (colorConcept.concept_type == \"entity_set\" && sideDim == colorConcept.domain && _this.model.marker.color.which !== _this.model.marker.side.which) {\n              _this.model.marker.color.setWhich({\"concept\" : _this.model.marker.side.which});\n            }          \n          } else {\n            sideDim = _this.model.marker.side.which;\n          }\n        } \n//        const sideDim = _this.model.marker.side.use == \"constant\" ? null : _this.model.marker.side.which;\n        _this.model.entities_geodomain.skipFilter = sideDim === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension;\n        _this.model.marker.side.clearSideState();\n        _this.model.entities_side.clearShow();\n        _this.model.entities_side.set(\"dim\", sideDim);\n      },\n      \"change:entities.show\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.entities.dim === _this.model.entities_side.dim\n          && !utils.isEmpty(_this.model.entities.show)\n          && _this.model.entities.show[_this.model.entities.dim]\n          && !utils.isEmpty(_this.model.entities_side.show)) {\n          utils.forEach(_this.model.entities_side.getFilteredEntities(), s => {\n            if (!_this.model.entities.isShown(s)) {\n              _this.model.marker.side.clearSideState();\n              _this.model.entities_side.showEntity(s);\n            }\n          });\n        }\n      },\n      \"change:entities_side.show\": function(evt) {\n        if (!_this._readyOnce) return;\n\n        let doReturn = false;\n        let _entitiesSameDimWithSide = null;\n        utils.forEach(_this.model.marker.side._space, h => {\n          if (h.dim === _this.model.entities_side.dim && h._name !== _this.model.entities_side._name && h._name !== _this.model.entities_geodomain._name) {\n            _entitiesSameDimWithSide = h;\n          }\n        });\n        if (_entitiesSameDimWithSide && !utils.isEmpty(_entitiesSameDimWithSide.show) && _entitiesSameDimWithSide.show[_entitiesSameDimWithSide.dim]) {\n          utils.forEach(_this.model.entities_side.getFilteredEntities(), s => {\n            if (!_entitiesSameDimWithSide.isShown(s)) {\n              _entitiesSameDimWithSide.showEntity(s);\n              doReturn = true;\n            }\n          });\n        }\n        if (doReturn) return;\n\n        _this._updateIndicators();\n        if (!_this.model.ready || !_this.frame) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.inpercent\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.flipSides\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.side.switchSideState();\n        _this._updateIndicators();\n        _this.resize();\n        _this._updateEntities();\n      }\n    };\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.xAxisLeft = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n    this.xScales = [];\n    //this.SHIFTEDAGEDIM = \"s_age\";\n\n    this.totalFieldName = \"Total\";\n  },\n\n  // afterPreload: function() {\n  //   var obj = {};\n  //   obj[\"which\"] = this.model.marker.axis_x.which;\n  //   obj[\"use\"] = this.model.marker.axis_x.use;\n  //   this.model.marker_side.hook_total.set(obj);\n  // },\n\n  checkDimensions() {\n    const stackDim = this.model.entities.dim;\n    const sideDim = this.model.entities_side.dim;\n\n    this.colorUseNotProperty = this.model.marker.color.use == \"constant\" || this.model.marker.color.use == \"indicator\";\n    this.stackSkip = this.colorUseNotProperty || stackDim == sideDim;\n    this.geoLess = stackDim !== this.geoDomainDimension && sideDim !== this.geoDomainDimension && this.AGEDIM !== this.geoDomainDimension;\n    this.sideSkip = this.model.marker.side.use == \"constant\";\n  },\n\n  /**\n   * DOM is ready\n   */\n  readyOnce() {\n    const _this = this;\n    this.el = (this.el) ? this.el : d3.select(this.element);\n    this.element = this.el;\n\n    this.interaction = this._interaction();\n\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisEl = this.graph.select(\".vzb-bc-axis-y\");\n    this.xAxisEl = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisLeftEl = this.graph.select(\".vzb-bc-axis-x-left\");\n    this.xTitleEl = this.element.select(\".vzb-bc-axis-x-title\");\n    this.xInfoEl = this.element.select(\".vzb-bc-axis-x-info\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.barsCrop = this.graph.select(\".vzb-bc-bars-crop\");\n    this.labelsCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bars = this.graph.select(\".vzb-bc-bars\");\n    this.labels = this.graph.select(\".vzb-bc-labels\");\n    this.labels.select(\".vzb-bc-age\").attr(\"y\", -10);\n\n    this.title = this.element.select(\".vzb-bc-title\");\n    this.titleRight = this.element.select(\".vzb-bc-title-right\");\n    this.year = this.element.select(\".vzb-bc-year\");\n\n    this.geoDomainDimension = this.model.entities_geodomain.getDimension();\n    this.geoDomainDefaultValue = this.model.entities_geodomain.show[this.geoDomainDimension][\"$in\"][0];\n\n    _this.someSelected = (_this.model.marker.select.length > 0);\n    _this.nonSelectedOpacityZero = false;\n\n\n    this.on(\"resize\", () => {\n      _this._updateEntities();\n  });\n\n    this._attributeUpdaters = {\n      _newWidth(d, i) {\n        d[\"x_\"] = 0;\n        let width;\n        if (_this.geoLess && _this.stackSkip && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.geoLess && _this.stackSkip) {\n          width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? (_this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue] : 0;\n        } else if (_this.geoLess && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.stackSkip) {\n          width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? _this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : 0;\n        } else if (_this.sideSkip) {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]];\n        } else {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]];\n        }\n        d[\"width_\"] = width ? _this.xScale(width) : 0;\n        if (_this.ui.chart.inpercent) {\n          d[\"width_\"] /= _this.total[d[_this.PREFIXEDSIDEDIM]];\n        }\n        return d.width_;\n      },\n      _newX(d, i) {\n        const prevSbl = this.previousSibling;\n        if (prevSbl) {\n          const prevSblDatum = d3.select(prevSbl).datum();\n          d[\"x_\"] = prevSblDatum.x_ + prevSblDatum.width_;\n        } else {\n          d[\"x_\"] = 0;\n        }\n        return d.x_;\n      }\n    };\n  },\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready() {\n    //TODO: get component ready if some submodel doesn't ready ??????\n    if (!this.model.marker._ready) return;\n\n    const _this = this;\n\n    this.timeSteps = this.model.time.getAllSteps();\n\n    this.shiftScale = d3.scaleLinear()\n      .domain([this.timeSteps[0], this.timeSteps[this.timeSteps.length - 1]])\n      .range([0, this.timeSteps.length - 1]);\n\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.side = this.model.marker.label_side.getEntity();\n    this.SIDEDIM = this.side.getDimension();\n    this.PREFIXEDSIDEDIM = \"side_\" + this.SIDEDIM;\n    this.stack = this.model.marker.label_stack.getEntity();\n    this.STACKDIM = this.stack.getDimension() || this.model.marker.color.which;\n    this.PREFIXEDSTACKDIM = \"stack_\" + this.STACKDIM;\n    this.age = this.model.marker.axis_y.getEntity();\n    this.AGEDIM = this.SHIFTEDAGEDIM = this.age.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n    this.groupBy = this.age.grouping || 1;\n    this.checkDimensions();\n    this.updateUIStrings();\n    this._updateIndicators();\n\n    this.frame = null;\n    this.model.marker.getFrame(_this.model.time.value, frame => {\n      _this.frame = frame;\n      _this.frameAxisX = frame.axis_x;\n      _this.model.marker_order.getFrame(_this.model.time.value, frameOrder => {\n        _this.frameOrder = frameOrder.hook_order;\n        _this._createLimits();\n        _this._updateLimits();\n  \n        _this._reorderBars();\n        _this.markers = this.model.marker.getKeys(_this.AGEDIM);\n\n        _this.resize();\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n      });\n    });\n  },\n\n  updateUIStrings() {\n    const _this = this;\n    this.translator = this.model.locale.getTFunction();\n\n    const xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"axis_x\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    const conceptPropsX = this.model.marker.axis_x.getConceptprops();\n    utils.setIcon(this.xInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n    this.xInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function() {\n      if (_this.model.time.dragging) return;\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", () => {\n      if (_this.model.time.dragging) return;\n    _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n  });\n\n    // var titleStringY = this.model.marker.axis_y.getConceptprops().name;\n\n    // var yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    // yTitle.enter().append(\"text\");\n    // yTitle\n    //   .attr(\"y\", \"-6px\")\n    //   .attr(\"x\", \"-9px\")\n    //   .attr(\"dx\", \"-0.72em\")\n    //   .text(titleStringY);\n  },\n\n  /**\n   * Changes labels for indicators\n   */\n  _updateIndicators() {\n    const _this = this;\n    this.duration = this.model.time.delayAnimations;\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n    this.xAxisLeft.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n\n    const sideDim = this.SIDEDIM;\n    const stackDim = this.STACKDIM;\n    const ageDim = this.AGEDIM;\n    const groupBy = this.groupBy;\n\n    const ages = this.model.marker.getKeys(ageDim);\n    let ageKeys = [];\n    ageKeys = ages.map(m => m[ageDim]);\n    this.shiftedAgeKeys = this.ageKeys = ageKeys;\n\n    //this.shiftedAgeKeys = this.timeSteps.map((m, i) => -i * groupBy).slice(1).reverse().concat(ageKeys);\n\n    const sideItems = this.model.marker.label_side.getItems();\n    //var sideKeys = Object.keys(sideItems);\n    let sideKeys = [];\n    if (!utils.isEmpty(sideItems)) {\n      const sideFiltered = !!this.model.marker.side.getEntity().show[sideDim];\n      const sides = this.model.marker.getKeys(sideDim)\n          .filter(f => !sideFiltered || this.model.marker.side.getEntity().isShown(f));\n      sideKeys = sides.map(m => m[sideDim]);\n\n      if (sideKeys.length > 2) sideKeys.length = 2;\n      if (sideKeys.length > 1) {\n        const sortFunc = this.ui.chart.flipSides ? d3.ascending : d3.descending;\n        sideKeys.sort(sortFunc);\n      }\n    }\n    if (!sideKeys.length) sideKeys.push(\"undefined\");\n    this.sideKeys = sideKeys;\n\n    const stacks = this.model.marker.color.use == \"indicator\" ? [] : this.model.marker.getKeys(stackDim);\n    const stackKeys = utils.without(stacks.map(m => {\n        if (m[stackDim] == _this.totalFieldName) _this.dataWithTotal = true;\n        return m[stackDim];\n      }), this.totalFieldName);\n\n    let sortedStackKeys = utils.keys(this.model.marker.color.getPalette()).reduce((arr, val) => {\n        if (stackKeys.indexOf(val) != -1) arr.push(val);\n        return arr;\n      }, []);\n\n    if (sortedStackKeys.length != stackKeys.length) {\n      sortedStackKeys = stackKeys.reduce((arr, val) => {\n          if (arr.indexOf(val) == -1) arr.push(val);\n          return arr;\n        }, sortedStackKeys);\n    }\n    this.stackKeys = sortedStackKeys;\n    this.stackItems = this.model.marker.label_stack.getItems();\n\n    this.stacked = this.ui.chart.stacked && this.model.marker.color.use != \"constant\" && this.stack.getDimension();\n\n    this.twoSided = this.sideKeys.length > 1;\n    this.titleRight.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.xScaleLeft = this.xScale.copy();\n      this.title.text(sideItems[this.sideKeys[1]]);\n      this.titleRight.text(sideItems[this.sideKeys[0]]);\n    } else {\n      const title = this.sideKeys.length && sideItems[this.sideKeys[0]] ? sideItems[this.sideKeys[0]] : \"\";\n      this.title.text(title);\n    }\n\n    this.cScale = this.model.marker.color.getScale();\n  },\n\n  _reorderBars() {\n    const _this = this;\n    const domain = this.yScale.domain();\n    const sideKeys = this.sideKeys;\n    domain.sort((a, b) => { \n      const result = d3.ascending(_this.frameOrder[a] || 0, _this.frameOrder[b] || 0);\n      return result !== 0 ? result : d3.ascending(_this.frameAxisX[sideKeys[0]][a] || 0, _this.frameAxisX[sideKeys[0]][b] || 0);\n    });\n    this.yScale.domain(domain);\n  },\n\n  _createLimits() {\n    const _this = this;\n    const axisX = this.model.marker.axis_x;\n\n    //const sideKeysNF = Object.keys(this.model.marker.side.getItems());\n    const sideKeysNF = Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));\n    if (!sideKeysNF.length) sideKeysNF.push(\"undefined\");\n\n    const keys = this.stackSkip && this.sideSkip ? [] : (this.sideSkip ? [this.STACKDIM] : (this.stackSkip ? [this.SIDEDIM] : [this.STACKDIM, this.SIDEDIM]));\n    const limits = axisX.getLimitsByDimensions(keys.concat([this.AGEDIM, this.TIMEDIM]));\n    const timeKeys = axisX.getUnique();\n    const totals = {};\n    const inpercentMaxLimits = {};\n    const maxLimits = {};\n    sideKeysNF.forEach(s => {\n      maxLimits[s] = [];\n      inpercentMaxLimits[s] = [];\n    });\n\n    if (_this.stackSkip && _this.sideSkip) {\n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        let ageSum = 0;\n        const sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, age => {\n          let stackSum = 0;\n          if (limits[age] && limits[age][time]) {\n            stackSum += limits[age][time].max;\n            ageSum += stackSum;\n          }\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        const maxSideLimit = Math.max(...sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.sideSkip) {\n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        let ageSum = 0;\n        const sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, age => {\n          let stackSum = 0;\n            utils.forEach(_this.stackKeys, stack => {\n              if (limits[stack] && limits[stack][age] && limits[stack][age][time]) {\n              stackSum += limits[stack][age][time].max;\n              ageSum += stackSum;\n            }\n          });\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        const maxSideLimit = Math.max(...sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.stackSkip) {\n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, side => {\n          let ageSum = 0;\n          const sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, age => {\n            let stackSum = 0;\n            if (limits[side] && limits[side][age] && limits[side][age][time]) {\n              stackSum += limits[side][age][time].max;\n              ageSum += stackSum;\n            }\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          const maxSideLimit = Math.max(...sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    } else {\n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, side => {\n          let ageSum = 0;\n          const sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, age => {\n            let stackSum = 0;\n            utils.forEach(_this.stackKeys, stack => {\n              if (limits[stack][side] && limits[stack][side][age] && limits[stack][side][age][time]) {\n                stackSum += limits[stack][side][age][time].max;\n                ageSum += stackSum;\n              }\n            });\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          const maxSideLimit = Math.max(...sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    }\n\n    this.maxLimits = {};\n    this.inpercentMaxLimits = {};\n    sideKeysNF.forEach(s => {\n      _this.maxLimits[s] = Math.max(...maxLimits[s]);\n      _this.inpercentMaxLimits[s] = Math.max(...inpercentMaxLimits[s]);\n    });\n    this.totals = totals;\n  },\n\n  _updateLimits() {\n    const _this = this;\n    const axisX = this.model.marker.axis_x;\n    const zero = axisX.scaleType == \"log\" ? 0.01 : 0;\n    let domain;\n    if (this.ui.chart.inpercent) {\n      domain = [zero * 0.01, Math.max(...this.sideKeys.map(s => _this.inpercentMaxLimits[s]))];\n    } else {\n      domain = (axisX.domainMin != null && axisX.domainMax != null) ? [+axisX.domainMin, +axisX.domainMax] : [zero, Math.max(...this.sideKeys.map(s => _this.maxLimits[s]))];\n    }\n    this.xScale.domain(domain);\n    if (this.xScaleLeft) this.xScaleLeft.domain(this.xScale.domain());\n  },\n\n\n  _interpolateBetweenTotals(timeSteps, totals, time) {\n    const nextStep = d3.bisectLeft(timeSteps, time);\n    const fraction = (time - timeSteps[nextStep - 1]) / (timeSteps[nextStep] - timeSteps[nextStep - 1]);\n    const total = {};\n    utils.forEach(this.sideKeys, side => {\n      total[side] = totals[timeSteps[nextStep]][side] * fraction + totals[timeSteps[nextStep - 1]][side] * (1 - fraction);\n  });\n    return total;\n  },\n\n  /**\n   * Updates entities\n   */\n  _updateEntities(reorder) {\n\n    const _this = this;\n    const time = this.model.time;\n    const sideDim = this.SIDEDIM;\n    const prefixedSideDim = this.PREFIXEDSIDEDIM;\n    const ageDim = this.AGEDIM;\n    const stackDim = this.STACKDIM;\n    const prefixedStackDim = this.PREFIXEDSTACKDIM;\n    const timeDim = this.TIMEDIM;\n    const duration = (time.playing) ? time.delayAnimations : 0;\n    let total;\n\n    const groupBy = this.groupBy;\n    //var group_offset = this.model.marker.group_offset ? Math.abs(this.model.marker.group_offset % groupBy) : 0;\n\n    if (this.ui.chart.inpercent) {\n      this.total = this.totals[time.value] ? this.totals[time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals, time.value);\n    }\n\n    const domain = this.yScale.domain();\n\n    //this.model.age.setVisible(markers);\n\n    //const nextStep = d3.bisectLeft(this.timeSteps, time.value);\n\n    const shiftedAgeDim = this.SHIFTEDAGEDIM;\n\n  //   const markers = this.markers.map(data => {\n  //       const o = {};\n  //   o[ageDim] = o[shiftedAgeDim] = +data[ageDim];\n  //   o[ageDim] -= nextStep * groupBy;\n  //   return o;\n  // });\n\n    const ageBars = this.markers.slice(0);\n\n    // const outAge = {};\n    // outAge[shiftedAgeDim] = markers.length * groupBy;\n    // outAge[ageDim] = outAge[shiftedAgeDim] - nextStep * groupBy;\n\n   //this.ageShift = 0;//= nextStep * groupBy;\n\n    // if (nextStep) ageBars.push(outAge);\n\n    this.entityBars = this.bars.selectAll(\".vzb-bc-bar\")\n        .data(ageBars, d => d[ageDim]);\n    //exit selection\n    this.entityBars.exit().remove();\n\n    const oneBarHeight = this.oneBarHeight;\n    const barHeight = this.barHeight;\n    const firstBarOffsetY = this.firstBarOffsetY;\n\n    //enter selection -- init bars\n    this.entityBars = this.entityBars.enter().append(\"g\")\n        .attr(\"class\", d => \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim])\n//  .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - groupBy) * oneBarHeight) + \")\")\n  .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\")\n  .merge(this.entityBars);\n\n    // this.entityBars.attr(\"class\", function(d) {\n    //     return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim];\n    //   })\n\n\n    this.sideBars = this.entityBars.selectAll(\".vzb-bc-side\").data(d => _this.sideKeys.map(m => {\n        const r = {};\n    r[ageDim] = d[ageDim];\n    r[shiftedAgeDim] = d[shiftedAgeDim];\n    r[prefixedSideDim] = m;\n    r[sideDim] = m;\n    return r;\n  }), d => d[prefixedSideDim]);\n\n    this.sideBars.exit().remove();\n    this.sideBars = this.sideBars.enter().append(\"g\")\n        .attr(\"class\", (d, i) => \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\"))\n    .merge(this.sideBars);\n\n    if (reorder) {\n      this.sideBars.attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n    }\n\n    const _attributeUpdaters = this._attributeUpdaters;\n\n    this.stackBars = this.sideBars.selectAll(\".vzb-bc-stack\").data((d, i) => {\n      const stacks = _this.stacked ? _this.stackKeys : [_this.totalFieldName];\n      return stacks.map(m => {\n        const r = {};\n        r[ageDim] = d[ageDim];\n        r[shiftedAgeDim] = d[shiftedAgeDim];\n        r[sideDim] = d[sideDim];\n        r[stackDim] = m;\n        r[prefixedSideDim] = d[prefixedSideDim];\n        r[prefixedStackDim] = m;\n        return r;\n      });\n    }, d => d[prefixedStackDim]);\n\n    this.stackBars.exit().remove();\n    this.stackBars = this.stackBars.enter().append(\"rect\")\n      .attr(\"class\", (d, i) => \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\"))\n      .attr(\"y\", 0)\n      .attr(\"height\", barHeight)\n      .attr(\"fill\", d => _this.cScale(_this.colorUseNotProperty ? _this.frame.color[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : d[prefixedStackDim]))\n      .attr(\"width\", _attributeUpdaters._newWidth)\n      .attr(\"x\", _attributeUpdaters._newX)\n      .on(\"mouseover\", _this.interaction.mouseover)\n      .on(\"mouseout\", _this.interaction.mouseout)\n      .on(\"click\", _this.interaction.click)\n      .onTap(_this.interaction.tap)\n      .merge(this.stackBars);\n\n\n    if (reorder) this.stackBars\n      .attr(\"fill\", d => _this.cScale(_this.colorUseNotProperty ? _this.frame.color[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : d[prefixedStackDim]))\n      .order();\n\n    const stepShift = (ageBars[0][shiftedAgeDim] - ageBars[0][ageDim]) - this.shiftScale(time.value) * groupBy;\n\n    if (duration) {\n      const transition = d3.transition()\n        .duration(duration)\n        .ease(d3.easeLinear);\n\n      this.entityBars\n        //.transition(transition)\n        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\");\n//        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\");\n      this.stackBars\n        .transition(transition)\n        .attr(\"width\", _attributeUpdaters._newWidth)\n        .attr(\"x\", _attributeUpdaters._newX);\n    } else {\n      this.entityBars.interrupt()\n        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\");\n//        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\");\n      this.stackBars.interrupt()\n        .attr(\"width\", _attributeUpdaters._newWidth)\n        .attr(\"x\", _attributeUpdaters._newX);\n    }\n\n    // this.entityLabels = this.labels.selectAll(\".vzb-bc-label\")\n    //   .data(this.markers, d => d[ageDim]);\n    // //exit selection\n    // this.entityLabels.exit().remove();\n\n    // const entityLabels = this.entityLabels.enter().append(\"g\")\n    //   .attr(\"class\", \"vzb-bc-label\")\n    //   .attr(\"id\", d => \"vzb-bc-label-\" + d[shiftedAgeDim] + \"-\" + _this._id)\n    // entityLabels.append(\"text\")\n    //   .attr(\"class\", \"vzb-bc-age\")\n    //   .attr(\"y\", (d, i) => firstBarOffsetY - _this.yScale(d[shiftedAgeDim]) - 10);\n\n    // this.entityLabels = entityLabels.merge(this.entityLabels);\n    // // .style(\"fill\", function(d) {\n    // //   var color = _this.cScale(values.color[d[ageDim]]);\n    // //   return d3.rgb(color).darker(2);\n    // // });\n\n    // if (reorder) this.entityLabels.selectAll(\".vzb-bc-age\").attr(\"y\", (d, i) => firstBarOffsetY - _this.yScale(d[shiftedAgeDim]) - 10);\n\n    if (duration) {\n      this.year.transition().duration(duration).ease(d3.easeLinear)\n        .on(\"end\", this._setYear(time.value));\n    } else {\n      this.year.interrupt().text(time.formatDate(time.value)).transition();\n    }\n  },\n\n  _setYear(timeValue) {\n    const formattedTime = this.model.time.formatDate(timeValue);\n    return function() { d3.select(this).text(formattedTime); };\n  },\n\n  _interaction() {\n    const _this = this;\n    return {\n      mouseover(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.highlightMarker(d);\n        //_this._showLabel(d);\n      },\n      mouseout(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n      },\n      click(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.selectMarker(d);\n      },\n      tap(d) {\n        d3.event.stopPropagation();\n        _this.model.marker.selectMarker(d);\n      }\n    };\n  },\n\n  _highlightBars(d) {\n    const _this = this;\n\n    _this.someHighlighted = (_this.model.marker.highlight.length > 0);\n\n    _this.updateBarsOpacity();\n\n    if (!_this.someHighlighted) {\n      //hide labels\n      _this.labels.selectAll(\".vzb-hovered\").classed(\"vzb-hovered\", false);\n    } else {\n      _this._showLabel(_this.model.marker.highlight[0]);\n    }\n  },\n\n  _showLabel(d) {\n    const _this = this;\n    const formatter = _this.ui.chart.inpercent ? d3.format(\".1%\") : _this.model.marker.axis_x.getTickFormatter();\n    const sideDim = _this.SIDEDIM;\n    const ageDim = _this.AGEDIM;\n    const stackDim = _this.STACKDIM;\n    const KEYS = this.KEYS;\n\n    const left = _this.sideKeys.indexOf(d[sideDim]);\n    const label = _this.labels.select(\".vzb-bc-label\");\n    const bar = _this.bars.select(\".vzb-bc-bar-\" + d[ageDim]);\n    //const label = _this.labels.select(\"#vzb-bc-label-\" + d[ageDim] + \"-\" + _this._id);\n    label.attr(\"transform\", bar.attr(\"transform\"))\n      .select(\".vzb-bc-age\")\n      .text(textData => {\n        //var total = _this.ui.chart.inpercent ? _this.totalValues[d[sideDim]] : 1;\n        let text = _this.stackKeys.length > 1 ? _this.stackItems[d[stackDim]] : _this.frame.label_age[d[ageDim]];\n        text = _this.twoSided ? text : text + \" \" + _this.stackItems[d[stackDim]];\n        const value = utils.getValueMD(d, _this.frameAxisX, KEYS);//_this.xScale.invert(d[\"width_\"]);\n        //var value = (_this.dataWithTotal || _this.stacked) ? _this.values1.axis_x[d[shiftedAgeDim]][d[sideDim]][d[stackDim]] / total : _this.xScale.invert(d[\"width_\"]);\n        return text + \": \" + formatter(value);\n      })\n      .attr(\"x\", (left ? -1 : 1) * (_this.activeProfile.centerWidth * 0.5 + 7))\n      .classed(\"vzb-text-left\", left);\n\n    label.classed(\"vzb-hovered\", true);\n  },\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n\n\n  presentationProfileChanges: {\n    medium: {\n      margin: { right: 80, bottom: 80 },\n      infoElHeight: 32\n    },\n    large: {\n      margin: { top: 100, right: 100, left: 100, bottom: 80 },\n      infoElHeight: 32\n    }\n  },\n\n  profiles: {\n    \"small\": {\n      margin: {\n        top: 70,\n        right: 20,\n        left: 40,\n        bottom: 40\n      },\n      infoElHeight: 16,\n      centerWidth: 2,\n      titlesSpacing: 5\n    },\n    \"medium\": {\n      margin: {\n        top: 80,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 20,\n      centerWidth: 2,\n      titlesSpacing: 10\n    },\n    \"large\": {\n      margin: {\n        top: 100,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 22,\n      centerWidth: 2,\n      titlesSpacing: 20\n    }\n  },\n\n  resize() {\n\n    const _this = this;\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    //this.activeProfile = this.profiles[this.getLayoutProfile()];\n    const margin = this.activeProfile.margin;\n    const infoElHeight = this.activeProfile.infoElHeight;\n\n    //stage\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) return utils.warn(\"Pop by age resize() abort: vizabi container is too little or has display:none\");\n\n    this.graph\n      .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    this.barsCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.labelsCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    const groupBy = this.groupBy;\n\n    const domain = this.yScale.domain();\n    this.oneBarHeight = this.model.marker.axis_y.scaleType == \"ordinal\" ? this.height / domain.length : this.height / (domain[1] - domain[0]);\n    const barHeight = this.barHeight = this.oneBarHeight * groupBy; // height per bar is total domain height divided by the number of possible markers in the domain\n    this.firstBarOffsetY = this.height - this.barHeight;\n\n    if (this.stackBars) this.stackBars.attr(\"height\", barHeight);\n\n    if (this.sideBars) this.sideBars\n      .attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n\n    const maxRange = this.twoSided ? ((this.width - this.activeProfile.centerWidth) * 0.5) : this.width;\n\n    this.xScale.range([0, maxRange]);\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale)\n      .tickValues([])\n      .tickSizeInner(-this.width)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.width, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_y.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 1\n      });\n\n    const format = this.ui.chart.inpercent ? d3.format((groupBy > 3 ? \"\" : \".1\") + \"%\") : this.model.marker.axis_x.getTickFormatter();\n\n    this.xAxis.scale(this.xScale)\n      .tickFormat(format)\n      .tickSizeInner(-this.height)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.height, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6\n      });\n\n    const translateX = this.twoSided ? ((this.width + _this.activeProfile.centerWidth) * 0.5) : 0;\n\n    this.xAxisEl.attr(\"transform\", \"translate(\" + translateX + \",\" + this.height + \")\")\n      .call(this.xAxis);\n\n    this.yAxisEl.attr(\"transform\", \"translate(\" + 0 + \",0)\")\n      .call(this.yAxis);\n    //this.xAxisEl.call(this.xAxis);\n    this.xAxisLeftEl.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n        this.xScaleLeft.range([(this.width - this.activeProfile.centerWidth) * 0.5, 0]);\n      } else {\n        this.xScaleLeft.rangePoints([(this.width - this.activeProfile.centerWidth) * 0.5, 0]).range();\n      }\n\n      this.xAxisLeft.scale(this.xScaleLeft)\n        .tickFormat(format)\n        .tickSizeInner(-this.height)\n        .tickSizeOuter(0)\n        .tickPadding(6)\n        .tickSizeMinor(-this.height, 0)\n        .labelerOptions({\n          scaleType: this.model.marker.axis_x.scaleType,\n          toolMargin: margin,\n          limitMaxTickNumber: 6\n        });\n\n      this.xAxisLeftEl.attr(\"transform\", \"translate(0,\" + this.height + \")\")\n        .call(this.xAxisLeft);\n      const zeroTickEl = this.xAxisEl.select(\".tick text\");\n      if (!zeroTickEl.empty()) {\n        const zeroTickWidth = zeroTickEl.node().getBBox().width;\n        zeroTickEl.attr(\"dx\", -(this.activeProfile.centerWidth + zeroTickWidth) * 0.5);\n      }\n      this.xAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n   \n      //hide left axis zero tick\n      const tickNodes = this.xAxisLeftEl.selectAll(\".tick\").nodes();\n      d3.select(tickNodes[tickNodes.length - 1]).classed(\"vzb-hidden\", true);\n   }\n\n    const isRTL = this.model.locale.isRTL();\n\n    this.bars.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n    this.labels.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n\n    this.title\n      .attr(\"x\", margin.left + (this.twoSided ? translateX - this.activeProfile.titlesSpacing : 0))\n      .style(\"text-anchor\", this.twoSided ? \"end\" : \"\")\n      .attr(\"y\", margin.top * 0.7);\n    this.titleRight\n      .attr(\"x\", margin.left + translateX + this.activeProfile.titlesSpacing)\n      .attr(\"y\", margin.top * 0.7);\n\n    this.xTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width : margin.left * 0.4) + \",\" + (margin.top * 0.4) + \")\");\n    this.xTitleEl.select(\"text\").text(this.model.marker.axis_x.getConceptprops().name);\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.xTitleEl.node().getBBox();\n      const t = utils.transform(this.xTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.xInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n\n    this.year.attr(\"x\", this.width + margin.left).attr(\"y\", margin.top * 0.4);\n\n  },\n\n  updateBarsOpacity(duration) {\n    const _this = this;\n    //if(!duration)duration = 0;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    const OPACITY_SELECT = this.model.marker.opacityRegular;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.stackBars\n    //.transition().duration(duration)\n      .style(\"opacity\", d => {\n\n        if (_this.someHighlighted) {\n          //highlight or non-highlight\n          if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n        }\n\n        if (_this.someSelected) {\n          //selected or non-selected\n          return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n        }\n\n        if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n        return OPACITY_REGULAR;\n      });\n\n    this.stackBars.style(\"stroke\", d => _this.model.marker.isSelected(d) ? \"#333\" : null);\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.stackBars.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n\n});\n\nexport default BarChartDS;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","module.exports = \"<!-- BarChartDS Component -->\\n<svg class=\\\"vzb-barchartds\\\">\\n    <g class=\\\"vzb-bc-header\\\">\\n        <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n        <text class=\\\"vzb-bc-title\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-right\\\"></text>\\n        <text class=\\\"vzb-bc-year\\\"></text>\\n    </g>\\n    <g class=\\\"vzb-bc-graph\\\">\\n\\n        <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n\\n        <g class=\\\"vzb-bc-axis-y\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-bars-crop\\\">\\n            <g class=\\\"vzb-bc-bars\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-x\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x vzb-bc-axis-x-left\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-labels-crop\\\">\\n            <g class=\\\"vzb-bc-labels\\\">\\n                <g class=\\\"vzb-bc-label\\\"><text class=\\\"vzb-bc-age\\\"></text></g>\\n            </g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-labels\\\">\\n            <!-- <text class=\\\"vzb-x_label\\\">Lifespan</text>\\n                  <text class=\\\"vzb-y_label\\\">Lifespan</text> -->\\n        </g>\\n    </g>\\n</svg>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}