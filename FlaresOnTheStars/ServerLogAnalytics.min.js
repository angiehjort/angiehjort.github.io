/*! ServerLogAnalytics - v1.0.0 - 2014-12-22
* Copyright (c) 2014 Angie; License CC BY-NC-ND 4.0 */
function Call(){var a=this;this.URL_KAIROSDB="http://kairosdb"+appModel.host+"/api/v1/datapoints/query",this.URL_ASSET_LIST="http://im"+appModel.host+"/api/v1/customers/1/sites",this.URL_KPISTORAGE="http://kpistorageservice"+appModel.host+"/kpistorage/v1/kpis",this.URL_COMPUTATION_SERVICE="http://computationservice"+appModel.host+"/query",this.METHOD_GET="GET",this.METHOD_POST="POST",this.TIMEOUT=1,this.HTTP_OR_AJAX="http",this.request=function(b,c,d,e,f,g,h,i,j){null==g&&(g=a.METHOD_POST),null==i&&(i=a.HTTP_OR_AJAX),null==j&&(j="jsonp");var k=function(){app.hey(HEY_DATA_RECEIVED,c,"Connecting to fallback data source..."),null!=f&&f(c,d),null==f&&e(c,d,null)},l=function(a,f){if(200!=f)return log(f),void k();var g="",i=0;null!=a.queries&&(g=a.queries[3].results[0].values.length+" samples in time series from "+h),null!=a.length&&(g=a.length+" records in data from "+h),null!=a.events&&(g=a.events.length+" events from "+h),null!=b&&"HADOOP_CHECK_PROGRESS"==b.instruction&&(i=KEEP_SILENT),app.hey(HEY_DATA_RECEIVED,c,g,i),null!=e&&e(c,d,a)};if(null==h)return void k();if("http"==i){var m=new XMLHttpRequest;m.onload=function(){l(JSON.parse(this.responseText),this.status)},m.ontimeout=function(){k(this)},m.onerror=function(){k(this)},m.timeout=a.TIMEOUT,m.open(g,h,!0),m.setRequestHeader("Content-Type","application/json;charset=UTF-8"),m.send(JSON.stringify(b))}if("ajax"==i){var m={};m.type=g,m.contentType="application/json;charset=utf-8",m.url=h,m.timeout=a.TIMEOUT,m.dataType=j,m.data=b,m.success=function(a,b,c){l(a,c.status)},m.error=function(a){k(a)},$.ajax(m)}}}function extendControllersOf(a){function b(a){window.prompt("Copy to clipboard: Ctrl+C, Enter",a)}function c(a,b,c){window.open("mailto:"+a+"?subject="+b+"&body="+c)}var d=this;$("#compareButton").click(function(){appModel.historyHidden?(overview.showHistory(),oneplant.showHistory(),appModel.historyHidden=!1,app.hey(HEY_HISTORY_VISIBLE)):(overview.hideHistory(),oneplant.hideHistory(),appModel.historyHidden=!0,app.hey(HEY_HISTORY_HIDDEN))}),$(".selector .option").click(function(){appModel.setTTStep(d3.select(this).attr("value"))}),$("#timeframeMain .right").click(function(){appModel.setTTLeftRight(0,appModel.TIMEFRAME_STEP_RIGHT)}),$("#timeframeMain .left").click(function(){appModel.setTTLeftRight(0,appModel.TIMEFRAME_STEP_LEFT)}),$("#timeframeHistoric .right").click(function(){appModel.setTTLeftRight(1,appModel.TIMEFRAME_STEP_RIGHT)}),$("#timeframeHistoric .left").click(function(){appModel.setTTLeftRight(1,appModel.TIMEFRAME_STEP_LEFT)}),$("input:radio.dataSource").on("change",function(){appModel.dataSource=$(this).val(),app.hey(HEY_DATASOURCE_CHANGED)}),$("input.galaxysInOneCall").on("change",function(){switch(appModel.galaxysInOneCall=appModel.galaxysInOneCallPossibleValues[+$(this).val()-1],appModel.galaxysInOneCall){case 100:var a=" — one heavy call";break;case 1:var a=" — super many small calls";break;default:var a=""}$("span.galaxysInOneCall").text(appModel.galaxysInOneCall+a),app.hey(HEY_DATASOURCE_CHANGED)}),$("#scalarDistortion").on("change",function(){appModel.scalarDistortion=$(this).prop("checked")}),$("#fakePlantsMetadata").on("change",function(){appModel.bypass.galaxysMetadata=$(this).prop("checked"),app.init()}),$("#fakeKpiData").on("change",function(){appModel.bypass.kpiData=$(this).prop("checked"),app.hey(HEY_DATASOURCE_CHANGED)}),$("#fakeofihbposehgfui541757Table").on("change",function(){appModel.bypass.alarmTableData=$(this).prop("checked"),app.hey(HEY_DATASOURCE_CHANGED)}),$("#flushbutton").click(function(){call.request(null,null,null,function(){log("FLUSH success"),app.hey(HEY_ENLIGHTMENTS_JOBS_FLUSHED)},function(){log("FLUSH fail"),app.hey(HEY_ENLIGHTMENTS_JOBS_FLUSHED)},call.METHOD_GET,call.URL_COMPUTATION_SERVICE+"?action=RELEASE_LOCK","ajax")}),a.updateTimeFrameUI=function(){var a=appModel.TTStep==appModel.TIMEFRAME_STEP_DAY?FORMAT_DATE_MED:FORMAT_DATE_NOY;$("#timeframeMain .tStart").val(appModel.TT[0].tStart.format(a)),$("#timeframeMain .tEnd").val(moment(+appModel.TT[0].tEnd.valueOf()-1).format(FORMAT_DATE_MED)),$("#timeframeHistoric .tStart").val(appModel.TT[1].tStart.format(a)),$("#timeframeHistoric .tEnd").val(moment(+appModel.TT[1].tEnd.valueOf()-1).format(FORMAT_DATE_MED)),$("#timeframeMain .tStart").attr("datavalue",appModel.TT[0].tStart.valueOf()),$("#timeframeHistoric .tStart").attr("datavalue",appModel.TT[1].tStart.valueOf()),d3.selectAll(".timeshift").classed("oneday",appModel.TTStep==appModel.TIMEFRAME_STEP_DAY),d3.selectAll(".selector .option").each(function(){d3.select(this).classed("selected",d3.select(this).attr("value")==appModel.TTStep)}),d3.select("#compareButton").classed("active",!appModel.historyHidden),d3.selectAll("#timeframeHistoric").style("display",appModel.historyHidden?"none":"block"),d3.selectAll("#timeframeMain").style("width",appModel.historyHidden?"50%":"25%")},a.updateUrl=function(a,b,c,d,e){var f={};f.galaxyID=b,f.historyHidden=c,f.TT=d,f.TTStep=e;var g="";a==STATEURL_REPLACE&&window.history.replaceState(f,g,URL_PREFIX+JSON.stringify(f)),a==STATEURL_PUSH&&window.history.pushState(f,g,URL_PREFIX+JSON.stringify(f))},$("#message").click(function(){$("#message").hide("fast")}),$("#logoLeft").click(function(){window.open("index.htm","_self")}),$("#backButton").click(function(){window.history.back()}),$("#quickButton").click(function(){$("#quickButton").mouseIsOver()||($(".sharingDropmenu").toggle("fast"),d3.select(".sharingDropmenu").style("left",d3.select("#quickButton")[0][0].offsetLeft+"px"))}),$("#quickButton").mouseenter(function(){$(".sharingDropmenu").show("fast"),d3.select(".sharingDropmenu").style("left",d3.select("#quickButton")[0][0].offsetLeft+"px")}),$("#quickButton").mouseleave(function(){$(".sharingDropmenu").mouseIsOver()||$(".sharingDropmenu").hide("fast")}),$(".sharingDropmenu").mouseleave(function(){$(this).hide("fast")}),$("#shareToClipboard").click(function(){b(location.href)}),$("#shareToEmailAddress").click(function(){c(appModel.sharingEmailTarget,SHARING_EMAIL_HEADER,SHARING_EMAIL_BODY+"%0D%0A %0D%0A"+location.href+"%0D%0A %0D%0A"+SHARING_EMAIL_FOOTER+USER_NAME)}),$(".timeshift input.tStart").focusin(function(){this.value=appModel.TT[$(this).attr("TT")][$(this).attr("bind")].format(FORMAT_DATE_SMA)}),$(".timeshift input.tStart").focusout(function(){this.value=appModel.TT[$(this).attr("TT")][$(this).attr("bind")].format(FORMAT_DATE_MED)}),$(".timeshift input.tStart").keyup(function(a){13==a.keyCode&&(appModel.setTT(moment(this.value,"DD.MM.YYYY"),+$(this).attr("TT"),$(this).attr("bind")),this.blur())}),$input=$(".datepicker").pickadate({firstDay:1,today:!1,clear:!1,selectYears:8,selectMonths:!0,max:!0,format:"dd.mm.yyyy",formatSubmit:"dd.mm.yyyy",onClose:function(){appModel.setTT(moment(this.get("select",FORMAT_DATE_SMA.toLowerCase()),FORMAT_DATE_SMA),+this.$node.context.attributes.tt.value,this.$node.context.attributes.bind.value)},onOpen:function(){this.set("select",+this.$node.context.attributes.datavalue.value)}}),picker=$input.pickadate("picker"),window.onkeydown=function(a){9==a.keyCode&&(a.preventDefault(),app.tab(event.shiftKey?-1:1)),d3.selectAll(".overview .leftPart .focusArea.focused")[0].length&&(40==a.keyCode&&app.hover(dataModel.galaxyIDs,1),38==a.keyCode&&app.hover(dataModel.galaxyIDs,-1)),d3.selectAll(".overview .rightPart .focusArea.focused")[0].length&&(39==a.keyCode&&app.hover(dataModel.galaxySortedByKpiIDs,1),37==a.keyCode&&app.hover(dataModel.galaxySortedByKpiIDs,-1))},a.tab=function(a,b){null==appModel.focusIndex&&1==a&&(b=0,a=0),null==appModel.focusIndex&&-1==a&&(b=0,a=-1),null==b&&(b=appModel.focusIndex);for(var c=".rightPart "+(appModel.historyHidden?".current ":"")+".focusArea, .leftPart .focusArea",d=d3.selectAll(c)[0].length,e=b+a;e>d-1;)e-=d;for(;0>e;)e+=d;if(d3.selectAll(c).classed("focused",!1),d3.selectAll(c).filter(function(a,b){return b==e}).classed("focused",!0),appModel.focusIndex=e,d3.selectAll(".overview .rightPart .focusArea.focused")[0].length){var f=d3.selectAll(".overview .rightPart .focusArea.focused").attr("id"),g=d3.selectAll(".history .focusArea.focused")[0].length?1:0;dataModel.sortAssetsByKpi(f,g)}},a.hover=function(a,b,c,d){null==appModel.galaxyHoveredID&&null==c&&1==b&&(c=0,b=0),null==appModel.galaxyHoveredID&&null==c&&-1==b&&(c=0,b=-1),null==c&&(c=a.indexOf(appModel.galaxyHoveredID));var e=a.length,f=c+b;if("don't loop"!=d){for(;f>e-1;)f-=e;for(;0>f;)f+=e}else{for(;f>e-1;)f=e-1;for(;0>f;)f=0}overview.iWannaHoverOn(a[f])},window.onpopstate=function(){app.hey(HEY_BACK_TOOVERVIEW)},a.init=function(){app.hey(HEY_LOADING_ON),app.updateUrl(STATEURL_PUSH,appModel.galaxyID,appModel.historyHidden,appModel.TT,appModel.TTStep),dataModel.updateAssetList(),dataModel.updateKpiMetadata()},window.onresize=function(){appModel.updateDimensions(),app.updateTimeFrameUI(),d3.selectAll(".subcontainer").remove(),overview=new OverviewView("#contentAreaHere"),oneplant=new OneplantView("#contentAreaHere"),overview.update(),oneplant.update(),null!=appModel.galaxyID&&(d3.select(".subcontainer.overview").style("display","none"),d3.select(".subcontainer.oneplant").style("display","block"),d3.select("#backButton").style("visibility","visible"))},a.hey=function(a,b,c,e){switch(e!=KEEP_SILENT&&(message=a,null!=b&&(message=message+", galaxy:"+b),null!=c&&(message=message+", "+c),log("HEY! "+message),$("#message").text(message),clearTimeout(d.messageTimer),$("#message").fadeTo(0,.8),d.messageTimer=setTimeout(function(){$("#message").fadeTo(1e3,0)},1e3)),a){case HEY_ASSETS_READY:dataModel.updateAllKpis(appModel.galaxyID,0),appModel.historyHidden||dataModel.updateAllKpis(appModel.galaxyID,1),null!=appModel.galaxyID&&app.hey(HEY_DRILL_TOONEPLANT,appModel.galaxyID),app.updateTimeFrameUI();break;case HEY_DATA_STORED:var f=dataModel.readyCount,g=null==appModel.galaxyID?dataModel.N_ASSETS:1;if(f[0].prios>=g*SOIMOHIJS5474_PRIORITY_LEVELS&&f[0].scalarKpi>=g*dataModel.scalarKpiNumber&&f[0].timeSeries>=1*g&&(1==f[0].alarmTable||null==appModel.galaxyID)&&(appModel.historyHidden||f[1].prios>=g*SOIMOHIJS5474_PRIORITY_LEVELS&&f[1].scalarKpi>=g*dataModel.scalarKpiNumber&&f[1].timeSeries>=1*g&&(1==f[1].alarmTable||null==appModel.galaxyID)))return void app.hey(HEY_COLLECTION_COMPLETE);f[b].timeSeries>=1*g&&1!=f[b].alarmTable&&null!=appModel.galaxyID&&dataModel.updateofihbposehgfui541757Table(appModel.galaxyID,b);break;case HEY_COLLECTION_COMPLETE:null==appModel.galaxyID?overview.update():oneplant.update();break;case HEY_ENLIGHTMENTS_IMPACT_LOADING:d3.selectAll("#enlightment"+c+" .spinner").classed("spinning",!0);break;case HEY_ENLIGHTMENTS_IMPACT_LOADED:oneplant.enlightmentsTableView.unlockEnlightmentsTableAtLine(b,c),d3.selectAll("#enlightment"+c+" .spinner").classed("spinning",!1),oneplant.updateTimeSeries(),oneplant.enlightmentsTableView.update();break;case HEY_ENLIGHTMENTS_COMP_STARTED:dataModel.updateEnlightmentsComputationProgress();break;case HEY_ENLIGHTMENTS_COMP_PROGRESS:"100%"==c?app.hey(HEY_ENLIGHTMENTS_COMP_COMPLETE):setTimeout(dataModel.updateEnlightmentsComputationProgress,1e3),oneplant.enlightmentsTableView.update();break;case HEY_ENLIGHTMENTS_COMP_COMPLETE:dataModel.updateEnlightments();break;case HEY_ENLIGHTMENTS_LIST_RECEIVED:oneplant.enlightmentsTableView.update(),dataModel.updateEnlightmentsImpact(b,0),dataModel.updateofihbposehgfui541757Topology(appModel.galaxyID);break;case HEY_SOIMOHIJS5474_TOPOLOGY_UPDATED:oneplant.alarmRelationsView.update(appModel.galaxyID);break;case HEY_ENLIGHTMENTS_DISPLAY_RECOMPOSE:oneplant.update();break;case HEY_TIME_CHANGED:app.hey(HEY_LOADING_ON),appModel.fastClickerLastClick=moment().valueOf(),setTimeout(function(){moment().valueOf()-appModel.fastClickerLastClick<appModel.fastClickerDelay||(dataModel.updateAllKpis(appModel.galaxyID,b),app.updateTimeFrameUI(),app.updateUrl(STATEURL_REPLACE,appModel.galaxyID,appModel.historyHidden,appModel.TT,appModel.TTStep))},appModel.fastClickerDelay);break;case HEY_DATASOURCE_CHANGED:dataModel.updateAllKpis(appModel.galaxyID,0),appModel.historyHidden||dataModel.updateAllKpis(appModel.galaxyID,1);break;case HEY_HISTORY_VISIBLE:app.hey(HEY_TIME_CHANGED,1),app.updateUrl(STATEURL_REPLACE,appModel.galaxyID,appModel.historyHidden,appModel.TT,appModel.TTStep);break;case HEY_HISTORY_HIDDEN:oneplant.update(),app.updateTimeFrameUI(),app.updateUrl(STATEURL_REPLACE,appModel.galaxyID,appModel.historyHidden,appModel.TT,appModel.TTStep);break;case HEY_SHOWME_THEPLANT:null!=b&&(appModel.galaxyID=b),dataModel.updateofihbposehgfui541757Table(appModel.galaxyID,0),appModel.historyHidden||dataModel.updateofihbposehgfui541757Table(appModel.galaxyID,1);break;case HEY_DRILL_TOONEPLANT:d3.select(".subcontainer.overview").style("display","none"),d3.select(".subcontainer.oneplant").style("display","block"),d3.select("#backButton").style("visibility","visible"),d3.select("#currentHtmlTitle").text(dataModel.galaxys[b].name+" — "+ONEPLANT_DASHBOARD_TITLE),d3.select("#currentPageTitle").text(dataModel.galaxys[b].name),d3.select("#shareToEmailAddress .caption").html("Send to <br/>"+dataModel.galaxys[b].manager.name),appModel.sharingEmailTarget=dataModel.galaxys[b].manager.email,app.updateUrl(STATEURL_PUSH,appModel.galaxyID,appModel.historyHidden,appModel.TT,appModel.TTStep);break;case HEY_BACK_TOOVERVIEW:appModel.galaxyID=null,dataModel.updateAllKpis(appModel.galaxyID,0),appModel.historyHidden||dataModel.updateAllKpis(appModel.galaxyID,1),d3.select(".subcontainer.oneplant").style("display","none"),d3.select(".subcontainer.overview").style("display","block"),d3.select("#backButton").style("visibility","hidden"),d3.select("#currentHtmlTitle").text(OVERVIEW_DASHBOARD_TITLE),d3.select("#currentPageTitle").text(OVERVIEW_DASHBOARD_TITLE),d3.select("#shareToEmailAddress .caption").html("Send to <br/> e-mail address"),appModel.sharingEmailTarget="",app.updateUrl(STATEURL_REPLACE,appModel.galaxyID,appModel.historyHidden,appModel.TT,appModel.TTStep);break;case HEY_OVERVIEW_UPDATED:app.hey(HEY_LOADING_OFF,null,null,KEEP_SILENT);break;case HEY_ONEPLANT_UPDATED:app.hey(HEY_LOADING_OFF,null,null,KEEP_SILENT);break;case HEY_LOADING_ON:d3.select("#overalProgress").classed("active",!0);break;case HEY_LOADING_OFF:d3.select("#overalProgress").classed("active",!1);break;case"NOP":}}}function AppModel(a){var b=this;if(this.host=window.location.host.substr(URL_PAGENAME.length),""==this.host&&(this.host=URL_DEFAULTHOST),this.TIMEFRAME_STEP_LEFT="left",this.TIMEFRAME_STEP_RIGHT="right",this.TIMEFRAME_STEP_DAY="days",this.TIMEFRAME_STEP_WEEK="weeks",this.TIMEFRAME_STEP_MONTH="months",this.TIMEFRAME_STEP_YEAR="years",this.fastClickerDelay=500,this.fastClickerLastClick=0,this.galaxysInOneCallPossibleValues=[1,2,3,4,5,10,15,25,50,100],this.xAxisTicks=0,this.timeFormat=d3.time.format("%Y-%m-%d"),this.sharingEmailTarget="",this.TIME_INIT=moment([2008,7,1]),this.BLACKFRAME_H={top:40,bottom:40},this.margin={top:10,right:50,bottom:0,left:10},this.updateDimensions=function(){b.width=window.innerWidth-b.margin.left-b.margin.right,b.height=window.innerHeight-b.margin.top-b.margin.bottom},this.updateDimensions(),this.bypass={},this.galaxyID=null,this.historyHidden=!0,this.oneplantLargeCentralState=null,this.focusIndex=null,this.galaxyHoveredId=null,this.bypass.galaxysMetadata=d3.select("#fakePlantsMetadata").property("checked"),this.bypass.kpiData=d3.select("#fakeKpiData").property("checked"),this.bypass.alarmTableData=d3.select("#fakeofihbposehgfui541757Table").property("checked"),this.scalarDistortion=d3.select("#scalarDistortion").property("checked"),this.dataSource=d3.select(".dataSource:checked").attr("value"),this.galaxysInOneCall=+d3.select("span.galaxysInOneCall").text(),this.TTStep=d3.select("#selectorTimeframe .selected").attr("value"),this.TT=[{tStart:moment(this.TIME_INIT),tEnd:moment(this.TIME_INIT).add(b.TTStep,1)},{tStart:moment(this.TIME_INIT),tEnd:moment(this.TIME_INIT).add(b.TTStep,1)}],this.TTanalysis={pStart:.7,pEnd:.99},this.TTStepMs=function(){switch(b.TTStep){case"days":return 864e5;case"weeks":return 6048e5;case"months":return 26784e5;case"years":return 31536e6;default:return"invalid TTStep"}},null!=a){null!=a.TT&&(a.TT[0].tStart=moment(a.TT[0].tStart),a.TT[0].tEnd=moment(a.TT[0].tEnd),a.TT[1].tStart=moment(a.TT[1].tStart),a.TT[1].tEnd=moment(a.TT[1].tEnd));for(param in a)null!=a[param]&&(this[param]=a[param]);a=null}this.setTTanalysis=function(a,c){null!=a&&(b.TTanalysis.pStart=a),null!=c&&(b.TTanalysis.pEnd=c),log("new analysis frame is "+b.TTanalysis.pStart+" to "+b.TTanalysis.pEnd)},this.setTT=function(a,c){a.valueOf()!=b.TT[c].tStart.valueOf()&&(b.TT[c].tStart=a,b.TT[c].tEnd=moment(a.valueOf()).add(b.TTStep,1),app.hey(HEY_TIME_CHANGED,c))},this.setTTLeftRight=function(a,c){var d=c==b.TIMEFRAME_STEP_LEFT?-1:1;b.TT[a].tStart.add(b.TTStep,d),b.TT[a].tEnd.add(b.TTStep,d),app.hey(HEY_TIME_CHANGED,a)},this.setTTStep=function(a){b.TTStep=a;for(var c in b.TT)b.TT[c].tEnd=moment(b.TT[c].tStart).add(b.TTStep,1);b.updateTimeScale(a),app.hey(HEY_TIME_CHANGED,0),b.historyHidden||app.hey(HEY_TIME_CHANGED,1)},this.updateTimeScale=function(a){switch(a){case b.TIMEFRAME_STEP_DAY:b.xAxisTicks=10,b.timeFormat=d3.time.format("%-H:%M");break;case b.TIMEFRAME_STEP_WEEK:b.xAxisTicks=8,b.timeFormat=d3.time.format("%e %b");break;case b.TIMEFRAME_STEP_MONTH:b.xAxisTicks=7,b.timeFormat=d3.time.format("%e %b");break;case b.TIMEFRAME_STEP_YEAR:b.xAxisTicks=12,b.timeFormat=d3.time.format("%b")}},this.updateTimeScale(this.TTStep)}function TimeSeriesSet(){this.alarmRate=[],this.alarmsActive=[]}function ScalarKpiSet(){this.alarmRateAvg=0,this.alarmRatePeak=0,this.timeToAck=0,this.timeInFlood=0,this.staleofihbposehgfui541757s=0,this.staleofihbposehgfui541757sOldest=0}function Asset(a){null==a&&(a={id:0});var b=["Hannibal","Tahvo","Ulla-Maj","Iines","Coatings SA","Utrio","Polyurethanes SA","Kai","Hiigara","Sademies","Laatikainen","Saariaho","Wolgodeminoil","Kaitainen","Camacari","Ukkonen","Kaarina","Kaija","Tainio","Kaiju","Achimgas","Taina","Iida","Ilola","Kaitala","Appleton","Osaka","Saarijärvi","Nevalainen","Ulla-Maj","Saarinen","Laila","Uppa","Geismar","Nevalainen","Kaj","Niemi","Tahvo","Haapasalo","Antti","Tahvo","Narjus","Uosukainen","Taipale","Taipale","Haapakoski","Ilkka","Nieminen","Urho","Haatainen","Iiro","Saara","Niinistö","Niinimaa","Jaboatao","Kaari","Uotila","Saariaho","Ida","Iida","Sademies","Orange","Nevalainen","Iines","Taipale","Haapakoski","Utrio","Orange","Ukkonen","Laatokka","Niemi","Ulla","Haapoja","Natalia","Kaisa","Hannibal","Geismar","Laaksonen","Kaarina","Ulpu","Sademies","Haanpää","Haatainen","Iida","Tainio","Tahvo","Haapajärvi","Kaarina","Wolgodeminoil","Antti","Ulpu","Tallus","TPS","Taimi","Nevalainen","Laiho","Haapasalo","Nea","Ocumare VZ","Hiigara"];this.name=null!=a.name?a.name:b[+a.id]+" "+a.id,this.manager=null!=a.manager?a.manager:{id:9,name:"Angie Skazka",email:"konzeptmeister@gmail.com",phone:"+46 768-326-452"},this.address=null!=a.address?a.address:'"Forskargränd 1,\n72226 Västerås,\nSweden"',this.enlightments=[],this.enlightmentsJob={id:null,progress:null},this.enlightmentsImpact=[],this.TT=[{prios:Array.apply(null,Array(SOIMOHIJS5474_PRIORITY_LEVELS)).map(Number.prototype.valueOf,0),scalarKpi:new ScalarKpiSet,timeSeries:new TimeSeriesSet,alarmTable:[]},{prios:Array.apply(null,Array(SOIMOHIJS5474_PRIORITY_LEVELS)).map(Number.prototype.valueOf,0),scalarKpi:new ScalarKpiSet,timeSeries:new TimeSeriesSet,alarmTable:[]}]}function DataModel(){var a=this;this.N_ASSETS=100,this.scalarKpiNumber=SCALARKPISET_AS_ARRAY.length,this.readyCount=[{prios:0,scalarKpi:0,timeSeries:0,alarmTable:0},{prios:0,scalarKpi:0,timeSeries:0,alarmTable:0}],this.galaxys={},this.galaxyIDs=[],this.galaxySortedByKpiIDs=[],this.timeSeriesSamples=(appModel.historyHidden?window.innerWidth/2:window.innerWidth/4)*TIME_SERIES_RESOLUTION,this.kpiStorageServiceIsAvailable=!1,this.updateAssetList=function(){call.request(null,null,null,function(b,c,d){null==d&&(d=Array.apply(null,{length:a.N_ASSETS}).map(function(a,b){return{id:b+1,activeApplications:[{id:2}]}})),d=d.filter(function(a){return a.activeApplications.filter(function(a){return 2==a.id}).length>0}),a.N_ASSETS=d.length,a.galaxyIDs=[],d.forEach(function(b){a.galaxyIDs.push(b.id+""),a.galaxys[b.id+""]=new Asset(b)}),dataModel.galaxyIDs=dataModel.galaxyIDs.sort(function(a,b){return+a-+b}),app.hey(HEY_ASSETS_READY)},null,call.METHOD_GET,appModel.bypass.galaxysMetadata?null:call.URL_ASSET_LIST)},this.updateKpiMetadata=function(){call.request(null,null,null,function(b,c,d){null==d?a.kpiStorageServiceIsAvailable=!1:(a.kpiStorageServiceIsAvailable=!0,d.forEach(function(a){switch(a.name){case"Flare density over time":TIME_SERIES_META.alarmRate.id_kpistorageservice=a.kpiId;break;case"Number of alarms priority 1":PRIORITIES_META[0].id_kpistorageservice=a.kpiId;break;case"Number of alarms priority 2":PRIORITIES_META[1].id_kpistorageservice=a.kpiId;break;case"Number of alarms priority 3":PRIORITIES_META[2].id_kpistorageservice=a.kpiId;break;case"Average alarm rate":SCALAR_KPI_META.alarmRateAvg.id_kpistorageservice=a.kpiId;break;case"Peak alarm rate":SCALAR_KPI_META.alarmRatePeak.id_kpistorageservice=a.kpiId;break;case"Average time an alarm is active":SCALAR_KPI_META.timeofihbposehgfui541757Active.id_kpistorageservice=a.kpiId;break;case"Average time to acknowledge":SCALAR_KPI_META.timeToAck.id_kpistorageservice=a.kpiId;break;case"Percentage of time above target":SCALAR_KPI_META.timeInFlood.id_kpistorageservice=a.kpiId;break;case"Number of stale alarms":SCALAR_KPI_META.staleofihbposehgfui541757s.id_kpistorageservice=a.kpiId;break;case"Duration of oldest stale alarm":SCALAR_KPI_META.staleofihbposehgfui541757sOldest.id_kpistorageservice=a.kpiId}})),app.hey(HEY_KPIMETADATA_UPDATED)},null,call.METHOD_GET,call.URL_KPISTORAGE)},this.iWannaComputeEnlightments=function(a,b){null==a&&(a=appModel.galaxyID),null==b&&(b={}),b.action="COMPUTE_HADOOP",b.instruction="HADOOP_EXECUTE",b.parameter="time="+moment(+appModel.TT[0].tStart.valueOf()+Math.round(appModel.TTStepMs()*appModel.TTanalysis.pStart)).format("YYYYMMDDHH:mm:ss")+" "+moment(+appModel.TT[0].tStart.valueOf()+Math.round(appModel.TTStepMs()*appModel.TTanalysis.pEnd)).format("YYYYMMDDHH:mm:ss"),call.request(b,a,null,function(a,b,c){null==c&&(c={id:"I AM UNHAPPY PLACEHOLDER FOR JOB ID"}),dataModel.galaxys[a].enlightmentsJob={id:c.id,progress:0},app.hey(HEY_ENLIGHTMENTS_COMP_STARTED)},null,call.METHOD_GET,call.URL_COMPUTATION_SERVICE,"ajax")},this.updateEnlightmentsComputationProgress=function(a){null==a&&(a=appModel.galaxyID);var b=dataModel.galaxys[a].enlightmentsJob.id,c={action:"COMPUTE_HADOOP",instruction:"HADOOP_CHECK_PROGRESS",parameter:b};call.request(c,a,null,function(a,c,d){if(null==d||"The queried job does not exist."==d.ERROR){var e=dataModel.galaxys[a].enlightmentsJob.progress+=Math.round(10*Math.random());d={},d[b]=e>100?"100%":e+"%"}dataModel.galaxys[a].enlightmentsJob.progress=+d[b].substr(0,d[b].length-1),app.hey(HEY_ENLIGHTMENTS_COMP_PROGRESS,a,d[b],KEEP_SILENT)},null,call.METHOD_GET,call.URL_COMPUTATION_SERVICE,"ajax")},this.updateEnlightments=function(b){null==b&&(b=appModel.galaxyID),null==dataModel.galaxys[b].enlightmentsJob.progress&&(dataModel.galaxys[b].enlightmentsJob.progress=100);var c={action:"COMPUTE_HADOOP",instruction:"HADOOP_FETCH_RESULT",parameter:dataModel.galaxys[b].enlightmentsJob.id};call.request(c,b,null,function(b,c,d){null==d&&(d={Results:{rules:[]}},d.Results.rules=d.Results.rules.concat([{ID:0,IFs:[{Source:"S_Puppis",Condition:"θ"}],THEN:{Source:"SO_Orion",Condition:"γ"},CONFIDENCE:.987,OCCURRENCES:293},{ID:1,IFs:[{Source:"S_Norma",Condition:"δ"}],THEN:{Source:"NB_Pavo",Condition:"δ"},CONFIDENCE:.956,OCCURRENCES:1670},{ID:2,IFs:[{Source:"NU_Camelopardalis",Condition:"γ"}],THEN:{Source:"NU_UrsaMinor",Condition:"γ"},CONFIDENCE:.931,OCCURRENCES:149},{ID:3,IFs:[{Source:"S_Norma",Condition:"δ"}],THEN:{Source:"S_Mensa",Condition:"δ"},CONFIDENCE:.948,OCCURRENCES:689},{ID:4,IFs:[{Source:"S_Lepus",Condition:"η"},{Source:"S_Pictor",Condition:"δ"},{Source:"S_Caelum",Condition:"δ"},{Source:"S_Vela",Condition:"η"},{Source:"S_Octans",Condition:"δ"},{Source:"S_Antlia",Condition:"δ"},{Source:"S_Fornax",Condition:"δ"},{Source:"S_Horologium",Condition:"δ"},{Source:"S_Miscroscope",Condition:"δ"}],THEN:{Source:"S_Grus",Condition:"η"},CONFIDENCE:.963,OCCURRENCES:131},{ID:5,IFs:[{Source:"S_Norma",Condition:"δ"}],THEN:{Source:"S_Reticulum",Condition:"δ"},CONFIDENCE:.938,OCCURRENCES:305}]),d.Results.rules=d.Results.rules.concat([{ID:0,conclusion:["Z_Scorpio.θ","Z_Virgo.θ"],premise:["Z_Libra.θ"],support:.012,confidence:.964,basketshavingall:53,basketshavingany:55,togetherness:.9466909090909091},{ID:1,conclusion:["Z_Scorpio.θ"],premise:["Z_Sagittarius.θ"],support:.012,confidence:.964,basketshavingall:54,basketshavingany:59,togetherness:.8825084745762711},{ID:2,conclusion:["Z_Scorpio.θ"],premise:["Z_Aquarius.θ"],support:.013,confidence:.965,basketshavingall:55,basketshavingany:59,togetherness:.956050847457627},{ID:3,conclusion:["Z_Sagittarius.θ"],premise:["Z_Pisces.θ"],support:.012,confidence:.964,basketshavingall:54,basketshavingany:58,togetherness:.8977241379310344},{ID:4,conclusion:["Z_Capricorn.θ"],premise:["Z_Leo.θ"],support:.013,confidence:.982,basketshavingall:56,basketshavingany:60,togetherness:.9401166666666666},{ID:5,conclusion:["Z_Aquarius.θ"],premise:["Z_Scorpio.θ"],support:.013,confidence:.965,basketshavingall:55,basketshavingany:59,togetherness:.956050847457627},{ID:6,conclusion:["Z_Pisces.θ"],premise:["Z_Sagittarius.θ"],support:.012,confidence:.964,basketshavingall:54,basketshavingany:58,togetherness:.8977241379310344}]),d.Results.rules=d.Results.rules.concat([{alarm:"S_Circinus.β",confidence:.752,hits:97},{alarm:"S_Circinus.δ",confidence:.712,hits:94},{alarm:"S_Sculptor.β",confidence:.829,hits:92},{alarm:"NB_Apus.δ",confidence:.702,hits:66},{alarm:"SO_Canis Major.α",confidence:.877,hits:193},{alarm:"SO_Canis Minor.α",confidence:.958,hits:181},{alarm:"SO_Unicorn.δ",confidence:.889,hits:104},{alarm:"NU_Hydrus.γ",confidence:.772,hits:152},{alarm:"NU_UrsaMajor.γ",confidence:.854,hits:164},{alarm:"NU_UrsaMinor.α",confidence:.709,hits:112},{alarm:"NU_Canes.α",confidence:.8,hits:88},{alarm:"NU_Canes.γ",confidence:.853,hits:453},{alarm:"NU_Coma.α",confidence:.972,hits:380},{alarm:"NU_Coma.γ",confidence:.962,hits:480},{alarm:"NU_Lynx.δ",confidence:.712,hits:259},{alarm:"NU_Delphinus.δ",confidence:.718,hits:262}])),null!=d.Results.Rules&&(d.Results.rules=d.Results.Rules),a.galaxys[b].enlightments=normalizeEnlightments(d.Results.rules),app.hey(HEY_ENLIGHTMENTS_LIST_RECEIVED,b)},null,call.METHOD_GET,call.URL_COMPUTATION_SERVICE,"ajax")},this.updateEnlightmentsImpact=function(b,c){null==b&&(b=appModel.galaxyID);var d=a.galaxys[b].enlightments[c],e="";for(var f in d.premise)e+=(0==f?"":" AND ")+d.premise[f].replace(".","/");app.hey(HEY_ENLIGHTMENTS_IMPACT_LOADING,b,c,KEEP_SILENT);var g={action:"KPI_AVG_SHORTTERM_DB",plant:appModel.galaxyID,instruction:"IF "+e+" THEN "+d.conclusion[0].replace(".","/")};call.request(g,b,null,function(b,e,f){d.events=null==f?dataModel.galaxys[b].TT[0].timeSeries.alarmRate.map(function(a){return[Math.round(a[0]+(Math.random()-.5)*appModel.TTStepMs()*Math.random()*10),Math.round(a[1]*Math.random()*.1)]}):f.events.map(function(a){return[moment(a.timeStamp).add("minutes",moment().zone()).valueOf(),a.value]}),d.isApplied=!0,d.timeClusters=a.getTimeClustersForEvents(d.events),d.stepIndex=0,app.hey(HEY_ENLIGHTMENTS_IMPACT_LOADED,b,c,KEEP_SILENT),c<a.galaxys[b].enlightments.length-1&&a.updateEnlightmentsImpact(b,c+1)},null,call.METHOD_GET,call.URL_COMPUTATION_SERVICE,"ajax")},this.updateReducedofihbposehgfui541757Rate=function(b){if(null!=b&&null!=a.galaxys[b].enlightments&&0!=a.galaxys[b].enlightments.length)for(var c in a.galaxys[b].TT){var d=a.galaxys[b].TT[c].timeSeries.alarmRate;if(0!=d.length){for(var e in d)d[e][2]=d[e][1];for(var f in a.galaxys[b].enlightments){var g=a.galaxys[b].enlightments[f];if(null!=g.events){var h=g.events.filter(function(a){return appModel.TT[c].tStart<=a[0]&&a[0]<=appModel.TT[c].tEnd});for(var e in h){var i=d.map(function(a){return a[0]}).indexOf(h[e][0]);-1==i&&(i=d.map(function(a){return a[0]}).indexOf(getIndexOfNearest(h[e][0],d.map(function(a){return a[0]})))),g.isApplied&&(d[i][2]=d[i][2]-h[e][1]),d[i][2]<0&&(d[i][2]=0)}}}}}},this.updateofihbposehgfui541757Table=function(a,b){if(null==a)return"no galaxy selected";null==b&&(b=0),dataModel.readyCount[b].alarmTable=0,app.hey(HEY_GETTING_SOIMOHIJS5474TABLE);var c={action:"LINE_SHORTTERM_DB",plant:appModel.galaxyID,parameter:appModel.TT[b].tStart.format("YYYYMMDDHH:mm:ss")+" "+appModel.TT[b].tEnd.format("YYYYMMDDHH:mm:ss")};call.request(c,a,b,function(a,b,c){var d=dataModel.galaxys[a].TT[b];d.alarmTable=[],c.events.forEach(function(a,b){for(var c in a){var e=c.substr(0,c.indexOf("/")),f=c.substr(c.indexOf("/")+1),g=c;d.alarmTable.push({id:g,description:dataModel.humanizeofihbposehgfui541757({Source:e,Condition:f}).Source+" "+dataModel.humanizeofihbposehgfui541757({Source:e,Condition:f}).Condition,source:e,condition:f,priority:Math.round(3*Math.random()),timeline:[],initiations:null}),a[c].forEach(function(e,f){f%2==0&&d.alarmTable[b].timeline.push([moment(e).add("minutes",moment().zone()).valueOf(),+a[c][+f+1]])}),d.alarmTable[b].timeline.sort(),d.alarmTable[b].initiations=d.alarmTable[b].timeline.filter(function(a){return a[1]==EVENT_ACTIVATION}).length}}),dataModel.readyCount[b].alarmTable=1,app.hey(HEY_DATA_STORED,b,null,KEEP_SILENT)},function(a,b){var c=dataModel.galaxys[a].TT[b];c.alarmTable=[];appModel.TT[b].tStart.valueOf(),appModel.TT[b].tEnd.valueOf();for(var d in alarmsMockData){c.alarmTable.push({id:"id_"+alarmsMockData[d].source+"_"+alarmsMockData[d].condition+(Math.random()>.3?"_1":"_2"),description:alarmsMockData[d].description,source:alarmsMockData[d].source,condition:alarmsMockData[d].condition,priority:alarmsMockData[d].priority,timeline:[],initiations:null});for(var e=c.timeSeries.alarmRate,f=null,g=c.alarmTable[d].source.fingerprint(),h=0;h<e.length;h++)(e[h][1]>SCALAR_KPI_META.alarmRateAvg.maximum*(d+1)/alarmsMockData.length&&e[h][0]%g<100||e[h][0]%g<1)&&(c.alarmTable[d].timeline.push([e[h][0],EVENT_ACTIVATION]),f=EVENT_ACTIVATION),f==EVENT_ACTIVATION&&e[h][0]%c.alarmTable[d].source.charCodeAt(2)==d&&c.alarmTable[d].timeline.push([e[h][0],EVENT_ACKNOWLEDG]),f==EVENT_ACTIVATION&&e[h][0]%c.alarmTable[d].source.charCodeAt(0)<10&&(c.alarmTable[d].timeline.push([e[h][0],EVENT_BACKTONORM]),f=EVENT_BACKTONORM);c.alarmTable[d].timeline.sort(),c.alarmTable[d].initiations=c.alarmTable[d].timeline.filter(function(a){return a[1]==EVENT_ACTIVATION}).length}dataModel.readyCount[b].alarmTable=1,app.hey(HEY_DATA_STORED,b,null,KEEP_SILENT)},call.METHOD_GET,appModel.bypass.alarmTableData?null:call.URL_COMPUTATION_SERVICE,"ajax")},this.updateofihbposehgfui541757Topology=function(a){null==a&&(a=appModel.galaxyID);var b=dataModel.galaxys[a],c=[];b.enlightments.forEach(function(a){c=c.concat(a.premise).concat(a.conclusion)});var c=arrayUnique(c).sort(d3.ascending).map(function(a){return{key:a}}),d={key:"All alarms",values:d3.nest().key(function(a){return a.key.length>0?a.key.substr(0,1):""}).key(function(a){return a.key.length>1?a.key.substr(0,2):""}).entries(c)},e=function(a){return a.id=a.key,delete a.key,null!=a.values&&(a.children=a.values.map(function(a){return e(a)}),delete a.values),a},f=e(d);b.alarmTopology=new DataTreeModel(f,b.enlightments),b.alarmTopology.init(),app.hey(HEY_SOIMOHIJS5474_TOPOLOGY_UPDATED)},this.updateAllKpis=function(c,d){null==c&&(c=a.galaxyIDs),null==d&&(d=0),c instanceof Array||(c=[c]);var e=appModel.TT[d].tStart.valueOf(),f=appModel.TT[d].tEnd.valueOf();if(dataModel.readyCount[d]={prios:0,scalarKpi:0,timeSeries:0},appModel.dataSource==DATA_SOURCE.KPISTORAGE){if(!a.kpiStorageServiceIsAvailable)return void c.forEach(function(a){b(a,d)});for(var g=0;g<c.length;g+=appModel.galaxysInOneCall){var h=c.slice(g,g+appModel.galaxysInOneCall),i={};i.startTime=e,i.endTime=f,i.filterIds=null,i.galaxyIds=h.join(),i.kpiIds=TIME_SERIES_META.alarmRate.id_kpistorageservice,i.sampleInterval=timeSeriesSampling(appModel.TTStep,a.timeSeriesSamples).value,call.request(i,h,d,function(b,c,d){null!=d&&d.forEach(function(b){var d=dataModel.galaxys[b.galaxyId].TT[c];
if(0==b.values.length)for(d.timeSeries.alarmRate=[],t=e;f>t;t+=(f-e)/a.timeSeriesSamples)d.timeSeries.alarmRate.push([t,0]);else d.timeSeries.alarmRate=b.values.map(function(a){return[a.time,a.value]});dataModel.readyCount[c].timeSeries++,app.hey(HEY_DATA_STORED,c,null,KEEP_SILENT)})},b,call.METHOD_GET,appModel.bypass.kpiData?null:call.URL_KPISTORAGE+"/timeSeries","ajax","json"),i.kpiIds=PRIORITIES_META.map(function(a){return a.id_kpistorageservice}).join()+","+SCALARKPISET_AS_ARRAY.map(function(a){return SCALAR_KPI_META[a].id_kpistorageservice}).join(),i.sampleInterval=timeSeriesSampling(appModel.TTStep,1).value,call.request(i,null,d,function(a,b,c){null!=c&&c.forEach(function(a){var c=dataModel.galaxys[a.galaxyId].TT[b];0==a.values.length?c[whatKpi(a.kpiId).type][whatKpi(a.kpiId).pointer]=0:(c[whatKpi(a.kpiId).type][whatKpi(a.kpiId).pointer]=a.values[0].value,"timeToAck"==whatKpi(a.kpiId).pointer&&(c.scalarKpi.timeToAck/=60)),"prios"==whatKpi(a.kpiId).type&&dataModel.readyCount[b].prios++,"scalarKpi"==whatKpi(a.kpiId).type&&dataModel.readyCount[b].scalarKpi++,app.hey(HEY_DATA_STORED,b,null,KEEP_SILENT)})},null,call.METHOD_GET,call.URL_KPISTORAGE+"/timeSeries","ajax","json")}}if(appModel.dataSource==DATA_SOURCE.KAIROS)for(var g=0;g<c.length;g+=appModel.galaxysInOneCall){var h=c.slice(g,g+appModel.galaxysInOneCall),i={cache_time:0,start_absolute:e,end_absolute:f,metrics:[]};h.forEach(function(b){for(var c=1;SOIMOHIJS5474_PRIORITY_LEVELS+1>c;c++)i.metrics.push({tags:{severity:[c+""]},name:"plant-"+b+"_priority"});i.metrics.push({tags:{},name:"plant-"+b+"_average_10min",aggregators:[{name:"avg",align_sampling:!0,sampling:timeSeriesSampling(appModel.TTStep,a.timeSeriesSamples)}]});for(var e in dataModel.galaxys[b].TT[d].scalarKpi)i.metrics.push({tags:{},name:"plant-"+b+"_"+SCALAR_KPI_META[e].id,aggregators:[{name:"avg",align_sampling:!0,sampling:{value:"24",unit:"hours"}}]})}),call.request(i,h,d,function(b,c,d){null!=d&&(d.queries.forEach(function(b,d){b=b.results[0];var g=b.name.substr(6,b.name.indexOf("_")-6),h=d%(SOIMOHIJS5474_PRIORITY_LEVELS+1+a.scalarKpiNumber),i=dataModel.galaxys[g].TT[c];if(3>h&&(i.prios[b.tags.severity[0]-1]=d3.sum(b.values.map(function(a){return a[1]})),dataModel.readyCount[c].prios++),3==h){if(0==b.values.length)for(i.timeSeries.alarmRate=[],t=e;f>t;t+=(f-e)/a.timeSeriesSamples)i.timeSeries.alarmRate.push([t,0]);else i.timeSeries.alarmRate=b.values;dataModel.readyCount[c].timeSeries++}if(h>3){var j=SCALARKPISET_AS_ARRAY[h-4];0==b.values.length?i.scalarKpi[j]=0:(i.scalarKpi[j]=d3.mean(b.values.map(function(a){return a[1]})),"timeToAck"==j&&(i.scalarKpi[j]/=60)),dataModel.readyCount[c].scalarKpi++}}),app.hey(HEY_DATA_STORED,c,null,KEEP_SILENT))},b,call.METHOD_POST,appModel.bypass.kpiData?null:call.URL_KAIROSDB,"http")}};var b=function(b,c){b instanceof Array||(b=[b]),b.forEach(function(b){for(var d=dataModel.galaxys[b].TT[c],e=appModel.TT[c].tStart.valueOf(),f=appModel.TT[c].tEnd.valueOf(),g="z".charCodeAt()-"0".charCodeAt(),h=[],i=[],j=dataModel.galaxys[b].name.replace(/(\s|_|&)/g,"z"),k=0;k<j.length;k++)i.push(Math.round((j.charCodeAt(k)-"0".charCodeAt())/g*100));for(var k=0;k<randomString.length;k++)h.push(Math.round((randomString.charCodeAt(k)-"a".charCodeAt())/("z".charCodeAt()-"a".charCodeAt())*100));d.timeSeries.alarmRate=[];var l=.002*h[+b],m=1.8,n=.1,o=36e5*(h[+b+i[2]]+1)*5,p=462e4*h[+b];for(t=e;f>t;t+=Math.round((f-e)/a.timeSeriesSamples))d.timeSeries.alarmRate.push([t,0+l*h[(t+b)%h.length]+m*h[Math.floor((t+p)/o%h.length)]*(t+p<(Math.floor((t+p)/o)+n)*o?1:0)*(.01*h[i[1]]*Math.abs(Math.sin(t/1e3/60/b*h[i[1]]+h[i[1]]))+.01*h[i[2]]*Math.abs(Math.sin(t/1e3/60/b*h[i[2]]+h[i[2]])))]);dataModel.readyCount[c].timeSeries++;for(var k=0;SOIMOHIJS5474_PRIORITY_LEVELS>k;k++)d.prios[k]=d3.sum(d.timeSeries.alarmRate.map(function(a){return a[1]<k*SCALAR_KPI_META.alarmRateAvg.maximum?a[1]:10}));dataModel.readyCount[c].prios+=SOIMOHIJS5474_PRIORITY_LEVELS,d.scalarKpi.alarmRateAvg=d3.mean(d.timeSeries.alarmRate.map(function(a){return a[1]})),d.scalarKpi.alarmRatePeak=d3.max(d.timeSeries.alarmRate.map(function(a){return a[1]})),d.scalarKpi.timeToAck=d.scalarKpi.alarmRateAvg*h[i[0]]/150+1,d.scalarKpi.staleofihbposehgfui541757s=h[i[0]+i[1]+i[2]]*d.scalarKpi.alarmRateAvg/120,d.scalarKpi.staleofihbposehgfui541757sOldest=(h[i[0]]+d.scalarKpi.alarmRatePeak)*b/2e3,d.scalarKpi.timeInFlood=d.timeSeries.alarmRate.filter(function(a){return a[1]>SCALAR_KPI_META.alarmRateAvg.maximum}).length/d.timeSeries.alarmRate.length*100,dataModel.readyCount[c].scalarKpi+=a.scalarKpiNumber,app.hey(HEY_DATA_STORED,c,null,KEEP_SILENT)})};this.getTimeSeries=function(b,c,d){if(null==b&&(b=a.galaxyIDs),null==c&&(c=0),null==d&&(d="alarmRate"),b instanceof Array){var e=[];for(t in b)e.push(a.galaxys[b[t]].TT[c].timeSeries[d]);return e}return a.galaxys[b].TT[c].timeSeries[d]},this.getEnlightmentsImpact=function(b,c){if(null==b&&(b=a.galaxyIDs),null==c&&(c=0),b instanceof Array){var d=[];for(t in b)d.push(a.galaxys[b[t]].enlightmentsImpact.filter(function(a){return appModel.TT[c].tStart<=a[0]&&a[0]<=appModel.TT[c].tEnd}));return d}return hiddenRate=a.galaxys[b].enlightmentsImpact.filter(function(a){return appModel.TT[c].tStart<=a[0]&&a[0]<=appModel.TT[c].tEnd})},this.getofihbposehgfui541757Priorities=function(b,c){if(null==b&&(b=a.galaxyIDs),null==c&&(c=0),b instanceof Array){var d=[];for(t in b)d.push(a.galaxys[b[t]].TT[c].prios);return d}return a.galaxys[b].TT[c].prios},this.getScalarKpi=function(b,c){if(null==b&&(b=a.galaxyIDs),null==c&&(c=0),b instanceof Array){var d=[];for(t in b)d.push(a.galaxys[b[t]].TT[c].scalarKpi);return d}return a.galaxys[b].TT[c].scalarKpi},this.getofihbposehgfui541757Table=function(b,c){if(null==b)return"no galaxy selected";null==c&&(c=0);var d=[];c instanceof Array||(c=[c]);for(t in c)d.push(a.galaxys[b].TT[c[t]].alarmTable);return d},this.getUniqueofihbposehgfui541757s=function(b){if(null==b)return"no galaxy selected";var c=a.galaxys[b].TT[0].alarmTable.map(function(a){return{id:a.id,initiations:a.initiations}});return appModel.historyHidden||a.galaxys[b].TT[1].alarmTable.forEach(function(a){var b=c.map(function(a){return a.id}).indexOf(a.id);-1==b?c.push({id:a.id,initiations:a.initiations}):c[b].initiations+=a.initiations}),c.sort(function(a,b){return b.initiations-a.initiations})},this.getTimeClustersForEvents=function(a,b){null==b&&(b=appModel.TTStepMs());for(var c=[],d=a.map(function(a){return a[0]}),e=moment(moment(d3.min(d)).format(FORMAT_DATE_MED),FORMAT_DATE_MED).valueOf();e<d3.max(d);)c.push(e),e+=b;return c},this.humanizeofihbposehgfui541757=function(b){if(null==b)return"alarm.wrong";"object"!=typeof b&&(b=a.parseofihbposehgfui541757IntoSourceAndCondition(b));for(var c="",d="",e=function(a,b){if(a.charCodeAt()=="_".charCodeAt())return"";if("0".charCodeAt()<a.charCodeAt()&&a.charCodeAt()<"9".charCodeAt())return a;var c=a.toLowerCase().charCodeAt()-"a".charCodeAt(),d=[["accumulator","battery","connection","disk","electric","fan","gas","hard drive","immitator","job","key","lubricant","motor","nuclear","o","pump","quality","rotor","station","turbine","unit","valve","weird error","x-section","y","zone"],["acceleration","burst","current","density","energy","frequency","growth","hard drive","immitator","junction","key","level","motor","n","o","pressure","quality","reaction","supply","turbine","unit","voltage","weird error","x-section","y","zone"]];return d[b][c]+" "},f=0;f<Math.min(5,b.Source.length);f++)c+=2>f?e(b.Source[f],f):b.Source[f];switch(c=c[0].toUpperCase()+""+c.substr(1),b.Condition){case"γ":d="too high";break;case"α":d="very high";break;case"δ":d="too low";break;case"δ":d="very low";break;case"θ":d="open";break;case"η":d="out";break;case"μ":d="closed";break;case"SUO":d="destroyed";break;case"YFSO":d="lost";break;default:d="Happened"}return c+" "+d},this.sortAssetsByKpi=function(b,c){a.galaxySortedByKpiIDs=arraySortingIndeces(dataModel.galaxyIDs.map(function(a){return dataModel.galaxys[a].TT[c].scalarKpi[b]})).map(function(a){return a+1})},this.parseofihbposehgfui541757IntoSourceAndCondition=function(a){return{Source:a.substr(0,a.indexOf(".")),Condition:a.substr(a.indexOf(".")+1)}}}function AppControllers(){var a=$("#drawerCallButton"),b=$(".footerDrawerGroup");a.click(function(){b.hasClass("up")?(b.removeClass("up"),$(this).removeClass("active")):(b.addClass("up"),$(this).addClass("active"))});var c=$(".panel-section"),d=$("#content"),e=null;c.each(function(){var a=$(this),b=$("h1",a);b.remove();var c=b.html();a.appendTo(d),$("#nav").append($('<div class="tab button">'+c+"</div>").click(function(){null!=e&&e!=a&&e.hide(),a.show(),e=a}))});var f=$(".drawer .tab");f.click(function(){f.removeClass("selected"),$(this).addClass("selected")})}function uppercaseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()}function quartiles(a){return{q25:d3.quantile(a,.25),q75:d3.quantile(a,.75),q10:d3.quantile(a,.1),q90:d3.quantile(a,.9)}}function getIndexOfNearest(a,b){var c,d,e,f=0;if(b.length){c=b[0];for(var f;f<b.length;f++)d=Math.abs(a-c),e=Math.abs(a-b[f]),d>e&&(c=b[f]),d=null,e=null;return c}return!1}function linterpolateArray(a,b,c,d){var e,f=a.length-1;if(c<a[0]){if(e=1,d)return b[0]}else if(a[f]<c){if(e=f,d)return b[f]}else for(var g=0;f>g;g++)if(a[g]<=c&&c<=a[g+1]){e=g+1;break}return b[e-1]+(b[e]-b[e-1])*(c-a[e-1])/(a[e]-a[e-1])}function humanize(a){switch(a){case"rfailure":return"Risk of failure";case"age":return"Age beard";default:return uppercaseFirstLetter(a)}}function log(a){}function OneplantView(a){var b=this;this.TRANSITION_DURATION_LAGOM=500,this.TRANSITION_DURATION_LONG=1e3,this.TABLEROW_H=300,this.SOIMOHIJS5474TABLE_ROW_H=20,this.PRIORITIES_H=12,this.ID_W=40,this.NUMBER_W=20,this.HORIZON_H=25,this.HORIZON_W=.5*window.innerWidth,this.BULLET_H=5,this.COL_MARGIN=window.innerWidth<1350?.01*window.innerWidth:.02*window.innerWidth,this.BULLET_BOXW=appModel.width-this.HORIZON_W-this.ID_W-this.PRIORITIES_W-9*this.COL_MARGIN,this.HEADER_H=50,this.BULLETONE_W=this.BULLET_BOXW/dataModel.scalarKpiNumber+this.COL_MARGIN,this.leftPartWidth=window.innerHeight<764?170:250,this.rightPartWidth=.5*window.innerWidth-this.leftPartWidth,this.lowerPartHeight=(window.innerHeight-80)/2,this.PRIORITIES_W=this.leftPartWidth-this.COL_MARGIN-appModel.margin.left,this.SCROLLBAR_W=10,this.widthTopLeft=[this.leftPartWidth/2,this.leftPartWidth/2],this.topLeftTemplate=[{nameShort:"Luminosity",methodShort:"",units:""},{nameShort:"",methodShort:"",units:""},{nameShort:"Initiations",methodShort:"",units:""}],this.topCenterTemplate=SCALARKPISET_AS_ARRAY,this.timeSeriesVis=d3.lineChart().width(this.HORIZON_W-b.COL_MARGIN).height(b.lowerPartHeight-24).duration(b.TRANSITION_DURATION_LAGOM).xAxisOn(!0).yAxisOn(!0).xAxisHideFirstTick(!0).ymax(SCALAR_KPI_META.alarmRatePeak.target).xyAuto(!0),this.priorityVis=d3.linearDonut().height(this.PRIORITIES_H).color(colormapPriorities),this.alarmTableVis=d3.o2rin57yr357().duration(b.TRANSITION_DURATION_LAGOM).height(b.SOIMOHIJS5474TABLE_ROW_H);var c=d3.select(a).append("div").attr("class","subcontainer oneplant");c.style("display","none");var d=c.append("div").attr("class","topRow").style("height",this.HEADER_H+appModel.margin.top+"px"),e=d.append("div").attr("class","leftpart").style("width",b.leftPartWidth+"px"),f=d.append("div").attr("class","centerpart"),g=(d.append("div").attr("class","rightpart").style("width",b.rightPartWidth+"px"),c.append("div").attr("class","leftPlusCenter").style("width",b.leftPartWidth+.5*window.innerWidth+"px")),h=g.append("div").attr("class","alarmTable").style("height",(window.innerHeight-80)/2-this.HEADER_H-appModel.margin.top+"px"),i=g.append("div").attr("class","lowerhalf").style("height",(window.innerHeight-80)/2+"px"),j=i.append("div").attr("class","leftpart").style("width",b.leftPartWidth+"px"),k=i.append("div").attr("class","centerpart").style("width",.5*window.innerWidth+"px"),l=c.append("div").attr("class","rightpart").style("width",b.rightPartWidth+"px"),m=c.append("div").attr("class","largeCentral").style("top",this.HEADER_H+appModel.margin.top+"px").style("left",this.leftPartWidth+"px").style("width",window.innerWidth/2+"px").style("height",window.innerHeight-80-this.HEADER_H-appModel.margin.top+"px"),n=e.append("div").style("position","absolute").style("height",b.HEADER_H+"px").style("margin-left",appModel.margin.left+"px"),o=e.append("div").style("position","absolute").style("height",b.HEADER_H+"px");n.append("span").attr("class","topline priosLabel").text(b.topLeftTemplate[0].nameShort),n.append("span").attr("class","topline priority history good"),n.append("span").attr("class","topline priority history").text(" - "),n.append("span").attr("class","topline priority history med"),n.append("span").attr("class","topline priority history").text(" - "),n.append("span").attr("class","topline priority history bad"),o.append("span").attr("class","topline priority current good"),o.append("span").attr("class","topline priority current").text(" - "),o.append("span").attr("class","topline priority current med"),o.append("span").attr("class","topline priority current").text(" - "),o.append("span").attr("class","topline priority current bad");var p=e.append("svg");p.append("g").attr("class","priority history"),p.append("g").attr("class","priority current"),f.selectAll("div").data(b.topCenterTemplate).enter().append("div").style("margin-right",b.COL_MARGIN+"px").each(function(a){var b=d3.select(this);b.append("span").attr("class","topline").text(SCALAR_KPI_META[a].methodShort+" "+SCALAR_KPI_META[a].nameShort),b.append("br"),b.append("span").attr("class","value history"),b.append("span").attr("class","value current"),b.append("span").attr("class","subline").text(" "),b.append("br").attr("class","history"),b.append("span").attr("class","subline").text(SCALAR_KPI_META[a].units)}),k.append("div").attr("class","topRow").attr("id","timeSeriesTitle").append("span").attr("class","topline").text(TIME_SERIES_META.alarmRate.name);var q=k.append("svg");q.append("g").attr("class","timeSeries history"),q.append("g").attr("class","timeSeries current"),this.iWannaSelectCentralView=function(a){switch(null==a&&(a=d3.select(this).attr("id")),j.selectAll(".option").classed("selected",function(){return d3.select(this).attr("id")==a}),b.alarmRelationsView.hide(),q.attr("visibility","hidden"),a){case d3.keys(TIME_SERIES_META)[0]:q.attr("visibility","visible");break;case d3.keys(ANALYTICS_RESULTS_META)[0]:b.alarmRelationsView.show(),$(".largeCentral").animate({scrollTop:0},b.TRANSITION_DURATION_LONG);break;case d3.keys(ANALYTICS_RESULTS_META)[d3.keys(ANALYTICS_RESULTS_META).length-1]:b.alarmRelationsView.show(),$(".largeCentral").animate({scrollTop:$(".largeCentral")[0].scrollHeight},b.TRANSITION_DURATION_LONG)}appModel.oneplantLargeCentralState=a};var r=j.append("div").attr("class","timeseries topRow");r.append("span").attr("class","topline").html("Time series<br/>");var s=r.append("div").attr("class","options");for(var t in TIME_SERIES_META)s.append("span").attr("class","option button").attr("id",t).html(TIME_SERIES_META[t].name+"<br/>").on("click",b.iWannaSelectCentralView);var u=j.append("div").attr("class","analyticsResults topRow");u.append("span").attr("class","topline").html("Analytics results<br/>");var s=u.append("div").attr("class","options");for(var t in ANALYTICS_RESULTS_META)s.append("span").attr("class","option button").attr("id",t).html(ANALYTICS_RESULTS_META[t].name+"<br/>").on("click",b.iWannaSelectCentralView);j.append("div").attr("class","axisExplanation").text("?");var v=j.append("div").attr("class","contacts topRow");v.append("br"),v.append("span").attr("class","contacts topline").text("contact"),v.append("br"),v.append("span").attr("class","contacts subline name"),v.append("span").attr("class","contacts subline email"),v.append("span").attr("class","contacts subline phone");var w=l.append("div").attr("class","oneplant uiframework analysis actionbar");w.append("div").attr("class","button").html("Compute relations").on("click",function(){dataModel.iWannaComputeEnlightments(null,{ruletype:"fullycontains",inputfile:"KPI/inputdata/data-1.csv"})});var x=l.append("div").attr("class","resultstable");this.enlightmentsTableView=new EnlightmentsTableView(x,this),this.alarmRelationsView=new ofihbposehgfui541757RelationsView(m,this),b.iWannaSelectCentralView(null!=appModel.oneplantLargeCentralState?appModel.oneplantLargeCentralState:d3.keys(TIME_SERIES_META)[0]),this.updateTimeSeries=function(a){null==a&&(a=appModel.galaxyID),dataModel.updateReducedofihbposehgfui541757Rate(a),q.select("g.timeSeries.history").attr("transform","translate(0,0)").data([dataModel.getTimeSeries(a,1)]).call(b.timeSeriesVis.width(b.HORIZON_W/2-b.COL_MARGIN).xmin(appModel.TT[1].tStart.valueOf()).xmax(appModel.TT[1].tEnd.valueOf()).xFrameOn(!1)),q.select("g.timeSeries.current").attr("transform","translate("+(appModel.historyHidden?0:b.HORIZON_W/2)+",0)").data([dataModel.getTimeSeries(a,0)]).call(b.timeSeriesVis.width((appModel.historyHidden?b.HORIZON_W:b.HORIZON_W/2)-b.COL_MARGIN).xmin(appModel.TT[0].tStart.valueOf()).xmax(appModel.TT[0].tEnd.valueOf()))},this.update=function(a){if(null==a&&(a=appModel.galaxyID),null==a)return void app.hey(HEY_NO_ASSET_SELECTED);b.enlightmentsTableView.update(a),b.alarmRelationsView.update(a),b.updateTimeSeries(a),o.style("margin-left",b.PRIORITIES_W/2+.5*b.COL_MARGIN+appModel.margin.left+"px");var c=dataModel.galaxys[a].TT[0].prios;o.select("span.current.good").text(Math.round(c[0]/d3.sum(c)*100)),o.select("span.current.med").text(Math.round(c[1]/d3.sum(c)*100)),o.select("span.current.bad").text(Math.round(c[2]/d3.sum(c)*100)+"%");var c=dataModel.galaxys[a].TT[1].prios;n.select("span.history.good").text(Math.round(c[0]/d3.sum(c)*100)),n.select("span.history.med").text(Math.round(c[1]/d3.sum(c)*100)),n.select("span.history.bad").text(Math.round(c[2]/d3.sum(c)*100)+"%"),p.select("g.priority.history").attr("transform","translate("+appModel.margin.left+",20)").data([dataModel.getofihbposehgfui541757Priorities(a,1)]).call(b.priorityVis.width(appModel.historyHidden?1:b.PRIORITIES_W/2)),p.select("g.priority.current").attr("transform","translate("+(appModel.historyHidden?appModel.margin.left:b.PRIORITIES_W/2+.5*b.COL_MARGIN+appModel.margin.left)+",20)").data([dataModel.getofihbposehgfui541757Priorities(a,0)]).call(b.priorityVis.width(appModel.historyHidden?this.PRIORITIES_W:b.PRIORITIES_W/2)),f.selectAll("div").each(function(b){var c=d3.select(this);c.select("span.value.history").text(SCALAR_KPI_META[b].format(dataModel.galaxys[a].TT[1].scalarKpi[b])+" ⇨ "),c.select("span.value.current").text(SCALAR_KPI_META[b].format(dataModel.galaxys[a].TT[0].scalarKpi[b]))}),j.select("span.contacts.subline.name").html(dataModel.galaxys[a].manager.name+"<br/>"),j.select("span.contacts.subline.email").html(dataModel.galaxys[a].manager.email+"<br/>"),j.select("span.contacts.subline.phone").html(dataModel.galaxys[a].manager.phone);var d=dataModel.getofihbposehgfui541757Table(a,[0,1]),e=d[0].map(function(a){return a.id}),g=d[1].map(function(a){return a.id}),i=h.selectAll(".row").data(dataModel.getUniqueofihbposehgfui541757s(a));i.enter().append("div").attr("class",function(a,b){return"row"+(b%2==0?"":" alt")}).each(function(){var a=d3.select(this),c=a.append("div").attr("class","rowLeft").style("width",b.leftPartWidth+"px");c.append("div").attr("class","priority"),c.append("div").attr("class","source"),c.append("div").attr("class","initiations");var d=a.append("div").attr("class","rowCenter").style("width",b.HORIZON_W-10+"px").append("svg");d.append("g").attr("class","timeline history"),d.append("g").attr("class","timeline current")}),i.exit().remove(),i.each(function(c){var f=d3.select(this),h=e.indexOf(c.id);if(-1!=h)var i=d[0][h],j=i;var k=g.indexOf(c.id);if(-1!=k)var l=d[1][k],j=l;f.select(".priority").style("background-color",colormapPriorities(j.priority)).style("width",b.leftPartWidth*c.initiations/dataModel.getUniqueofihbposehgfui541757s(a)[0].initiations+"px"),f.select(".source").text(j.source+"."+j.condition.toLowerCase()),f.select(".initiations").text(c.initiations),f.select(".timeline.current").data([null==i?[]:i.timeline]).attr("transform","translate("+(appModel.historyHidden?0:b.HORIZON_W/2)+",0)").call(b.alarmTableVis.width((appModel.historyHidden?b.HORIZON_W:b.HORIZON_W/2)-b.COL_MARGIN).xmin(appModel.TT[0].tStart.valueOf()).xmax(appModel.TT[0].tEnd.valueOf())),f.select(".timeline.history").data([null==l?[]:l.timeline]).attr("transform","translate(0,0)").call(b.alarmTableVis.width(b.HORIZON_W/2-b.COL_MARGIN).xmin(appModel.TT[1].tStart.valueOf()).xmax(appModel.TT[1].tEnd.valueOf()))}),d3.selectAll(".history").attr("visibility",appModel.historyHidden?"hidden":"visible"),d3.selectAll(".topRow span.history, br.history").style("display",appModel.historyHidden?"none":"inline"),d3.selectAll(".oneplant .priosLabel").style("display",appModel.historyHidden?"inline":"none"),app.hey(HEY_ONEPLANT_UPDATED)},this.hideHistory=function(){d3.selectAll(".oneplant .history").attr("visibility","hidden"),d3.selectAll(".oneplant g.priority.current").transition().duration(overview.TRANSITION_DURATION_LAGOM).attr("transform","translate("+appModel.margin.left+",20)").call(b.priorityVis.width(b.PRIORITIES_W)),d3.selectAll(".oneplant .timeSeries.current").transition().duration(overview.TRANSITION_DURATION_LAGOM).attr("transform","translate(0,0)").call(b.timeSeriesVis.width(b.HORIZON_W-b.COL_MARGIN)),d3.selectAll(".oneplant .timeline.current").transition().duration(overview.TRANSITION_DURATION_LAGOM).attr("transform","translate(0,0)").call(b.alarmTableVis.width(b.HORIZON_W-b.COL_MARGIN)),d3.selectAll(".oneplant .topRow span.history, br.history").style("display","none"),d3.selectAll(".oneplant .priosLabel").style("display","inline")},this.showHistory=function(){d3.selectAll(".oneplant g.priority.current").transition().duration(overview.TRANSITION_DURATION_LAGOM).attr("transform","translate("+(b.PRIORITIES_W/2+.5*b.COL_MARGIN+appModel.margin.left)+",20)").call(b.priorityVis.width(b.PRIORITIES_W/2)),d3.selectAll(".oneplant .timeSeries.current").transition().duration(overview.TRANSITION_DURATION_LAGOM).attr("transform","translate("+b.HORIZON_W/2+",0)").call(b.timeSeriesVis.width(b.HORIZON_W/2-b.COL_MARGIN)),d3.selectAll(".oneplant .timeline.current").transition().duration(overview.TRANSITION_DURATION_LAGOM).attr("transform","translate("+b.HORIZON_W/2+",0)").call(b.alarmTableVis.width(b.HORIZON_W/2-b.COL_MARGIN)),d3.selectAll(".oneplant .topRow span.history, br.history").style("display","auto"),d3.selectAll(".oneplant .priosLabel").style("display","none")}}function ofihbposehgfui541757RelationsView(a,b){var c=this;this.topology=null;var d={top:0,right:20,bottom:10,left:10},e=Math.min(+a.style("width").unpixel(),+a.style("height").unpixel()),f=e-d.right-d.left,g=e-d.top-d.bottom,h=(a.append("div").attr("class","tooltip"),{Name:function(a,b){return d3.ascending(a.id,b.id)},Frequency:function(a,b){return c.topology.getLinksByNode(a).length-c.topology.getLinksByNode(b).length},"Length of the name":function(a,b){return a.id.length-b.id.length}});a.selectAll("div").remove();var i=a.append("div").attr("class","matrixLayoutContainer"),j=a.append("div").attr("class","circularLayoutContainer");this.matrixVis=new AdjacencyMatrix(i,c),this.hebVis=new HierarchicalEdgeBundling(j,c),this.matrixVis.margin(d).width(f).height(g).duration(b.TRANSITION_DURATION_LONG),this.hebVis.margin(d).width(f).height(g).duration(b.TRANSITION_DURATION_LONG),this.update=function(a){if(null==a&&(a=appModel.galaxyID),null!=dataModel.galaxys[a].alarmTopology){c.topology=dataModel.galaxys[a].alarmTopology;var b=d3.median(c.topology.links.map(function(a){return a.hits})),d=d3.max(c.topology.links.map(function(a){return a.shine})),e=d3.min(c.topology.links.map(function(a){return a.shine})),f={r:d3.scale.sqrt().domain([0,b]).range([4,10]),s:d3.scale.linear().domain([0,b]).range([0,1]),o:d3.scale.linear().domain([Math.min(.4,e),d]).range([.1,1])};c.matrixVis.scale(f).update(a),c.hebVis.scale(f).update(a),c.redraw()}},this.show=function(){a.style("visibility","visible")},this.hide=function(){a.style("visibility","hidden")},this.redraw=function(a){c.matrixVis.redraw(a),c.hebVis.redraw(a)},this.iWannaClick=function(a){c.iWannaHoverNodeOFF(a),a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null),c.redraw(a)},this.iWannaHoverLinkON=function(a){d3.select("div.tooltip").style("opacity",.9).html(a.source+" → "+a.target+" <br> shine: "+a.shine+" <br> hits: "+a.hits).style("top",d3.event.y+10+"px").style("left",d3.event.x+10+"px");var b=c.topology.getFirstVisibleNode(c.topology.getNodeByNodeID(a.source)).id,d=c.topology.getFirstVisibleNode(c.topology.getNodeByNodeID(a.target)).id;d3.selectAll(".vertical.id"+b.undot()).classed("hover",!0),d3.selectAll(".horizontal.id"+d.undot()).classed("hover",!0),d3.selectAll(".heb.id"+b.undot()).classed("hover",!0),d3.selectAll(".heb.id"+d.undot()).classed("hover",!0),d3.selectAll(".link.id"+a.source.undot()+a.target.undot()).classed("hover",!0)},this.iWannaHoverLinkOFF=function(a){d3.select("div.tooltip").style("opacity",0).style("top",0).style("left",0);var b=c.topology.getFirstVisibleNode(c.topology.getNodeByNodeID(a.source)).id,d=c.topology.getFirstVisibleNode(c.topology.getNodeByNodeID(a.target)).id;d3.selectAll(".vertical.id"+b.undot()).classed("hover",!1),d3.selectAll(".horizontal.id"+d.undot()).classed("hover",!1),d3.selectAll(".heb.id"+b.undot()).classed("hover",!1),d3.selectAll(".heb.id"+d.undot()).classed("hover",!1),d3.selectAll(".link.id"+a.source.undot()+a.target.undot()).classed("hover",!1)},this.iWannaHoverNodeON=function(a){d3.selectAll(".id"+a.id.undot()).classed("hover",!0),c.topology.getLeaves(a).forEach(function(a){d3.selectAll(".id"+a.id.undot()+" .grid").classed("hover",!0)}),c.topology.getLinksByNode(a).forEach(function(a){d3.selectAll(".link.id"+a.source.undot()+a.target.undot()).classed("hover",!0)})},this.iWannaHoverNodeOFF=function(a){d3.selectAll(".id"+a.id.undot()).classed("hover",!1),c.topology.getLeaves(a).forEach(function(a){d3.selectAll(".id"+a.id.undot()+" .grid").classed("hover",!1)}),c.topology.getLinksByNode(a).forEach(function(a){d3.selectAll(".link.id"+a.source.undot()+a.target.undot()).classed("hover",!1)})},this.iWannaHieUpDown=function(a){0==c.topology.hieLevel&&0>a||c.topology.hieLevel==c.topology.hieLevelMax&&a>0||(c.topology.hieLevel=c.topology.hieLevel+a,c.topology.tree=JSON.parse(JSON.stringify(c.topology._tree)),c.topology.nodes=c.topology.recomputeLayout(),c.topology.tree.x0=g/2,c.topology.tree.y0=0,c.topology.reduceTreeToDepth(c.topology.tree,c.topology.hieLevel),c.redraw())},this.iWannaSortLeavesBy=function(a){c.matrixVis.comparator(h[a]),c.hebVis.comparator(h[a]),c.redraw()}}function EnlightmentsTableView(a){var b=this;this.humanFormat=!1,this.exploringNowIndex=null,a.html("<br/><br/>Flares analysis and reduction"),this.elapsed=0,this.lastProgress=0,this.updateProgressBar=function(c){null==c&&(c=appModel.galaxyID);var d=dataModel.galaxys[c].enlightmentsJob.progress,e=dataModel.galaxys[c].enlightmentsJob.id,f=d;f>b.lastProgress&&(b.lastProgress=f,b.elapsed=0);var g=14>f?30:50>f?120:5,h=14>f?14:50>f?85:15;d=Math.min(100,f+h*(1-g/(3*b.elapsed++ +g))).toFixed(0),a.html("</br></br>Computation progress =  "+d+'%</br><progress max="100" value="'+d+'"></progress>'),log("Job "+e+" progress: "+f+"%, elapsed = "+b.elapsed+" s estimated progress = "+d)},this.update=function(c){if(null==c&&(c=appModel.galaxyID),null==dataModel.galaxys[c].enlightmentsJob.progress)return void a.html("<br/><br/>Flares analysis and reduction");if(dataModel.galaxys[c].enlightmentsJob.progress<100)return void b.updateProgressBar(c);var d=dataModel.galaxys[c].enlightments;if(null!=d){a.html("");var e=a.append("table"),f=e.append("tr");f.append("th").text(""),f.append("th").text("Relation").attr("colspan",3),f.append("th").text("With").attr("colspan",2),f.append("th").text("Confidence").attr("colspan",2),f.append("th").text("Hits").attr("colspan",2),f.append("th").text(appModel.TTStep).attr("colspan",2),f.append("th").text(""),e.selectAll(".row").data(d).enter().append("tr").each(function(a,c){var d=d3.select(this).attr("class",a.type+" link id"+(a.premise.length?a.premise[0].undot():a.conclusion[0].undot())+a.conclusion[0].undot()).attr("id","enlightment"+c).on("mouseover",b.iWannaHoverRowON).on("mouseout",b.iWannaHoverRowOFF),e=d.append("td"),f=e.append("input").attr("type","checkbox").attr("id","enlightmentCheck"+c).attr("checked",!0),g=e.append("label").attr("class","checkbox").attr("for","enlightmentCheck"+c);g.append("span"),f.property("checked",a.isApplied),e.append("div").attr("class","spinner").classed("spinning",null==a.events);var h=b.humanFormat?a.premise.map(function(a){return dataModel.humanizeofihbposehgfui541757(a)}):a.premise,i=b.humanFormat?a.conclusion.map(function(a){return dataModel.humanizeofihbposehgfui541757(a)}):a.conclusion,j=h.join("\n"),k=i.join("\n");h.length>2&&(h=h.slice(0,2),h[2]="..."),i.length>2&&(i=i.slice(0,2),i[2]="..."),d.append("td").attr("title",k).html(i.join("</br>")),d.append("td"),d.append("td"),d.append("td").attr("title",j).html(h.join("</br>")),d.append("td"),d.append("td");var l=(100*a.shine).toFixed(),m=d.append("td").append("div").attr("class","barContainer");m.append("div").attr("class","bar back"),m.append("div").attr("class","bar forth").style("width",l+"%"),m.append("div").attr("class","bar text").text(l+" %"),d.append("td").text(a.hits),d.append("td").text(0==c?"in":"");d.append("td").attr("class","stepIndex").text("");d.append("td").attr("class","timeClusters").text("");var n=d.append("td").append("div").attr("class","buttonContainer"),o=n.append("div").attr("class","button one").text("Find"),p=n.append("div").attr("class","button two").text("<<"),q=n.append("div").attr("class","button two").text(">>");null!=a.events&&b.unlockEnlightmentsTableAtLine(appModel.galaxyID,c),b.exploringNowIndex==c&&b.exploringNowAtLine(c,a.stepIndex),o.on("click",function(){b.exploringNowIndex=c,b.exploringNowAtLine(c,a.stepIndex),a.isApplied||(a.isApplied=!0,f.property("checked",!0),dataModel.updateReducedofihbposehgfui541757Rate(appModel.galaxyID)),b.serveHistory(a,a.stepIndex)}),q.on("click",function(){a.stepIndex++,a.stepIndex==a.timeClusters.length&&(a.stepIndex=0),b.exploringNowAtLine(c,a.stepIndex),b.serveHistory(a,a.stepIndex)}),p.on("click",function(){a.stepIndex--,-1==a.stepIndex&&(a.stepIndex=a.timeClusters.length-1),b.exploringNowAtLine(c,a.stepIndex),b.serveHistory(a,a.stepIndex)}),f.on("change",function(){a.isApplied=$(this).prop("checked"),app.hey(HEY_ENLIGHTMENTS_DISPLAY_RECOMPOSE)})});var g=a.append("div").attr("class","bottomContainer");g.append("div").attr("class","button humanformat").classed("active",b.humanFormat).attr("title","Humanized alarm names").on("click",function(){b.humanFormat=!0,b.update()}),g.append("div").attr("class","button robotformat").classed("active",!b.humanFormat).attr("title","Encoded alarm names").on("click",function(){b.humanFormat=!1,b.update()})}},this.serveHistory=function(a,b){appModel.setTT(moment(a.timeClusters[b]),1),app.hey(HEY_TIME_CHANGED,1),appModel.historyHidden&&(overview.showHistory(),oneplant.showHistory(),appModel.historyHidden=!1)},this.exploringNowAtLine=function(b,c){a.selectAll(".button.two").style("display","none"),a.selectAll(".button.one").style("display","inherit"),a.selectAll(".stepIndex").text(""),a.selectAll("#enlightment"+b+" .button.one").style("display","none"),a.selectAll("#enlightment"+b+" .button.two").style("display","inherit"),a.selectAll("#enlightment"+b+" .stepIndex").html("<span class='stress'>"+(c+1)+"</span>/")},this.unlockEnlightmentsTableAtLine=function(b,c){var d=dataModel.galaxys[b].enlightments[c];a.selectAll("#enlightment"+c+" .checkbox").style("display","inherit");var e=d.timeClusters.map(function(a,b){return b+1+") "+moment(a).format(FORMAT_DATE_SMA)}).join("\n");a.selectAll("#enlightment"+c+" .timeClusters").attr("title",e).text(d.timeClusters.length),a.selectAll("#enlightment"+c+" .buttonContainer").style("display","inherit")
},this.iWannaHoverRowON=function(a){var b=a.premise.length?a.premise[0]:a.conclusion[0],c=a.conclusion[0];d3.selectAll(".vertical.id"+b.undot()).classed("hover",!0),d3.selectAll(".horizontal.id"+c.undot()).classed("hover",!0),d3.selectAll(".heb.id"+b.undot()).classed("hover",!0),d3.selectAll(".heb.id"+c.undot()).classed("hover",!0),d3.selectAll(".link.id"+b.undot()+c.undot()).classed("hover",!0)},this.iWannaHoverRowOFF=function(a){var b=a.premise.length?a.premise[0]:a.conclusion[0],c=a.conclusion[0];d3.selectAll(".vertical.id"+b.undot()).classed("hover",!1),d3.selectAll(".horizontal.id"+c.undot()).classed("hover",!1),d3.selectAll(".heb.id"+b.undot()).classed("hover",!1),d3.selectAll(".heb.id"+c.undot()).classed("hover",!1),d3.selectAll(".link.id"+b.undot()+c.undot()).classed("hover",!1)}}function OverviewView(a){var b=this;this.TRANSITION_DURATION_SHORT=100,this.TRANSITION_DURATION_LAGOM=500,this.TRANSITION_DURATION_LONG=1e3,this.HEADER_H=40,this.FOOTER_H=40,this.NUMBER_W=30,this.COL_MARGIN=.01*window.innerWidth,this.TABLEROW_H=(window.innerHeight-this.HEADER_H-this.FOOTER_H-appModel.BLACKFRAME_H.top-appModel.BLACKFRAME_H.bottom)/dataModel.N_ASSETS,this.NAMES_SHOWN_WHEN_WINDOW_HEIGHT_IS_LARGER=764,this.ID_W=window.innerHeight>this.NAMES_SHOWN_WHEN_WINDOW_HEIGHT_IS_LARGER?80:0,this.PRIORITIES_H=.7*this.TABLEROW_H,this.PRIORITIES_W=120,this.TIMESERIES_W=.5*window.innerWidth,this.BULLET_BOXW=appModel.width-this.TIMESERIES_W-this.ID_W-this.PRIORITIES_W-9*this.COL_MARGIN,this.BULLETONE_W=this.BULLET_BOXW/dataModel.scalarKpiNumber+this.COL_MARGIN,this.TIME_SERIES_AXIS_H=30,this.TIME_SERIES_AXIS_Y=window.innerHeight-80-70-60,this.LEFTPART_W=this.NUMBER_W+this.ID_W+this.PRIORITIES_W+this.TIMESERIES_W+appModel.margin.left,this.RIGHTPART_W=window.innerWidth-this.LEFTPART_W,this.RIGHTCONTENT_W=this.RIGHTPART_W-appModel.margin.right-this.COL_MARGIN,this.offsetX=[],this.offsetX.push(0),this.offsetX.push(this.NUMBER_W),this.offsetX.push(this.offsetX[1]+this.ID_W),this.offsetX.push(this.offsetX[2]+this.PRIORITIES_W/2+this.COL_MARGIN/2),this.offsetX.push(this.offsetX[3]+this.PRIORITIES_W/2),this.offsetX.push(this.offsetX[4]+this.TIMESERIES_W/2),this.offsetX.push(this.offsetX[5]+this.TIMESERIES_W/2+this.COL_MARGIN/2),this.showing=[DATA_META.number,window.innerHeight>this.NAMES_SHOWN_WHEN_WINDOW_HEIGHT_IS_LARGER?DATA_META.galaxyName:SCALAR_KPI_META.empty,SHARES_META.priorityShares,SCALAR_KPI_META.empty,TIME_SERIES_META.alarmRate,SCALAR_KPI_META.empty];var c=d3.select(a).append("div").attr("class","subcontainer overview");d3.select("#backButton").style("visibility","hidden"),this.priorityVis=d3.linearDonut().duration(0).height(this.PRIORITIES_H).color(colormapPriorities),this.timeSeriesScale=d3.lineChart().height(this.TIME_SERIES_AXIS_H).dheight(this.TIME_SERIES_AXIS_H).xAxisOn(!0),this.timeSeriesVis=d3.lineChart().height(this.TABLEROW_H).dheight(this.TABLEROW_H-1).xAxisOn(!1).yAxisOn(!1).relativeToTheFirst(!0).xyAuto(!1).ymax(TIME_SERIES_META.alarmRate.maximum).ymin(0),this.scalarKpiVis=d3.dashPlot().duration(this.TRANSITION_DURATION_SHORT).stepy((this.TABLEROW_H*dataModel.N_ASSETS+this.HEADER_H)/dataModel.scalarKpiNumber).height(this.TABLEROW_H*dataModel.N_ASSETS+this.HEADER_H);var d=c.append("div").attr("class","topRow").style("top",appModel.margin.top+"px").style("height",b.HEADER_H+"px"),e=c.append("div").attr("class","leftPart").style("width",this.LEFTPART_W+"px"),f=c.append("div").attr("class","rightPart").style("width",this.RIGHTPART_W+"px"),g=e.append("svg").append("g").attr("transform","translate("+appModel.margin.left+","+(b.HEADER_H+appModel.margin.top)+")"),h=f.append("svg").append("g").attr("transform","translate("+b.COL_MARGIN+","+(b.HEADER_H+appModel.margin.top+8)+")");g.append("rect").attr("class","focusArea").attr("x",b.offsetX[1]).attr("width",b.offsetX[6]-b.offsetX[1]-b.COL_MARGIN).attr("height",b.TABLEROW_H*dataModel.N_ASSETS),g.append("g").data([[[0,0],[0,0]]]).attr("class","timeSeries history scale"),g.append("g").data([[[0,0],[0,0]]]).attr("class","timeSeries current scale");var i=h.append("g").attr("class","scalarKpiVis history"),j=h.append("g").attr("class","scalarKpiVis current");for(var k in this.showing){var l=k<b.offsetX.length-1?appModel.margin.left+b.offsetX[k]:appModel.margin.left+b.offsetX[b.offsetX.length-1]+b.COL_MARGIN+(b.BULLET_BOXW/dataModel.scalarKpiNumber+b.COL_MARGIN)*(k-b.offsetX.length+1),m=k<b.offsetX.length-1?100:this.BULLETONE_W;2==k&&(m=b.PRIORITIES_W),(4==k||5==k)&&(m=b.TIMESERIES_W/2);var n=""==b.showing[k].method||""==b.showing[k].units?"":", ",o=d.append("div").attr("class","topRow").style("left",l+"px").style("width",m+"px");o.append("span").attr("class","topline").text(function(){return b.showing[k].name}),o.append("br"),o.append("span").attr("class","subline").text(function(){return b.showing[k].units+n+b.showing[k].method}),2==k&&(o.append("span").attr("class","subline priority current good").text("low"),o.append("span").attr("class","subline priority current").text(" - "),o.append("span").attr("class","subline priority current med").text("med"),o.append("span").attr("class","subline priority current").text(" - "),o.append("span").attr("class","subline priority current bad").text("high")),5==k&&o.select(".topline").attr("id","hoverPlantName").text("")}this.iWannaTouch=new OverviewTouchSupport(b,c),this.iWannaHoverOff=function(a){d3.select(".table.row#"+ASSET_ID+a).select(".background").classed("active",!1),d3.selectAll("."+ASSET_ID+"#"+ASSET_ID+a).classed("active",!1),d3.select("#hoverPlantName").text(""),d3.select("span.priority.good").text("low"),d3.select("span.priority.med").text("med"),d3.select("span.priority.bad").text("high"),appModel.galaxyHoveredID=null},this.iWannaHoverOn=function(a){null!=appModel.galaxyHoveredID&&b.iWannaHoverOff(appModel.galaxyHoveredID),d3.select(".table.row#"+ASSET_ID+a).select(".background").classed("active",!0),d3.selectAll("."+ASSET_ID+"#"+ASSET_ID+a).classed("active",!0),d3.select("#hoverPlantName").text(dataModel.galaxys[a].name);var c=dataModel.galaxys[a].TT[0].prios;d3.select("span.priority.good").text(Math.round(c[0]/d3.sum(c)*100)),d3.select("span.priority.med").text(Math.round(c[1]/d3.sum(c)*100)),d3.select("span.priority.bad").text(Math.round(c[2]/d3.sum(c)*100)+" %"),appModel.galaxyHoveredID=a},this.iWannaClick=function(a){app.hey(HEY_SHOWME_THEPLANT,a);var c=d3.selectAll(".hideable");c.classed("hidden",function(){return d3.select(this).attr("id")!=ASSET_ID+a});var d=g.select("#"+ASSET_ID+a+".row"),e=d.attr("transform");d.transition().duration(b.TRANSITION_DURATION_LAGOM).attr("transform","translate(0,"+dataModel.N_ASSETS*b.TABLEROW_H+")"),setTimeout(function(){d.attr("transform",e),c.classed("hidden",!1),app.hey(HEY_DRILL_TOONEPLANT,a)},b.TRANSITION_DURATION_LONG)},d3.select("#hoverPlantName").on("click",function(){b.iWannaClick(appModel.galaxyHoveredID)}),this.update=function(){g.selectAll(".row").data(dataModel.galaxyIDs).enter().append("g").attr("class","table row hoverable hideable "+ASSET_ID).attr("id",function(a){return ASSET_ID+a}).attr("transform",function(a,c){return"translate(0,"+c*b.TABLEROW_H+")"}).each(function(a,c){var d=d3.select(this);d.append("rect").attr("class","background").attr("x",b.offsetX[1]).attr("width",b.offsetX[6]-b.offsetX[1]-b.COL_MARGIN).attr("height",b.TABLEROW_H),d.append("g").attr("class","priority history "+ASSET_ID).attr("id",ASSET_ID+a),d.append("g").attr("class","priority current "+ASSET_ID).attr("id",ASSET_ID+a),d.append("g").attr("class","timeSeries history "+ASSET_ID).attr("id",ASSET_ID+a),d.append("g").attr("class","timeSeries current "+ASSET_ID).attr("id",ASSET_ID+a),((c+1)%5==0||0==c)&&d.append("text").attr("class","galaxyNumber").attr("dy",b.TABLEROW_H/2+4).attr("transform","translate("+b.offsetX[0]+",0)").text(c+1+"."),window.innerHeight>b.NAMES_SHOWN_WHEN_WINDOW_HEIGHT_IS_LARGER&&d.append("text").attr("class","galaxyName").attr("dy",b.TABLEROW_H/2+4).attr("transform","translate("+b.offsetX[1]+",0)").style("font-size",b.TABLEROW_H>14?13:b.TABLEROW_H-1+"px")}),g.selectAll(".row").each(function(a){var c=d3.select(this);c.select(".priority.history").attr("transform","translate("+b.offsetX[2]+","+(b.TABLEROW_H-b.PRIORITIES_H)+")").data([dataModel.getofihbposehgfui541757Priorities(a,1)]).call(b.priorityVis.width(appModel.historyHidden?1:b.PRIORITIES_W/2-b.COL_MARGIN)),c.select(".priority.current").attr("transform","translate("+(appModel.historyHidden?b.offsetX[2]:b.offsetX[3])+","+(b.TABLEROW_H-b.PRIORITIES_H)+")").data([dataModel.getofihbposehgfui541757Priorities(a,0)]).call(b.priorityVis.width(appModel.historyHidden?b.PRIORITIES_W-b.COL_MARGIN/2:b.PRIORITIES_W/2-b.COL_MARGIN)),c.select(".timeSeries.history").attr("transform","translate("+b.offsetX[4]+",0)").data([dataModel.getTimeSeries(a,1)]).call(b.timeSeriesVis.galaxyID(a).width(b.TIMESERIES_W/2-b.COL_MARGIN).xmin(appModel.TT[1].tStart.valueOf()).xmax(appModel.TT[1].tEnd.valueOf())),c.select(".timeSeries.current").attr("transform","translate("+(appModel.historyHidden?b.offsetX[4]:b.offsetX[5])+",0)").data([dataModel.getTimeSeries(a,0)]).call(b.timeSeriesVis.galaxyID(a).width((appModel.historyHidden?b.TIMESERIES_W:b.TIMESERIES_W/2)-b.COL_MARGIN).xmin(appModel.TT[0].tStart.valueOf()).xmax(appModel.TT[0].tEnd.valueOf())),c.select("text.galaxyName").text(dataModel.galaxys[a].name)}),g.select(".timeSeries.history.scale").attr("transform","translate("+b.offsetX[4]+","+b.TIME_SERIES_AXIS_Y+")").call(b.timeSeriesScale.width(b.TIMESERIES_W/2-b.COL_MARGIN).xmin(appModel.TT[1].tStart.valueOf()).xmax(appModel.TT[1].tEnd.valueOf()).xAxisHideLastTick(!0)),g.select(".timeSeries.current.scale").attr("transform","translate("+(appModel.historyHidden?b.offsetX[4]:b.offsetX[5])+","+b.TIME_SERIES_AXIS_Y+")").call(b.timeSeriesScale.width((appModel.historyHidden?b.TIMESERIES_W:b.TIMESERIES_W/2)-b.COL_MARGIN).xmin(appModel.TT[0].tStart.valueOf()).xmax(appModel.TT[0].tEnd.valueOf()).xAxisHideLastTick(!1)),i.data([dataModel.getScalarKpi(null,1)]).attr("transform","translate(0,0)").call(b.scalarKpiVis.width(b.RIGHTCONTENT_W/2-b.COL_MARGIN)),j.data([dataModel.getScalarKpi(null,0)]).attr("transform","translate("+(appModel.historyHidden?0:b.RIGHTCONTENT_W/2+b.COL_MARGIN)+",0)").call(b.scalarKpiVis.width(appModel.historyHidden?b.RIGHTCONTENT_W:b.RIGHTCONTENT_W/2-b.COL_MARGIN)),d3.selectAll(".history").attr("visibility",appModel.historyHidden?"hidden":"visible"),d3.selectAll("."+ASSET_ID+".hoverable").on("mouseover",function(){b.iWannaHoverOn(d3.select(this).attr("id").substr(ASSET_ID.length))}),d3.selectAll("."+ASSET_ID+".hoverable").on("mouseout",function(){b.iWannaHoverOff(d3.select(this).attr("id").substr(ASSET_ID.length))}),d3.selectAll("."+ASSET_ID+".hoverable").on("click",function(){b.iWannaClick(d3.select(this).attr("id").substr(ASSET_ID.length))}),app.hey(HEY_OVERVIEW_UPDATED)},this.hideHistory=function(){d3.selectAll(".overview .history").attr("visibility","hidden"),d3.selectAll(".overview .priority.current").transition().duration(b.TRANSITION_DURATION_LAGOM).attr("transform","translate("+b.offsetX[2]+","+(b.TABLEROW_H-b.PRIORITIES_H)+")").call(b.priorityVis.width(b.PRIORITIES_W-b.COL_MARGIN/2)),d3.selectAll(".overview .timeSeries.current").transition().duration(b.TRANSITION_DURATION_LAGOM).attr("transform","translate("+b.offsetX[4]+",0)").call(b.timeSeriesVis.width(this.TIMESERIES_W-b.COL_MARGIN)),d3.selectAll(".overview .timeSeries.current.scale").transition().duration(b.TRANSITION_DURATION_LAGOM).attr("transform","translate("+b.offsetX[4]+","+b.TIME_SERIES_AXIS_Y+")").call(b.timeSeriesScale.width(this.TIMESERIES_W-b.COL_MARGIN)),d3.selectAll(".overview .scalarKpiVis.current").transition().duration(b.TRANSITION_DURATION_LAGOM).attr("transform","translate(0,0)").call(b.scalarKpiVis.width(b.RIGHTCONTENT_W))},this.showHistory=function(){d3.selectAll(".overview .priority.current").attr("transform","translate("+b.offsetX[3]+","+(b.TABLEROW_H-b.PRIORITIES_H)+")").call(b.priorityVis.width(b.PRIORITIES_W/2-b.COL_MARGIN)),d3.selectAll(".overview .timeSeries.current").attr("transform","translate("+b.offsetX[5]+",0)").call(b.timeSeriesVis.width(this.TIMESERIES_W/2-b.COL_MARGIN)),d3.selectAll(".overview .timeSeries.current.scale").transition().duration(b.TRANSITION_DURATION_LAGOM).attr("transform","translate("+b.offsetX[5]+","+b.TIME_SERIES_AXIS_Y+")").call(b.timeSeriesScale.width(this.TIMESERIES_W/2-b.COL_MARGIN)),d3.selectAll(".overview .scalarKpiVis.current").transition().duration(b.TRANSITION_DURATION_LAGOM).attr("transform","translate("+(b.RIGHTCONTENT_W/2+b.COL_MARGIN)+",0)").call(b.scalarKpiVis.width(b.RIGHTCONTENT_W/2-b.COL_MARGIN))}}function OverviewTouchSupport(a,b){var c,d=a,e={};b.select(".leftPart").on("touchstart",function(){d3.event.preventDefault(),c=[d3.mouse(this)[0],d3.mouse(this)[1]-d.HEADER_H],e.h=d3.select(this).style("height").unpixel()-d.HEADER_H-d.FOOTER_H,e.origin=Math.round(c[1]/e.h*dataModel.N_ASSETS)-1}).on("touchmove",function(){d3.event.preventDefault(),e.shift=Math.round((d3.mouse(this)[1]-d.HEADER_H-c[1])/e.h*dataModel.N_ASSETS),e.timeframe=!appModel.historyHidden&&d.offsetX[4]<d3.mouse(this)[0]&&d3.mouse(this)[0]<d.offsetX[5]?1:0,d3.mouse(this)[0]<d.offsetX[4]&&(e.timeframe=null),(e.shift!=e.shift_1||e.timeframe!=e.timeframe_1)&&d3.selectAll(".overview #galaxyID"+appModel.galaxyHoveredID+".row .timeSeries"+(1==e.timeframe_1?".history":".current")).call(d.timeSeriesVis.forceHoveringAt(null)),app.hover(dataModel.galaxyIDs,e.shift,e.origin,"don't loop"),null!=e.timeframe&&d3.selectAll(".overview #galaxyID"+appModel.galaxyHoveredID+".row .timeSeries"+(1==e.timeframe?".history":".current")).call(d.timeSeriesVis.forceHoveringAt([d3.mouse(this)[0]-d.offsetX[appModel.historyHidden||0!=e.timeframe?4:5]-appModel.margin.left,0])),e.shift_1=e.shift,e.timeframe_1=e.timeframe}).on("touchend",function(){d3.selectAll(".overview #galaxyID"+appModel.galaxyHoveredID+".row .timeSeries").call(d.timeSeriesVis.forceHoveringAt(null)),d3.select("#hoverPlantName").classed("highlight",!0),setTimeout(function(){d3.select("#hoverPlantName").classed("highlight",!1)},10*d.TRANSITION_DURATION_LONG)}),b.select(".rightPart").on("touchstart",function(){d3.event.preventDefault(),e.timeframe=!appModel.historyHidden&&d3.mouse(this)[0]<d.RIGHTPART_W/2?1:0,e.kpiIndex=Math.floor(d3.mouse(this)[1]/d3.select(this).style("height").unpixel()*dataModel.scalarKpiNumber),e.kpi=SCALARKPISET_AS_ARRAY[e.kpiIndex],c=[d3.mouse(this)[0]-(appModel.historyHidden||0!=e.timeframe?0:d.RIGHTCONTENT_W/2),d3.mouse(this)[1]],dataModel.sortAssetsByKpi(e.kpi,e.timeframe)}).on("touchmove",function(){d3.event.preventDefault();var a=[d3.mouse(this)[0]-(appModel.historyHidden||0!=e.timeframe?0:d.RIGHTCONTENT_W/2),0],b=appModel.historyHidden?d.RIGHTCONTENT_W:d.RIGHTCONTENT_W/2;a[0]<0&&(a[0]=0),a[0]>b&&(a[0]=b);var f=Math.round(c[0]/b*dataModel.N_ASSETS),g=Math.round((a[0]-c[0])/b*dataModel.N_ASSETS);app.hover(dataModel.galaxySortedByKpiIDs,g,f,"don't loop"),d3.selectAll(".overview .scalarKpiVis"+(1==e.timeframe?".history":".current")).call(d.scalarKpiVis.forceHoveringAt(a,e.kpiIndex))}).on("touchend",function(){d3.selectAll(".overview .scalarKpiVis").call(d.scalarKpiVis.forceHoveringAt(null,null)),app.hover(dataModel.galaxySortedByKpiIDs,0,null,"don't loop"),d3.select("#hoverPlantName").classed("highlight",!0),setTimeout(function(){d3.select("#hoverPlantName").classed("highlight",!1)},10*d.TRANSITION_DURATION_LONG)})}var colormapPriorities=d3.scale.ordinal().range(["#87C9CB","#EBCA72","#E08D65"]),colormapGradient=d3.scale.linear().range(["#cec09e","#b48f5d","#7e582a","#8b2500","#5d0000","#2c0000"]),TIME_SERIES_RESOLUTION=.5,EVENT_ACTIVATION=0,EVENT_BACKTONORM=2,EVENT_ACKNOWLEDG=1,OVERVIEW_DASHBOARD_TITLE="Flares on the stars",ONEPLANT_DASHBOARD_TITLE="Flares on the stars",SOIMOHIJS5474_PRIORITY_LEVELS=3,ASSET_ID="galaxyID",URL_PAGENAME="alarm-dashboard",URL_DEFAULTHOST=".ac.crcxnet.com",URL_PREFIX="?state=",STATEURL_PUSH="push",STATEURL_REPLACE="replace",TARGET_LO_ISGOOD="low is good",TARGET_HI_ISGOOD="high is good",FORMAT_DATE_SMA="DD.MM.YYYY",FORMAT_DATE_MED="DD MMM YYYY",FORMAT_DATE_NOY="DD MMM",FORMAT_TIME="hh:mm",DATA_SOURCE={KAIROS:"kairosDb",KPISTORAGE:"kpiStorageService"},KEEP_SILENT="don't put the message to the log and don't show the toast",SHARING_EMAIL_HEADER="Shared view from ABB Flares on the stars",SHARING_EMAIL_BODY="Please take a look at the following alarm situation:",SHARING_EMAIL_FOOTER="Regards, ",USER_NAME="Angie Skazka",HEY_LOADING_ON="Loading...",HEY_LOADING_OFF="Loading off",HEY_GETTING_SOIMOHIJS5474TABLE="requesting alarm table",HEY_ASSETS_READY="galaxys ready",HEY_KPIMETADATA_UPDATED="KPI metadata is updated",HEY_PARSING_DATA="parsing data",HEY_COLLECTION_COMPLETE="data collection complete",HEY_OVERVIEW_UPDATED="overview updated",HEY_ONEPLANT_UPDATED="one plant updated",HEY_DATA_RECEIVED="data received",HEY_DATA_STORED="data stored",HEY_DATA_FAILED="failed to receive data",HEY_TIME_CHANGED="time changed",HEY_DATASOURCE_CHANGED="data source changed",HEY_SHOWME_THEPLANT="user ordered to see one plant view",HEY_DRILL_TOONEPLANT="building screen for one plant",HEY_BACK_TOOVERVIEW="going back to overview",HEY_HISTORY_VISIBLE="history made visible",HEY_HISTORY_HIDDEN="history hidden",HEY_ENLIGHTMENTS_JOBS_FLUSHED="All jobs flushed",HEY_ENLIGHTMENTS_COMP_STARTED="enlightments computation started",HEY_ENLIGHTMENTS_COMP_PROGRESS="enlightments computation progress received",HEY_ENLIGHTMENTS_COMP_COMPLETE="enlightments computation complete",HEY_ENLIGHTMENTS_LIST_RECEIVED="received the list of enlightments",HEY_ENLIGHTMENTS_IMPACT_LOADING="fetching data on enlightment impact...",HEY_ENLIGHTMENTS_IMPACT_LOADED="got data on enlightment impact",HEY_ENLIGHTMENTS_DISPLAY_RECOMPOSE="reduced alarm rate graph need recompute and repaint",HEY_SOIMOHIJS5474_TOPOLOGY_UPDATED="updated alarm topology",HEY_NO_ASSET_SELECTED="no galaxy selected",randomString="A star is a massive, luminous sphere of plasma held together by its own gravity. The nearest star to Earth is the Sun, which is the source of most of the planets energy. Other stars are visible from Earth during the night, appearing as a multitude of fixed luminous points due to their immense distance. Historically, the most prominent stars were grouped into constellations and asterisms, and the brightest stars gained proper names. Extensive catalogues of stars have been assembled by astronomers, which provide standardized star designations. For at least a portion of its life, a star shines due to thermonuclear fusion of hydrogen into helium in its core, releasing energy that traverses the stars interior and then radiates into outer space. Once the hydrogen in the core of a star is nearly exhausted, almost all naturally occurring elements heavier than helium are created by stellar nucleosynthesis during the stars lifetime and, for some stars, by supernova nucleosynthesis when it explodes. Near the end of its life, a star can also contain degenerate matter. Astronomers can determine the mass, age, metallicity chemical composition, and many other properties of a star by observing its motion through space, luminosity, and spectrum respectively. The total mass of a star is the principal determinant of its evolution and eventual fate. Other characteristics of a star, including diameter and temperature, change over its life, while the stars environment affects its rotation and movement. A plot of the temperature of many stars against their luminosities, known as a Hertzsprung Russell diagram HR diagram, allows the age and evolutionary state of a star to be determined.".replace(/(\s|,|;|-|\?|\.|—|’|\(|\)|\[|\]|\d|“|”|:|!|\%)/g,"").toLowerCase();alarmsMockData=[{description:"Pressure high",source:"NP_Cepheus",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:1},{description:"Station not found",source:"SO_Orion",condition:"θ",timeline:[],staleofihbposehgfui541757s:1,priority:1},{description:"Motor lifetime near to end",source:"NP_Andromeda",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Missing Module",source:"NP_Persus",condition:"δ",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Cable break",source:"NP_Pegasus",condition:"δ",timeline:[],staleofihbposehgfui541757s:1,priority:2},{description:"Temperature low",source:"NP_Cetus",condition:"δ",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Hard drive full",source:"NP_Cassiopea",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:1},{description:"IO system error: write to...",source:"NP_Lacerta",condition:"ε",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"historian error: disk is full",source:"NP_Triangulum",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Temperature low",source:"SH_Hercules",condition:"δ",timeline:[],staleofihbposehgfui541757s:1,priority:1},{description:"Volume exceeded",source:"SH_Sagitta",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:2},{description:"Emergency valve open",source:"SH_Aquila",condition:"ζ",timeline:[],staleofihbposehgfui541757s:1,priority:1},{description:"Flow reached critical level",source:"SH_Lyra",condition:"δ",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Gas detected",source:"SH_Cygnus",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Power cable break",source:"SH_Vulpecula",condition:"δ",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Pressure low",source:"SH_Hydra",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Missing support module",source:"SH_Sextans",condition:"δ",timeline:[],staleofihbposehgfui541757s:1,priority:2},{description:"Flow high",source:"SH_Crater",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:1},{description:"Emergency valve open",source:"SH_Corvus",condition:"δ",timeline:[],staleofihbposehgfui541757s:1,priority:1},{description:"Flow reached critical level",source:"SH_Serpens",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Gas detected",source:"SH_Scutum",condition:"δ",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Power cable break",source:"SH_Centaurus",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Pressure low",source:"SH_Lupus",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:0},{description:"Missing support module",source:"SH_Altar",condition:"α",timeline:[],staleofihbposehgfui541757s:1,priority:2},{description:"Flow high",source:"SH_Crux",condition:"δ",timeline:[],staleofihbposehgfui541757s:1,priority:1}],DATA_META={number:{name:"№",method:"",units:""},galaxyName:{name:"Galaxy",method:"",units:""}},SHARES_META={priorityShares:{name:"Luminosity",method:"",units:""}},TIME_SERIES_META={alarmRate:{name:"Flare density over time",method:"colored by absolute average",units:"/10min",targetType:TARGET_LO_ISGOOD,target:1,maximum:40,id_kpistorageservice:-1,format:function(a){return d3.round(a,2)==d3.round(a,0)?d3.round(a,0):d3.format(".2r")(a)},colorStops:[1,10,20,40,60,80]},alarmsActive:{name:"Number of active flares",method:"colored by absolute average",units:"/10min",targetType:TARGET_LO_ISGOOD,target:1,maximum:20,id_kpistorageservice:-1,format:function(a){return d3.round(a,2)==d3.round(a,0)?d3.round(a,0):d3.format(".2r")(a)},colorStops:[1,10,20,40,60,80]},timeOutsideTarget:{name:"Flares above limit ",method:"",units:"%",targetType:TARGET_LO_ISGOOD,target:1,maximum:10,format:d3.format(".3r")}},ANALYTICS_RESULTS_META={matrixLayout:{name:"Matrix layout"},circularLayout:{name:"Circular layout"}},SCALAR_KPI_META={alarmRateAvg:{name:"Flare density",nameShort:"Flare density",id:"average_10min",id_kpistorageservice:-1,method:"Average",methodShort:"Avg",units:"/10min",targetType:TARGET_LO_ISGOOD,target:1,maximum:20,format:function(a){return d3.round(a,2)==d3.round(a,0)?d3.round(a,0):d3.format(".2r")(a)}},alarmRatePeak:{name:"Flare density",nameShort:"rate",id:"peak_10min_1",id_kpistorageservice:-1,method:"Peak",methodShort:"Peak",units:"/10min",targetType:TARGET_LO_ISGOOD,target:10,maximum:200,format:function(a){return d3.round(a,2)==d3.round(a,0)?d3.round(a,0):d3.format(".2r")(a)}},timeToAck:{name:"Time to discover",nameShort:"Time to ackn",id:"timetoacknow",id_kpistorageservice:-1,method:"Average",methodShort:"Avg",units:"min",targetType:TARGET_LO_ISGOOD,target:3,maximum:20,format:function(a){return 1>60*a?"0":minutesToMMSS(a)}},timeofihbposehgfui541757Active:{name:"Flare time",nameShort:"Time active",id:"",id_kpistorageservice:-1,method:"Average",methodShort:"Avg",units:"h",targetType:TARGET_LO_ISGOOD,target:1,maximum:10,format:d3.format(".3g")},timeInFlood:{name:"Flares above limit",nameShort:"Flares above limit",id:"flood_10min_50",id_kpistorageservice:-1,method:"",methodShort:"",units:"%",targetType:TARGET_LO_ISGOOD,target:1,maximum:10,format:function(a){return d3.round(a,2)==d3.round(a,0)?d3.round(a,0):d3.format(".2r")(a)}},staleofihbposehgfui541757s:{name:"Standing flares",nameShort:"Standing flares",id:"staleall",id_kpistorageservice:-1,method:"Number of",methodShort:"",units:"total",targetType:TARGET_LO_ISGOOD,target:5,maximum:50,format:function(a){return d3.round(a,2)==d3.round(a,0)?d3.round(a,0):d3.format(".2r")(a)}},staleofihbposehgfui541757sOldest:{name:"Longest active flare",nameShort:"",id:"staleoldest",id_kpistorageservice:-1,method:"Longest",methodShort:"Longest",units:"months",targetType:TARGET_LO_ISGOOD,target:1,maximum:12,format:function(a){return d3.round(a,2)==d3.round(a,0)?d3.round(a,0):d3.format(".2r")(a)}},trainingsPassed:{name:"Training passed",nameShort:"Training passed",id:"",id_kpistorageservice:-1,method:"total",methodShort:"",units:"",targetType:TARGET_HI_ISGOOD,target:0,maximum:1,format:d3.format(".3g")},improvements:{name:"Improvements",nameShort:"Improves",id:"",id_kpistorageservice:-1,method:"total",methodShort:"",units:"",targetType:TARGET_HI_ISGOOD,target:0,maximum:1,format:d3.format(".3g")},empty:{name:"",nameShort:"",id:"",id_kpistorageservice:"",method:"",methodShort:"",units:"",targetType:TARGET_LO_ISGOOD,target:0,maximum:1,format:d3.format(".3g")}},PRIORITIES_META=[{name:"Priority",nameShort:"P",id_kpistorageservice:-1},{name:"Priority",nameShort:"P",id_kpistorageservice:-1},{name:"Priority",nameShort:"P",id_kpistorageservice:-1}],SCALARKPISET_AS_ARRAY=Object.keys(new ScalarKpiSet),whatKpi=function(a){for(var b in TIME_SERIES_META)if(TIME_SERIES_META[b].id_kpistorageservice==a)return{type:"timeSeries",pointer:b};for(var b in PRIORITIES_META)if(PRIORITIES_META[b].id_kpistorageservice==a)return{type:"prios",pointer:b};for(var b in SCALAR_KPI_META)if(SCALAR_KPI_META[b].id_kpistorageservice==a)return{type:"scalarKpi",pointer:b}},DataTreeModel=function(a,b){var c=this;this.tree=a,this._tree=JSON.parse(JSON.stringify(a)),this.links=flattenofihbposehgfui541757Groups(b),this.init=function(){c.recomputeLayout(),c.hieLevel=d3.max(c.getLeaves().map(function(a){return a.depth}))-1,c.hieLevelMax=c.hieLevel,c.hieSteps=c.hieLevel+1},this.generateLinks=function(a,b){for(var c=[],d=0;b>d;d++)c.push({source:a[Math.floor(Math.random()*a.length)],target:a[Math.floor(Math.random()*a.length)],hits:Math.floor(Math.exp(7*Math.random())),shine:Math.random()});return c},this.recomputeLayout=function(a){return null==a&&(a=d3.layout.cluster()),c.nodes=a.nodes(c.tree).reverse(),c.tree.x0=0,c.tree.y0=0,c.nodes},this.updateLeaves=function(a){return null==a&&(a=c.tree),c.leaves=c.getLeaves(a),c.leaves},this.collapseAll=function(a){return a.children&&(a._children=a.children,a._children.forEach(c.collapseAll),a.children=null),a},this.getNodeByNodeID=function(a,b){return null==b&&(b=c.tree),c.getAllNodes(b).filter(function(b){return b.id==a})[0]},this.getAllNodes=function(a){null==a&&(a=c.tree);var b=[a];if(a.children)for(var d in a.children)b=b.concat(c.getLeavesEvenHidden(a.children[d]));if(a._children)for(var d in a._children)b=b.concat(c.getLeavesEvenHidden(a._children[d]));return b},this.getLeaves=function(a){null==a&&(a=c.tree);var b=[];if(null==a.children)return[a];for(var d in a.children)b=b.concat(c.getLeaves(a.children[d]));return b},this.getLeavesEvenHidden=function(a){var b=[];if(null==a.children&&null==a._children)return[a];if(a.children)for(var d in a.children)b=b.concat(c.getLeavesEvenHidden(a.children[d]));if(a._children)for(var d in a._children)b=b.concat(c.getLeavesEvenHidden(a._children[d]));return b},this.getFirstLeaveY=function(a){return c.getLeaves(a)[0].x},this.getLastLeaveY=function(a){var b=c.getLeaves(a);return b[b.length-1].x},this.getFirstVisibleNode=function(a){for(var b=[];null!=a;)b[a.depth]=null!=a.parent?null!=a.parent.children?a:null:a,a=a.parent;return-1==b.indexOf(null)?b[b.length-1]:b[b.indexOf(null)-1]},this.getLinksByNode=function(a,b,d,e){if(null==b&&(b=!0),null==d&&(d=!0),null==e&&(e=!0),e){var f=[];return c.getLeavesEvenHidden(a).forEach(function(a){f=f.concat(c.links.filter(function(c){return b&&c.source==a.id||d&&c.target==a.id}))}),arrayUnique(f)}return c.links.filter(function(c){return b&&c.source==a.id||d&&c.target==a.id})},this.reduceTreeToDepth=function(a,b){if(a.children||a._children){if(a.depth==b)return a.children=c.getLeavesEvenHidden(a),a.children.forEach(function(c){c.parent=a,c.depth=b+1}),a._children=null,a;if(a.depth<b)return a.children.forEach(function(a){c.reduceTreeToDepth(a,b)}),a;if(a.depth>b)return a}}},function(){d3.o2rin57yr357=function(){function a(a){a.each(function(a){null==a&&(a=[]),a.length>1e3&&(h=0);var d=d3.time.scale().domain([g,f]).range([0,b]),e=d3.select(this),j=e.selectAll("line.activation").data(a.filter(function(a){return d(a[0])>=0&&d(a[0])<=b&&a[1]==EVENT_ACTIVATION})),k=e.selectAll("line.acknowledgement").data(a.filter(function(a){return d(a[0])>=0&&d(a[0])<=b&&a[1]==EVENT_ACKNOWLEDG})),l=e.selectAll("line.duration").data(a.filter(function(a){return d(a[0])>=0&&d(a[0])<=b&&a[1]==EVENT_ACTIVATION}));j.enter().append("line").attr("class","activation").attr("y1",c/2-i/2).attr("y2",c/2+i/2).attr("x1",0).attr("x2",0),j.exit().remove(),j.transition().duration(h).attr("x1",function(a){return d(a[0])}).attr("x2",function(a){return d(a[0])}),k.enter().append("line").attr("class","acknowledgement").attr("y1",c-4).attr("y2",c).attr("x1",0).attr("x2",0),k.exit().remove(),k.transition().duration(h).attr("x1",function(a){return d(a[0])}).attr("x2",function(a){return d(a[0])}),l.enter().append("line").attr("class","duration").attr("y1",c/2).attr("y2",c/2).attr("x1",0).attr("x2",0),l.exit().remove(),l.transition().duration(h).attr("x1",function(a){return d(a[0])}).attr("x2",function(b){var c=a.filter(function(a){return a[0]>b[0]&&(a[1]==EVENT_BACKTONORM||a[1]==EVENT_ACTIVATION)});return d(0!=c.length?c[0][0]:f)})})}var b=960,c=40,d=0,e=0,f=0,g=0,h=0,i=8;return a.duration=function(b){return arguments.length?(h=+b,a):h},a.width=function(c){return arguments.length?(b=+c,a):b},a.height=function(b){return arguments.length?(c=+b,a):c},a.dwidth=function(b){return arguments.length?(d=+b,a):d},a.dheight=function(b){return arguments.length?(e=+b,a):e},a.xmax=function(b){return arguments.length?(f=+b,a):f},a.xmin=function(b){return arguments.length?(g=+b,a):g},a}}(),AdjacencyMatrix=function(a,b){var c=this,d=200,e=200,f=0,g=50,h=5,j=null,k={top:0,right:20,bottom:10,left:10},l=null,m=function(a,b){return d3.ascending(a.id,b.id)},n=10,o=100,p=d3.layout.cluster().separation(function(){return 1}),q="placeholder. update should be called first",r="placeholder. update should be called first",s="placeholder. update should be called first",t="placeholder. update should be called first";return this.update=function(c){if(null==c&&(c=appModel.galaxyID),null!=dataModel.galaxys[c].alarmTopology){j=dataModel.galaxys[c].alarmTopology,g=.2*d,80>g&&(g=80),g>160&&(g=160),p.size([d-g,e-g]),q=a.selectAll("svg.matrix").data([1]),q.enter().append("svg").attr("class","matrix").attr("width",d+k.left+k.right).attr("height",e+k.top+k.bottom),groupAll=q.selectAll("g.groupAll").data([1]),groupAll.enter().append("g").attr("class","groupAll").attr("transform","translate("+k.left+","+k.top+")"),s=groupAll.selectAll("g.groupV").data([1]),s.enter().append("g").attr("class","groupV").attr("transform","translate(0,"+g+")"),r=groupAll.selectAll("g.groupH").data([1]),r.enter().append("g").attr("class","groupH").attr("transform","translate("+g+",0)"),t=groupAll.selectAll("g.groupLinks").data([1]),t.enter().append("g").attr("class","groupLinks").attr("transform","translate("+g+","+g+")");
var f=a.selectAll("div.controlls").data([1]).enter().append("div").attr("class","controlls topRow").style("width",g+"px").style("height",g+"px").style("top",k.top+"px").style("left",k.left+"px");f.append("div").attr("class","topline").text("Modify hierarchy:");var h=f.append("div");h.append("div").attr("class","hieUp button subline").text("▲").on("click",function(){b.iWannaHieUpDown(-1)}),h.append("div").attr("class","hieDown button subline").text("▼").on("click",function(){b.iWannaHieUpDown(1)}),f.append("div").attr("class","topline").text("Sort leaves:");var i=f.append("div");i.selectAll(".sortingControll").data(["Name","Frequency","Length of the name"]).enter().append("div").attr("class","sortingControll button subline").text(function(a){return a.substr(0,2)}).attr("title",function(a){return a}).on("click",function(a){b.iWannaSortLeavesBy(a)})}},this.redraw=function(a){null==a&&(a=j.tree),c.redrawNodes(a),c.redrawLinks(a)},this.redrawNodes=function(a){j.recomputeLayout(p.sort(m)),h=(d-g)/j.getLeaves().length,j.nodes.forEach(function(a){a.y=a.children?a.depth*(g-(h>n?o:0))/j.hieSteps:j.hieSteps*(g-(h>n?o:10))/j.hieSteps});var c=s.selectAll("g.node.vertical").data(j.nodes.filter(function(a){return 0!=a.depth}),function(a){return a.id||(a.id=++i)}),k=r.selectAll("g.node.horizontal").data(j.nodes.filter(function(a){return 0!=a.depth}),function(a){return a.id||(a.id=++i)}),l=c.enter().append("g").attr("class",function(a){return"node vertical id"+a.id.undot()}).attr("transform",function(){return"translate("+a.y0+","+a.x0+")"}).on("click",b.iWannaClick).on("mouseover",b.iWannaHoverNodeON).on("mouseout",b.iWannaHoverNodeOFF),q=k.enter().append("g").attr("class",function(a){return"node horizontal id"+a.id.undot()}).attr("transform",function(){return"translate("+a.x0+","+a.y0+")"}).on("click",b.iWannaClick).on("mouseover",b.iWannaHoverNodeON).on("mouseout",b.iWannaHoverNodeOFF);l.append("line").attr("class","grid").attr("y1",0).attr("y2",0).attr("stroke-dasharray","2,1"),q.append("line").attr("class","grid").attr("x1",0).attr("x2",0).attr("stroke-dasharray","2,1"),l.append("line").attr("class","tab").attr("x1",0).attr("x2",0),q.append("line").attr("class","tab").attr("y1",0).attr("y2",0),l.append("text").style("fill-opacity",1e-6),q.append("text").style("fill-opacity",1e-6);var t=c.classed("leaf",function(a){return!a.children&&!a._children}).classed("collapsed",function(a){return a._children}).transition().duration(f).attr("transform",function(a){return"translate("+a.y+","+a.x+")"}),u=k.classed("leaf",function(a){return!a.children&&!a._children}).classed("collapsed",function(a){return a._children}).transition().duration(f).attr("transform",function(a){return"translate("+a.x+","+a.y+")"});t.select("line.grid").attr("x1",function(a){return g-a.y}).attr("x2",function(a){return d-a.y}).style("opacity",function(a){return null==a.children?1:0}),u.select("line.grid").attr("y1",function(a){return g-a.y}).attr("y2",function(a){return e-a.y}).style("opacity",function(a){return null==a.children?1:0}),t.select("line.tab").attr("y1",function(a){return j.getFirstLeaveY(a)-a.x-h/3}).attr("y2",function(a){return j.getLastLeaveY(a)-a.x+h/3}),u.select("line.tab").attr("x1",function(a){return j.getFirstLeaveY(a)-a.x-h/3}).attr("x2",function(a){return j.getLastLeaveY(a)-a.x+h/3}),t.select("text").text(function(a){return h>n||a.children||a._children?a.id:""}).attr("transform",function(a){return"rotate("+(a.children?-90:0)+")"}).attr("x",function(a){return a.children?0:10}).attr("dy",function(a){return a.children?"-0.7em":".35em"}).attr("text-anchor",function(a){return a.children?"middle":"start"}).style("fill-opacity",1),u.select("text").text(function(a){return h>n||a.children||a._children?a.id:""}).attr("transform",function(a){return"rotate("+(a.children?0:-90)+")"}).attr("x",function(a){return a.children?0:-10}).attr("dy",function(a){return a.children?"-0.7em":".35em"}).attr("text-anchor",function(a){return a.children?"middle":"end"}).style("fill-opacity",1);var v=c.exit().transition().duration(f).attr("transform",function(){return"translate("+a.y+","+a.x+")"}).remove(),w=k.exit().transition().duration(f).attr("transform",function(){return"translate("+a.x+","+a.y+")"}).remove();v.select("line").style("fill-opacity",1e-6),w.select("line").style("fill-opacity",1e-6),v.select("text").style("fill-opacity",1e-6),w.select("text").style("fill-opacity",1e-6),j.nodes.forEach(function(a){a.x0=a.x,a.y0=a.y})},this.redrawLinks=function(a){var c=h/2;4>c&&(c=4),c>15&&(c=15),l.r.range([4,c]);var d=t.selectAll(".matrix circle.link").data(j.links);d.exit().remove(),d.enter().append("circle").attr("cy",a.x).attr("cx",a.x).attr("r",0).style("opacity",0).on("mouseover",b.iWannaHoverLinkON).on("mouseout",b.iWannaHoverLinkOFF),d.transition().duration(f).attr("class",function(a){return"link "+a.type+" id"+a.source.undot()+a.target.undot()}).attr("cy",function(a){return j.getFirstVisibleNode(j.getNodeByNodeID(a.source)).x}).attr("cx",function(a){return j.getFirstVisibleNode(j.getNodeByNodeID(a.target)).x}).attr("r",function(a){return l.r(a.hits)}).style("opacity",function(a){return l.o(a.shine)})},this.margin=function(a){return arguments.length?(k=a,c):k},this.duration=function(a){return arguments.length?(f=+a,c):f},this.width=function(a){return arguments.length?(d=+a,c):d},this.height=function(a){return arguments.length?(e=+a,c):e},this.scale=function(a){return arguments.length?(l=a,c):l},this.comparator=function(a){return arguments.length?(m=a,c):m},this},function(){d3.dashPlot=function(){function a(a){a.each(function(c){if(null!=c&&0!=c.length){var j=SCALARKPISET_AS_ARRAY,k=[],l=[],m=[];j.forEach(function(a,d){k.push(c.map(function(b){return b[a]}));var e=Math.max(d3.max(k[d]),SCALAR_KPI_META[a].maximum);l.push(d3.fisheye.scale(d3.scale.linear).domain([0,e]).range([0,b])),m.push(d3.svg.axis().scale(l[d]).orient("bottom").ticks(5).tickFormat(SCALAR_KPI_META[a].format))});var p=function(c,d,e,f){var g=SCALAR_KPI_META[j[f]],h=l[f];h.distortion(c).focus(d),e.select(".x.axis").call(m[f]),e.selectAll(".dash").transition().duration(i).attr("x1",h).attr("x2",h),e.selectAll(".dash").style("stroke-width",function(a){return Math.max(2,7*Math.pow(1-Math.abs(h(a)-d)/b,6))}),e.selectAll(".target.mark").attr("x1",h(g.target)).attr("x2",h(g.target)),e.selectAll(".targetValue.mark").attr("dx",h(g.target)-3),e.selectAll(".dashValueShadow").attr("dx",function(a){return h(a)-5}),e.selectAll(".dashValue").attr("dx",function(a){return h(a)-5}),e.selectAll(".connection").transition().duration(i).attr("x1",h),f>0&&a.selectAll("g.dashPlot.oneKpi.kpiIndex"+(f-1)).selectAll(".connection").transition().duration(i).attr("x2",function(a,b){return h(k[f][b])}),e.selectAll(".background.bad").attr("x",g.targetType==TARGET_HI_ISGOOD?0:h(g.target)).attr("width",g.targetType==TARGET_HI_ISGOOD?h(g.target):b-h(g.target)),e.selectAll(".background.good").attr("x",g.targetType==TARGET_LO_ISGOOD?0:h(g.target)).attr("width",g.targetType==TARGET_LO_ISGOOD?h(g.target):b-h(g.target))};if(null!=n){if(!appModel.scalarDistortion)return;d3.select(this).select("g.kpiIndex"+o).each(function(a){var c=o,d=d3.select(this),e=(SCALAR_KPI_META[j[c]],l[c]),f=n,g=a.length/(1+d3.sum(a.map(function(a){return Math.abs(e(a)-f[0])/b})));p(g,f[0],d,c),n=null})}else d3.select(this).selectAll("g").remove();d3.select(this).selectAll("g").data(k).enter().append("g").attr("class",function(a,b){return"dashPlot oneKpi kpiIndex"+b}).attr("transform",function(a,b){return"translate("+e+","+(f+d*b)+")"}).each(function(a,c){var e=d3.select(this),f=SCALAR_KPI_META[j[c]],i=l[c],n=e.selectAll(".eventArea").data([null]);if(n.enter().append("g").attr("class","eventArea"),0==c&&(e.selectAll(".target.legend").data([null]).enter().append("line").attr("class","target legend").attr("x1",b-45).attr("x2",b-45).attr("y1",2.8*-g).attr("y2",1.7*-g),e.selectAll(".targetValue.legend").data([null]).enter().append("text").attr("class","targetValue legend").attr("dx",b-40).attr("dy",2*-g).text("target")),c<k.length-1){var o=l[c+1];e.selectAll(".connection").data(a).enter().append("line").attr("class",function(){return"connection hideable "+ASSET_ID}).attr("id",function(a,b){return ASSET_ID+dataModel.galaxyIDs[b]}).attr("x1",function(a){return i(a)}).attr("x2",function(a,b){return o(k[c+1][b])}).attr("y1",g/2).attr("y2",d-g/2)}e.selectAll(".midLine").data([null]).enter().append("line").attr("class","midLine").attr("x1",0).attr("x2",b).attr("y1",0).attr("y2",0),e.selectAll(".x.axis").data([null]).enter().append("g").attr("class","x axis").attr("transform","translate(0,10)").call(m[c]);var q=(""==f.method||""==f.units?"":", ",e.selectAll(".topRow").data([null]).enter().append("g").attr("class","topRow"));q.selectAll(".topline").data([null]).enter().append("text").attr("class","topline").attr("dy",2*-g).text(f.method+" "+f.name),q.selectAll(".subline").data([null]).enter().append("text").attr("class","subline").attr("dx",0).attr("dy",-g).text(f.units),n.selectAll(".background.bad").data([null]).enter().append("rect").attr("class","background bad").attr("x",f.targetType==TARGET_HI_ISGOOD?0:i(f.target)).attr("y",-g/2).attr("width",f.targetType==TARGET_HI_ISGOOD?i(f.target):b-i(f.target)).attr("height",g),n.selectAll(".background.good").data([null]).enter().append("rect").attr("class","background good").attr("x",f.targetType==TARGET_LO_ISGOOD?0:i(f.target)).attr("y",-g/2).attr("width",f.targetType==TARGET_LO_ISGOOD?i(f.target):b-i(f.target)).attr("height",g),n.selectAll(".target.mark").data([null]).enter().append("line").attr("class","target mark").attr("x1",i(f.target)).attr("x2",i(f.target)).attr("y1",-h/2).attr("y2",+h/2),e.selectAll(".targetValue.mark").data([null]).enter().append("text").attr("class","targetValue mark").attr("dx",i(f.target)-3).attr("dy",27).text(f.format(f.target)),n.selectAll(".dash").data(a).enter().append("line").attr("class",function(){return"dash "+ASSET_ID+" hoverable hideable"}).attr("id",function(a,b){return ASSET_ID+dataModel.galaxyIDs[b]}).attr("x1",function(a){return i(a)}).attr("x2",function(a){return i(a)}).attr("y1",-g/2).attr("y2",+g/2),e.selectAll(".dashValueShadow").data(a).enter().append("text").attr("class",function(){return"dashValueShadow "+ASSET_ID}).attr("id",function(a,b){return ASSET_ID+dataModel.galaxyIDs[b]}).attr("dy",-g).attr("dx",function(a){return i(a)-5}).text(function(a){return f.format(a)}),e.selectAll(".dashValue").data(a).enter().append("text").attr("class",function(){return"dashValue "+ASSET_ID}).attr("id",function(a,b){return ASSET_ID+dataModel.galaxyIDs[b]}).attr("dy",-g).attr("dx",function(a){return i(a)-5}).text(function(a){return f.format(a)}),e.append("rect").attr("class","focusArea").attr("id",j[c]).attr("y",3*-g).attr("width",b).attr("height",5*g),n.on("mouseleave",function(){e.selectAll(".dash").style("stroke-width",null),e.selectAll(".x.axis").call(m[c].ticks(5)),p(0,0,e,c)}),n.on("mouseenter",function(){e.selectAll(".x.axis").call(m[c].ticks(10))}),n.on("mousemove",function(){if(appModel.scalarDistortion){var d=d3.mouse(this),f=a.length/(1+d3.sum(a.map(function(a){return Math.abs(i(a)-d[0])/b})));p(f,d[0],e,c)}})})}})}var b=960,c=40,d=10,e=0,f=0,g=16,h=30,i=0,j=null,k=null,l=null,m="#bd0026",n=null,o=null;return a.forceHoveringAt=function(b,c){return n=b,o=c,a},a.duration=function(b){return arguments.length?(i=+b,a):i},a.stepy=function(b){return arguments.length?(d=+b,a):d},a.width=function(c){return arguments.length?(b=+c,a):b},a.height=function(b){return arguments.length?(c=+b,a):c},a.dwidth=function(b){return arguments.length?(e=+b,a):e},a.dheight=function(b){return arguments.length?(f=+b,a):f},a.color=function(b){return arguments.length?(m=b,a):m},a.xmin=function(b){return arguments.length?(j=+b,a):j},a.xmax=function(b){return arguments.length?(k=+b,a):k},a.ymax=function(b){return arguments.length?(l=+b,a):l},a.dashH=function(b){return arguments.length?(g=+b,a):g},a}}(),HierarchicalEdgeBundling=function(a,b){var c=this,d=200,e=200,f=0,g=10,h=null,i=null,j=null,k=function(a,b){return d3.ascending(a.id,b.id)},l=15,m=100,n=50,o=null,p=null,q=d3.layout.cluster().separation(function(){return 1}),r=d3.layout.bundle(),s=d3.svg.line.radial().interpolate("bundle").tension(.8).radius(function(a){return a.y}).angle(function(a){return a.x/180*Math.PI}),t="placeholder. update should be called first",u="placeholder. update should be called first";return this.update=function(b){return null==b&&(b=appModel.galaxyID),null!=dataModel.galaxys[b].alarmTopology?(i=dataModel.galaxys[b].alarmTopology,o=d/2,g=(d-n-m)*Math.PI/i.getLeaves().length,l>g&&(m=0),p=o-m-n,t=a.selectAll("svg.heb").data([1]),t.enter().append("svg").attr("class","heb").attr("width",2*o+h.left+h.right).attr("height",2*o+h.top+h.bottom),u=t.selectAll("g.groupAll").data([1]),u.enter().append("g").attr("class","groupAll").attr("transform","translate("+(o+h.left)+","+(o+h.top)+")"),q.size([360,p]),c):void 0},this.redraw=function(a){return null==a&&(a=i.tree),c.redrawNodes(a),c.redrawLinks(a),c},this.redrawNodes=function(a){i.recomputeLayout(q.sort(k));var d=2*Math.PI/i.nodes.length;i.nodes.forEach(function(a){if(a.children){var b=m>0;a.y1=p+m+n*(1-a.depth/(i.hieSteps-(b?1:0)))}else a.y1=a.y});var e=u.selectAll("g.node.heb").data(i.nodes.filter(function(a){return 0!=a.depth})),f=e.enter().append("g").attr("class",function(a){return"node heb id"+a.id.undot()}).on("click",b.iWannaClick).on("mouseover",b.iWannaHoverNodeON).on("mouseout",b.iWannaHoverNodeOFF);f.append("g").attr("class","textcontainer").attr("transform",function(){return"rotate("+(a.x0-90)+")translate("+a.y0+")"}).append("text").style("fill-opacity",1e-6),f.append("path").attr("class","tab");var g=e.attr("class",function(a){return"node heb id"+a.id.undot()}).classed("leaf",function(a){return!a.children&&!a._children}).classed("collapsed",function(a){return a._children});g.select("g.textcontainer").attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y1+")"}),g.select("g.textcontainer text").attr("dx",function(a){return a.x<180?8:-8}).attr("dy",".31em").attr("text-anchor",function(a){return a.x<180?"start":"end"}).attr("transform",function(a){return a.x<180?null:"rotate(180)"}).text(function(a){return m>0||a.children||a._children?a.id:""}).style("fill-opacity",1),g.select("path").style("visibility",function(a){return a.children||0==m||a._children?"visible":"hidden"}).datum(function(a){return{innerRadius:a.y1+(a.children?0:4),outerRadius:a.y1+(a.children?0:4),startAngle:i.getFirstLeaveY(a)/360*2*Math.PI-.2*d,endAngle:i.getLastLeaveY(a)/360*2*Math.PI+.2*d}}).attr("d",d3.svg.arc());var h=e.exit().attr("transform",function(){return"rotate("+(a.x-90)+")translate("+a.y1+")"}).remove();return h.select("text").style("fill-opacity",1e-6),h.select("path").style("fill-opacity",1e-6),c},this.redrawLinks=function(a){var d=u.selectAll("path.link").data(i.links.filter(function(a){return"noaction"!=a.type}));d.exit().remove(),d.enter().append("path").on("mouseover",b.iWannaHoverLinkON).on("mouseout",b.iWannaHoverLinkOFF),d.attr("class",function(a){return"link "+a.type+" id"+a.source.undot()+a.target.undot()}).style("opacity",function(a){return j.o(a.shine)}).attr("d",function(a){var b=i.getFirstVisibleNode(i.getNodeByNodeID(a.source)),c=i.getFirstVisibleNode(i.getNodeByNodeID(a.target));return s(r([{source:b,target:c}])[0])});var e=u.selectAll("circle.link").data(i.links.filter(function(a){return"noaction"==a.type}));return e.exit().remove(),e.enter().append("circle").attr("transform",function(){return"rotate("+(a.x0-90)+")translate("+(a.y0-10)+")"}).attr("cy",0).attr("cx",0).attr("r",0).style("opacity",0).on("mouseover",b.iWannaHoverLinkON).on("mouseout",b.iWannaHoverLinkOFF),e.transition().duration(f).attr("class",function(a){return"link "+a.type+" id"+a.source.undot()+a.target.undot()}).attr("transform",function(a){var b=i.getFirstVisibleNode(i.getNodeByNodeID(a.source));return"rotate("+(b.x-90)+")translate("+(b.y-10)+")"}).attr("r",function(a){return j.r(a.hits)}).style("opacity",function(a){return j.o(a.shine)}),c},this.margin=function(a){return arguments.length?(h=a,c):h},this.duration=function(a){return arguments.length?(f=+a,c):f},this.width=function(a){return arguments.length?(d=+a,c):d},this.height=function(a){return arguments.length?(e=+a,c):e},this.scale=function(a){return arguments.length?(j=a,c):j},this.comparator=function(a){return arguments.length?(k=a,c):k},this},function(){function a(a){return a[0]}function b(a){return a[1]}function c(a,b,c){return"offset"==c?function(c){return"translate(0,"+(c+(0>c)-a)*b+")"}:function(c){return(0>c?"scale(1,-1)":"")+"translate(0,"+(c-a)*b+")"}}d3.horizon=function(){function f(a){a.each(function(a){var b,f,s,t=d3.select(this),u=1/0,v=-1/0,w=-1/0,x=a.map(function(a,b){var c=j.call(this,a,b),d=k.call(this,a,b);return u>c&&(u=c),c>v&&(v=c),-d>w&&(w=-d),d>w&&(w=d),[c,d]}),y=d3.scale.linear().domain([null!=o?o:u,null!=p?p:v]).range([0,l]),z=d3.scale.linear().domain([0,null!=q?q:w]).range([0,m*g]),A=c(g,m,h);this.__chart__?(b=this.__chart__.x,f=this.__chart__.y,t0=this.__chart__.t,s=this.__chart__.id):(b=y.copy(),f=z.copy(),t0=A,s=++e);var B=t.selectAll("defs").data([null]);B.enter().append("defs").append("clipPath").attr("id","d3_horizon_clip"+s).append("rect").attr("width",l).attr("height",m),B.select("rect").transition().duration(n).attr("width",l).attr("height",m),t.selectAll("g").data([null]).enter().append("g").attr("clip-path","url(#d3_horizon_clip"+s+")");var C=t.select("g").selectAll("path").data(d3.range(-1,-g-1,-1).concat(d3.range(1,g+1)),Number),D=d.interpolate(i).x(function(a){return b(a[0])}).y0(m*g).y1(function(a){return m*g-f(a[1])})(x),E=d.x(function(a){return y(a[0])}).y1(function(a){return m*g-z(a[1])})(x);C.enter().append("path").style("fill",r).attr("transform",t0).attr("d",D),C.transition().duration(n).style("fill",r).attr("transform",A).attr("d",E),C.exit().transition().duration(n).attr("transform",A).attr("d",E).remove(),this.__chart__={x:y,y:z,t:A,id:s}}),d3.timer.flush()}var g=1,h="offset",i="linear",j=a,k=b,l=960,m=40,n=0,o=null,p=null,q=null,r=d3.scale.linear().domain([-1,0,0,1]).range(["#006d2c","#bae4b3","#ead372","#dd4c00"]);return f.duration=function(a){return arguments.length?(n=+a,f):n},f.bands=function(a){return arguments.length?(g=+a,r.domain([-g,0,0,g]),f):g},f.mode=function(a){return arguments.length?(h=a+"",f):h},f.colors=function(a){return arguments.length?(r.range(a),f):r.range()},f.interpolate=function(a){return arguments.length?(i=a+"",f):i},f.x=function(a){return arguments.length?(j=a,f):j},f.y=function(a){return arguments.length?(k=a,f):k},f.width=function(a){return arguments.length?(l=+a,f):l},f.height=function(a){return arguments.length?(m=+a,f):m},f.xmin=function(a){return arguments.length?(o=+a,f):o},f.xmax=function(a){return arguments.length?(p=+a,f):p},f.ymax=function(a){return arguments.length?(q=+a,f):q},f};var d=d3.svg.area(),e=0}(),function(){d3.lineChart=function(){function a(a){a.each(function(a){if(null!=a&&0!=a.length){var x=a[0][1];k&&(v.bottom=20,v.top=40),s&&(i=Math.max(d3.max(a.map(function(a){return a[1]})),i),j=d3.min(a.map(function(a){return a[1]}))),.001>j&&(j=0);var y=d3.time.scale().domain([g,h]).range([v.left,b-v.left]),z=d3.scale.linear().domain([j,i]).range([c,v.top]).clamp(p),A=d3.svg.axis().scale(y).orient("bottom").ticks(appModel.xAxisTicks).tickFormat(appModel.timeFormat),B=d3.select(this),C=B.selectAll("g").data([null]);C.enter().append("g").attr("class","pathbox").attr("transform","translate("+d+","+((q?-z(x):0)+e)+")");var D=d3.svg.line().x(function(a){return y(a[0])}).y(function(a){return z(a[1])}),E=C.selectAll("path.original").data([0]);if(E.enter().append("path").attr("class","original"),E.attr("stroke",w(d3.mean(a.map(function(a){return a[1]})))).attr("d",D(a)),E.exit().remove(),a[0].length>2){var F=d3.svg.line().x(function(a){return y(a[0])}).y(function(a){return z(a[2])+2}),G=C.selectAll("path.reduced").data([0]);G.enter().append("path").attr("class","reduced"),G.attr("d",F(a)),G.exit().remove()}k&&(C.selectAll(".x.axis").data([null]).enter().append("g").attr("class","x axis").attr("transform","translate(0,"+c+")"),C.selectAll(".x.axis").call(A),n&&d3.select(B.selectAll(".tick")[0][0]).attr("visibility","hidden"),o&&d3.select(B.selectAll(".tick")[0][B.selectAll(".tick")[0].length-1]).attr("visibility","hidden"));var H=C.selectAll(".axisgroup").data([0]);H.enter().append("g").attr("class","axisgroup");var I=function(){var b=d3.max(a.map(function(a){return a[1]})),d=d3.min(a.map(function(a){return a[1]})),e=d3.median(a.map(function(a){return a[1]})),g=quartiles(a.map(function(a){return a[1]}).sort(d3.ascending)),h=g.q25,i=g.q75,j=g.q10,k=g.q90,m=20,n=H.selectAll("line.background").data([0]),o=H.selectAll("circle.original").data([0]),p=H.selectAll("circle.reduced").data([0]),q=H.selectAll("line.minLine").data([0]),r=H.selectAll("line.maxLine").data([0]),s=H.selectAll("line.q10Line").data([0]),t=H.selectAll("line.q90Line").data([0]),v=H.selectAll("line.q25Line").data([0]),x=H.selectAll("line.q75Line").data([0]),y=H.selectAll("text.max").data([0,0]),A=H.selectAll("text.min").data([0,0]),B=H.selectAll("text.q75").data([0,0]),C=H.selectAll("text.q25").data([0,0]),D=H.selectAll("text.q90").data([0,0]),E=H.selectAll("text.q10").data([0,0]),F=H.selectAll("text.median").data([0,0]),G=H.selectAll("text.max2line").data([0,0]),I=H.selectAll("text.max3line").data([0,0]);n.enter().append("line").attr("class","background"),o.enter().append("circle").attr("class","original"),p.enter().append("circle").attr("class","reduced"),q.enter().append("line").attr("class","minMaxLine minLine"),r.enter().append("line").attr("class","minMaxLine maxLine"),s.enter().append("line").attr("class","q10q90Line q10Line"),t.enter().append("line").attr("class","q10q90Line q90Line"),v.enter().append("line").attr("class","q25q75Line q25Line"),x.enter().append("line").attr("class","q25q75Line q75Line");var J=function(a,b){return(1==a?"foreground":"shadow")+" "+b};z(i)-z(k)>m&&z(e)-z(k)>m&&D.enter().append("text").attr("class",function(a,b){return J(b,"q90")}),z(j)-z(h)>m&&z(j)-z(e)>m&&E.enter().append("text").attr("class",function(a,b){return J(b,"q10")}),z(e)-z(i)>m&&B.enter().append("text").attr("class",function(a,b){return J(b,"q75")}),z(h)-z(e)>m&&C.enter().append("text").attr("class",function(a,b){return J(b,"q25")}),y.enter().append("text").attr("class",function(a,b){return J(b,"max")}),A.enter().append("text").attr("class",function(a,b){return J(b,"min")}),F.enter().append("text").attr("class",function(a,b){return J(b,"median")}),G.enter().append("text").attr("class",function(a,b){return J(b,"max2line")}),I.enter().append("text").attr("class",function(a,b){return J(b,"max3line")}),n.attr("x1",1).attr("x2",1).attr("y1",z(b)).attr("y2",z(d)),o.attr("cx",1).attr("cy",0).attr("r",u).attr("fill",w(d3.mean(a.map(function(a){return a[1]})))),p.attr("cx",1).attr("cy",0).attr("r",u),q.attr("x1",1).attr("x2",1).attr("y1",z(j)).attr("y2",z(d)),r.attr("x1",1).attr("x2",1).attr("y1",z(k)).attr("y2",z(b)),s.attr("x1",0).attr("x2",0).attr("y1",z(h)).attr("y2",z(j)),t.attr("x1",0).attr("x2",0).attr("y1",z(i)).attr("y2",z(k)),v.attr("x1",1).attr("x2",1).attr("y1",z(e)+u/2).attr("y2",z(h)),x.attr("x1",1).attr("x2",1).attr("y1",z(e)-u/2).attr("y2",z(i));var K=function(){y.attr("x",5).attr("y",z(b)).attr("dy",".0em").text(TIME_SERIES_META.alarmRate.format(b)+""+TIME_SERIES_META.alarmRate.units),A.attr("x",5).attr("y",c+9).attr("dy",".71em").text(TIME_SERIES_META.alarmRate.format(d)),B.attr("x",5).attr("y",z(i)).attr("dy",".0em").text(TIME_SERIES_META.alarmRate.format(i)),C.attr("x",5).attr("y",z(h)).attr("dy",".71em").text(TIME_SERIES_META.alarmRate.format(h)),D.attr("x",5).attr("y",z(k)).attr("dy",".0em").text(TIME_SERIES_META.alarmRate.format(k)),E.attr("x",5).attr("y",z(j)).attr("dy",".71em").text(TIME_SERIES_META.alarmRate.format(j)),F.attr("x",5).attr("y",z(e)).attr("dy",".35em").text(TIME_SERIES_META.alarmRate.format(e)),G.attr("x",5).attr("y",z(b)).attr("dy","1em").text("2 line"),I.attr("x",5).attr("y",z(b)).attr("dy","2em").text("3 line")};K(),$(".axisExplanation").mouseenter(function(){y.text("MAX VALUE: "+TIME_SERIES_META.alarmRate.format(b)+" alarms"+TIME_SERIES_META.alarmRate.units),A.text("MIN: "+TIME_SERIES_META.alarmRate.format(d)),F.text("MEDIAN VALUE: "+TIME_SERIES_META.alarmRate.format(e)),B.text("▼▼ 50% OF ALL VALUES ARE IN THIS RANGE"),C.text("▲▲ 50% OF ALL VALUES"),D.text("▼ 80%"),E.text("▲ 80%")}),$(".axisExplanation").mouseleave(K),l&&H.transition().duration(f).attr("transform","translate(0,0)"),H.selectAll("text").style("visibility",l?"inherit":"hidden"),H.selectAll("line").style("visibility",l?"inherit":"hidden"),H.selectAll("text.max2line").style("visibility","hidden"),H.selectAll("text.max3line").style("visibility","hidden"),H.selectAll("circle").style("visibility","hidden")},J=c,K=10,L=20,M=.1,N=function(){if(!l||!m)return null;var a=appModel.TTanalysis.pStart,d=appModel.TTanalysis.pEnd,e=C.selectAll(".xFrame").data([null]);e.enter().append("g").attr("class","xFrame draggable").attr("transform","translate(1,"+(q?z(x)-c:0)+")");var f=e.selectAll(".xFrameArea").data([null]);f.enter().append("rect").attr("class","xFrameArea").attr("height",J).attr("y",0);var g=e.selectAll(".xFrameBorder").data(["left","right"]);g.enter().append("g").attr("class",function(a,b){return"xFrameBorder "+(0==b?"left":"right")}),g.selectAll("line").data([null]).enter().append("line").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",J),g.selectAll("rect").data([null]).enter().append("rect").attr("class","draggable").attr("width",K).attr("height",L).attr("y",c*M).attr("x",0),e.selectAll(".left rect").classed("left",!0),e.selectAll(".right rect").classed("right",!0).attr("x",-K);var h=function(){f.attr("width",(d-a)*b).attr("x",a*b),g.attr("transform",function(c,e){return"translate("+(0==e?a:d)*b+",0)"})};h();var i=d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation(),this.oldP=d3.mouse(C[0][0])[0]/b,this.oldpEnd=d,this.oldpStart=a}).on("drag",function(){var c=d3.mouse(C[0][0])[0]/b,e=d,f=a;return d3.select(this).classed("xFrame")&&(e=this.oldpEnd+c-this.oldP,f=this.oldpStart+c-this.oldP),d3.select(this).classed("right")&&(e=c),d3.select(this).classed("left")&&(f=c),.01>f||f>d-.05||a+.05>e||e>.99?"out of bounds":(d=e,a=f,void h())}).on("dragend",function(){appModel.setTTanalysis(a,d)});d3.selectAll(".draggable").call(i)},O=function(){var d=null!=t?t:d3.mouse(this);d3.event.preventDefault();var e=d3.bisector(function(a){return a[0]}).left,f=y.invert(d[0]),g=e(a,f,1),h=a[g-1],i=a[g];if(g>=a.length)return null;var j=f-h[0]>i[0]-f?i:h;H.attr("transform","translate("+y(j[0])+",0)"),H.select(".minLine").attr("y1",z(j[1])+u).attr("y2",c),H.select(".maxLine").attr("y1",z(j[1])-u).attr("y2",v.top),H.select("circle.original").style("visibility","visible").attr("cy",z(j[1])),H.selectAll("line.q25q75Line, line.q10q90Line").style("visibility","hidden"),H.selectAll("text").style("visibility","hidden"),H.selectAll("text.max").style("visibility","visible").text(TIME_SERIES_META.alarmRate.format(j[1])+(d[0]>.8*b?"":" alarms")+(d[0]>.5*b?"":TIME_SERIES_META.alarmRate.units)+(d[0]>.9*b?", ":" at ")+appModel.timeFormat(new Date(moment(j[0])))),l||H.selectAll("text.max").attr("y",z(j[1])).attr("dy",-5).attr("dx",5),j.length>2&&(H.select("circle.reduced").style("visibility","visible").attr("cy",z(j[2])),H.selectAll("text.max2line").style("visibility","visible").text(TIME_SERIES_META.alarmRate.format(j[2])+" — reduced rate"),H.selectAll("text.max3line").style("visibility","visible").text((j[1]>0?((j[1]-j[2])/j[1]*100).toFixed():0)+"% reduction")),t=null};a.length>2&&(C.selectAll(".eventListenerArea").data([null]).enter().append("rect").attr("class","eventListenerArea "+ASSET_ID).attr("id",ASSET_ID+r).attr("width",b).attr("height",c-(m?J:0)).attr("x",0).attr("y",(q?z(x)-c:0)+(m?J:0)),C.selectAll(".eventListenerArea").on("mouseleave",I).on("mousemove",O)),I(),N(),null!=t&&O()}})}var b=960,c=40,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=!1,l=!1,m=!1,n=!1,o=!1,p=!1,q=!1,r=null,s=!0,t=null,u=(TIME_SERIES_META.alarmRate,4),v={left:0,bottom:0,top:0,right:0},w=colormapGradient.domain(TIME_SERIES_META.alarmRate.colorStops);return a.forceHoveringAt=function(b){return t=b,a},a.duration=function(b){return arguments.length?(f=+b,a):f},a.width=function(c){return arguments.length?(b=+c,a):b},a.height=function(b){return arguments.length?(c=+b,a):c},a.dwidth=function(b){return arguments.length?(d=+b,a):d},a.dheight=function(b){return arguments.length?(e=+b,a):e},a.xmin=function(b){return arguments.length?(g=+b,a):g},a.xmax=function(b){return arguments.length?(h=+b,a):h},a.ymax=function(b){return arguments.length?(i=b,a):i},a.ymin=function(b){return arguments.length?(j=b,a):j},a.xAxisOn=function(b){return arguments.length?(k=b?!0:!1,a):k},a.yAxisOn=function(b){return arguments.length?(l=b?!0:!1,a):l},a.xFrameOn=function(b){return arguments.length?(m=b?!0:!1,a):m},a.xAxisHideFirstTick=function(b){return arguments.length?(n=b?!0:!1,a):n},a.xAxisHideLastTick=function(b){return arguments.length?(o=b?!0:!1,a):o},a.clamp=function(b){return arguments.length?(p=b?!0:!1,a):p},a.relativeToTheFirst=function(b){return arguments.length?(q=b?!0:!1,a):q},a.xyAuto=function(b){return arguments.length?(s=b?!0:!1,a):s},a.galaxyID=function(b){return arguments.length?(r=b,a):r},a}}(),function(){d3.linearDonut=function(){function a(a){a.each(function(a){if(null==a)return null;var f=d3.sum(a);if(0==f)return null;var g=d3.scale.linear().domain([0,f]).range([0,b]),h=d3.select(this).selectAll("rect").data(a);h.exit().remove(),h.enter().append("rect").attr("class","shares").attr("height",c).style("fill",function(a,b){return e(b)}),h.transition().duration(d).attr("x",function(b,c){return g(d3.sum(a.slice(0,c)))}).attr("width",function(a){return g(a)})})}var b=100,c=20,d=0,e=d3.scale.ordinal().range(["#000","#000"]);return a.width=function(c){return arguments.length?(b=+c,a):b},a.height=function(b){return arguments.length?(c=+b,a):c},a.duration=function(b){return arguments.length?(d=+b,a):d},a.color=function(b){return arguments.length?(e=b,a):e},a}}();var HEY_ONE="one happened",HEY_TWO="two happened";arrayContains=function(a,b){for(var c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},arrayUnique=function(a){for(var b=[],c=0;c<a.length;c++)arrayContains(a[c],b)||b.push(a[c]);return b},String.prototype.unpixel=function(){return this.substr(0,this.length-2)},String.prototype.undot=function(){return this.replace(".","")},String.prototype.fingerprint=function(){for(var a=0,b=0;b<this.length;b++)a+=this.charCodeAt(b);return a},arraySortingIndeces=function(a){for(var b=a.length,c=[];b--;)c[b]={k:b,v:a[b]};return c.sort(function(a,b){return+a.v-+b.v}),c.map(function(a){return a.k})};var timeSeriesSampling=function(a,b){if(null==b)var b=500;switch(a){case"days":return{value:Math.round(864e5/b)+"",unit:"milliseconds"};case"weeks":return{value:Math.round(6048e5/b)+"",unit:"milliseconds"};case"months":return{value:Math.round(26784e5/b)+"",unit:"milliseconds"};case"years":return{value:Math.round(31536e6/b)+"",unit:"milliseconds"};default:return{value:"1",unit:"hours"}}};minutesToMMSS=function(a){return(a>=60?Math.floor(a/60)+":":"")+d3.format("0"+(a>=60?2:1)+"d")(Math.floor(a%60))+":"+d3.format("02d")(Math.floor(60*(a-Math.floor(a))))},jQuery.fn.mouseIsOver=function(){return $(this).parent().find($(this).selector+":hover").length>0},this.alarmRateAvg=0,this.alarmRatePeak=0,this.timeToAck=0,this.timeofihbposehgfui541757Active=0,this.timeInFlood=0,this.staleofihbposehgfui541757s=0,this.staleofihbposehgfui541757sOldest=0,this.trainingsPassed=0,this.improvements=0;var flattenofihbposehgfui541757Groups=function(a){if(null==a)return"data not defined";var b=a.filter(function(a){return a.premise.length<=1&&a.conclusion.length<=1}).map(function(a){return{source:a.premise.length>0?a.premise[0]:a.conclusion[0],target:a.conclusion[0],type:a.type,hits:a.hits,shine:a.shine}
}),c=a.filter(function(a){return a.premise.length>1||a.conclusion.length>1}).map(function(a){return a.alarms=a.premise.concat(a.conclusion),a});return c.sort(function(a){return a.alarms.length-a.alarms.length}),c.forEach(function(a){a.alarms.forEach(function(c){a.alarms.forEach(function(d){c!=d&&(b.filter(function(b){return b.type==a.type&&(b.source==c&&b.target==d||b.source==d&&b.target==c)}).length||b.push({source:c,target:d,type:a.type,hits:a.hits,shine:a.shine}))})})}),b},normalizeEnlightments=function(a){return a.map(function(a){return null!=a.IFs&&null!=a.type?{type:a.type,premise:a.IFs.map(function(a){return a.Source+"."+a.Condition}),conclusion:[a.THEN].map(function(a){return a.Source+"."+a.Condition}),hits:a.OCCURRENCES,shine:a.CONFIDENCE}:null!=a.IFs&&null==a.type?{type:"fullycontains",premise:a.IFs.map(function(a){return a.Source+"."+a.Condition}),conclusion:[a.THEN].map(function(a){return a.Source+"."+a.Condition}),hits:a.OCCURRENCES,shine:a.CONFIDENCE}:null!=a.togetherness?{type:"timewindows",premise:a.premise,conclusion:a.conclusion,hits:a.basketshavingall,shine:a.togetherness}:null!=a.alarm?{type:"noaction",premise:[],conclusion:[a.alarm],hits:a.hits,shine:a.confidence}:void 0})};