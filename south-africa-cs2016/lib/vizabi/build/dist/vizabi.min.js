/**
 * vizabi - Vizabi Framework, Interactive charts and visualization tools animated through time
 * @version v0.15.0-35
 * @build timestampMon Jun 27 2016 18:45:50 GMT+0200 (CEST)
 * @link http://vizabi.org
 * @license BSD-3-Clause
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Vizabi=e()}(this,function(){"use strict";function t(t){return t instanceof Date||t instanceof RegExp}function e(t){if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);throw new Error("Unexpected situation")}function i(a){var n=[];return xt(a,function(a,s){"object"==typeof a&&null!==a?rt(a)?n[s]=i(a):t(a)?n[s]=e(a):n[s]=zt({},a):n[s]=a}),n}function a(t,e){return function(i,a){var n=e.getBoundingClientRect(),s=t.getScreenCTM();return{x:s.a*i+s.c*a+s.e-n.left,y:s.b*i+s.d*a+s.f-n.top}}}function s(t,e){function i(){!_e&&this.init&&this.init.apply(this,arguments)}e=1===arguments.length?t:e;var a=this.prototype;_e=!0;var n=new this;return _e=!1,xt(e,function(t,i){"function"==typeof e[i]&&"function"==typeof a[i]&&ze.test(e[i])?n[i]=function(t,e){return function(){var i=this._super;this._super=a[t];var n=e.apply(this,arguments);return this._super=i,n}}(i,e[i]):n[i]=t}),i.prototype=n,i.prototype.constructor=i,i.extend=s,i._collection={},i.register=function(t,e){"undefined"!=typeof this._collection[t]&&Ft('"'+t+'" is already registered. Overwriting...'),this._collection[t]=e},i.unregister=function(t){this._collection[t]=void 0},i.getCollection=function(){return this._collection},i.define=function(t,e){this.prototype[t]=e},i.get=function(t,e){return this._collection.hasOwnProperty(t)?this._collection[t]:(e||Ft('"'+t+'" was not found.'),!1)},arguments.length>1&&this.register&&this.register(t,i),i}function l(t){return this instanceof l?(this.status="pending",this.value,this.reason,this._resolves=[],this._rejects=[],d(t)&&t(this.resolve.bind(this),this.reject.bind(this)),this):new l(t)}function r(t,e){return e===t&&t.reject(new Error("TypeError")),e instanceof l?o(t,e):m(e)?c(t,e):t.resolve(e)}function o(t,e){var i=e.status;return"pending"===i&&e.then(t.resolve.bind(t),t.reject.bind(t)),"resolved"===i&&t.resolve(e.value),"rejected"===i&&t.reject(e.reason),promise}function c(t,e){var i,a=g(function(e){i||(r(t,e),i=!0)}),n=g(function(e){i||(t.reject(e),i=!0)});try{e.then.call(e,a,n)}catch(s){if(!i)throw s;t.reject(s)}return t}function h(t){for(var e,i,a=t.status,n=t["resolved"===a?"_resolves":"_rejects"],s=t["resolved"===a?"value":"reason"];e=n.shift();)i=e.call(t,s),i&&r(t._next,i);return t}function d(t){return"function"===u(t)}function u(t){var e={};return e.toString.call(t).replace(/\[object (\w+)\]/,"$1").toLowerCase()}function m(t){return t&&t.then&&d(t.then)}function g(t){var e,i;return function(){return e?i:(e=!0,i=t.apply(this,arguments))}}function p(t){ke=!0,t&&(rt(t)||(t=[t]),xt(t,function(t){Te[t]=!0}))}function f(){ke=!1,Te={};for(var t=Object.keys(Ee),e=0;e<t.length;e++){var i=Ee[t[e]];i&&i.unfreeze()}Ee={}}function v(t,e){return t&&(t.hasOwnProperty("_data")||e&&t.hasOwnProperty("_val"))}function b(t){for(var e in t._data)Object.defineProperty(t,e,{configurable:!0,get:function(e){return function(){return t.get(e)}}(e),set:function(e){return function(i){return t.set(e,i)}}(e)})}function y(t,e,i){function a(t,e){i._ready&&(e=i._name+"."+e,i.trigger(t,e))}function n(t,e){i.trigger(t,e)}function s(t,e){i.setReady(!1),i.trigger(t,e)}function l(t,e){i.trigger(t,e)}function r(t,e){i.setReady(!1),se(function(){i.setReady()})}var o;if(!mt(e)||rt(e)){var c={change:a};o=new Pe(t,e,i,c)}else{var c={change:a,hook_change:n,load_start:s,load_error:l,ready:r};if(v(e,!0))o=e,o.on(c);else{var h=t.split("_")[0],d=Ie.get(h,!0)||$e[h]||Ie;o=new d(t,e,i,c)}}return o}function x(t){return t._intervals?t._intervals:t._parent?x(t._parent):new Ae}function _(t,e){var i=z(t,e);return i?i:t._parent?_(t._parent,e):void 0}function z(t,e){for(var i in t._data)if(i===e&&v(t._data[i]))return t._data[i]}function M(t){return rt(t.space)?t.space:t._parent?M(t._parent):void Ht('ERROR: space not found.\n You must specify the objects this hook will use under the "space" attribute in the state.\n Example:\n space: ["entities", "time"]')}function w(){var t=function(t){return e(t)+"w"+i(t)};t.parse=function(t){var e=t.match(/^(\d{4})w(\d{2})$/);return e?a(e[1],e[2]):null};var e=function(t){var e=+t;return new Date(e+864e5*(4-(t.getUTCDay()||7))).getUTCFullYear()},i=function(t){var e=+t,i=new Date(e+864e5*(4-(t.getUTCDay()||7))),a=Math.ceil(((i.getTime()-i.setUTCMonth(0,1))/864e5+1)/7);return 10>a?"0"+a:a},a=function(t,e){var i=parseInt(e),a=t,n=new Date;n.setUTCFullYear(a),n.setUTCMonth(0),n.setUTCDate(4);var s=n.getUTCDay()||7,l=1,r=7*i+l-(s+4),o=Be.year.parse(a);return o=new Date(o.getTime()+24*r*60*60*1e3)};return t}function S(){var t=function(t){return Be.year(t)+"q"+e(t)};t.parse=function(t){var e=t.match(/^(\d{4})q(\d)$/);return e?i(e[1],e[2]):null};var e=function(t){return(t.getUTCMonth()/3|0)+1},i=function(t,e){var i=parseInt(e),a=3*i-2,n=t;return Be.month.parse([n,(9>a?"0":"")+a].join(""))};return t}function k(t){var e=new l,i=[];xt(t.components,function(t){i.push(k(t))});var a=i.length?l.all(i):new l.resolve;return a.then(function(){t.preload(e)},function(t){Ht("Error preloading data:",t)}),e.then(function(){return t.afterPreload(),!0})}function E(t,e){var i=function(e){return t.replace(/<%=([^\%]*)%>/g,function(t){var i=t.match(/t\s*\(([^)]+)\)/g);return i.length?i=e.t(i[0].match(/\"([^"]+)\"/g)[0].split('"').join("")):(i=t.match(/([a-z\-A-Z]+([a-z\-A-Z0-9]?[a-zA-Z0-9]?)?)/g)[0],i=e[i]||i),i})},a=/<[a-z][\s\S]*>/i.test(t)?i:ai[t]=ai[t]||E(at.templates[t]);return e?a(e):a}function T(){this._container&&this.setSize()}function O(t,e){function i(){var n=JSON.stringify(t.getPlainObject()),s=arguments[0]||0;this._readyOnce?e():e(this);var l=JSON.stringify(t.getPlainObject());s>=a?Ht("Max validation loop."):n!==l&&i.call(this,[s+=1])}var a=10;return i}function C(t,e){for(var i,a,n,s,l=Object.keys(e),r=l.length,o=0;r>o;o+=1)i=l[o],"_defs_"!==i&&(a=e[i],n=t[i],s=typeof a,"object"===s&&(s=mt(a)&&a._defs_?"object":rt(a)?"array":"model"),"undefined"==typeof n&&("object"!==s&&"model"!==s?t[i]=a:t[i]=C({},a)),n=t[i],"number"===s&&isNaN(n)?t[i]=0:"string"===s&&"string"!=typeof n?t[i]="":"array"!==s||rt(n)?"model"===s?(ot(n)||(t[i]={}),t[i]=C(t[i],a)):"object"===s&&(ot(n)&&0!==Object.keys(n).length||(n=!1),ot(a._defs_)||(a._defs_={}),t[i]=n||a._defs_):t[i]=[]);return t}function L(){return function t(e){function i(t,e,i){return i.indexOf(t)===e}function a(t){if(null!=g)return void a.highlightValueRun(t);var i=t.append("g").attr("class","tick widthSampling"),n=i.append("text").text("0");x.cssMarginTop=n.style("margin-top"),x.cssMarginBottom=n.style("margin-bottom"),x.cssMarginLeft=n.style("margin-left"),x.cssMarginRight=n.style("margin-right"),x.widthOfOneDigit=n[0][0].getBBox().width,x.heightOfOneDigit=n[0][0].getBBox().height,i.remove(),a.labelFactory(x),e(x.transitionDuration>0?t.transition().duration(x.transitionDuration):t);var s="top"==a.orient()||"bottom"==a.orient()?o:r,l=s==o&&a.pivot()||s==r&&!a.pivot()?h:c;t.selectAll(".vzb-axis-value").data([null]).enter().append("g").attr("class","vzb-axis-value").classed("vzb-hidden",!0).append("text"),t.selectAll("text").each(function(t,e){var i=d3.select(this);null!=a.pivot()&&(i.attr("transform","rotate("+(a.pivot()?-90:0)+")"),i.style("text-anchor",l==c?"middle":"end"),i.attr("x",l==c?0:-a.tickPadding()-a.tickSize()),i.attr("y",l==c?(s==r?-1:1)*(a.tickPadding()+a.tickSize()):0),i.attr("dy",l==c?s==r?0:".72em":".32em"))}),null!=a.repositionLabels()&&t.selectAll(".tick").each(function(t,e){var i=d3.select(this).select("text"),n=a.repositionLabels()[e]||{x:0,y:0};i.attr("x",+i.attr("x")+n.x),i.attr("y",+i.attr("y")+n.y)}),null==a.tickValuesMinor()&&a.tickValuesMinor([]);var d=t.selectAll(".tickMinor").data(b);d.exit().remove(),d.enter().append("line").attr("class","tickMinor");var u=a.tickSizeMinor().outbound,m=a.tickSizeMinor().inbound,p=a.scale();d.attr("y1",s==o?("top"==a.orient()?1:-1)*m:p).attr("y2",s==o?("top"==a.orient()?-1:1)*u:p).attr("x1",s==r?("right"==a.orient()?-1:1)*m:p).attr("x2",s==r?("right"==a.orient()?1:-1)*u:p),t.selectAll("path").remove();var f=t.selectAll(".vzb-axis-line").data([0]);f.exit().remove(),f.enter().append("line").attr("class","vzb-axis-line"),x.constantRakeLength?f.attr("x1",s==r?0:-1).attr("x2",s==r?0:x.constantRakeLength).attr("y1",0).attr("y2",s==o?0:x.constantRakeLength):f.attr("x1",s==r?0:d3.min(p.range())-(x.bump||0)-1).attr("x2",s==r?0:d3.max(p.range())+(x.bump||0)).attr("y1",s==o?0:d3.min(p.range())-(x.bump||0)).attr("y2",s==o?0:d3.max(p.range())+(x.bump||0))}function n(t,e){null==e&&(e=!0);var i=[],a=[];-1!=t.indexOf(0)&&(i.push([0]),a.push(t.indexOf(0)));for(var n=t.length;n>=1;n=4>n?n-1:n/2)i.push(t.filter(function(t,i){return i%Math.floor(n)!=0||-1!=a.indexOf(i)&&e?!1:(a.push(i),!0)}));return i}function s(t,e,i,a,n){if(null==t)return null;var s=i==r?{head:e.toolMargin.top,tail:e.toolMargin.bottom}:{head:e.toolMargin.right,tail:e.toolMargin.left},l={};return t.forEach(function(c,h){if(0==h||h==t.length-1){var d=s.head+e.bump+(i==o?1:0)*d3.max(a.range())-(i==o?0:1)*d3.min(a.range())+(i==o?-1:1)*a(c)-("x"==n)*e.formatter(c).length*e.widthOfOneDigit/2-("y"==n)*e.heightOfOneDigit/2-("x"==n)*parseInt(e.cssMarginRight)-("y"==n)*parseInt(e.cssMarginTop),u=Math.min(s.tail,e.widthOfOneDigit)+e.bump+(i==r?1:0)*d3.max(a.range())-(i==r?0:1)*d3.min(a.range())+(i==r?-1:1)*a(c)-("x"==n)*e.formatter(c).length*e.widthOfOneDigit/2-("y"==n)*e.heightOfOneDigit/2-("x"==n)*parseInt(e.cssMarginLeft)-("y"==n)*parseInt(e.cssMarginBottom);d>0&&(d=0),u>0&&(u=0),l[h]={x:0,y:0},l[h][n]=("y"==n&&i==r?-1:1)*(d-u)}}),t.forEach(function(s,c){if(0!=c&&c!=t.length-1){var h=Math.abs(a(s)-a(t[t.length-1]))-("y"==n)*(i==o?-1:1)*l[t.length-1][n]-("x"==n)*(i==o?1:-1)*l[t.length-1][n]-("x"==n)*e.widthOfOneDigit/2*e.formatter(s).length-("x"==n)*e.widthOfOneDigit/2*e.formatter(t[t.length-1]).length-("y"==n)*e.heightOfOneDigit*.7-("x"==n)*parseInt(e.cssMarginLeft)-("y"==n)*parseInt(e.cssMarginBottom),d=Math.abs(a(s)-a(t[0]))-("y"==n)*(i==r?-1:1)*l[0][n]-("x"==n)*(i==r?1:-1)*l[0][n]-("x"==n)*e.widthOfOneDigit/2*e.formatter(s).length-("x"==n)*e.widthOfOneDigit/2*e.formatter(t[0]).length-("y"==n)*e.heightOfOneDigit*.7-("x"==n)*parseInt(e.cssMarginLeft)-("y"==n)*parseInt(e.cssMarginBottom);h>0&&(h=0),d>0&&(d=0),l[c]={x:0,y:0},l[c][n]=("y"==n&&i==r?-1:1)*(h-d)}}),l}function l(t,e,i,n,s){return a.labelerOptions().isDevMode?null!=s?void console.log(t,e,i,n,s):null!=n?void console.log(t,e,i,n):null!=i?void console.log(t,e,i):null!=e?void console.log(t,e):null!=t?void console.log(t):void 0:void 0}var r="vertical axis",o="horizontal axis",c="labels stack side by side",h="labels stack top to bottom",d="optimistic approximation: labels have different lengths",u="pessimistic approximation: all labels have the largest length",m=10;a.highlightValueRun=function(t){var e="top"==a.orient()||"bottom"==a.orient()?o:r;t.select(".vzb-axis-value").classed("vzb-hidden","none"==g).select("text").text(x.formatter("none"==g?0:g));var i=function(){return"none"==g?"translate(0,0)":"translate("+(e==o?a.scale()(g):0)+","+(e==r?a.scale()(g):0)+")"},n=function(t,e){return"none"==g?1:Math.min(1,Math.pow(Math.abs(a.scale()(t)-a.scale()(g))/(a.scale().range()[1]-a.scale().range()[0])*5,2))};p?(t.selectAll(".tick").each(function(t,e){d3.select(this).select("text").transition().duration(p).ease("linear").style("opacity",n(t,e))}),t.select(".vzb-axis-value").transition().duration(p).ease("linear").attr("transform",i)):(t.selectAll(".tick").each(function(t,e){d3.select(this).select("text").interrupt().style("opacity",n(t,e))}),t.select(".vzb-axis-value").interrupt().attr("transform",i)),g=null};var g=null;a.highlightValue=function(t){return arguments.length?(g=t,a):g};var p=0;a.highlightTransDuration=function(t){return arguments.length?(p=t,a):p};var f=null;a.repositionLabels=function(t){return arguments.length?(f=t,a):f};var v=!1;a.pivot=function(t){return arguments.length?(v=!!t,a):v};var b=[];a.tickValuesMinor=function(t){return arguments.length?(b=t,a):b};var y={outbound:0,inbound:0};a.tickSizeMinor=function(t,e){return arguments.length?(y={outbound:t,inbound:e||0},l("setting",y),a):y};var x={};return a.labelerOptions=function(t){return arguments.length?(x=t,a):x},a.METHOD_REPEATING="repeating specified powers",a.METHOD_DOUBLING="doubling the value",a.labelFactory=function(t){function e(e,i){return 0==e||0==i?0:(null==i&&(i=t.logBase),Math.log(e)/Math.log(i))}if(null==t&&(t={}),"linear"!=t.scaleType&&"time"!=t.scaleType&&"genericLog"!=t.scaleType&&"log"!=t.scaleType&&"ordinal"!=t.scaleType)return a.ticks(_).tickFormat(null).tickValues(null).tickValuesMinor(null).pivot(null).repositionLabels(null);if("ordinal"==t.scaleType)return a.tickValues(null);null==t.logBase&&(t.logBase=m),null==t.stops&&(t.stops=[1,2,5,3,7,4,6,8,9]),null==t.removeAllLabels&&(t.removeAllLabels=!1),null==t.formatter&&(t.formatter=a.tickFormat()?a.tickFormat():function(t){return t+""}),t.cssLabelMarginLimit=5,(null==t.cssMarginLeft||parseInt(t.cssMarginLeft)<t.cssLabelMarginLimit)&&(t.cssMarginLeft=t.cssLabelMarginLimit+"px"),(null==t.cssMarginRight||parseInt(t.cssMarginRight)<t.cssLabelMarginLimit)&&(t.cssMarginRight=t.cssLabelMarginLimit+"px"),(null==t.cssMarginTop||parseInt(t.cssMarginTop)<t.cssLabelMarginLimit)&&(t.cssMarginTop=t.cssLabelMarginLimit+"px"),(null==t.cssMarginBottom||parseInt(t.cssMarginBottom)<t.cssLabelMarginLimit)&&(t.cssMarginBottom=t.cssLabelMarginLimit+"px"),null==t.toolMargin&&(t.toolMargin={left:30,bottom:30,right:30,top:30}),null==t.bump&&(t.bump=0),null==t.constantRakeLength&&(t.constantRakeLength=0),null==t.pivotingLimit&&(t.pivotingLimit=t.toolMargin[this.orient()]),null==t.showOuter&&(t.showOuter=!1),null==t.limitMaxTickNumber&&(t.limitMaxTickNumber=0);var c="top"==this.orient()||"bottom"==this.orient()?o:r;null==t.isPivotAuto&&(t.isPivotAuto=c==r),null==t.cssFontSize&&(t.cssFontSize="13px"),null==t.widthToFontsizeRatio&&(t.widthToFontsizeRatio=.75),null==t.heightToFontsizeRatio&&(t.heightToFontsizeRatio=1.2),null==t.widthOfOneDigit&&(t.widthOfOneDigit=parseInt(t.cssFontSize)*t.widthToFontsizeRatio),null==t.heightOfOneDigit&&(t.heightOfOneDigit=parseInt(t.cssFontSize)*t.heightToFontsizeRatio),null!=t.fitIntoScale&&"pessimistic"!=t.fitIntoScale||(t.fitIntoScale=u),"optimistic"==t.fitIntoScale&&(t.fitIntoScale=d),l("********** "+c+" **********");var h=a.scale().domain(),g=a.scale().range(),p=(Math.abs(h[h.length-1]-h[0]),Math.abs(g[g.length-1]-g[0])),f=d3.min([h[0],h[h.length-1]]),v=d3.max([h[0],h[h.length-1]]),b=0>=f&&v>=0&&"time"!=t.scaleType,y=t.showOuter?[f,v]:[],x=[],_=5,z=d3.max(d3.range(f,v,(v-f)/17).concat(v).map(function(e){return t.formatter(e).length}))*t.widthOfOneDigit+parseInt(t.cssMarginLeft),M=t.isPivotAuto&&(z+a.tickPadding()+a.tickSize()>t.pivotingLimit&&c==r||!(z+a.tickPadding()+a.tickSize()>t.pivotingLimit)&&!(c==r)),w=c==o&&M||c==r&&!M,S=!w&&t.heightOfOneDigit>t.pivotingLimit;if(t.removeAllLabels)return a.tickValues([]);if(f==v)return a.tickValues([f]).ticks(1).tickFormat(t.formatter);var k=function(e,i,n,s){if(null==e||e.length<=1)return!0;if(null==n&&(n=u),null==s&&(scaleType="none"),w)return i>e.length*(t.heightOfOneDigit+parseInt(t.cssMarginTop)+parseInt(t.cssMarginBottom));var l=parseInt(t.cssMarginLeft)+parseInt(t.cssMarginRight),r=d3.max(e.map(function(e){return t.formatter(e).length}));return"log"==s?(i=Math.abs(a.scale()(d3.max(e))-a.scale()(d3.min(e))),i>d3.sum(e.map(function(e){return(t.widthOfOneDigit*(n==u?r:t.formatter(e).length)+l)*(1+Math.log(e.toString().replace(/([0\.])/g,"")[0])/Math.LN10)}))):i+t.toolMargin.left+t.toolMargin.right>e.length*l+(n==u?t.widthOfOneDigit*e.length*r:0)+(n==d?t.widthOfOneDigit*e.map(function(e){return t.formatter(e)}).join("").length:0)},E=function(e,i){if(null==i||0==i.length)return!1;i instanceof Array||(i=[i]);for(var n=0;n<i.length;n++)if(e!=i[n]&&0!=e&&Math.abs(a.scale()(e)-a.scale()(i[n]))<(w?t.heightOfOneDigit:(t.formatter(e).length+t.formatter(i[n]).length)*t.widthOfOneDigit/2))return!0;return!1};if("genericLog"==t.scaleType||"log"==t.scaleType){var T=a.scale().eps?a.scale().eps():0,O=b?[0]:[],C=T>v?[]:d3.range(Math.floor(e(Math.max(T,f))),Math.ceil(e(v)),1).concat(Math.ceil(e(v))).map(function(e){return Math.pow(t.logBase,e)}),L=f>-T?[]:d3.range(Math.floor(e(Math.max(T,-v))),Math.ceil(e(-f)),1).concat(Math.ceil(e(-f))).map(function(e){return-Math.pow(t.logBase,e)});if(null==t.method){var A=b?Math.max(Math.abs(v),Math.abs(f))/T:Math.max(Math.abs(v),Math.abs(f))/Math.min(Math.abs(v),Math.abs(f));t.method=A>=10&&1024>=A?this.METHOD_DOUBLING:this.METHOD_REPEATING}if(t.method==this.METHOD_DOUBLING){var D=[];b&&y.push(0);var P=[].concat(y),I=T>v?null:4*C[Math.floor(C.length/2)-1],B=f>-T?null:4*L[Math.floor(L.length/2)-1];if(I)for(var R=I;v>=R;R*=2)D.push(R);if(I)for(var R=I/2;R>=Math.max(f,T);R/=2)D.push(R);if(B)for(var R=B;R>=f;R*=2)D.push(R);if(B)for(var R=B/2;R<=Math.min(v,-T);R/=2)D.push(R);D=D.sort(d3.ascending).filter(function(t){return t>=f&&v>=t}),x=x.concat(D),D=n(D,!1);for(var F=y,N=0;N<D.length;N++){var q=F.concat(D[N]).filter(function(t){return!E(t,P)}).filter(i);if(!k(q,p,u,"none"))break;y=q}}if(t.method==this.METHOD_REPEATING){var H=O.concat(C).concat(L).sort(d3.ascending);t.stops.forEach(function(t,e){x=x.concat(H.map(function(e){return e*t}))}),H=n(H);var P=O.concat(y),Y=!1;t.stops.forEach(function(e,a){if(0==a){for(var n=0;n<H.length;n++){var s=y.concat(H[n].map(function(t){return t*e})).filter(function(t){return!E(t,P)}).filter(function(t){return t>=f&&v>=t}).filter(i);if(!k(s,p,u,"none"))break;y=s}H=[].concat.apply([],H)}else{if(Y)return;var s=y.concat(H.map(function(t){return t*e})).filter(function(t){return t>=f&&v>=t}).filter(i);if(!k(s,p,u,"log"))return void(Y=!0);if(y.length>t.limitMaxTickNumber&&0!=t.limitMaxTickNumber)return void(Y=!0);y=s}})}}if("linear"==t.scaleType||"time"==t.scaleType){b&&y.push(0);var P=[].concat(y);_=w?Math.max(Math.floor(p/(t.heightOfOneDigit+parseInt(t.cssMarginTop))),2):Math.max(Math.floor(p/z),2),0!=t.limitMaxTickNumber&&_>t.limitMaxTickNumber&&(_=t.limitMaxTickNumber);var j=a.scale().ticks.apply(a.scale(),[_]).sort(d3.ascending).filter(function(t){return t>=f&&v>=t});x=x.concat(j),j=n(j,!1);for(var F=y,N=0;N<j.length;N++){var q=F.concat(j[N]).filter(function(t){return!E(t,P)}).filter(i);if(!k(q,p,t.fitIntoScale,"none"))break;y=q}y=y.filter(function(t){return!E(t,P)}).filter(i)}return null!=y&&y.length<=2&&!b&&(y=[f,v]),null!=y&&y.length<=3&&b&&(y=E(0,[f,v])?[f,v]:[f,0,v]),null!=y&&y.sort(function(t,e){return(c==o?-1:1)*(a.scale()(e)-a.scale()(t))}),S&&(y=[]),x=x.filter(function(t){return-1==y.indexOf(t)&&t>=f&&v>=t}),l("final result",y),a.ticks(_).tickFormat(t.formatter).tickValues(y).tickValuesMinor(x).pivot(M).repositionLabels(s(y,t,c,a.scale(),w?"y":"x"))},a.copy=function(){return t(d3.svg.axis())},d3.rebind(a,e,"scale","orient","ticks","tickValues","tickFormat","tickSize","innerTickSize","outerTickSize","tickPadding","tickSubdivide")}(d3.svg.axis())}function A(t,e,i){var a,n,s,l,r,o,c,h,d,u,m;return{move:function(e,i){t.style("right",e+"px"),t.style("top",i+"px")},dragStart:function(i){if(ve()){var g=d3.touches(e.node());a=g[0][0],n=g[0][1]}else a=i.sourceEvent.clientX,n=i.sourceEvent.clientY;s=parseInt(t.style("top"))||0,l=parseInt(t.style("right"))||0,r=parseInt(t.style("margin-right"))||0,o=parseInt(t.style("width")),c=parseInt(t.style("height")),h=parseInt(e.style("width"))-r,d=parseInt(e.style("height")),u=a+l,m=n-s},drag:function(t){if(ve()){var s=d3.touches(e.node());a=s[0][0],n=s[0][1]}else a=t.sourceEvent.clientX,n=t.sourceEvent.clientY;var l=-a+u,r=n-m;-i>l&&(l=-i),0>r&&(r=0),l+o>h&&(l=h-o),r+c>d&&(r=d-c),this.move(l,r)}}}function D(){return window?void 0!==window.document.webkitIsFullScreen?window.document.webkitIsFullScreen:void 0!==window.document.mozFullScreen?window.document.mozFullScreen:void 0!==window.document.msFullscreenElement?window.document.msFullscreenElement:!1:!1}function P(t){D()||t()}function I(t){if(window){var e=window.document;this.exitFullscreenHandler=P.bind(this,t),e.addEventListener("webkitfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("mozfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("fullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("MSFullscreenChange",this.exitFullscreenHandler,!1)}}function B(){var t=window.document;t.removeEventListener("webkitfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("mozfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("fullscreenchange",this.exitFullscreenHandler),t.removeEventListener("MSFullscreenChange",this.exitFullscreenHandler)}function R(t){t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&(navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&!navigator.userAgent.match("CriOS")||t.webkitRequestFullscreen())}function F(){B.call(this),document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function N(){function t(){function t(){for(var t=[],i=0;s>i;i++){var d=l+(1-l)/s*i;t.push([]);for(var u=0;a>=u;u++){var m=n+(1-n)/a*u;t[i].push({display:e(m,0==u?h:r,0==i?o:d),meaning:e(m,0==u?h:r,0==i?c:d)})}}return t}function e(t,e,i){var a,n,s;if(0==e)a=n=s=i;else{var l=function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t},r=.5>i?i*(1+e):i+e-i*e,o=2*i-r;a=l(o,r,t+1/3),n=l(o,r,t),s=l(o,r,t-1/3)}return"#"+Math.round(255*a).toString(16)+Math.round(255*n).toString(16)+Math.round(255*s).toString(16)}function i(e){if(i.container=e,z=e.select("."+b.COLOR_PICKER),z.empty()){e.on("click",function(){i.show(!1),d3.event.stopPropagation()}),y=t(),z=e.append("svg").style("position","absolute").style("top","0").style("left","0").style("width","100%").style("max-width",u+"px").style("height","100%").style("max-height",m+"px").style("z-index",9999).attr("class",b.COLOR_PICKER+" vzb-dialog-shadow").classed(b.INVISIBLE,!w).on("mouseout",function(t){L(p)});var a=parseInt(z.style("width")),n=parseInt(z.style("height")),l=a/2*(1-g.left-g.right);E=z.append("rect").attr("width",a).attr("height",m).attr("class",b.COLOR_BUTTON+" "+b.COLOR_BACKGR).on("mouseover",function(t){L(p)});var r=z.append("g").attr("class",b.COLOR_CIRCLES).attr("transform","translate("+(l+a*g.left)+","+(l+n*g.top)+")");z.append("rect").attr("class",b.COLOR_SAMPLE).attr("width",a/2).attr("height",n*g.top/2),S=z.append("rect").attr("class",b.COLOR_SAMPLE).attr("width",a/2).attr("x",a/2).attr("height",n*g.top/2),z.append("text").attr("x",a*g.left).attr("y",n*g.top/2).attr("dy","1.3em").attr("class",b.COLOR_SAMPLE).style("text-anchor","start"),k=z.append("text").attr("x",a*(1-g.right)).attr("y",n*g.top/2).attr("dy","1.3em").attr("class",b.COLOR_SAMPLE).style("text-anchor","end"),z.append("text").attr("x",.1*a).attr("y",n*(1-g.bottom)).attr("dy","1.2em").attr("class","vzb-default-label").style("text-anchor","start").text("default"),z.append("circle").attr("class",b.COLOR_DEFAULT+" "+b.COLOR_BUTTON).attr("r",a*g.left/2).attr("cx",a*g.left*1.5).attr("cy",n*(1-1.5*g.bottom)).on("mouseover",function(){d3.select(this).style("stroke","#444"),L(f)}).on("mouseout",function(){d3.select(this).style("stroke","none")}),r.selectAll("."+b.COLOR_CIRCLE).data(y).enter().append("g").attr("class",b.COLOR_CIRCLE).each(function(t,e){x.outerRadius(d+(l-d)/s*(s-e)).innerRadius(d+(l-d)/s*(s-e-1));var i=d3.select(this).selectAll("."+b.COLOR_SEGMENT).data(_(t)).enter().append("g").attr("class",b.COLOR_SEGMENT);i.append("path").attr("class",b.COLOR_BUTTON).attr("d",x).style("fill",function(t){return t.data.display}).style("stroke",function(t){return t.data.display}).on("mouseover",function(t){L(t.data.meaning,this)}).on("mouseout",function(t){A()})}),r.append("circle").attr("r",d).attr("fill",v).attr("class",b.COLOR_BUTTON).on("mouseover",function(){d3.select(this).style("stroke","#555"),L(v)}).on("mouseout",function(){d3.select(this).style("stroke","none")}),M=r.append("path").attr("class",b.COLOR_POINTER+" "+b.INVISIBLE),z.selectAll("."+b.COLOR_BUTTON).on("click",function(){d3.event.stopPropagation(),C.show(!1)}),O(z),i.resize(z)}}var a=15,n=0,s=4,l=.5,r=.7,o=.4,c=.3,h=0,d=15,u=280,m=323,g={top:.1,bottom:.1,left:.1,right:.1},p="#000",f="#000",v="#f8f8f8",b={INVISIBLE:"vzb-invisible",COLOR_POINTER:"vzb-colorpicker-pointer",COLOR_BUTTON:"vzb-colorpicker-cell",COLOR_DEFAULT:"vzb-colorpicker-default",COLOR_SAMPLE:"vzb-colorpicker-sample",COLOR_PICKER:"vzb-colorpicker-svg",COLOR_CIRCLE:"vzb-colorpicker-circle",COLOR_CIRCLES:"vzb-colorpicker-circles",COLOR_SEGMENT:"vzb-colorpicker-segment",COLOR_BACKGR:"vzb-colorpicker-background"},y=[],x=d3.svg.arc(),_=d3.layout.pie().sort(null).value(function(t){return 1}),z=null,M=null,w=!1,S=null,k=null,E=null,T=function(t){console.info("Color picker callback example. Setting color to "+t)},O=function(t){t.select("."+b.COLOR_BACKGR).style("fill","white"),t.select("."+b.COLOR_POINTER).style("stroke-width",2).style("stroke",v).style("pointer-events","none").style("fill","none"),t.selectAll("."+b.COLOR_BUTTON).style("cursor","pointer"),t.selectAll("text").style("fill","#D9D9D9").style("font-size","0.7em").style("text-transform","uppercase"),t.selectAll("circle."+b.COLOR_BUTTON).style("stroke-width",2)},C=i,L=function(t,e){null!=e&&M.classed(b.INVISIBLE,!1).attr("d",d3.select(e).attr("d")),S.style("fill",t),k.text(t),T(t)},A=function(){M.classed(b.INVISIBLE,!0)},D="toggle";return i.show=function(t){return arguments.length?(null==z&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),w=t==D?!w:t,w||(T=function(){}),void z.classed(b.INVISIBLE,!w)):w},i.nCellsH=function(t){return arguments.length?(a=t,i):a},i.minH=function(t){return arguments.length?(n=t,i):n},i.nCellsL=function(t){return arguments.length?(s=t,i):s},i.minL=function(t){return arguments.length?(l=t,i):l},i.outerL_display=function(t){return arguments.length?(o=t,i):o},i.outerL_meaning=function(t){return arguments.length?(c=t,i):c},i.satConstant=function(t){return arguments.length?(r=t,i):r},i.firstAngleSat=function(t){return arguments.length?(h=t,i):h},i.minRadius=function(t){return arguments.length?(d=t,i):d},i.margin=function(t){return arguments.length?(g=t,i):g},i.callback=function(t){return arguments.length?(T=t,i):T},i.colorDef=function(t){return arguments.length?("undefined"!=typeof t&&(f=t),null==z&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),z.select("."+b.COLOR_DEFAULT).style("fill",f),i):f},i.fitToScreen=function(t){var e,a,n=i.container.node().getBoundingClientRect(),s=parseInt(z.style("width")),l=parseInt(z.style("height"));t?(e=t[0]-n.left,a=t[1]-n.top):(e=n.width-parseInt(z.style("right"))-s,a=parseInt(z.style("top")));var r={left:""};return.8*n.width<=s?r.right=.5*(n.width-s)+"px":e+s>n.width?r.right=Math.min(.1*n.width,20)+"px":r.right=n.width-e-s+"px",.8*n.height<=l?r.top=.5*(n.height-l)+"px":a+1.2*l>n.height?r.top=.9*n.height-l+"px":r.top=a+"px",z.style(r),i},i.colorOld=function(t){return arguments.length?(p=t,null==z&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),z.select("rect."+b.COLOR_SAMPLE).style("fill",p),z.select("text."+b.COLOR_SAMPLE).text(p),i):p},i.resize=function(t){if(!arguments.length)return resize;if("undefined"!=typeof t){var e=t,a=parseInt(e.style("width")),n=parseInt(e.style("height")),s=a/2*(1-g.left-g.right),l=e.select("."+b.COLOR_DEFAULT),r=e.select(".vzb-default-label"),o=e.select("."+b.COLOR_CIRCLES),c=s+n*g.top,h=(1+.5*g.top)*n*.5;c=c>h?h:c,o.attr("transform","translate("+(s+a*g.left)+","+c+")"),l.attr("cx",a*g.left*1.5).attr("cy",n*(1-1.5*g.bottom)),r.attr("x",.1*a).attr("y",n*(1-g.bottom))}return i.fitToScreen(),i},i}return function(){return null==vn&&(vn=t()),vn}()}function q(){function t(t,i){return{type:"Feature",id:t.id,properties:t.properties,geometry:e(t.geometry,i)}}function e(t,i){if(!t)return null;if("GeometryCollection"===t.type)return{type:"GeometryCollection",geometries:object.geometries.map(function(t){return e(t,i)})};if(!me.hasOwnProperty(t.type))return null;var a=me[t.type];return d3.geo.stream(t,i(a)),a.result()}function i(){}function a(t){if((e=t.length)<4)return!1;for(var e,i=0,a=t[e-1][1]*t[0][0]-t[e-1][0]*t[0][1];++i<e;)a+=t[i-1][1]*t[i][0]-t[i-1][0]*t[i][1];return 0>=a}function n(t,e){for(var i=e[0],a=e[1],n=!1,s=0,l=t.length,r=l-1;l>s;r=s++){var o=t[s],c=o[0],h=o[1],d=t[r],u=d[0],m=d[1];h>a^m>a&&(u-c)*(a-h)/(m-h)+c>i&&(n=!n)}return n}function s(t){return t?t/Math.sin(t):1}function l(t){return t>0?1:0>t?-1:0}function r(t){return t>1?ve:-1>t?-ve:Math.asin(t)}function o(t){return t>1?0:-1>t?fe:Math.acos(t)}function c(t){return t>0?Math.sqrt(t):0}function h(t){function e(t,e){var i=Math.cos(t),n=Math.cos(e),s=Math.sin(e),l=n*i,r=-((1-l?Math.log(.5*(1+l))/(1-l):-.5)+a/(1+l));return[r*n*Math.sin(t),r*s]}var i=Math.tan(.5*t),a=2*Math.log(Math.cos(.5*t))/(i*i);return e.invert=function(e,i){var n,s=Math.sqrt(e*e+i*i),l=t*-.5,o=50;if(!s)return[0,0];do{var c=.5*l,h=Math.cos(c),d=Math.sin(c),u=Math.tan(c),m=Math.log(1/h);l-=n=(2/u*m-a*u-s)/(-m/(d*d)+1-a/(2*h*h))}while(Math.abs(n)>ge&&--o>0);var g=Math.sin(l);return[Math.atan2(e*g,s*Math.cos(l)),r(i*g/s)]},e}function d(){var t=ve,e=ze(h),i=e(t);return i.radius=function(i){return arguments.length?e(t=i*fe/180):t/fe*180},i}function u(t,e){var i=Math.cos(e),a=s(o(i*Math.cos(t/=2)));return[2*i*Math.sin(t)*a,Math.sin(e)*a]}function m(t){function e(t,e){var r=Math.cos(e),o=Math.cos(t/=2);return[(1+r)*Math.sin(t),(n*e>-Math.atan2(o,s)-.001?0:10*-n)+l+Math.sin(e)*a-(1+r)*i*o]}var i=Math.sin(t),a=Math.cos(t),n=t>0?1:-1,s=Math.tan(n*t),l=(1+i-a)/2;return e.invert=function(t,e){var r=0,o=0,c=50;do{var h=Math.cos(r),d=Math.sin(r),u=Math.cos(o),m=Math.sin(o),g=1+u,p=g*d-t,f=l+m*a-g*i*h-e,v=.5*g*h,b=-d*m,y=.5*i*g*d,x=a*u+i*h*m,_=b*y-x*v,z=.5*(f*b-p*x)/_,M=(p*y-f*v)/_;r-=z,o-=M}while((Math.abs(z)>ge||Math.abs(M)>ge)&&--c>0);return n*o>-Math.atan2(Math.cos(r),s)-.001?[2*r,o]:null},e}function g(){var t=fe/9,e=t>0?1:-1,i=Math.tan(e*t),a=ze(m),n=a(t),s=n.stream;return n.parallel=function(n){return arguments.length?(i=Math.tan((e=(t=n*fe/180)>0?1:-1)*t),a(t)):t/fe*180},n.stream=function(a){var l=n.rotate(),r=s(a),o=(n.rotate([0,0]),s(a));return n.rotate(l),r.sphere=function(){o.polygonStart(),o.lineStart();for(var a=-180*e;180>e*a;a+=90*e)o.point(a,90*e);for(;e*(a-=t)>=-180;)o.point(a,e*-Math.atan2(Math.cos(a*ye/2),i)*xe);o.lineEnd(),o.polygonEnd()},r},n}function p(t){return t=Math.exp(2*t),(t-1)/(t+1)}function f(t){return.5*(Math.exp(t)-Math.exp(-t))}function v(t){return.5*(Math.exp(t)+Math.exp(-t))}function b(t){return Math.log(t+c(t*t+1))}function y(t){return Math.log(t+c(t*t-1))}function x(t,e){var i=Math.tan(e/2),a=c(1-i*i),n=1+a*Math.cos(t/=2),s=Math.sin(t)*a/n,l=i/n,r=s*s,o=l*l;return[4/3*s*(3+r-3*o),4/3*l*(3+3*r-o)]}function _(t,e){var i=Math.abs(e);return fe/4>i?[t,Math.log(Math.tan(fe/4+e/2))]:[t*Math.cos(i)*(2*Math.SQRT2-1/Math.sin(i)),l(e)*(2*Math.SQRT2*(i-fe/4)-Math.log(Math.tan(i/2)))]}function z(t){function e(t,e){var a=we(t,e);if(Math.abs(t)>ve){var n=Math.atan2(a[1],a[0]),s=Math.sqrt(a[0]*a[0]+a[1]*a[1]),l=i*Math.round((n-ve)/i)+ve,o=Math.atan2(Math.sin(n-=l),2-Math.cos(n));n=l+r(fe/s*Math.sin(o))-o,a[0]=s*Math.cos(n),a[1]=s*Math.sin(n)}return a}var i=2*fe/t;return e.invert=function(t,e){var a=Math.sqrt(t*t+e*e);if(a>ve){var n=Math.atan2(e,t),s=i*Math.round((n-ve)/i)+ve,l=n>s?-1:1,r=a*Math.cos(s-n),o=1/Math.tan(l*Math.acos((r-fe)/Math.sqrt(fe*(fe-2*r)+a*a)));n=s+2*Math.atan((o+l*Math.sqrt(o*o-3))/3),t=a*Math.cos(n),e=a*Math.sin(n)}return we.invert(t,e)},e}function M(){var t=5,e=ze(z),i=e(t),a=i.stream,n=.01,s=-Math.cos(n*ye),l=Math.sin(n*ye);return i.lobes=function(i){return arguments.length?e(t=+i):t},i.stream=function(e){
var o=i.rotate(),c=a(e),h=(i.rotate([0,0]),a(e));return i.rotate(o),c.sphere=function(){h.polygonStart(),h.lineStart();for(var e=0,i=360/t,a=2*fe/t,o=90-180/t,c=ve;t>e;++e,o-=i,c-=a)h.point(Math.atan2(l*Math.cos(c),s)*xe,r(l*Math.sin(c))*xe),-90>o?(h.point(-90,-180-o-n),h.point(-90,-180-o+n)):(h.point(90,o+n),h.point(90,o-n));h.lineEnd(),h.polygonEnd()},c},i}function w(t){return function(e){var i,a=t*Math.sin(e),n=30;do e-=i=(e+Math.sin(e)-a)/(1+Math.cos(e));while(Math.abs(i)>ge&&--n>0);return e/2}}function S(t,e,i){function a(i,a){return[t*i*Math.cos(a=n(a)),e*Math.sin(a)]}var n=w(i);return a.invert=function(a,n){var s=r(n/e);return[a/(t*Math.cos(s)),r((2*s+Math.sin(2*s))/i)]},a}function k(t,e){var i=2.00276,a=Se(e);return[i*t/(1/Math.cos(e)+1.11072/Math.cos(a)),(e+Math.SQRT2*Math.sin(a))/i]}function E(t){var e=0,i=ze(t),a=i(e);return a.parallel=function(t){return arguments.length?i(e=t*fe/180):e/fe*180},a}function T(t,e){return[t*Math.cos(e),e]}function O(t){function e(e,a){var n=i+t-a,s=n?e*Math.cos(a)/n:n;return[n*Math.sin(s),i-n*Math.cos(s)]}if(!t)return T;var i=1/Math.tan(t);return e.invert=function(e,a){var n=Math.sqrt(e*e+(a=i-a)*a),s=i+t-n;return[n/Math.cos(s)*Math.atan2(e,a),s]},e}function C(t){function e(e,i){for(var a=Math.sin(i),n=Math.cos(i),s=new Array(3),c=0;3>c;++c){var h=t[c];if(s[c]=A(i-h[1],h[3],h[2],n,a,e-h[0]),!s[c][0])return h.point;s[c][1]=P(s[c][1]-h.v[1])}for(var d=o.slice(),c=0;3>c;++c){var u=2==c?0:c+1,m=D(t[c].v[0],s[c][0],s[u][0]);s[c][1]<0&&(m=-m),c?1==c?(m=l-m,d[0]-=s[c][0]*Math.cos(m),d[1]-=s[c][0]*Math.sin(m)):(m=r-m,d[0]+=s[c][0]*Math.cos(m),d[1]+=s[c][0]*Math.sin(m)):(d[0]+=s[c][0]*Math.cos(m),d[1]-=s[c][0]*Math.sin(m))}return d[0]/=3,d[1]/=3,d}t=t.map(function(t){return[t[0],t[1],Math.sin(t[1]),Math.cos(t[1])]});for(var i,a=t[2],n=0;3>n;++n,a=i)i=t[n],a.v=A(i[1]-a[1],a[3],a[2],i[3],i[2],i[0]-a[0]),a.point=[0,0];var s=D(t[0].v[0],t[2].v[0],t[1].v[0]),l=D(t[0].v[0],t[1].v[0],t[2].v[0]),r=fe-s;t[2].point[1]=0,t[0].point[0]=-(t[1].point[0]=.5*t[0].v[0]);var o=[t[2].point[0]=t[0].point[0]+t[2].v[0]*Math.cos(s),2*(t[0].point[1]=t[1].point[1]=t[2].v[0]*Math.sin(s))];return e}function L(){var t=[[0,0],[0,0],[0,0]],e=ze(C),i=e(t),a=i.rotate;return delete i.rotate,i.points=function(n){if(!arguments.length)return t;t=n;var s=d3.geo.centroid({type:"MultiPoint",coordinates:t}),l=[-s[0],-s[1]];return a.call(i,l),e(t.map(d3.geo.rotation(l)).map(I))},i.points([[-150,55],[-35,55],[-92.5,10]])}function A(t,e,i,a,n,s){var l,c=Math.cos(s);if(Math.abs(t)>1||Math.abs(s)>1)l=o(i*n+e*a*c);else{var h=Math.sin(.5*t),d=Math.sin(.5*s);l=2*r(Math.sqrt(h*h+e*a*d*d))}return Math.abs(l)>ge?[l,Math.atan2(a*Math.sin(s),e*n-i*a*c)]:[0,0]}function D(t,e,i){return o(.5*(t*t+e*e-i*i)/(t*e))}function P(t){return t-2*fe*Math.floor((t+fe)/(2*fe))}function I(t){return[t[0]*ye,t[1]*ye]}function B(t,e){var i=c(1-Math.sin(e));return[2/be*t*i,be*(1-i)]}function R(t){function e(t,e){return[t,(t?t/Math.sin(t):1)*(Math.sin(e)*Math.cos(t)-i*Math.cos(e))]}var i=Math.tan(t);return e.invert=i?function(t,e){t&&(e*=Math.sin(t)/t);var a=Math.cos(t);return[t,2*Math.atan2(Math.sqrt(a*a+i*i-e*e)-a,i-e)]}:function(t,e){return[t,r(t?e*Math.tan(t)/t:e)]},e}function F(t,e){var i=Math.sqrt(3);return[i*t*(2*Math.cos(2*e/3)-1)/be,i*be*Math.sin(e/3)]}function N(t){function e(t,e){return[t*i,Math.sin(e)/i]}var i=Math.cos(t);return e.invert=function(t,e){return[t/i,r(e*i)]},e}function q(t){function e(t,e){return[t*i,(1+i)*Math.tan(.5*e)]}var i=Math.cos(t);return e.invert=function(t,e){return[t/i,2*Math.atan(e/(1+i))]},e}function H(t,e){var i=Math.sqrt(8/(3*fe));return[i*t*(1-Math.abs(e)/fe),i*e]}function Y(t,e){var i=Math.sqrt(4-3*Math.sin(Math.abs(e)));return[2/Math.sqrt(6*fe)*t*i,l(e)*Math.sqrt(2*fe/3)*(2-i)]}function j(t,e){var i=Math.sqrt(fe*(4+fe));return[2/i*t*(1+Math.sqrt(1-4*e*e/(fe*fe))),4/i*e]}function V(t,e){var i=(2+ve)*Math.sin(e);e/=2;for(var a=0,n=1/0;10>a&&Math.abs(n)>ge;a++){var s=Math.cos(e);e-=n=(e+Math.sin(e)*(s+2)-i)/(2*s*(1+s))}return[2/Math.sqrt(fe*(4+fe))*t*(1+Math.cos(e)),2*Math.sqrt(fe/(4+fe))*Math.sin(e)]}function X(t,e){return[t*(1+Math.cos(e))/Math.sqrt(2+fe),2*e/Math.sqrt(2+fe)]}function K(t,e){for(var i=(1+ve)*Math.sin(e),a=0,n=1/0;10>a&&Math.abs(n)>ge;a++)e-=n=(e+Math.sin(e)-i)/(1+Math.cos(e));return i=Math.sqrt(2+fe),[t*(1+Math.cos(e))/i,2*e/i]}function W(t,e){var i=Math.sin(t/=2),a=Math.cos(t),n=Math.sqrt(Math.cos(e)),s=Math.cos(e/=2),l=Math.sin(e)/(s+Math.SQRT2*a*n),r=Math.sqrt(2/(1+l*l)),o=Math.sqrt((Math.SQRT2*s+(a+i)*n)/(Math.SQRT2*s+(a-i)*n));return[Te*(r*(o-1/o)-2*Math.log(o)),Te*(r*l*(o+1/o)-2*Math.atan(l))]}function U(t,e){var i=Math.tan(e/2);return[t*Oe*c(1-i*i),(1+Oe)*i]}function G(t,e){var i=e/2,a=Math.cos(i);return[2*t/be*Math.cos(e)*a*a,be*Math.tan(i)]}function Q(t,e){function i(e,i){var s=Ce(e,i),l=s[0],r=s[1],o=l*l+r*r;if(o>n){var c=Math.sqrt(o),h=Math.atan2(r,l),d=a*Math.round(h/a),u=h-d,m=t*Math.cos(u),g=(t*Math.sin(u)-u*Math.sin(m))/(ve-m),p=Z(u,g),f=(fe-t)/$(p,m,fe);l=c;var v,b=50;do l-=v=(t+$(p,m,l)*f-c)/(p(l)*f);while(Math.abs(v)>ge&&--b>0);r=u*Math.sin(l),ve>l&&(r-=g*(l-ve));var y=Math.sin(d),x=Math.cos(d);s[0]=l*x-r*y,s[1]=l*y+r*x}return s}var a=2*fe/e,n=t*t;return i.invert=function(e,i){var s=e*e+i*i;if(s>n){var l=Math.sqrt(s),r=Math.atan2(i,e),o=a*Math.round(r/a),c=r-o,e=l*Math.cos(c);i=l*Math.sin(c);for(var h=e-ve,d=Math.sin(e),u=i/d,m=ve>e?1/0:0,g=10;;){var p=t*Math.sin(u),f=t*Math.cos(u),v=Math.sin(f),b=ve-f,y=(p-u*v)/b,x=Z(u,y);if(Math.abs(m)<pe||!--g)break;u-=m=(u*d-y*h-i)/(d-2*h*(b*(f+u*p*Math.cos(f)-v)-p*(p-u*v))/(b*b))}l=t+$(x,f,e)*(fe-t)/$(x,f,fe),r=o+u,e=l*Math.cos(r),i=l*Math.sin(r)}return Ce.invert(e,i)},i}function Z(t,e){return function(i){var a=t*Math.cos(i);return ve>i&&(a-=e),Math.sqrt(1+a*a)}}function J(){var t=6,e=30*ye,i=Math.cos(e),a=Math.sin(e),n=ze(Q),s=n(e,t),l=s.stream,r=.01,o=-Math.cos(r*ye),c=Math.sin(r*ye);return s.radius=function(s){return arguments.length?(i=Math.cos(e=s*ye),a=Math.sin(e),n(e,t)):e*xe},s.lobes=function(i){return arguments.length?n(e,t=+i):t},s.stream=function(e){var n=s.rotate(),r=l(e),h=(s.rotate([0,0]),l(e));return s.rotate(n),r.sphere=function(){h.polygonStart(),h.lineStart();for(var e=0,n=2*fe/t,s=0;t>e;++e,s-=n)h.point(Math.atan2(c*Math.cos(s),o)*xe,Math.asin(c*Math.sin(s))*xe),h.point(Math.atan2(a*Math.cos(s-n/2),i)*xe,Math.asin(a*Math.sin(s-n/2))*xe);h.lineEnd(),h.polygonEnd()},r},s}function $(t,e,i){for(var a=50,n=(i-e)/a,s=t(e)+t(i),l=1,r=e;a>l;++l)s+=2*t(r+=n);return.5*s*n}function tt(t,e,i,a,n,s,l,r){function o(o,c){if(!c)return[t*o/fe,0];var h=c*c,d=t+h*(e+h*(i+h*a)),u=c*(n-1+h*(s-r+h*l)),m=(d*d+u*u)/(2*u),g=o*Math.asin(d/m)/fe;return[m*Math.sin(g),c*(1+h*r)+m*(1-Math.cos(g))]}return arguments.length<8&&(r=0),o.invert=function(o,h){var d,u,m=fe*o/t,g=h,p=50;do{var f=g*g,v=t+f*(e+f*(i+f*a)),b=g*(n-1+f*(s-r+f*l)),y=v*v+b*b,x=2*b,_=y/x,z=_*_,M=Math.asin(v/_)/fe,w=m*M;if(xB2=v*v,dxBdφ=(2*e+f*(4*i+6*f*a))*g,dyBdφ=n+f*(3*s+5*f*l),dpdφ=2*(v*dxBdφ+b*(dyBdφ-1)),dqdφ=2*(dyBdφ-1),dmdφ=(dpdφ*x-y*dqdφ)/(x*x),cosα=Math.cos(w),sinα=Math.sin(w),mcosα=_*cosα,msinα=_*sinα,dαdφ=m/fe*(1/c(1-xB2/z))*(dxBdφ*_-v*dmdφ)/z,fx=msinα-o,fy=g*(1+f*r)+_-mcosα-h,δxδφ=dmdφ*sinα+mcosα*dαdφ,δxδλ=mcosα*M,δyδφ=1+dmdφ-(dmdφ*cosα-msinα*dαdφ),δyδλ=msinα*M,denominator=δxδφ*δyδλ-δyδφ*δxδλ,!denominator)break;m-=d=(fy*δxδφ-fx*δyδφ)/denominator,g-=u=(fx*δyδλ-fy*δxδλ)/denominator}while((Math.abs(d)>ge||Math.abs(u)>ge)&&--p>0);return[m,g]},o}function et(t,e){var i=t*t,a=e*e;return[t*(1-.162388*a)*(.87-952426e-9*i*i),e*(1+a/12)]}function it(t){function e(){var t=!1,e=ze(i),a=e(t);return a.quincuncial=function(i){return arguments.length?e(t=!!i):t},a}function i(e){var i=e?function(e,i){var n=Math.abs(e)<ve,s=t(n?e:e>0?e-fe:e+fe,i),r=(s[0]-s[1])*Math.SQRT1_2,o=(s[0]+s[1])*Math.SQRT1_2;if(n)return[r,o];var c=a*Math.SQRT1_2,h=r>0^o>0?-1:1;return[h*r-l(o)*c,h*o-l(r)*c]}:function(e,i){var n=e>0?-.5:.5,s=t(e+n*fe,i);return s[0]-=n*a,s};return t.invert&&(i.invert=e?function(e,i){var n=(e+i)*Math.SQRT1_2,s=(i-e)*Math.SQRT1_2,l=Math.abs(n)<.5*a&&Math.abs(s)<.5*a;if(!l){var r=a*Math.SQRT1_2,o=n>0^s>0?-1:1,c=-o*(e+(s>0?1:-1)*r),h=-o*(i+(n>0?1:-1)*r);n=(-c-h)*Math.SQRT1_2,s=(c-h)*Math.SQRT1_2}var d=t.invert(n,s);return l||(d[0]+=n>0?fe:-fe),d}:function(e,i){var n=e>0?-.5:.5,s=t.invert(e+n*a,i),l=s[0]-n*fe;return-fe>l?l+=2*fe:l>fe&&(l-=2*fe),s[0]=l,s}),i}var a=t(ve,0)[0]-t(-ve,0)[0];return e.raw=i,e}function at(t,e){var i=l(t),a=l(e),n=Math.cos(e),s=Math.cos(t)*n,o=Math.sin(t)*n,c=Math.sin(a*e);t=Math.abs(Math.atan2(o,c)),e=r(s),Math.abs(t-ve)>ge&&(t%=ve);var h=nt(t>fe/4?ve-t:t,e);return t>fe/4&&(c=h[0],h[0]=-h[1],h[1]=-c),h[0]*=i,h[1]*=-a,h}function nt(t,e){if(e===ve)return[0,0];var i=Math.sin(e),a=i*i,n=a*a,s=1+n,l=1+3*n,o=1-n,h=r(1/Math.sqrt(s)),d=o+a*s*h,u=(1-i)/d,m=Math.sqrt(u),g=u*s,p=Math.sqrt(g),f=m*o;if(0===t)return[0,-(f+a*p)];var v=Math.cos(e),b=1/v,y=2*i*v,x=(-3*a+h*l)*y,_=(-d*v-(1-i)*x)/(d*d),z=.5*_/m,M=o*z-2*a*m*y,w=a*s*_+u*l*y,S=-b*y,k=-b*w,E=-2*b*M,T=4*t/fe;if(t>.222*fe||fe/4>e&&t>.175*fe){var O=(f+a*c(g*(1+n)-f*f))/(1+n);if(t>fe/4)return[O,O];var C=O,L=.5*O,A=50;O=.5*(L+C);do{var D=Math.sqrt(g-O*O),P=O*(E+S*D)+k*r(O/p)-T;if(!P)break;0>P?L=O:C=O,O=.5*(L+C)}while(Math.abs(C-L)>ge&&--A>0)}else{var I,O=ge,A=25;do{var B=O*O,D=c(g-B),R=E+S*D,P=O*R+k*r(O/p)-T,F=R+(k-S*B)/D;O-=I=D?P/F:0}while(Math.abs(I)>ge&&--A>0)}return[O,-f-a*c(g-O*O)]}function st(t,e){for(var i=0,a=1,n=.5,s=50;;){var l=n*n,r=Math.sqrt(n),o=Math.asin(1/Math.sqrt(1+l)),c=1-l+n*(1+l)*o,h=(1-r)/c,d=Math.sqrt(h),u=h*(1+l),m=d*(1-l),g=u-t*t,p=Math.sqrt(g),f=e+m+n*p;if(Math.abs(a-i)<pe||0===--s||0===f)break;f>0?i=n:a=n,n=.5*(i+a)}if(!s)return null;var v=Math.asin(r),b=Math.cos(v),y=1/b,x=2*r*b,_=(-3*n+o*(1+3*l))*x,z=(-c*b-(1-r)*_)/(c*c),M=.5*z/d,w=(1-l)*M-2*n*d*x,S=-2*y*w,k=-y*x,E=-y*(n*(1+l)*z+h*(1+3*l)*x);return[fe/4*(t*(S+k*p)+E*Math.asin(t/Math.sqrt(u))),v]}function lt(t,e,i){if(!t){var a=rt(e,1-i);return[[0,a[0]/a[1]],[1/a[1],0],[a[2]/a[1],0]]}var n=rt(t,i);if(!e)return[[n[0],0],[n[1],0],[n[2],0]];var a=rt(e,1-i),s=a[1]*a[1]+i*n[0]*n[0]*a[0]*a[0];return[[n[0]*a[2]/s,n[1]*n[2]*a[0]*a[1]/s],[n[1]*a[1]/s,-n[0]*n[2]*a[0]*a[2]/s],[n[2]*a[1]*a[2]/s,-i*n[0]*n[1]*a[0]/s]]}function rt(t,e){var i,a,n,s,l;if(ge>e)return s=Math.sin(t),a=Math.cos(t),i=.25*e*(t-s*a),[s-i*a,a+i*s,1-.5*e*s*s,t-i];if(e>=1-ge)return i=.25*(1-e),a=v(t),s=p(t),n=1/a,l=a*f(t),[s+i*(l-t)/(a*a),n-i*s*n*(l-t),n+i*s*n*(l+t),2*Math.atan(Math.exp(t))-ve+i*(l-t)/a];var o=[1,0,0,0,0,0,0,0,0],h=[Math.sqrt(e),0,0,0,0,0,0,0,0],d=0;for(a=Math.sqrt(1-e),l=1;Math.abs(h[d]/o[d])>ge&&8>d;)i=o[d++],h[d]=.5*(i-a),o[d]=.5*(i+a),a=c(i*a),l*=2;n=l*o[d]*t;do s=h[d]*Math.sin(a=n)/o[d],n=.5*(r(s)+n);while(--d);return[Math.sin(n),s=Math.cos(n),s/Math.cos(n-a),n]}function ot(t,e,i){var a=Math.abs(t),n=Math.abs(e),s=f(n);if(a){var r=1/Math.sin(a),o=1/(Math.tan(a)*Math.tan(a)),h=-(o+i*s*s*r*r-1+i),d=(i-1)*o,u=.5*(-h+Math.sqrt(h*h-4*d));return[ct(Math.atan(1/Math.sqrt(u)),i)*l(t),ct(Math.atan(c((u/o-1)/i)),1-i)*l(e)]}return[0,ct(Math.atan(s),1-i)*l(e)]}function ct(t,e){if(!e)return t;if(1===e)return Math.log(Math.tan(t/2+fe/4));for(var i=1,a=Math.sqrt(1-e),n=Math.sqrt(e),s=0;Math.abs(n)>ge;s++){if(t%fe){var l=Math.atan(a*Math.tan(t)/i);0>l&&(l+=fe),t+=l+~~(t/fe)*fe}else t+=t;n=(i+a)/2,a=Math.sqrt(i*a),n=((i=n)-a)/2}return t/(Math.pow(2,s)*i)}function ht(t,e){var i=(Math.SQRT2-1)/(Math.SQRT2+1),a=Math.sqrt(1-i*i),n=ct(ve,a*a),s=-1,l=Math.log(Math.tan(fe/4+Math.abs(e)/2)),r=Math.exp(s*l)/Math.sqrt(i),o=dt(r*Math.cos(s*t),r*Math.sin(s*t)),c=ot(o[0],o[1],a*a);return[-c[1],(e>=0?1:-1)*(.5*n-c[0])]}function dt(t,e){var i=t*t,a=e+1,n=1-i-e*e;return[.5*((t>=0?ve:-ve)-Math.atan2(n,2*t)),-.25*Math.log(n*n+4*i)+.5*Math.log(a*a+i)]}function ut(t,e){var i=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/i,(t[1]*e[0]-t[0]*e[1])/i]}function mt(t){function e(t,e){var s=n(t,e);t=s[0],e=s[1];var l=Math.sin(e),r=Math.cos(e),c=Math.cos(t),h=o(i*l+a*r*c),d=Math.sin(h),u=Math.abs(d)>ge?h/d:1;return[u*a*Math.sin(t),(Math.abs(t)>ve?u:-u)*(i*r-a*l*c)]}var i=Math.sin(t),a=Math.cos(t),n=gt(t);return n.invert=gt(-t),e.invert=function(t,e){var a=Math.sqrt(t*t+e*e),s=-Math.sin(a),l=Math.cos(a),r=a*l,o=-e*s,h=a*i,d=c(r*r+o*o-h*h),u=Math.atan2(r*h+o*d,o*h-r*d),m=(a>ve?-1:1)*Math.atan2(t*s,a*Math.cos(u)*l+e*Math.sin(u)*s);return n.invert(m,u)},e}function gt(t){var e=Math.sin(t),i=Math.cos(t);return function(t,a){var n=Math.cos(a),s=Math.cos(t)*n,l=Math.sin(t)*n,o=Math.sin(a);return[Math.atan2(l,s*i-o*e),r(o*i+s*e)]}}function pt(){var t=0,e=ze(mt),i=e(t),a=i.rotate,n=i.stream,s=d3.geo.circle();return i.parallel=function(a){if(!arguments.length)return t/fe*180;var n=i.rotate();return e(t=a*fe/180).rotate(n)},i.rotate=function(e){return arguments.length?(a.call(i,[e[0],e[1]-t/fe*180]),s.origin([-e[0],-e[1]]),i):(e=a.call(i),e[1]+=t/fe*180,e)},i.stream=function(t){return t=n(t),t.sphere=function(){t.polygonStart();var e,i=.01,a=s.angle(90-i)().coordinates[0],n=a.length-1,l=-1;for(t.lineStart();++l<n;)t.point((e=a[l])[0],e[1]);for(t.lineEnd(),a=s.angle(90+i)().coordinates[0],n=a.length-1,t.lineStart();--l>=0;)t.point((e=a[l])[0],e[1]);t.lineEnd(),t.polygonEnd()},t},i}function ft(t,e){function i(i,a){var n=Ie(i/e,a);return n[0]*=t,n}return arguments.length<2&&(e=t),1===e?Ie:e===1/0?bt:(i.invert=function(i,a){var n=Ie.invert(i/t,a);return n[0]*=e,n},i)}function vt(){var t=2,e=ze(ft),i=e(t);return i.coefficient=function(i){return arguments.length?e(t=+i):t},i}function bt(t,e){return[t*Math.cos(e)/Math.cos(e/=2),2*Math.sin(e)]}function yt(t,e){for(var i,a=Math.sin(e)*(0>e?2.43763:2.67595),n=0;20>n&&(e-=i=(e+Math.sin(e)-a)/(1+Math.cos(e)),!(Math.abs(i)<ge));n++);return[.85*t*Math.cos(e*=.5),Math.sin(e)*(0>e?1.93052:1.75859)]}function xt(t){function e(e,h){var d,u=Math.abs(h);if(u>a){var m=Math.min(t-1,Math.max(0,Math.floor((e+fe)/c)));e+=fe*(t-1)/t-m*c,d=d3.geo.collignon.raw(e,u),d[0]=d[0]*n/s-n*(t-1)/(2*t)+m*n/t,d[1]=l+4*(d[1]-r)*o/n,0>h&&(d[1]=-d[1])}else d=i(e,h);return d[0]/=2,d}var i=d3.geo.cylindricalEqualArea.raw(0),a=Be*fe/180,n=2*fe,s=d3.geo.collignon.raw(fe,a)[0]-d3.geo.collignon.raw(-fe,a)[0],l=i(0,a)[1],r=d3.geo.collignon.raw(0,a)[1],o=d3.geo.collignon.raw(0,ve)[1]-r,c=2*fe/t;return e.invert=function(e,a){e*=2;var h=Math.abs(a);if(h>l){var d=Math.min(t-1,Math.max(0,Math.floor((e+fe)/c)));e=(e+fe*(t-1)/t-d*c)*s/n;var u=d3.geo.collignon.raw.invert(e,.25*(h-l)*n/o+r);return u[0]-=fe*(t-1)/t-d*c,0>a&&(u[1]=-u[1]),u}return i.invert(e,a)},e}function _t(){function t(){var t=180/e;return{type:"Polygon",coordinates:[d3.range(-180,180+t/2,t).map(function(t,e){return[t,1&e?90-1e-6:Be]}).concat(d3.range(180,-180-t/2,-t).map(function(t,e){return[t,1&e?-90+1e-6:-Be]}))]}}var e=2,i=ze(xt),a=i(e),n=a.stream;return a.lobes=function(t){return arguments.length?i(e=+t):e},a.stream=function(e){var i=a.rotate(),s=n(e),l=(a.rotate([0,0]),n(e));return a.rotate(i),s.sphere=function(){d3.geo.stream(t(),l)},s},a}function zt(t){function e(e,n){var r,o,u=1-Math.sin(n);if(u&&2>u){var m,g=ve-n,p=25;do{var f=Math.sin(g),v=Math.cos(g),b=s+Math.atan2(f,a-v),y=1+d-2*a*v;g-=m=(g-h*s-a*f+y*b-.5*u*i)/(2*a*f*b)}while(Math.abs(m)>pe&&--p>0);r=l*Math.sqrt(y),o=e*b/fe}else r=l*(t+u),o=e*s/fe;return[r*Math.sin(o),c-r*Math.cos(o)]}var i,a=1+t,n=Math.sin(1/a),s=r(n),l=2*Math.sqrt(fe/(i=fe+4*s*a)),c=.5*l*(a+Math.sqrt(t*(2+t))),h=t*t,d=a*a;return e.invert=function(t,e){var n=t*t+(e-=c)*e,u=(1+d-n/(l*l))/(2*a),m=o(u),g=Math.sin(m),p=s+Math.atan2(g,a-u);return[r(t/Math.sqrt(n))*fe/p,r(1-2*(m-h*s-a*g+(1+d-2*a*u)*p)/i)]},e}function Mt(){var t=1,e=ze(zt),i=e(t);return i.ratio=function(i){return arguments.length?e(t=+i):t},i}function wt(t,e){return e>-Re?(t=ke(t,e),t[1]+=Fe,t):T(t,e)}function St(t,e){return Math.abs(e)>Re?(t=ke(t,e),t[1]-=e>0?Fe:-Fe,t):T(t,e)}function kt(t,e){return[3*t/(2*fe)*Math.sqrt(fe*fe/3-e*e),e]}function Et(t){function e(e,i){if(Math.abs(Math.abs(i)-ve)<ge)return[0,0>i?-2:2];var a=Math.sin(i),n=Math.pow((1+a)/(1-a),t/2),s=.5*(n+1/n)+Math.cos(e*=t);return[2*Math.sin(e)/s,(n-1/n)/s]}return e.invert=function(e,i){var a=Math.abs(i);if(Math.abs(a-2)<ge)return e?null:[0,l(i)*ve];if(a>2)return null;e/=2,i/=2;var n=e*e,s=i*i,o=2*i/(1+n+s);return o=Math.pow((1+o)/(1-o),1/t),[Math.atan2(2*e,1-n-s)/t,r((o-1)/(o+1))]},e}function Tt(){var t=.5,e=ze(Et),i=e(t);return i.spacing=function(i){return arguments.length?e(t=+i):t},i}function Ot(t,e){return[t*(1+Math.sqrt(Math.cos(e)))/2,e/(Math.cos(e/2)*Math.cos(t/6))]}function Ct(t,e){var i=t*t,a=e*e;return[t*(.975534+a*(-.119161+i*-.0143059+a*-.0547009)),e*(1.00384+i*(.0802894+a*-.02855+199025e-9*i)+a*(.0998909+a*-.0491032))]}function Lt(t,e){return[Math.sin(t)/Math.cos(e),Math.tan(e)*Math.cos(t)]}function At(t){function e(e,n){var s=n-t,l=Math.abs(s)<ge?e*i:Math.abs(l=fe/4+n/2)<ge||Math.abs(Math.abs(l)-ve)<ge?0:e*s/Math.log(Math.tan(l)/a);return[l,s]}var i=Math.cos(t),a=Math.tan(fe/4+t/2);return e.invert=function(e,n){var s,l=n+t;return[Math.abs(n)<ge?e/i:Math.abs(s=fe/4+l/2)<ge||Math.abs(Math.abs(s)-ve)<ge?0:e*Math.log(Math.tan(s)/a)/n,l]},e}function Dt(t,e){return[t,1.25*Math.log(Math.tan(fe/4+.4*e))]}function Pt(t){function e(e,a){for(var n,s=Math.cos(a),l=2/(1+s*Math.cos(e)),r=l*s*Math.sin(e),o=l*Math.sin(a),c=i,h=t[c],d=h[0],u=h[1];--c>=0;)h=t[c],d=h[0]+r*(n=d)-o*u,u=h[1]+r*u+o*n;return d=r*(n=d)-o*u,u=r*u+o*n,[d,u]}var i=t.length-1;return e.invert=function(e,a){var n=20,s=e,l=a;do{for(var o,c=i,h=t[c],d=h[0],u=h[1],m=0,g=0;--c>=0;)h=t[c],m=d+s*(o=m)-l*g,g=u+s*g+l*o,d=h[0]+s*(o=d)-l*u,u=h[1]+s*u+l*o;m=d+s*(o=m)-l*g,g=u+s*g+l*o,d=s*(o=d)-l*u-e,u=s*u+l*o-a;var p,f,v=m*m+g*g;s-=p=(d*m+u*g)/v,l-=f=(u*m-d*g)/v}while(Math.abs(p)+Math.abs(f)>ge*ge&&--n>0);if(n){var b=Math.sqrt(s*s+l*l),y=2*Math.atan(.5*b),x=Math.sin(y);return[Math.atan2(s*x,b*Math.cos(y)),b?r(l*x/b):0]}},e}function It(){var t=Ne.miller,e=ze(Pt),i=e(t);return i.coefficients=function(i){return arguments.length?e(t="string"==typeof i?Ne[i]:i):t},i}function Bt(t,e){var i=Math.sqrt(6),a=Math.sqrt(7),n=Math.asin(7*Math.sin(e)/(3*i));return[i*t*(2*Math.cos(2*n/3)-1)/a,9*Math.sin(n/3)/a]}function Rt(t,e){for(var i,a=(1+Math.SQRT1_2)*Math.sin(e),n=e,s=0;25>s&&(n-=i=(Math.sin(n/2)+Math.sin(n)-a)/(.5*Math.cos(n/2)+Math.cos(n)),!(Math.abs(i)<ge));s++);return[t*(1+2*Math.cos(n)/Math.cos(n/2))/(3*Math.SQRT2),2*Math.sqrt(3)*Math.sin(n/2)/Math.sqrt(2+Math.SQRT2)]}function Ft(t,e){for(var i,a=Math.sqrt(6/(4+fe)),n=(1+fe/4)*Math.sin(e),s=e/2,l=0;25>l&&(s-=i=(s/2+Math.sin(s)-n)/(.5+Math.cos(s)),!(Math.abs(i)<ge));l++);return[a*(.5+Math.cos(s))*t/1.5,a*s]}function Nt(t,e){var i=e*e,a=i*i;return[t*(.8707-.131979*i+a*(-.013791+a*(.003971*i-.001529*a))),e*(1.007226+i*(.015085+a*(-.044475+.028874*i-.005916*a)))]}function qt(t,e){return[t*(1+Math.cos(e))/2,2*(e-Math.tan(e/2))]}function Ht(t,e){var i=e*e;return[t,e*(qe+i*i*(He+i*(Ye+je*i)))]}function Yt(t,e){if(Math.abs(e)<ge)return[t,0];var i=Math.tan(e),a=t*Math.sin(e);return[Math.sin(a)/i,e+(1-Math.cos(a))/i]}function jt(t){function e(e,a){var n=i?Math.tan(e*i/2)/i:e/2;if(!a)return[2*n,-t];var s=2*Math.atan(n*Math.sin(a)),l=1/Math.tan(a);return[Math.sin(s)*l,a+(1-Math.cos(s))*l-t]}var i=Math.sin(t);return e.invert=function(e,a){if(Math.abs(a+=t)<ge)return[i?2*Math.atan(i*e/2)/i:e,0];var n,s=e*e+a*a,l=0,c=10;do{var h=Math.tan(l),d=1/Math.cos(l),u=s-2*a*l+l*l;l-=n=(h*u+2*(l-a))/(2+u*d*d+2*(l-a)*h)}while(Math.abs(n)>ge&&--c>0);var m=e*(h=Math.tan(l)),g=Math.tan(Math.abs(a)<Math.abs(l+1/h)?.5*r(m):.5*o(m)+fe/4)/Math.sin(l);return[i?2*Math.atan(i*g)/i:2*g,l]},e}function Vt(t,e){var i,a=Math.min(18,36*Math.abs(e)/fe),n=Math.floor(a),s=a-n,l=(i=Qe[n])[0],r=i[1],o=(i=Qe[++n])[0],c=i[1],h=(i=Qe[Math.min(19,++n)])[0],d=i[1];return[t*(o+s*(h-l)/2+s*s*(h-2*o+l)/2),(e>0?ve:-ve)*(c+s*(d-r)/2+s*s*(d-2*c+r)/2)]}function Xt(t){function e(e,i){var a=Math.cos(i),n=(t-1)/(t-a*Math.cos(e));return[n*a*Math.sin(e),n*Math.sin(i)]}return e.invert=function(e,i){var a=e*e+i*i,n=Math.sqrt(a),s=(t-Math.sqrt(1-a*(t+1)/(t-1)))/((t-1)/n+n/(t-1));return[Math.atan2(e*s,n*Math.sqrt(1-s*s)),n?r(i*s/n):0]},e}function Kt(t,e){function i(e,i){var l=a(e,i),r=l[1],o=r*s/(t-1)+n;return[l[0]*n/o,r/o]}var a=Xt(t);if(!e)return a;var n=Math.cos(e),s=Math.sin(e);return i.invert=function(e,i){var l=(t-1)/(t-1-i*s);return a.invert(l*e,l*i*n)},i}function Wt(){var t=1.4,e=0,i=ze(Kt),a=i(t,e);return a.distance=function(a){return arguments.length?i(t=+a,e):t},a.tilt=function(a){return arguments.length?i(t,e=a*fe/180):180*e/fe},a}function Ut(t,e){var i=Math.tan(e/2),a=Math.sin(fe/4*i);return[t*(.74482-.34588*a*a),1.70711*i]}function Gt(t){function e(e,s){var l=o(Math.cos(s)*Math.cos(e-i)),r=o(Math.cos(s)*Math.cos(e-a)),h=0>s?-1:1;return l*=l,r*=r,[(l-r)/(2*t),h*c(4*n*r-(n-l+r)*(n-l+r))/(2*t)]}if(!t)return d3.geo.azimuthalEquidistant.raw;var i=-t/2,a=-i,n=t*t,s=Math.tan(a),l=.5/Math.sin(a);return e.invert=function(t,e){var n,r,c=e*e,h=Math.cos(Math.sqrt(c+(n=t+i)*n)),d=Math.cos(Math.sqrt(c+(n=t+a)*n));return[Math.atan2(r=h-d,n=(h+d)*s),(0>e?-1:1)*o(Math.sqrt(n*n+r*r)*l)]},e}function Qt(){var t=[[0,0],[0,0]],e=ze(Gt),i=e(0),a=i.rotate;return delete i.rotate,i.points=function(i){if(!arguments.length)return t;t=i;var n=d3.geo.interpolate(i[0],i[1]),s=n(.5),l=d3.geo.rotation([-s[0],-s[1]])(i[0]),o=.5*n.distance,c=-r(Math.sin(l[1]*ye)/Math.sin(o));return l[0]>0&&(c=fe-c),a.call(l,[-s[0],-s[1],-c*xe]),e(2*o)},i}function Zt(t){function e(t,e){var a=d3.geo.gnomonic.raw(t,e);return a[0]*=i,a}var i=Math.cos(t);return e.invert=function(t,e){return d3.geo.gnomonic.raw.invert(t/i,e)},e}function Jt(){var t=[[0,0],[0,0]],e=ze(Zt),i=e(0),a=i.rotate;return delete i.rotate,i.points=function(i){if(!arguments.length)return t;t=i;var n=d3.geo.interpolate(i[0],i[1]),s=n(.5),l=d3.geo.rotation([-s[0],-s[1]])(i[0]),o=.5*n.distance,c=-r(Math.sin(l[1]*ye)/Math.sin(o));return l[0]>0&&(c=fe-c),a.call(l,[-s[0],-s[1],-c*xe]),e(o)},i}function $t(t,e){if(Math.abs(e)<ge)return[t,0];var i=Math.abs(e/ve),a=r(i);if(Math.abs(t)<ge||Math.abs(Math.abs(e)-ve)<ge)return[0,l(e)*fe*Math.tan(a/2)];var n=Math.cos(a),s=Math.abs(fe/t-t/fe)/2,o=s*s,c=n/(i+n-1),h=c*(2/i-1),d=h*h,u=d+o,m=c-d,g=o+c;return[l(t)*fe*(s*m+Math.sqrt(o*m*m-u*(c*c-d)))/u,l(e)*fe*(h*g-s*Math.sqrt((o+1)*u-g*g))/u]}function te(t,e){if(Math.abs(e)<ge)return[t,0];var i=Math.abs(e/ve),a=r(i);if(Math.abs(t)<ge||Math.abs(Math.abs(e)-ve)<ge)return[0,l(e)*fe*Math.tan(a/2)];var n=Math.cos(a),s=Math.abs(fe/t-t/fe)/2,o=s*s,h=n*(Math.sqrt(1+o)-s*n)/(1+o*i*i);return[l(t)*fe*h,l(e)*fe*c(1-h*(2*s+h))]}function ee(t,e){if(Math.abs(e)<ge)return[t,0];var i=e/ve,a=r(i);if(Math.abs(t)<ge||Math.abs(Math.abs(e)-ve)<ge)return[0,fe*Math.tan(a/2)];var n=(fe/t-t/fe)/2,s=i/(1+Math.cos(a));return[fe*(l(t)*c(n*n+1-s*s)-n),fe*s]}function ie(t,e){if(!e)return[t,0];var i=Math.abs(e);if(!t||i===ve)return[0,e];var a=i/ve,n=a*a,s=(8*a-n*(n+2)-5)/(2*n*(a-1)),r=s*s,o=a*s,h=n+r+2*o,d=a+3*s,u=t/ve,m=u+1/u,g=l(Math.abs(t)-ve)*Math.sqrt(m*m-4),p=g*g,f=h*(n+r*p-1)+(1-n)*(n*(d*d+4*r)+12*o*r+4*r*r),v=(g*(h+r-1)+2*c(f))/(4*h+p);return[l(t)*ve*v,l(e)*ve*c(1+g*Math.abs(v)-v*v)]}function ae(t,e){return[t*Math.sqrt(1-3*e*e/(fe*fe)),e]}function ne(t,e){var i=.90631*Math.sin(e),a=Math.sqrt(1-i*i),n=Math.sqrt(2/(1+a*Math.cos(t/=3)));return[2.66723*a*n*Math.sin(t),1.24104*i*n]}function se(t,e){var i=Math.cos(e),a=Math.cos(t)*i,n=1-a,s=Math.cos(t=Math.atan2(Math.sin(t)*i,-Math.sin(e))),l=Math.sin(t);return i=c(1-a*a),[l*i-s*n,-s*i-l*n]}function le(t,e){var i=u(t,e);return[(i[0]+t/ve)/2,(i[1]+e)/2]}d3.geo.project=function(t,i){var a=i.stream;if(!a)throw new Error("not yet supported");return(t&&re.hasOwnProperty(t.type)?re[t.type]:e)(t,a)};var re={Feature:t,FeatureCollection:function(e,i){return{type:"FeatureCollection",features:e.features.map(function(e){return t(e,i)})}}},oe=[],ce=[],he={point:function(t,e){oe.push([t,e])},result:function(){var t=oe.length?oe.length<2?{type:"Point",coordinates:oe[0]}:{type:"MultiPoint",coordinates:oe}:null;return oe=[],t}},de={lineStart:i,point:function(t,e){oe.push([t,e])},lineEnd:function(){oe.length&&(ce.push(oe),oe=[])},result:function(){var t=ce.length?ce.length<2?{type:"LineString",coordinates:ce[0]}:{type:"MultiLineString",coordinates:ce}:null;return ce=[],t}},ue={polygonStart:i,lineStart:i,point:function(t,e){oe.push([t,e])},lineEnd:function(){var t=oe.length;if(t){do oe.push(oe[0].slice());while(++t<4);ce.push(oe),oe=[]}},polygonEnd:i,result:function(){if(!ce.length)return null;var t=[],e=[];return ce.forEach(function(i){a(i)?t.push([i]):e.push(i)}),e.forEach(function(e){var i=e[0];t.some(function(t){return n(t[0],i)?(t.push(e),!0):void 0})||t.push([e])}),ce=[],t.length?t.length>1?{type:"MultiPolygon",coordinates:t}:{type:"Polygon",coordinates:t[0]}:null}},me={Point:he,MultiPoint:he,LineString:de,MultiLineString:de,Polygon:ue,MultiPolygon:ue,Sphere:ue},ge=1e-6,pe=ge*ge,fe=Math.PI,ve=fe/2,be=Math.sqrt(fe),ye=fe/180,xe=180/fe,_e=d3.geo.projection,ze=d3.geo.projectionMutator;d3.geo.interrupt=function(t){function e(e,i){for(var a=0>i?-1:1,n=r[+(0>i)],s=0,l=n.length-1;l>s&&e>n[s][2][0];++s);var o=t(e-n[s][1][0],i);return o[0]+=t(n[s][1][0],a*i>a*n[s][0][1]?n[s][0][1]:i)[0],o}function i(){l=r.map(function(e){return e.map(function(e){var i,a=t(e[0][0],e[0][1])[0],n=t(e[2][0],e[2][1])[0],s=t(e[1][0],e[0][1])[1],l=t(e[1][0],e[1][1])[1];return s>l&&(i=s,s=l,l=i),[[a,s],[n,l]]})})}function a(){for(var t=1e-6,e=[],i=0,a=r[0].length;a>i;++i){var s=r[0][i],l=180*s[0][0]/fe,o=180*s[0][1]/fe,c=180*s[1][1]/fe,h=180*s[2][0]/fe,d=180*s[2][1]/fe;e.push(n([[l+t,o+t],[l+t,c-t],[h-t,c-t],[h-t,d+t]],30))}for(var i=r[1].length-1;i>=0;--i){var s=r[1][i],l=180*s[0][0]/fe,o=180*s[0][1]/fe,c=180*s[1][1]/fe,h=180*s[2][0]/fe,d=180*s[2][1]/fe;e.push(n([[h-t,d-t],[h-t,c+t],[l+t,c+t],[l+t,o-t]],30))}return{type:"Polygon",coordinates:[d3.merge(e)]}}function n(t,e){for(var i,a,n,s=-1,l=t.length,r=t[0],o=[];++s<l;){i=t[s],a=(i[0]-r[0])/e,n=(i[1]-r[1])/e;for(var c=0;e>c;++c)o.push([r[0]+c*a,r[1]+c*n]);r=i}return o.push(i),o}function s(t,e){return Math.abs(t[0]-e[0])<ge&&Math.abs(t[1]-e[1])<ge}var l,r=[[[[-fe,0],[0,ve],[fe,0]]],[[[-fe,0],[0,-ve],[fe,0]]]];t.invert&&(e.invert=function(i,a){for(var n=l[+(0>a)],o=r[+(0>a)],c=0,h=n.length;h>c;++c){var d=n[c];if(d[0][0]<=i&&i<d[1][0]&&d[0][1]<=a&&a<d[1][1]){var u=t.invert(i-t(o[c][1][0],0)[0],a);return u[0]+=o[c][1][0],s(e(u[0],u[1]),[i,a])?u:null}}});var o=d3.geo.projection(e),c=o.stream;return o.stream=function(t){var e=o.rotate(),i=c(t),n=(o.rotate([0,0]),c(t));return o.rotate(e),i.sphere=function(){d3.geo.stream(a(),n)},i},o.lobes=function(t){return arguments.length?(r=t.map(function(t){return t.map(function(t){return[[t[0][0]*fe/180,t[0][1]*fe/180],[t[1][0]*fe/180,t[1][1]*fe/180],[t[2][0]*fe/180,t[2][1]*fe/180]]})}),i(),o):r.map(function(t){return t.map(function(t){return[[180*t[0][0]/fe,180*t[0][1]/fe],[180*t[1][0]/fe,180*t[1][1]/fe],[180*t[2][0]/fe,180*t[2][1]/fe]]})})},o},(d3.geo.airy=d).raw=h,u.invert=function(t,e){if(!(t*t+4*e*e>fe*fe+ge)){var i=t,a=e,n=25;do{var s,l=Math.sin(i),r=Math.sin(i/2),c=Math.cos(i/2),h=Math.sin(a),d=Math.cos(a),u=Math.sin(2*a),m=h*h,g=d*d,p=r*r,f=1-g*c*c,v=f?o(d*c)*Math.sqrt(s=1/f):s=0,b=2*v*d*r-t,y=v*h-e,x=s*(g*p+v*d*c*m),_=s*(.5*l*u-2*v*h*r),z=.25*s*(u*r-v*h*g*l),M=s*(m*c+v*p*d),w=_*z-M*x;if(!w)break;var S=(y*_-b*M)/w,k=(b*z-y*x)/w;i-=S,a-=k}while((Math.abs(S)>ge||Math.abs(k)>ge)&&--n>0);return[i,a]}},(d3.geo.aitoff=function(){return _e(u)}).raw=u,(d3.geo.armadillo=g).raw=m,x.invert=function(t,e){if(t*=3/8,e*=3/8,!t&&Math.abs(e)>1)return null;var i=t*t,a=e*e,n=1+i+a,s=Math.sqrt(.5*(n-Math.sqrt(n*n-4*e*e))),o=r(s)/3,c=s?y(Math.abs(e/s))/3:b(Math.abs(t))/3,h=Math.cos(o),d=v(c),u=d*d-h*h;return[2*l(t)*Math.atan2(f(c)*h,.25-u),2*l(e)*Math.atan2(d*Math.sin(o),.25+u)]},(d3.geo.august=function(){return _e(x)}).raw=x;var Me=Math.log(1+Math.SQRT2);_.invert=function(t,e){if((a=Math.abs(e))<Me)return[t,2*Math.atan(Math.exp(e))-ve];var i,a,n=Math.sqrt(8),s=fe/4,r=25;do{var o=Math.cos(s/2),c=Math.tan(s/2);s-=i=(n*(s-fe/4)-Math.log(c)-a)/(n-.5*o*o/c)}while(Math.abs(i)>pe&&--r>0);return[t/(Math.cos(s)*(n-1/Math.sin(s))),l(e)*s]},(d3.geo.baker=function(){return _e(_)}).raw=_;var we=d3.geo.azimuthalEquidistant.raw;(d3.geo.berghaus=M).raw=z;var Se=w(fe),ke=S(Math.SQRT2/ve,Math.SQRT2,fe);(d3.geo.mollweide=function(){return _e(ke)}).raw=ke,k.invert=function(t,e){var i,a,n=2.00276,s=n*e,l=0>e?-fe/4:fe/4,r=25;do a=s-Math.SQRT2*Math.sin(l),l-=i=(Math.sin(2*l)+2*l-fe*Math.sin(a))/(2*Math.cos(2*l)+2+fe*Math.cos(a)*Math.SQRT2*Math.cos(l));while(Math.abs(i)>ge&&--r>0);return a=s-Math.SQRT2*Math.sin(l),[t*(1/Math.cos(a)+1.11072/Math.cos(l))/n,a]},(d3.geo.boggs=function(){return _e(k)}).raw=k,T.invert=function(t,e){return[t/Math.cos(e),e]},(d3.geo.sinusoidal=function(){return _e(T)}).raw=T,(d3.geo.bonne=function(){return E(O).parallel(45)}).raw=O;var Ee=S(1,4/fe,fe);(d3.geo.bromley=function(){return _e(Ee)}).raw=Ee,(d3.geo.chamberlin=L).raw=C,B.invert=function(t,e){var i=(i=e/be-1)*i;return[i>0?t*Math.sqrt(fe/i)/2:0,r(1-i)]},(d3.geo.collignon=function(){return _e(B)}).raw=B,(d3.geo.craig=function(){return E(R)}).raw=R,F.invert=function(t,e){var i=Math.sqrt(3),a=3*r(e/(i*be));return[be*t/(i*(2*Math.cos(2*a/3)-1)),a]},(d3.geo.craster=function(){return _e(F)}).raw=F,(d3.geo.cylindricalEqualArea=function(){return E(N)}).raw=N,(d3.geo.cylindricalStereographic=function(){return E(q)}).raw=q,H.invert=function(t,e){var i=Math.sqrt(8/(3*fe)),a=e/i;return[t/(i*(1-Math.abs(a)/fe)),a]},(d3.geo.eckert1=function(){return _e(H)}).raw=H,Y.invert=function(t,e){var i=2-Math.abs(e)/Math.sqrt(2*fe/3);return[t*Math.sqrt(6*fe)/(2*i),l(e)*r((4-i*i)/3)]},(d3.geo.eckert2=function(){return _e(Y)}).raw=Y,j.invert=function(t,e){var i=Math.sqrt(fe*(4+fe))/2;return[t*i/(1+c(1-e*e*(4+fe)/(4*fe))),e*i/2]},(d3.geo.eckert3=function(){return _e(j)}).raw=j,V.invert=function(t,e){var i=.5*e*Math.sqrt((4+fe)/fe),a=r(i),n=Math.cos(a);return[t/(2/Math.sqrt(fe*(4+fe))*(1+n)),r((a+i*(n+2))/(2+ve))]},(d3.geo.eckert4=function(){return _e(V)}).raw=V,X.invert=function(t,e){var i=Math.sqrt(2+fe),a=e*i/2;return[i*t/(1+Math.cos(a)),a]},(d3.geo.eckert5=function(){return _e(X)}).raw=X,K.invert=function(t,e){var i=1+ve,a=Math.sqrt(i/2);return[2*t*a/(1+Math.cos(e*=a)),r((e+Math.sin(e))/i)]},(d3.geo.eckert6=function(){return _e(K)}).raw=K,W.invert=function(t,e){var i=d3.geo.august.raw.invert(t/1.2,1.065*e);if(!i)return null;var a=i[0],n=i[1],s=20;t/=Te,e/=Te;do{var l=a/2,r=n/2,o=Math.sin(l),c=Math.cos(l),h=Math.sin(r),d=Math.cos(r),u=Math.cos(n),m=Math.sqrt(u),g=h/(d+Math.SQRT2*c*m),p=g*g,f=Math.sqrt(2/(1+p)),v=Math.SQRT2*d+(c+o)*m,b=Math.SQRT2*d+(c-o)*m,y=v/b,x=Math.sqrt(y),_=x-1/x,z=x+1/x,M=f*_-2*Math.log(x)-t,w=f*g*z-2*Math.atan(g)-e,S=h&&Math.SQRT1_2*m*o*p/h,k=(Math.SQRT2*c*d+m)/(2*(d+Math.SQRT2*c*m)*(d+Math.SQRT2*c*m)*m),E=-.5*g*f*f*f,T=E*S,O=E*k,C=(C=2*d+Math.SQRT2*m*(c-o))*C*x,L=(Math.SQRT2*c*d*m+u)/C,A=-(Math.SQRT2*o*h)/(m*C),D=_*T-2*L/x+f*(L+L/y),P=_*O-2*A/x+f*(A+A/y),I=g*z*T-2*S/(1+p)+f*z*S+f*g*(L-L/y),B=g*z*O-2*k/(1+p)+f*z*k+f*g*(A-A/y),R=P*I-B*D;if(!R)break;var F=(w*P-M*B)/R,N=(M*I-w*D)/R;a-=F,n=Math.max(-ve,Math.min(ve,n-N))}while((Math.abs(F)>ge||Math.abs(N)>ge)&&--s>0);return Math.abs(Math.abs(n)-ve)<ge?[0,n]:s&&[a,n]};var Te=3+2*Math.SQRT2;(d3.geo.eisenlohr=function(){return _e(W)}).raw=W,U.invert=function(t,e){var i=e/(1+Oe);return[t?t/(Oe*c(1-i*i)):0,2*Math.atan(i)]};var Oe=Math.cos(35*ye);(d3.geo.fahey=function(){return _e(U)}).raw=U,G.invert=function(t,e){var i=Math.atan(e/be),a=Math.cos(i),n=2*i;return[t*be*.5/(Math.cos(n)*a*a),n]},(d3.geo.foucaut=function(){return _e(G)}).raw=G,d3.geo.gilbert=function(t){function e(e){return t([.5*e[0],r(Math.tan(.5*e[1]*ye))*xe])}var i=d3.geo.equirectangular().scale(xe).translate([0,0]);return t.invert&&(e.invert=function(e){return e=t.invert(e),e[0]*=2,e[1]=2*Math.atan(Math.sin(e[1]*ye))*xe,e}),e.stream=function(e){e=t.stream(e);var a=i.stream({point:function(t,i){e.point(.5*t,r(Math.tan(.5*-i*ye))*xe)},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}});return a.sphere=function(){e.sphere()},a.valid=!1,
a},e};var Ce=d3.geo.azimuthalEquidistant.raw;(d3.geo.gingery=J).raw=Q;var Le=tt(2.8284,-1.6988,.75432,-.18071,1.76003,-.38914,.042555);(d3.geo.ginzburg4=function(){return _e(Le)}).raw=Le;var Ae=tt(2.583819,-.835827,.170354,-.038094,1.543313,-.411435,.082742);(d3.geo.ginzburg5=function(){return _e(Ae)}).raw=Ae;var De=tt(5/6*fe,-.62636,-.0344,0,1.3493,-.05524,0,.045);(d3.geo.ginzburg6=function(){return _e(De)}).raw=De,et.invert=function(t,e){var i,a=t,n=e,s=50;do{var l=n*n;n-=i=(n*(1+l/12)-e)/(1+l/4)}while(Math.abs(i)>ge&&--s>0);s=50,t/=1-.162388*l;do{var r=(r=a*a)*r;a-=i=(a*(.87-952426e-9*r)-t)/(.87-.00476213*r)}while(Math.abs(i)>ge&&--s>0);return[a,n]},(d3.geo.ginzburg8=function(){return _e(et)}).raw=et;var Pe=tt(2.6516,-.76534,.19123,-.047094,1.36289,-.13965,.031762);(d3.geo.ginzburg9=function(){return _e(Pe)}).raw=Pe,at.invert=function(t,e){var i=l(t),a=l(e),n=-i*t,s=-a*e,o=1>s/n,c=st(o?s:n,o?n:s),h=c[0],d=c[1];o&&(h=-ve-h);var u=Math.cos(d),t=Math.cos(h)*u,e=Math.sin(h)*u,m=Math.sin(d);return[i*(Math.atan2(e,-m)+fe),a*r(t)]},d3.geo.gringorten=it(at),ht.invert=function(t,e){var i=(Math.SQRT2-1)/(Math.SQRT2+1),a=Math.sqrt(1-i*i),n=ct(ve,a*a),s=-1,l=lt(.5*n-e,-t,a*a),r=ut(l[0],l[1]),o=Math.atan2(r[1],r[0])/s;return[o,2*Math.atan(Math.exp(.5/s*Math.log(i*r[0]*r[0]+i*r[1]*r[1])))-ve]},d3.geo.guyou=it(ht),(d3.geo.hammerRetroazimuthal=pt).raw=mt;var Ie=d3.geo.azimuthalEqualArea.raw;bt.invert=function(t,e){var i=2*r(e/2);return[t*Math.cos(i/2)/Math.cos(i),i]},(d3.geo.hammer=vt).raw=ft,yt.invert=function(t,e){var i=Math.abs(i=e*(0>e?.5179951515653813:.5686373742600607))>1-ge?i>0?ve:-ve:r(i);return[1.1764705882352942*t/Math.cos(i),Math.abs(i=((i+=i)+Math.sin(i))*(0>e?.4102345310814193:.3736990601468637))>1-ge?i>0?ve:-ve:r(i)]},(d3.geo.hatano=function(){return _e(yt)}).raw=yt;var Be=41+48/36+37/3600;(d3.geo.healpix=_t).raw=xt,(d3.geo.hill=Mt).raw=zt;var Re=.7109889596207567,Fe=.0528035274542;wt.invert=function(t,e){return e>-Re?ke.invert(t,e-Fe):T.invert(t,e)},(d3.geo.sinuMollweide=function(){return _e(wt).rotate([-20,-55])}).raw=wt,St.invert=function(t,e){return Math.abs(e)>Re?ke.invert(t,e+(e>0?Fe:-Fe)):T.invert(t,e)},(d3.geo.homolosine=function(){return _e(St)}).raw=St,kt.invert=function(t,e){return[2/3*fe*t/Math.sqrt(fe*fe/3-e*e),e]},(d3.geo.kavrayskiy7=function(){return _e(kt)}).raw=kt,(d3.geo.lagrange=Tt).raw=Et,Ot.invert=function(t,e){var i=Math.abs(t),a=Math.abs(e),n=fe/Math.SQRT2,s=ge,l=ve;n>a?l*=a/n:s+=6*o(n/a);for(var r=0;25>r;r++){var h=Math.sin(l),d=c(Math.cos(l)),u=Math.sin(l/2),m=Math.cos(l/2),g=Math.sin(s/6),p=Math.cos(s/6),f=.5*s*(1+d)-i,v=l/(m*p)-a,b=d?-.25*s*h/d:0,y=.5*(1+d),x=(1+.5*l*u/m)/(m*p),_=l/m*(g/6)/(p*p),z=b*_-x*y,M=(f*_-v*y)/z,w=(v*b-f*x)/z;if(l-=M,s-=w,Math.abs(M)<ge&&Math.abs(w)<ge)break}return[0>t?-s:s,0>e?-l:l]},(d3.geo.larrivee=function(){return _e(Ot)}).raw=Ot,Ct.invert=function(t,e){var i=l(t)*fe,a=e/2,n=50;do{var s=i*i,r=a*a,o=i*a,c=i*(.975534+r*(-.119161+s*-.0143059+r*-.0547009))-t,h=a*(1.00384+s*(.0802894+r*-.02855+199025e-9*s)+r*(.0998909+r*-.0491032))-e,d=.975534-r*(.119161+3*s*.0143059+.0547009*r),u=-o*(.238322+.2188036*r+.0286118*s),m=o*(.1605788+7961e-7*s+-0.0571*r),g=1.00384+s*(.0802894+199025e-9*s)+r*(3*(.0998909-.02855*s)-.245516*r),p=u*m-g*d,f=(h*u-c*g)/p,v=(c*m-h*d)/p;i-=f,a-=v}while((Math.abs(f)>ge||Math.abs(v)>ge)&&--n>0);return n&&[i,a]},(d3.geo.laskowski=function(){return _e(Ct)}).raw=Ct,Lt.invert=function(t,e){var i=t*t,a=e*e,n=a+1,s=t?Math.SQRT1_2*Math.sqrt((n-Math.sqrt(i*i+2*i*(a-1)+n*n))/i+1):1/Math.sqrt(n);return[r(t*s),l(e)*o(s)]},(d3.geo.littrow=function(){return _e(Lt)}).raw=Lt,(d3.geo.loximuthal=function(){return E(At).parallel(40)}).raw=At,Dt.invert=function(t,e){return[t,2.5*Math.atan(Math.exp(.8*e))-.625*fe]},(d3.geo.miller=function(){return _e(Dt)}).raw=Dt;var Ne={alaska:[[.9972523,0],[.0052513,-.0041175],[.0074606,.0048125],[-.0153783,-.1968253],[.0636871,-.1408027],[.3660976,-.2937382]],gs48:[[.98879,0],[0,0],[-.050909,0],[0,0],[.075528,0]],gs50:[[.984299,0],[.0211642,.0037608],[-.1036018,-.0575102],[-.0329095,-.0320119],[.0499471,.1223335],[.026046,.0899805],[7388e-7,-.1435792],[.0075848,-.1334108],[-.0216473,.0776645],[-.0225161,.0853673]],miller:[[.9245,0],[0,0],[.01943,0]],lee:[[.721316,0],[0,0],[-.00881625,-.00617325]]};(d3.geo.modifiedStereographic=It).raw=Pt,Bt.invert=function(t,e){var i=Math.sqrt(6),a=Math.sqrt(7),n=3*r(e*a/9);return[t*a/(i*(2*Math.cos(2*n/3)-1)),r(3*Math.sin(n)*i/7)]},(d3.geo.mtFlatPolarParabolic=function(){return _e(Bt)}).raw=Bt,Rt.invert=function(t,e){var i=e*Math.sqrt(2+Math.SQRT2)/(2*Math.sqrt(3)),a=2*r(i);return[3*Math.SQRT2*t/(1+2*Math.cos(a)/Math.cos(a/2)),r((i+Math.sin(a))/(1+Math.SQRT1_2))]},(d3.geo.mtFlatPolarQuartic=function(){return _e(Rt)}).raw=Rt,Ft.invert=function(t,e){var i=Math.sqrt(6/(4+fe)),a=e/i;return Math.abs(Math.abs(a)-ve)<ge&&(a=0>a?-ve:ve),[1.5*t/(i*(.5+Math.cos(a))),r((a/2+Math.sin(a))/(1+fe/4))]},(d3.geo.mtFlatPolarSinusoidal=function(){return _e(Ft)}).raw=Ft,Nt.invert=function(t,e){var i,a=e,n=25;do{var s=a*a,l=s*s;a-=i=(a*(1.007226+s*(.015085+l*(-.044475+.028874*s-.005916*l)))-e)/(1.007226+s*(.045255+l*(-0.311325+.259866*s-.005916*11*l)))}while(Math.abs(i)>ge&&--n>0);return[t/(.8707+(s=a*a)*(-.131979+s*(-.013791+s*s*s*(.003971-.001529*s)))),a]},(d3.geo.naturalEarth=function(){return _e(Nt)}).raw=Nt,qt.invert=function(t,e){for(var i=e/2,a=0,n=1/0;10>a&&Math.abs(n)>ge;a++){var s=Math.cos(e/2);e-=n=(e-Math.tan(e/2)-i)/(1-.5/(s*s))}return[2*t/(1+Math.cos(e)),e]},(d3.geo.nellHammer=function(){return _e(qt)}).raw=qt;var qe=1.0148,He=.23185,Ye=-.14499,je=.02406,Ve=qe,Xe=5*He,Ke=7*Ye,We=9*je,Ue=1.790857183;Ht.invert=function(t,e){e>Ue?e=Ue:-Ue>e&&(e=-Ue);var i,a=e;do{var n=a*a;a-=i=(a*(qe+n*n*(He+n*(Ye+je*n)))-e)/(Ve+n*n*(Xe+n*(Ke+We*n)))}while(Math.abs(i)>ge);return[t,a]},(d3.geo.patterson=function(){return _e(Ht)}).raw=Ht;var Ge=it(ht);(d3.geo.peirceQuincuncial=function(){return Ge().quincuncial(!0).rotate([-90,-90,45]).clipAngle(180-1e-6)}).raw=Ge.raw,Yt.invert=function(t,e){if(Math.abs(e)<ge)return[t,0];var i,a=t*t+e*e,n=.5*e,s=10;do{var c=Math.tan(n),h=1/Math.cos(n),d=a-2*e*n+n*n;n-=i=(c*d+2*(n-e))/(2+d*h*h+2*(n-e)*c)}while(Math.abs(i)>ge&&--s>0);return c=Math.tan(n),[(Math.abs(e)<Math.abs(n+1/c)?r(t*c):l(t)*(o(Math.abs(t*c))+ve))/Math.sin(n),n]},(d3.geo.polyconic=function(){return _e(Yt)}).raw=Yt,(d3.geo.rectangularPolyconic=function(){return E(jt)}).raw=jt;var Qe=[[.9986,-.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];Qe.forEach(function(t){t[1]*=1.0144}),Vt.invert=function(t,e){var i=e/ve,a=90*i,n=Math.min(18,Math.abs(a/5)),s=Math.max(0,Math.floor(n));do{var l=Qe[s][1],r=Qe[s+1][1],o=Qe[Math.min(19,s+2)][1],c=o-l,h=o-2*r+l,d=2*(Math.abs(i)-r)/c,u=h/c,m=d*(1-u*d*(1-2*u*d));if(m>=0||1===s){a=(e>=0?5:-5)*(m+n);var g,p=50;do n=Math.min(18,Math.abs(a)/5),s=Math.floor(n),m=n-s,l=Qe[s][1],r=Qe[s+1][1],o=Qe[Math.min(19,s+2)][1],a-=(g=(e>=0?ve:-ve)*(r+m*(o-l)/2+m*m*(o-2*r+l)/2)-e)*xe;while(Math.abs(g)>pe&&--p>0);break}}while(--s>=0);var f=Qe[s][0],v=Qe[s+1][0],b=Qe[Math.min(19,s+2)][0];return[t/(v+m*(b-f)/2+m*m*(b-2*v+f)/2),a*ye]},(d3.geo.robinson=function(){return _e(Vt)}).raw=Vt,(d3.geo.satellite=Wt).raw=Kt,Ut.invert=function(t,e){var i=e/1.70711,a=Math.sin(fe/4*i);return[t/(.74482-.34588*a*a),2*Math.atan(i)]},(d3.geo.times=function(){return _e(Ut)}).raw=Ut,(d3.geo.twoPointEquidistant=Qt).raw=Gt,(d3.geo.twoPointAzimuthal=Jt).raw=Zt,$t.invert=function(t,e){if(Math.abs(e)<ge)return[t,0];if(Math.abs(t)<ge)return[0,ve*Math.sin(2*Math.atan(e/fe))];var i=(t/=fe)*t,a=(e/=fe)*e,n=i+a,s=n*n,r=-Math.abs(e)*(1+n),c=r-2*a+i,h=-2*r+1+2*a+s,d=a/h+(2*c*c*c/(h*h*h)-9*r*c/(h*h))/27,u=(r-c*c/(3*h))/h,m=2*Math.sqrt(-u/3),g=o(3*d/(u*m))/3;return[fe*(n-1+Math.sqrt(1+2*(i-a)+s))/(2*t),l(e)*fe*(-m*Math.cos(g+fe/3)-c/(3*h))]},(d3.geo.vanDerGrinten=function(){return _e($t)}).raw=$t,te.invert=function(t,e){if(!t)return[0,ve*Math.sin(2*Math.atan(e/fe))];var i=Math.abs(t/fe),a=(1-i*i-(e/=fe)*e)/(2*i),n=a*a,s=Math.sqrt(n+1);return[l(t)*fe*(s-a),l(e)*ve*Math.sin(2*Math.atan2(Math.sqrt((1-2*a*i)*(a+s)-i),Math.sqrt(s+a+i)))]},(d3.geo.vanDerGrinten2=function(){return _e(te)}).raw=te,ee.invert=function(t,e){if(!e)return[t,0];var i=e/fe,a=(fe*fe*(1-i*i)-t*t)/(2*fe*t);return[t?fe*(l(t)*Math.sqrt(a*a+1)-a):0,ve*Math.sin(2*Math.atan(i))]},(d3.geo.vanDerGrinten3=function(){return _e(ee)}).raw=ee,ie.invert=function(t,e){if(!t||!e)return[t,e];e/=fe;var i=l(t)*t/ve,a=(i*i-1+4*e*e)/Math.abs(i),n=a*a,s=2*e,r=50;do{var o=s*s,c=(8*s-o*(o+2)-5)/(2*o*(s-1)),h=(3*s-o*s-10)/(2*o*s),d=c*c,u=s*c,m=s+c,g=m*m,p=s+3*c,f=g*(o+d*n-1)+(1-o)*(o*(p*p+4*d)+d*(12*u+4*d)),v=-2*m*(4*u*d+(1-4*o+3*o*o)*(1+h)+d*(-6+14*o-n+(-8+8*o-2*n)*h)+u*(-8+12*o+(-10+10*o-n)*h)),b=Math.sqrt(f),y=a*(g+d-1)+2*b-i*(4*g+n),x=a*(2*c*h+2*m*(1+h))+v/b-8*m*(a*(-1+d+g)+2*b)*(1+h)/(n+4*g);s-=δ=y/x}while(δ>ge&&--r>0);return[l(t)*(Math.sqrt(a*a+4)+a)*fe/4,ve*s]},(d3.geo.vanDerGrinten4=function(){return _e(ie)}).raw=ie;var Ze=function(){var t=4*fe+3*Math.sqrt(3),e=2*Math.sqrt(2*fe*Math.sqrt(3)/t);return S(e*Math.sqrt(3)/fe,e,t/6)}();(d3.geo.wagner4=function(){return _e(Ze)}).raw=Ze,ae.invert=function(t,e){return[t/Math.sqrt(1-3*e*e/(fe*fe)),e]},(d3.geo.wagner6=function(){return _e(ae)}).raw=ae,ne.invert=function(t,e){var i=t/2.66723,a=e/1.24104,n=Math.sqrt(i*i+a*a),s=2*r(n/2);return[3*Math.atan2(t*Math.tan(s),2.66723*n),n&&r(e*Math.sin(s)/(1.24104*.90631*n))]},(d3.geo.wagner7=function(){return _e(ne)}).raw=ne,se.invert=function(t,e){var i=-.5*(t*t+e*e),a=Math.sqrt(-i*(2+i)),n=e*i+t*a,s=t*i-e*a,l=Math.sqrt(s*s+n*n);return[Math.atan2(a*n,l*(1+i)),l?-r(a*s/l):0]},(d3.geo.wiechel=function(){return _e(se)}).raw=se,le.invert=function(t,e){var i=t,a=e,n=25;do{var s,l=Math.cos(a),r=Math.sin(a),c=Math.sin(2*a),h=r*r,d=l*l,u=Math.sin(i),m=Math.cos(i/2),g=Math.sin(i/2),p=g*g,f=1-d*m*m,v=f?o(l*m)*Math.sqrt(s=1/f):s=0,b=.5*(2*v*l*g+i/ve)-t,y=.5*(v*r+a)-e,x=.5*s*(d*p+v*l*m*h)+.5/ve,_=s*(u*c/4-v*r*g),z=.125*s*(c*g-v*r*d*u),M=.5*s*(h*m+v*p*l)+.5,w=_*z-M*x,S=(y*_-b*M)/w,k=(b*z-y*x)/w;i-=S,a-=k}while((Math.abs(S)>ge||Math.abs(k)>ge)&&--n>0);return[i,a]},(d3.geo.winkel3=function(){return _e(le)}).raw=le}function H(){return function(){function t(u){return null==n?void console.warn("D3 collision resolver stopped: missing data to work with. Example: data = {asi: {valueY: 45, valueX: 87}, ame: {valueY: 987, valueX: 767}}"):null==s?void console.warn("D3 collision resolver stopped: missing a CSS slector"):null==l?void console.warn("D3 collision resolver stopped: missing height of the canvas"):null==o?void console.warn("D3 collision resolver stopped: missing pointer within data objects. Example: value = 'valueY' "):null==d?void console.warn("D3 collision resolver stopped: missing a key for data. Example: key = 'geo' "):(u.each(function(t,e){i[t[d]]=d3.select(this).select(s)[0][0].getBBox().height}),a=t.calculatePositions(n,o,l,r),void u.each(function(t,i){if(!n[t[d]][c]){var l=a[t[d]]||r(n[t[d]][o])||0,u=null;return null!=h?void h(t,i,this,u,l):void d3.select(this).selectAll(s).transition().duration(e).attr("transform","translate(0,"+l+")")}}))}var e=300,i={},a={};t.calculatePositions=function(t,e,a,n){var s={},l=Object.keys(t).sort(function(i,a){return t[i][e]-t[a][e]});l.forEach(function(a,r){s[a]=n(t[a][e]);for(var o=r;o>0;o--){var c=s[l[o-1]]-s[l[o]]-i[l[o]];if(0>c&&(s[l[o-1]]-=c),c>0)break}});var r=a-s[l[0]]-i[l[0]];if(0>r){s[l[0]]+=r;for(var o=0;o<l.length-1;o++){var r=s[l[o]]-s[l[o+1]]-i[l[o+1]];if(0>r&&(s[l[o+1]]+=r),r>0)break}}return s};var n=null;t.data=function(e){return arguments.length?(n=e,t):n};var s=null;t.selector=function(e){return arguments.length?(s=e,t):s};var l=null;t.height=function(e){return arguments.length?(l=e,t):l};var r=d3.scale.linear().domain([0,1]).range([0,1]);t.scale=function(e){return arguments.length?(r=e,t):r};var o=null;t.value=function(e){return arguments.length?(o=e,t):o};var c=null;t.fixed=function(e){return arguments.length?(c=e,t):c};var h=null;t.handleResult=function(e){return arguments.length?(h=e,t):h};var d=null;return t.KEY=function(e){return arguments.length?(d=e,t):d},t}()}function Y(t){this.ddfPath=t,"/"!==this.ddfPath[this.ddfPath.length-1]&&(this.ddfPath+="/");var e=document.createElement("a");e.href=t}function j(t){return t.select.map(function(t){var e=t.indexOf(".");return e>=0?t.substr(e+1):t})}function V(t){var e=[];for(var i in t.where)if(t.where.hasOwnProperty(i)){var a=i.indexOf("."),n=a>=0?i.substr(a+1):i;n=n.replace(/is--/,""),e.push(n)}return e}function X(){try{new Function("",""),xs=!0}catch(t){xs=!1}}function K(t){var e;return null==t?null:d3.csv.parseRows(t,function(t,i){if(i){for(var a={},n=-1,s=e.length;++n<s;)a[e[n]]=t[n];return a}e=t})}function W(t){if(_s.FILE_REQUESTED[t])return _s.FILE_REQUESTED[t];_s.FILE_REQUESTED[t]=new l,null==xs&&X();var e=xs?d3.csv:d3.text,i=xs?null:K;return Y.chromeFs&&(e=function(t,e){Y.chromeFs.readFile(t,"",function(t,i){e(t,i)})},i=K),e(t,function(e,a){var n;return a?e?(n="Error Happened While Loading CSV File: "+t+": "+e.message,Ht(n),_s.FILE_CACHED[t]=null,void _s.FILE_REQUESTED[t].reject(n)):(i&&(a=i(a)),_s.FILE_CACHED[t]=a,void _s.FILE_REQUESTED[t].resolve()):(n="No permissions or empty file: "+t+": "+e.message,Ht(n),_s.FILE_CACHED[t]=null,void _s.FILE_REQUESTED[t].reject(n))}),_s.FILE_REQUESTED[t]}function U(t){return t=t||[],t.reduce(function(t,e){var i=[].concat(e).some(Array.isArray);return t.concat(i?e.flatten():e)},[])}function G(t){for(var e={},i=[],a=0,n=t.length;n>a;++a)e.hasOwnProperty(t[a])||(i.push(t[a]),e[t[a]]=1);return i}function Q(t){function e(e){var i=zs[t].exec(e[0]),a=zs[t].exec(e[1]);return{first:[i[1],i[2],i[3]],second:[a[1],a[2],a[3]]}}function i(t,i,a,n,s){for(var l=e(t),r=Number(l.first[0]),o=Number(l.first[1]),c=Number(l.second[0]),h=Number(l.second[1]),d=[],u=r;c>=u;u++)for(var m=u===r?o:i,g=u===c?h:a,p=m;g>=p;p++)s===!0&&10>p&&(p="0"+p),d.push(u+n+p);return d}var a=[function n(t){for(var i=e(t),a=Number(i.first[0]),s=Number(i.second[0]),l=[],n=a;s>=n;n++)l.push(""+n);return l},function(t){return i(t,1,4,"q",!1)},function(t){return i(t,1,12,"",!0)},function(t){return i(t,1,53,"w",!0)},function(t){for(var i=e(t),a=Number(i.first[0]),n=Number(i.first[1]),s=Number(i.first[2]),l=Number(i.second[0]),r=Number(i.second[1]),o=Number(i.second[2]),c=[],h=a;l>=h;h++)for(var d=h===a?n:1,u=h===l?r:12,m=d;u>=m;m++)for(var g=10>m?"0"+m:m,p=h===a&&m===d?s:1,f=h===l&&m===u?o:31,v=p;f>=v;v++){var b=10>v?"0"+v:v;c.push(h+""+g+b)}return c}];return a[t]}function Z(t){for(var e=U(t),i=[],a=0;a<e.length;a++)for(var n=0;n<zs.length;n++)if(zs[n].test(e[a])){i.push(n);break}if(i=G(i),1!==i.length)throw new Error("Wrong time query format: "+JSON.stringify(t));return i[0]}function J(t){var e=Z(t),i=Q(e),a=[];return t.forEach(function(t){"string"==typeof t&&a.push(t),"object"==typeof t&&(a=a.concat(i(t)))}),a}function $(t){return ys.map(function(e){return e[t]})}function tt(t){var e={world_4region:[["africa","Africa","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 584.5 364.5'><path id='africa' d='M322.7,114.7l-1-1.8l-6.5,2.3l-16-4.8l-2.3,1.7l-1.8,4.5l-16.9-8.6l-0.2-0.6l-0.3-5.5l-2-2.8l-29,4.4l-0.2-0.4 l-1.7,0.2l-0.1,1.1l-6.7,7l-0.5,1.9l-0.6,0.7l-0.3,3.3l-15.3,23.7l0.6,13.2l-1.4,3l1.1,7.6l12.1,17.9l6,2.8l7.1-1.9l4.5,0.8 l13.7-3.3l3.9,4.5h3.5l1.6,1.4l1.8,3.6l-1.1,10.7l9.2,27.4l-4,14.6l8.5,30.7l1.1,1.1v0.7h0.5l3.5,12.5l2,1.7l11.9-0.6l15-18.2v-3.9 l5.1-4.5l1.1-4.2l-1.1-5.9l10.5-12.2l0.6-0.3l1.6-3.7l-3.4-24l25-43.3l-13.1,1.1l-1.8-1.1l-24.7-48.6l0.9-0.4l0.6-1L322.7,114.7  M360.1,233.2l2.3,1.7l-8.6,30.5l-4.3-0.6l-2-7.6l2.8-14.6l6.4-4.4l2.8-4.9L360.1,233.2z'/></svg>"],["americas","Americas","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 584.5 364.5'><path id='americas' d='M134.8,152l-11.4,1.8l-3.1-1.7l5.3-1.3l-0.7-1.1l-3.3-1.4h-0.1l-8.1-0.9l-0.3-0.3l-0.3-1.5l-6.2-3.6l-3.4,0.8 l-1.6,1.3l-1.2-0.5l-0.7-1.7l3.8-1.6l9.1,0.7l9.5,5.3l0,0l3.3,1.8l1.7-0.5l6.6,2.8L134.8,152 M183.7,25.4l-0.5-1.5l-2.6-2.2 l-2.1-0.6l-2.9-2.2l-18.2-2.2l-5.1,3.7l2,4.3l-6,2.2l1-1.7l-4.6-1.9l-0.5-1.7l-1.1-1.2l-2.9,0.5l-2.1,4.2l-5.8,2.5l-15.5-2.2 l10.5-1.7l-1.3-4l-11.6-0.4l-3.2-1.5L96,20.7h5.8l4,1.9l-1.7,1l0.8,1l7.2,2.3l-78.9-5.3l-10,3.6l-0.4,4.4L18,31.1l1,1.8l1.7,1.2 l-5.5,4.5l-0.4,5.6L13.8,46l1.8,1.8l-4.4,6.2L22,43.7l1.8-0.5l1.3-1.2l13.4,4l4,4.2l-1.3,14l1.6,2.6l-3.3,1.3L39.4,70l2.7,2.6 L28.6,96.9l1.6,11.2l4.8,5.6l-0.2,3.4l2.5,6.1l-0.5,5l6.6,11.9L38,121.5l1.7-4l3.4,6.1l0.3,2.2l7.1,13.1l1.1,9.2l11.1,8.7l1.6,0.3 l1.3,0.9l5.5,1.2l3.4-0.9l5.5,4.2l0.3,0.5l0.8,0.3l2.1,1.9l5.5,0.5l0.2,0.6l0.8,0.3l4.8,8.9l2.3,1.5l0.2,0.5l7.1,3.4l1.6-1.7 l-5.1-2.2l-1.3-15.6l-6.3-2.2l-3.7,0.3v-4.6l3.7-8.9l-5.2-0.9l-0.5,0.3L83,151l-6.3,2.2l-4-2.8l-3.2-8.9l3.2-11.8l0.5-0.3l0.2-1.2 l2.6-3.1l8.5-3.6l6.3,1.8l4.5-3.1l9.2,1.1l2.5,3.1l1.5,7.8l1.3,1.8l2.1-4.5l-1.1-5l1.6-7l13.7-12.3l0.2-3.7l0.8-1.7l0.9-0.2l0.7,0.5 l0.6-1.9l15-8.8l2.2-3.9l11.9-5.1l-2.2,3.6l11.4-3.8l-5.2-1.7l-1.8-2.8l1.6-4.2l-0.8-0.9h-4.2l0.8-1.5l19.5-3.2l1.6,2.8l-4.5,4.2 l6,1.7l5.3-2.2l-6.3-7.6l4.5-6.1l-1.1-0.6l-0.2-0.5h-3.2l-3.7-13.4l-7.7,3.1l-1.8-1.9l0.2-3.9l-2.3-2.5l-3.4-1.5l-6.6,1.9l-2.1,4.2 l-1.1,0.6l-1.3,2.2l-0.3,3.4l-10,9.5l-0.8,2.8l-1.8,1.9l-2.1,0.3l-1.8-2.5l1.1-4.8l-11.9-6.1l-3.1-5.1l15-12l1.3,0.3l5.1-1.2 l1.1-1.2l0.4-1.2l3.4-0.3l-1.7,4.8L147,34l4.6,0.7l-2.2-2.9l-2.1-1.2l8.2-2.8l0.3-0.6l2-1.7l0.7,0.1l8.1-4.2l7.4,5.3l0.2,1.5l-6,1.5 l-1.8,2.2l3.7,5.3l3.4,1.2l2.3-2.2l2.9-1.2L179,33l-0.2-1.9l7.7-1.7L183.7,25.4 M119.7,74.5l0.8,3.1l1.7,1.8l3.3-0.2l5.4,4.7 l2.7,0.2l-0.5,1.7l-4.7-0.4l0.2-1.2l-2.6-0.9l-2,0.6l-2.6,3.4l3.1,1.7l-3.2,2.3l-2.6-1.2l0.1-9.3l-9.6,9.9L108,88l4.5-7l4.3-2 l-5.1-2.1l-4.8,0.5l0.2-1.7l1.3-1.2l8.7-2.2L119.7,74.5 M205.9,223.1l-1.3,3.1H204l-7.1,11.2l-1.9,18.2l-3.1,6.1h-0.5v0.6l-0.8,0.3 l-1.1,1.2l-2.7-0.3l-9.4,6.7l-7.7,21.6l-3.9,3.3l-5.1-1.1l2.1,3.3l0.5,5.3l-7.9,3.3l-1.4,1.5l-0.5,3.6l-1.1,0.6l-1.1-0.3l-1.8,0.9 l1.8,6.1l-1.8,5.6l3.4,6.1l-2,5.9l0.5,3.1l11.1,8.2l-0.2,0.5l-9.3-0.6l-4.3-5.1l-4.7-1.7l-8.6-17.1l0.5-1.7l-6-12.3l-4.5-56.7 l-12.4-10.2l-4.2-8.1l-0.8-0.6l-9.8-21.5l1.1-2.2l-0.3-2.6l-0.5-0.8l7.9-15.3l0.3-5.6l-1-2.8l1-3.9l1.8-0.3l9.7-8.2l2.1,0.3l0.8,5.1 l2.7-5.1l1.3-0.3l4.2,2.8h0.9l0.2,0.6l14.8,3.9l1.6,1.4l0.3,0.6l7.9,6.7l7.7,0.9l4.3,4l2,6.3l-1,4.6l4.4,1.4l1.1,2.2l5.2-1.1 l2.1,1.1l2.6,4l2.9-0.9l9,1.9l8.6,5.8L205.9,223.1'/></svg>"],["asia","Asia","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 584.5 364.5'><path id='asia' d='M322.9,118.9l22.8,42.5l13.5-5.9l16.8-19l-7.3-6.5l-0.7-3.4h-0.1l-5.7,5.2l-0.9,0.1l-3.2-4.4l-0.4-0.2l-0.7,1.7 l-1.2-0.4l-4.1-11.4l0.2-0.5l1.9-1.2l5.1,6.8l6.2,2.7l0.8-0.2l1.1-1.1l1.6,0.4l2.9,2.6l0.4,0.8l16.4,0.8l6.9,6.5l0.4,0.1l1.4-0.3 l0.3,0.1l-1.7,2.5l2.9,2.8h0.7l3.3-3.3l0.5,0.3l9.2,32.1l4,3.7l1.3-1.3h0.2l1.7,1.3l1.4,6.6l1.6,0.9l1.7-2.9l-2.3-7.3l-0.1,0.3v-0.2 l-1.7,0.6l-1.3-1.1l1.2-14.3l14.3-17.6l5.9-1.7l0.3,0.1l3.1,4.5l0.8,0.2l0.9,1.5l0.8,0.3l4.7,10.3l0.2,0.1l2-0.6l5.4,10.1l-0.3,10.5 l2.8,3.7l0,0l4.2,10.8l1.8,1.7l-1.1,2.4l-0.8-0.6l-1.9-4l-1.7-1.4l-0.3-0.9l-5.5-3.5l-2.4-0.3l-0.2,1.2l19.8,28.5l2.6-3.6l-5.7-11.2 l0.9-4l0.7-0.2l0.2-2.3l-9.3-18.6l-0.3-8.9l1.4-1.5l6.7,7.8l1.4,0.3l1.1-0.6l0.1,0.1l-0.2,3.4l0.6,0.5l0.5,0.2l7.4-7.9l-2-10.4 l-6.9-9.5l4.9-6l0.8,0.2l0.8,0.5l1.7,3.9l2.9-4.7l10.1-3.6l5.1-8.1l1.6-9.9l-2.5-2l1.1-1.7l-7.5-11.5l3.5-4.7l-6.1-0.9l-3.5-3.7 l4.1-4.3l0.8-0.1l1.4,0.9l0.6,2.9l2.8-1.3l3.9,1.4l0.9,3.2l2.3,0.5l5,9h0.4l2.3-2.4h0.3l1-1.5l-1.7-3.8l-5.8-5.9l2.1-4v-3.6l2.6-2.4 l0.5,0.1l0.2-0.1l-3.5-15.2l-0.2,0.1v-0.1l-9.3,1.2l-7.3-9.3L464,58.8l-0.8,1.9L441.2,60l-1.5-1.8l-0.2,0.1l0,0l-7.3,4.1l-7.5-3 l-0.5,0.3l-1.8-0.8l-0.9-1.2l-0.3,0.1l-0.1-0.1l-5.7-0.4l-0.3-0.2l0,0l0,0l-1,0.5l-1.5,4.5l-4.2,2.7l-16.8-4.4L377.5,50l0,0l-0.2,1 l1.8,6.7l-13.3,3l-9.2-3.8l-1.1,3.1l-6.7-1.6l-0.1,0.1h-0.2l-4.4,6.8l3.8,3.8l0.6,2.7l0,0l0,0L352,71l2.6,2.2V74l-2.3,1.9l-0.8,1.6 l1.6,3.9l0.9,0.3l1,1.1l2.6,0.9l1.7,1.7l-0.2,1.1l-1.5,2.8l2.1,3.7v4.5l-1.3,1.4l-3.8-0.9l-4.7-5.1v-0.6l-1.4-1.4l-3.9,2.1l-2.4-2.1 l-1.6,0.9l-0.3,5.1l-15.2,4.7l-1.7,9.8l-2.5,1.7L322.9,118.9 M531.1,99.3l-1,2l-4,1.7l-2.4,3l-3.3-2.5l-6.4,0.2l-0.2-0.7l8.9-4.2 l3.7-4.9l-0.6-3.3l-3.2-5.1l-0.7-0.4v-5.1l1.4-2.6l1.7,0.3l0.6,0.7h0.8l1.1,0.8l1.3,0.3l0.6,1.9l-1.7,2l-2.6-1.2L531.1,99.3  M500.5,130.3l1.9-0.9l-0.8,6.3l-1.6-0.3L500.5,130.3 M515.9,180.5l-1.7,0.4l-2.2-3.3l-3.6-2.2l4.3-2.5l0.9-3.1l-0.3-4.1l-4.6-2.1 l-2,0.5l-5.1,8.5l-2.4,0.3l-0.2-3.4l0.8-0.7l4.2-9.3l-1.8-3.7l1.4-9.3l2.4,1.8l1.6,3.6l-0.5,4.8l8,6.4l0.1-0.1l3.1,11.2L515.9,180.5 L515.9,180.5L515.9,180.5 M497.7,179.5l2.6,0.9l1.1,1.9l-1.8,5.1l0.8,7l-6,10.9l-9.2-1.7l-2.9-10.9L497.7,179.5L497.7,179.5  M509,194.8l-1.8,0.1L509,194.8 M515,193.9l-1.7,2.2l-2.4-0.2l-1.9-1.1l-3.3,1.3l-0.3,1.9l1.2,1.4l2.1-0.3l0.9-0.7l1.1,0.1l0.3,1.2 l-1.9,2.6l0.7,5.6l-2.3-2l-1-2l-1.5,1l0.9,5.2l-3.1-0.4l0.2-2.8l-1.4-2.5l2.9-10.5l3.2-1.6l3.8,1.2l3.4-1.1L515,193.9 M530.7,198.1 l2.5,0.5l0.4,0.4l2,5.3l2.1-2.2l4.2-1.7l14.5,11.5l2.4,0.5l4-2.6l-1.2,4.7l-3.5,1.4l-0.5,1.4l0.1,1.3l4.4,6.5l-4.4-1.5l-5.2-7.5 l-5.6,4.4l-5.6-2l-1.2-1.5l1.3-1.5l-1.9-2.4l-0.3-0.8l-8.5-5l-0.9-4.7l-3.4-3.1l2.4-1.4H530.7 M476.6,212.1l19.1,5l3.1-0.8l4.4,1.4 l3.3-0.9l12.4,2.1l-0.1,0.6l-8.2,4v-1.9l-35.4-5.6l-1.5-1.8l2.5-1.9H476.6 M569.4,280.1l-19,14.6l-0.7-1.1l2.2-4.6l5.1-3l7.4-9.7 l0.9-4.3l4.8,5.1L569.4,280.1 M554.3,267.3l-11.1,18.2l-5.7,3.1l-4.8,7.7l-2.5,0.5l-0.6-1.9l0.5-3.4l2.8-2.9l-6.6-0.8l-1.6-1.4 l-1.7-8.4l-0.9-0.9l-3.1,1.1l-5.2-3.9l-32.3,7.3l-2.3-1.9l2.3-4.5l0.6-21.9l1.8-2.5l13.9-6.4l4.3-4.8l0.3-0.9l10-9.2l4.2,1.9l5.5-7 l4.2-1.4l4.9,2l-1.1,5l2.8,4.8l4.5,2.8l3.2-4.5l2.5-11.7l4.6,10.8v7.6l7.7,18.5L554.3,267.3L554.3,267.3L554.3,267.3L554.3,267.3 L554.3,267.3L554.3,267.3'/></svg>"],["europe","Europe","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 584.5 364.5'><path id='europe' d='M556.7,26.9l-35.5-7.3l-3.5,1.4l-49.9-5.2l-2.7,2l-45.8-4.1l-1.3-1.9l-15.3-2.2l-0.2,0.1h-0.1l-0.2,0.2l-6,0.6 l-0.5,0.5L372.4,17l-1.7,1.7l-5.8-3.1h-1.7l-1.5,3.7l1.8,2.5l-0.4,0.2l-10.1-1.5l-6.8,1.9l-5.3-0.6l-7.2,2.6l-4.2-1h-0.1l-3.1,3.2 l-0.9,0.2l-2.6,2.2l-2.3,0.8l-1.6,2h-1.7l-5.1-5.1l-1-0.2l-0.1-0.5l1.3-0.9l8.4,1.6l0.5-0.1l2.4-1.8l-0.8-0.9l-20.2-5.5l-16.9,3.4 L268,37l0.8,6.1l3.2,1.7l4-1l1.5,0.9l2.6,5.5h0.8l0.7,1.2l0.8,0.2l7.9-9.7l-2.9-5.4l8.5-8.9h0.5l1.3,1.7l-2.7,6.6l0.8,2.8l11.9,2.4 l-4,1.8l-3.5-0.3l-1.5,1.2l1,1.6l-0.1,2.2l-0.9-0.6H297l-1.8,1.2l-0.5,3.9l-2.3,2.2h-4.3l-4.2,1.9l-6.8-0.7l-0.6-0.4l2.5-1.7 l0.5-1.2l-0.9-1.7l-0.2-0.1l-2.3,0.5l-0.2-0.1l-0.2-3.4l-0.4-0.1l-2.6,3.9l1.3,3.7l-1.4,1.7L269,57l-18.9,13.1l0.1,1l1.7,1.6 l0.8,0.3l1.3,2.2l0.3,3.6l-3.1,4.5l-9.7-0.9l-1.3,1.5L239,97.9l0.4,1.1l5.1,3.1l0.2,0.8l1.6-0.2l0.1-0.2h0.1v-0.1l7.9-4.5l10-14.3 l10-2.8l1.2,0.5l11,11.5l0.2,2.3l-2,1.8l-1.9-0.4l-1.8,0.5l3.8,3.9l1.1-0.7l3.7-5.6l0.2-0.5l-0.9-1.9l0.2-0.4l2.3,0.3l0.8-1 l-1.7-0.9l-8.7-7.6l-0.5-4.5l1.4,0.2l10.4,8l3.4,9l1,0.5l0.5,0.6v1.5l4.5,6.1v0.4l0.7,1.1l3.7,1.3l1.4-1.6l-3.8-2.3l-0.1-1.7 l2.2-2.6l-6.3-6.3l5.6-2.2L306,90l5.8,8l4.2-0.6l2.7,0.9l1,4.7l0.7-0.1l1.8-2l-1.3-1.7l0.2-0.9h4.3l0.3,2.7l15.2-4.7l0.4-5.1 l1.5-0.9l2.5,2l3.9-2.1l1.4,1.5l0.3-3.9l-3.1-5.3l-1.3-8.6l2.9-2.5l-0.6-2.7l-3.8-3.8l4.5-6.9l6.8,1.6l1.1-3.1l9.2,3.8l13.3-3.1 l-1.8-6.7l0.2-1l8.7,7.4l22.2,7.4l4.3-2.7l1.5-4.5l1-0.5l0.2,0.2l6,0.4l1,1.2l1.7,0.8l0.5-0.3l7.5,2.9l7.5-4.2l1.5,1.8l22.1,0.8 l0.7-1.8l23.5-1.4l7,9.2l9.6-1.2l3.4,15.2l1,1.1l-0.2,0.2l1.7,1.7l0.5,0.1l1.8-2.2l1.6-5.3L508,56.7l-2.9-2.2l-5.5,0.3l-2.6-2.5 l1.8-7.8l0.5-0.3l0.2-0.9l3.4-1.7l14.2,0.6l1.3-4.8l1.6-1.2l0.4-0.1l4.3,1.2l0.1-0.1l0.2,0.1l3.1-2.5l1.7,0.9l-1,12l6.9,15.9l3.1-3 l0.1-0.3l2.3,1.1l0.8-2.2l-1.1-8.7l-4.8-5.8l0.1-2.6l0.8-1.5l4.5-2.2l2.2,0.2l4-3.7l2.1-0.3l1.1-1.7l-5.2-2.5l-0.5-1.7l2.9-1.7 l8.2,2.2l0.9-0.2l0.8-1.2L556.7,26.9 M331,87l-11.6-3.1l-8.9,2.9l-0.2-0.1l-0.5-1.9l2.9-7l2.9-2.5h1.7l2.1,1.1l2.3-1.7l1.8-3.4 l1.8-0.6l2.1,0.6l-0.8,3.9l7.7,7.3L331,87 M252.8,18.2l-5.8,5.6l-3.7,1.1l-1.1,4.3l-2.2,1.7l-0.2,1.2l0.9,1.7l7.8,1.2l-2.4,2.9 l-4.6,1.7l-5.9-2.9l2-1.8l1.9-0.8l-2.5-2.1l-11.4,1.7l-4.7,3.1l-8,1.7L203,49l-3.4,0.3l-3.7-2.8l-1.3-10.6l5.2-4.5l1.1-2l-1.9-3.3 l-0.5-0.3v-0.6l-0.5-0.3v-0.6l-0.6-0.3l-1.1-1.4l-3.1-1.4h-5.5l-4-1.7l71.2-3.4L252.8,18.2 M258.9,60.7l0.7,1.2l-10.5,1.5l3.4-1.5 l-0.1-1.5l-2.7-0.9l4.2-4.9l-2.7-2.7l-5.9,7.4l-4.4,0.8l1.1-2.7l-0.2-2.7l8.5-4.8l0.3-3.8l1-1.3l1.3,0.4l0.2,1.1l1.3,0.3l-0.8,3.2 l3.3,2.4l1.7,5.1l2.6,0.9L258.9,60.7'/></svg>"]],geographic_regions:[["america","America","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='america' d='M189.96,40.495c1.3,0.72,2.56,1.51,3.82,2.32l1.04,0.23c0.57,0.13,1.7,0.39,2.27,0.52c0.55,0.18,1.64,0.55,2.18,0.73c-0.13,1.2-0.26,2.41-0.36,3.61c-4.66,0.37-9.34,0.55-14,0.8c0.06,1.15,0.11,2.3,0.16,3.45c0.58-0.04,1.74-0.11,2.32-0.14c1.6-0.47,2.8,0.77,3.51,2.04l0.63,0.8c0.88,0.68,1.23,1.54,1.06,2.59l-0.11,1.04c1.27-0.13,1.89,0.44,1.87,1.71c2.21,0.13,4.42,0.26,6.65,0.27c1.38-0.07,2.75,0.11,4.1,0.43c1.94,0.35,3.91,0.45,5.88,0.44c0.57,0.09,1.72,0.27,2.29,0.35l1.24,0.46c0.12-1.63,0.31-3.27,0.3-4.91c-0.29-1.27,0.12-2.87,1.7-2.85c1.17-0.31,2.33-0.63,3.5-0.96c-0.16-0.53-0.46-1.58-0.61-2.1c-0.42-1.05-0.16-1.91,0.76-2.6c1.85-1.74,3.41-3.76,5.09-5.66c2.13-2.35,5.27-3.21,8.07-4.51l0.62-0.31c1.1-0.64,2.26-1.21,3.49-1.58c1.25-0.46,2.52-0.97,3.57-1.83c0.51-0.9,1.27-1.43,2.28-1.59c2.35-0.65,4.6-1.6,6.83-2.58l-0.65-1.11c-0.6-0.83-0.87-1.75-0.81-2.76c-2.47-0.83-4.94-1.79-7.54-2.09c-1.18-0.02-2.34-0.27-3.43-0.68c-0.87-0.11-2.59-0.34-3.45-0.46c-1.18,0.08-2.35-0.12-3.47-0.479c-2.02-0.15-6.06-0.46-8.09-0.62c-1.35,0.04-4.07,0.11-5.43,0.14c-0.54,0.18-1.64,0.54-2.18,0.71c-0.62,0.89-1.44,1.311-2.48,1.271l-0.72,0.03c-4.64,0.31-9.27,0.63-13.89,1.02l-0.78,0.38c-2.28,1.27-4.54,2.55-6.82,3.82l-0.7,0.42c-0.93,0.689-1.95,1.24-3.04,1.6l-0.93,0.521c-0.83,0.83-1.72,1.02-2.7,0.56C184.92,35.785,186.99,38.645,189.96,40.495z M203.85,33.395l-1.02,0.57c2.36,1.12-1.66,3.47-1.3,0.83c-0.15-1.15-0.3-2.311-0.43-3.46C201.77,28.755,206.22,32.025,203.85,33.395z M204.82,54.435c-2.256-0.119-4.503-0.26-6.75-0.442c-0.075-1.56,0.615-2.036,2.07-1.438C201.7,53.195,203.26,53.815,204.82,54.435 M162.94,36.825c0.44,0.12,1.3,0.36,1.74,0.48c1.02-0.1,1.92,0.2,2.7,0.88c1.21,0.82,2.51,1.5,3.83,2.14c1.16,0.36,1.59,1.11,1.31,2.23c0.15-0.36,0.43-1.09,0.58-1.46c0.31-1.14,1.05-1.58,2.22-1.31c1.21,0.15,2.43,0.26,3.66,0.33c0.56,0.1,1.69,0.29,2.25,0.39c0.49,0.17,1.46,0.5,1.95,0.66c0.19-1.6,0.38-3.21,0.57-4.81l-0.66-0.3c-2.57-1.13-5.11-2.33-7.64-3.53l0.2,1.09c0.74,1.38-1.02,2.32-2.03,1.35c-1.1-0.49-2.23-0.92-3.38-1.28c-1.12-0.23-2.15-0.77-2.95-1.6c-0.99-0.82-1.99-1.62-3-2.4c-1.93,0.89-3.85,1.8-5.74,2.74c0.42,0.4,1.28,1.2,1.71,1.6C161.26,34.855,162.13,35.815,162.94,36.825 M146.08,43.795c0.74-1.05,1.6-2.01,2.57-2.86c0.47-0.47,1.42-1.42,1.89-1.89c-3.31-0.11-6.59-0.23-9.88-0.37c0.93,2.65,1.99,5.26,3.18,7.8C144.61,45.605,145.35,44.705,146.08,43.795 M126.03,51.835c2.62-0.65,5.14-1.52,7.75-2.24c-0.52,1.48-1.03,2.97-1.56,4.45c-0.15,0.4-0.43,1.2-0.57,1.6c1.2,0,2.12,1.06,2.04,2.24c0.42,0.14,1.27,0.42,1.7,0.56c2.78,0.89,5.5,1.98,8.13,3.25c0.76-0.15,2.27-0.46,3.03-0.62c0.85-0.58,1.77-0.78,2.78-0.58c3.31,0.26,6.48-1.06,9.3-2.65c0.95-0.74,1.82-0.69,2.61,0.13c0.27-1.58,0.55-3.16,0.84-4.74c-2.61-1.72-5.18-3.49-7.79-5.21l-0.6-0.39c-1.13-0.69-2.22-1.45-3.19-2.35c-0.19,0.48-0.57,1.45-0.76,1.93c-0.33,1.19-1.07,1.63-2.23,1.33l0.36,1.28c0.87,1.17-0.63,2.79-1.7,1.55c-2.62-1.55-5.39-2.82-7.95-4.47c-2.48-1.64-4.97-3.27-7.46-4.89c-2.52,0.64-4.88,1.82-6.94,3.4c-0.82,0.75-1.98,1.45-3.11,0.91c-0.15,1.61-0.31,3.23-0.47,4.84C122.14,51.535,124.08,52.215,126.03,51.835 M176.44,48.955l-0.4-1.49c-3.84,0.58-7.59,1.65-11.2,3.1c0.39,0.4,1.18,1.19,1.58,1.59c1.19,1.11,2.27,2.34,3.31,3.6c1.17,2.14,3.56,2.08,5.56,1.21c0.73-1.21,1.51-2.4,2.29-3.58c0.25-0.73,0.75-2.2,1-2.94C177.36,50.695,176.65,50.195,176.44,48.955 M320.03,350.335c-0.43-1.08-0.7-2.22-0.76-3.37c-0.96-1.18-2.23-2.02-3.43-2.9c-2.29-1.58-4.56-3.18-6.87-4.71c-6.17-1.83-12.18-4.11-18.19-6.42c-1.25-0.35-2.65-0.8-3.27-2.05c-1.73-2.42-2.9-5.17-3.72-8.02c-0.54-1.74-0.94-3.49-1.21-5.25l-0.97,0.03c-1.07,0.09-1.87-0.35-2.4-1.34c-0.73-0.86-1.54-1.63-2.44-2.3c-1.07-0.54-1.41-1.33-1.01-2.36c-2.81-0.28-5.71-0.37-8.45-0.97c-1.79-1.51-3.28-3.33-4.68-5.18l-0.42-0.53c-3.22-4.75-8.95-8.5-14.85-7.28c-1.59,0.11-3.24,0.24-4.77-0.29c-3.42-1.09-6.75-2.48-10.11-3.67c-0.86,0.83-1.69,1.68-2.5,2.55c-0.83,0.98-1.75,1.87-2.72,2.7c-0.92,1.06-1.58,2.3-2.16,3.57c-0.15,1.4-1.72,1.69-2.63,0.76c-0.61-0.01-1.82-0.05-2.43-0.07c-2.08,0.09-4.21-0.19-6.23-0.36l-1.3-0.14c-1.27-0.02-1.85-0.64-1.74-1.87c0.11-4.16,0.39-8.36-0.12-12.5c0.09-1.47-0.99-2.41-2.32-2.7c-1.12-0.2-2.19-0.59-3.16-1.18c-0.72-0.35-2.16-1.04-2.89-1.39c-0.38-0.2-1.15-0.59-1.53-0.78c0.19-2.24,0.58-6.7,0.77-8.94c0.17-1.35,0.45-2.68,0.71-4.01c-0.73-1.02-1.3-2.16-1.69-3.35c-1.41-0.13-2.82-0.25-4.22-0.37c-0.07,1.19-1.18,2.11-2.36,1.93c-0.49,1.16-0.96,2.32-1.44,3.49c-0.45,1.52-1.59,2.7-2.99,3.41l-1.12,0.7c-1.02,0.89-2.69,1.36-3.71,0.2l-0.8-0.63c-2.7-1.79-4.49-4.5-5.88-7.35l-0.46-0.82c-0.61-0.88-0.7-1.81-0.29-2.8c0.95-4.01,1.78-8.05,2.24-12.15c0.18-1.43,0.56-4.28,0.74-5.71c0.51-0.12,1.53-0.38,2.05-0.5c4.34-0.98,8.8-0.27,13.19,0.1c0.4-0.88,0.98-1.61,1.74-2.2l0.86-0.78c1.29-1.25,2.9-1.47,4.81-0.66c7.01,0.89,5.82,9.64,10.35,13.31c0.98,0.58,1.98,1.14,2.94,1.78c0.85-1.45,1.68-2.91,2.54-4.35c1.59,0.13,3.18,0.29,4.78,0.45c0.05-0.72,0.15-2.16,0.2-2.88c-0.68-0.6-1.31-1.25-1.89-1.93c-0.83,0.05-2.48,0.14-3.3,0.18c-1.15,0.15-1.85-0.36-2.12-1.52c-0.48-1.21-1.02-2.38-1.64-3.51c-0.69-0.84-0.86-1.76-0.52-2.75c0.45-1.72,0.81-3.47,1.39-5.14c1.92-3.29,5.11-5.51,7.9-8c3.73-2.83,5-7.82,4.94-12.3c-0.17-1.02,0.05-1.95,0.65-2.79l0.3-0.99c0.05-1.04,0.45-1.92,1.21-2.63l0.61-0.85c0.94-1.39,1.91-3.09,3.76-3.31c1.39-0.36,2.78-0.7,4.18-1.04c-0.01-1.86,0.26-3.64,0.82-5.35c1.01-1.68,1.96-3.64,3.86-4.47c3.43-1.92,5.49,2.56,7.97,4.13c0.34-0.5,1.02-1.48,1.37-1.97c0.63-1.18,1.73-1.96,2.9-2.55c3.53-1.93,5.72-5.48,8.29-8.44c-1.73-0.08-3.47-0.14-5.2-0.13l-0.69,0.42c-1.16,0.68-3.49,2.03-4.65,2.7c-0.18-2.73-0.37-5.46-0.56-8.19c-0.16-1.88-0.4-3.76-0.64-5.63c3.98-1.15,9.02,0.07,12.39-2.86c0.65-0.67,2.51-2.1,2.9-0.45c-0.49,1.17-1.38,1.52-2.67,1.07c-0.13,2.38-0.34,4.76-0.33,7.14c0.02,1.15,0.03,2.32-0.15,3.46c3.36,0.98,6.79,2.07,10.34,1.83c1.45-0.11,2.9-0.21,4.36-0.17c-0.22-1.62-0.53-3.23-0.93-4.81c-0.55-0.93-0.62-1.87-0.2-2.83l0.42-1.16c-0.98,0.56-1.86,0.39-2.64-0.5c-0.99-0.79-1.99-1.55-3.01-2.29c-0.17-1.03-0.34-2.06-0.5-3.09c-0.39-1.14,0.12-2.29,0.81-3.19c0.26-0.41,0.77-1.23,1.02-1.65c-1.23,0.19-1.89-0.34-1.99-1.58c-0.26-1.61-0.52-3.22-0.75-4.83c-2.32-1.69-4.63-3.4-6.9-5.15l-0.61-0.49c-3.13-2.6-3.67-6.84-5.2-10.39l-0.33-0.76c-0.79-1.49-1.58-2.99-2.33-4.5l-0.5-0.78c-0.93-0.52-1.46-1.3-1.59-2.33c-0.16-0.71-0.49-2.13-0.66-2.84c-1.89,1.68-3.82,3.34-5.9,4.78c-1.01,0.73-2.21,1.13-3.38,1.52c-1.21,0.35-1.87-0.14-1.99-1.5l-0.29-1.46c-0.38-1.91-0.65-3.83-0.82-5.76c-0.37-0.28-1.13-0.83-1.51-1.11c-1.97-1.44-3.84-2.99-5.77-4.47c-2.81-1.52-6.83-4.98-9.96-2.68c-0.82,0.99-1.68,1.98-2.81,2.63l-0.48,0.32c1.23,0.07,1.76,0.73,1.62,1.98c-0.02,0.59-0.05,1.77-0.06,2.36c0.13,1.22-0.43,2.32-1,3.34l-0.35,1.23c-0.16,1.45-0.48,4.34-0.64,5.78l1,1c1.06,0.86,1.74,2.08,2.08,3.4c0.2,0.55,0.61,1.65,0.82,2.19c1.07,0.76,1,2.28-0.25,2.81c-0.13,0.52-0.39,1.55-0.51,2.06c-0.09,1.05-0.61,1.82-1.56,2.3c-0.52,0.46-1.55,1.38-2.07,1.84c-0.63,0.99-1.46,1.32-2.5,0.98l0.86,0.89c0.84,0.72,1.08,1.61,0.72,2.68c-0.09,0.51-0.28,1.52-0.37,2.03c-0.33,1.91-0.66,3.83-0.99,5.75c-2.6-2.17-4.47-5.01-5.64-8.17c-0.67-1.56-1.46-3.12-2.87-4.13c-1.31-1.02-2.56-2.12-3.75-3.27c-0.49-0.36-1.47-1.1-1.96-1.46c-0.97-0.34-1.67-0.96-2.09-1.88l-0.54-0.47c-2.16-1.24-4.37-2.39-6.62-3.44c-0.56-0.03-1.68-0.09-2.24-0.11c-1.42,0.43-2.59-0.58-2.73-1.97c-0.45-1.25-1.33-2.26-2.19-3.23c-0.88-0.76-1.5-1.84-1.29-3.03c-0.02-1.82-0.05-5.44-0.07-7.25c-0.15-1.06,0.23-1.89,1.14-2.49l0.56-0.51c2.08-2.03,4.12-4.09,6.26-6.06l0.59-0.53c1.88-1.6,3.89-3.03,5.88-4.48c1.43,1.48,2.86,2.97,4.31,4.44l0.7,0.71c1.06-0.53,2.21-0.87,3.38-1.01l1.1-0.19c1.52-0.33,3.08-0.32,4.62-0.14c0.74,0.05,2.22,0.15,2.95,0.2l-0.47-0.85c-0.49-0.82-0.88-1.68-1.18-2.58c-0.52-1.42-1.36-2.96-2.95-3.34c-1-0.16-1.8-0.65-2.39-1.47c-0.5-0.38-1.5-1.13-2-1.5c-1.4-0.39-2.09-2.31-0.38-2.85l0.61-0.39c2.4-1.55,4.78-3.12,7.19-4.66c-0.09-4.37,0.03-8.75,0.43-13.1c2.47-0.39,4.87-0.71,7.4-0.95c0.1,0.38,0.31,1.15,0.41,1.53c1.18,3.42,0.01,6.92-1.29,10.1c1.73,0.26,3.47,0.5,5.22,0.74c0.88-1.42,1.76-2.84,2.67-4.25l0.23,0.87c0.51,1.48,1.12,2.93,1.68,4.4c0.69,1.19,0.26,2.77-0.95,3.44c-3.19,2.63-7,4.34-10.61,6.29c-0.06,1.3-0.11,2.59-0.15,3.89c0.44,0.16,1.32,0.48,1.77,0.64c1.19,0.31,1.61,1.06,1.26,2.23c0.65-0.32,1.95-0.96,2.6-1.28c0.96-0.65,2.12-0.99,3.28-0.73c0.8,0.05,2.39,0.16,3.19,0.22c1.14-0.03,1.85,0.52,2.14,1.66l0.45,1.03c0.65,1.35,1.3,2.72,1.68,4.19c1.31,0.26,2.63,0.5,3.96,0.72c1.19,0.04,2.25,0.59,3.16,1.33l0.74,0.45c0.98,0.37,1.64,1.04,1.98,2.03c0.37,0.03,1.09,0.08,1.45,0.1c0.5-0.24,1.49-0.72,1.98-0.96c2.45-2.4,3.93-6.04,3.27-9.47c-1.39-2.09-2.91-4.1-4.47-6.07c-0.79-0.84-1.51-1.74-2.15-2.69c-2.13-1.1-0.01-3.44,1.2-1.3c0.34,0.14,1.01,0.42,1.35,0.56c1.54,0.69,1.79,1.7,0.75,3.04l-0.41,0.53c0.32,0.09,0.97,0.28,1.29,0.38c1.87,0.56,3.75,1.08,5.64,1.59c0.72-2.99,2.35-6.14,1.49-9.25c-0.72-0.89-1.31-1.87-1.66-2.95c-0.62-1.77-2.39-2.69-4.08-3.14c-1.02-0.13-1.83-0.61-2.44-1.42l-0.71-0.38c-1.87-0.3-2.59-2.03-1.34-3.48c1.17-1.91-0.47-3.89-1.54-5.42c-1.67-1.75-3.41-3.44-5.21-5.05c-2.09-1.45-4.52-2.33-6.93-3.09c-1.18-0.17-2.16-0.89-2.66-1.97c-1.34-1.99-2.99-4.55-5.76-4.2c-2.88,0.07-5.78,0.27-8.64,0.4c-0.28-0.95-0.55-1.89-0.83-2.83c-0.39-1.31-0.78-2.61-1.16-3.91l-0.91-0.04c-2.99-0.08-6-0.26-8.97-0.41c-2-0.11-3.99-0.22-5.98-0.35c0.34,1.1-0.08,1.84-1.24,2.24c-1.83,0.94-4.07,2.22-3.44,4.67c0.01,1.39,0.02,4.16,0.02,5.55v1.65c1.32,0.73,2.41,1.8,3.37,2.95l0.52,0.57c1.78,1.89,3.5,3.83,5.19,5.8l0.59,0.65c1.18,0.65,1.15,2.14,0.08,2.89c-1.08,1.62-1.93,3.38-2.82,5.12c-0.47-1.42-0.98-2.82-1.55-4.2c-0.84-1.05-1.68-2.1-2.52-3.14c-0.92-0.63-1.84-1.25-2.78-1.84c-2.03-1.28-3.91-2.82-5.42-4.69c-2.34-3.72-1.01-8.14,0.93-11.74c0.48-1.26,1.53-2.16,2.48-3.08l0.52-0.86c0.54-1.3,1.06-2.61,1.71-3.87c-4.5-0.35-9.01-0.53-13.5-0.77c0.33,3.29,0.67,6.56,1.03,9.86c0.79,1.74,0.37,5.85-1.53,3.4c-0.52-1.8-0.85-3.64-1.27-5.46c-0.37-1.33-0.54-2.75-0.08-4.08l0.2-0.83c-0.66-0.63-1.99-1.91-2.66-2.55c-2.68,0.97-5.37,1.91-8.09,2.8l0.73,1.25c1.63,1.58-0.23,3.44-2.02,2.41l-1.4-0.29c0.14,0.55,0.43,1.66,0.58,2.21c-0.07,1.32,0.38,2.41,1.35,3.26c1.23,1.06,2.44,2.13,3.64,3.23c1.93,1.33,3.99,2.45,6.18,3.36c-0.18,1.2-0.54,3.58-0.71,4.77c-0.09,1.33-0.77,2.49-1.37,3.64l-0.21,0.75c-0.55,1.73,0.23,4.73-1.9,5.06c-1.77,0.26-3.56,0.39-5.34,0.51c-2.41,0.82-1.84-2.77,0.25-1.51c0.16-1.29,0.27-2.59,0.33-3.89c-0.13-1.01,0.12-1.93,0.74-2.73c0.44-0.86,1.32-2.56,1.76-3.41c-2.41-0.77-4.82-1.56-7.21-2.35c-1.07-2.78-2.1-5.6-3.54-8.21c-0.71-1.14-1.31-2.34-1.83-3.57l-0.57-0.93c-0.87-0.81-1.06-1.7-0.57-2.67c-0.56,0.26-1.67,0.78-2.23,1.04c-1.16,0.64-2.42,1.07-3.73,1.25c-1.56,0.32-3.11,0.71-4.59,1.3c-0.51,1.26-2.01,1.35-2.8,0.31c-2.05-1.15-4.24-2-6.39-2.95c-1.49-0.42-2.39-1.76-2.83-3.17c-0.23-0.56-0.7-1.7-0.93-2.26c-0.7,0.85-1.58,1.02-2.64,0.51c-1.57-0.41-3.16-0.66-4.78-0.73c-1.38,0-2.76-0.17-4.06-0.67c-0.98-0.31-2.96-0.92-3.95-1.23c-1.11,1.67-2.21,3.34-3.19,5.09c-0.72,1.52-1.22,3.19-1.16,4.88c0.21,1,0.05,1.94-0.47,2.82c-0.17,0.48-0.51,1.43-0.68,1.91c-0.27,0.49-0.81,1.46-1.08,1.94l1.45,0.17c1.57,0.01,2.94,0.84,4.11,1.83c0.55,0.42,1.66,1.25,2.22,1.67c1.45-0.74,2.97-1.35,4.45-2.03c0.44-0.29,1.34-0.87,1.78-1.16c1.21-1.49,3.39-1.11,3.28,1.04c0.46,1.97,0.93,3.95,1.64,5.86c0.63,1.68,1.31,3.35,1.98,5.02c-1.55-0.32-4.65-0.96-6.21-1.28l-0.78-0.17c-1.49-0.22-2.7-1.15-3.94-1.92c-0.65,0-1.94-0.01-2.59-0.02c-0.58,0.91-1.39,1.39-2.44,1.44l-1.09,0.13c-1.8,0.49-3.98,0.2-4.71-1.77c-0.67-1.09-1.33-2.17-1.98-3.26c-0.3,0.47-0.89,1.41-1.19,1.88c-0.39,0.38-1.19,1.15-1.59,1.53c-0.33-0.03-0.99-0.09-1.33-0.13c-2.13-0.22-4.28-0.26-6.43-0.32l-0.64,0.86c-0.67,1.22-1.97,1.87-3.33,1.92c-2.62,0.42-5.23,0.9-7.86,1.3c-1.76,0.58-3.34,0.42-4.74-0.49c-1.27-0.72-2.54-1.44-3.9-1.98c-2.91-0.98-5.88-1.77-8.84-2.56c-2.48-0.6-5.07-0.64-7.6-0.74c-1.11,0-3.32-0.01-4.43-0.01l-0.43-0.39c-1.47-1.27-3.03-2.67-4.99-3.07c-1.03,0-1.91-0.36-2.62-1.09l-0.8-0.55c-3.01-0.08-6.03-0.02-9.03,0.07c-1.48,0.5-2.85,1.26-4.15,2.11c-0.91,0.67-1.96,1.38-3.16,1.15l-1.17-0.04c0.47,1.06,0.17,1.87-0.9,2.45c-0.85,0.64-1.68,1.31-2.48,2.01c-2.47,2.23-4.9,4.51-7.38,6.72c-0.05,0.71-0.14,2.15-0.18,2.86c2.14,0.98,4.26,1.98,6.39,2.98c-0.13,0.68-0.38,2.04-0.5,2.72c-1.64,0.98-3.28,1.96-4.88,3l-0.68,0.47c-1.25,0.94-2.49,1.89-3.82,2.72c0.56,1.04,1.16,2.05,1.8,3.04c2.23,1.52,4.57,2.87,6.96,4.1c1.76-0.04,3.51-0.32,5.25-0.53c2.18-1.18,4.07,2.1,1.22,2.51c-1.65,0.48-3.32,0.83-4.99,1.19c-1.98,3.8-4.07,7.55-5.56,11.57c3.6,4.66,8.7,9.03,14.52,10.34c0.56,0.06,1.68,0.18,2.24,0.24c0.73,0.05,2.18,0.16,2.91,0.21l1.31,0.03c-1.57,2.04-3.23,4.03-4.96,5.95l-0.46,0.55c-0.79,1.03-1.75,1.94-2.9,2.57l-0.8,0.52c0.99-0.38,1.87-0.13,2.62,0.75l0.97,0.5c0.53,0.21,1.59,0.64,2.13,0.85l0.61,0.36c1.54-2.01,3.15-3.95,4.83-5.82l0.46-0.53c0.8-1.02,1.75-1.9,2.75-2.73l0.42-0.57c0.27-0.98,0.84-1.73,1.72-2.23c0.61-0.99,1.1-2.03,1.48-3.12c0.36-0.95,0.71-1.9,1.07-2.85c2.33,0.83,4.68,1.61,7.05,2.33c0.81-0.38,2.42-1.14,3.23-1.52c-0.14-0.51-0.41-1.52-0.55-2.03c-0.81-1.22,0.19-3.21,1.7-2.16c1.89,0.66,3.8,1.37,5.81,1.51c1.01-0.12,1.93,0.11,2.77,0.69c0.73,0.14,2.2,0.43,2.93,0.57c1.02-0.03,1.88,0.34,2.56,1.12c1.74,0.99,3.71,1.48,5.62,2.04c1.35,0.17,2.33,1.14,3.14,2.16c0.72,0.89,1.59,1.59,2.6,2.11c1.67,0.69,3.31,1.46,4.91,2.32l0.78,0.43c0.98,0.43,1.54,1.18,1.69,2.27l0.34,0.91c0.85,0.58,1.37,1.36,1.57,2.37l0.29,0.73c0.92,0.44,1.53,1.15,1.83,2.13l0.33,0.64c2.2,3.86,5.06,7.42,6.47,11.69c0.37,2.61,0.62,5.25,0.75,7.9c1.43,0.72,2.69,1.74,3.72,2.98c0.45,0.51,1.34,1.54,1.79,2.06c1.46,3.03,1.53,6.45,1.91,9.74l0.06,0.87c0.08,3.9-0.08,7.8-0.12,11.7c0.09,4.67-0.44,9.82,2.34,13.86c0.78,1.11,1.41,2.32,1.83,3.63l0.4,0.96c0.6,1.22,1.06,2.52,1.24,3.88c0.04,4.18,2.96,7.21,7.13,7.43c1.13,0.12,1.74,0.75,1.84,1.9c0.43,2.14,1.01,4.33,2.3,6.13c0.7,0.73,1.06,1.61,1.06,2.63c0.87,1.88,2.33,3.39,3.62,4.99c1.05,0.95,1.24,2.41,1.2,3.76c0,2.61,0.3,5.51,2.48,7.27c0.98,0.86,1.85,1.85,2.56,2.95c0.43,0.5,1.28,1.51,1.7,2.01c1.21,1.09,2.4,2.19,3.54,3.35c0.48,0.44,1.44,1.33,1.92,1.77c-0.01-1.13-0.07-2.25-0.19-3.37c-0.89-0.56-1.35-1.35-1.4-2.36c-0.25-1.72-0.61-3.42-0.93-5.11c-0.27-1.41-0.52-2.82-0.77-4.23c0.95,1.41,1.9,2.82,2.84,4.24c0.57,0.9,1.21,1.76,1.91,2.57c0.82,0.6,1.29,1.42,1.42,2.43l0.23,0.76c0.96,0.37,1.64,1.03,2.05,1.98l0.51,0.72c0.78,1.01,1.8,2.07,1.67,3.46c0.07,1.77,0.19,5.29,0.25,7.05c1.55,1.72,3.06,3.47,4.5,5.29l0.77-0.12c1.19-0.4,2.27,0.37,3.06,1.18c1.23,1.09,2.66,1.95,4.21,2.52c1.14,0.2,1.75,0.85,1.83,1.95c0.03,0.23,0.09,0.7,0.11,0.93c3.98,0.29,7.94,0.73,11.89,1.31c2.31,1.2,4.04,3.26,6.36,4.46c1.13,0.17,2.28,0.46,3.2,1.2c2.2,1.37,4.42,2.7,6.52,4.23c1.07,0.54,1.59,1.65,1.94,2.75l0.35,0.77c0.82,0.6,1.31,1.4,1.48,2.41c0.47,1.4,1.42,2.63,2.56,3.56c3.62,1.77,7.67,2.93,11.7,2.06c0.65,0.53,1.31,1.07,1.97,1.61c0.89,0.61,1.22,1.47,1,2.58c0.02,0.95,0.05,2.85,0.07,3.8c0.07,0.97,0.2,2.91,0.27,3.88l-0.47,0.43l-0.81,0.82c-1.12,1.29-2.29,2.53-3.47,3.76c-0.92,1.14-1.57,2.54-1.78,4c0.07,1.02-0.21,1.93-0.86,2.72c0.07,0.51,0.21,1.54,0.29,2.05c0.58,0.86,0.76,1.8,0.53,2.81c-0.06,0.58-0.19,1.75-0.25,2.33c0,1.35-0.42,2.65-0.99,3.87c-3.28,4.89,0.22,10.28,4.09,13.3c0.87,0.59,1.3,1.43,1.29,2.51l0.21,0.99c0.55,0.86,0.74,1.8,0.57,2.82c-0.08,1.57,0.61,3.05,1.41,4.37c0.74,1.11,1.33,2.32,1.76,3.59c0.22,0.46,0.66,1.37,0.88,1.83c1,1.31,1.99,2.63,2.89,4.02c0.6,0.88,1.28,1.69,2.05,2.43c2.23,1.97,4.52,3.84,6.84,5.71l0.82,0.58c0.26,0.18,0.79,0.54,1.05,0.72c-0.06,0.89-0.16,2.66-0.22,3.55c-0.12,2.02-0.36,6.06-0.48,8.08c-0.12,1.19-0.36,3.56-0.48,4.74c-0.21,1.66-0.35,3.34-0.42,5.02c0.07,1.17-0.16,2.33-0.58,3.43c-0.36,1.29-0.57,2.61-0.65,3.95c-0.52,7.56-0.05,15.36-2.29,22.68c-0.4,1.31-0.83,2.61-1.12,3.96c-0.08,1.01-0.49,1.86-1.25,2.54l-0.54,0.76c-0.29,6.19-0.28,12.4-0.39,18.62c0.01,2.93,0.4,5.85,0.73,8.77c0.19,1.04-0.13,1.9-0.98,2.61l-0.66,0.85c-0.53,1.09-1.32,1.45-2.38,1.07c0.65,2.08,1.4,4.14,1.89,6.28c0.64,3.28,0.71,6.58,0.98,9.93c0.15,2.62,0.29,5.26,0.4,7.91c0.89,0.75,1.78,1.51,2.67,2.28c2.52,2.16,4.89,4.47,7.35,6.71c3.25,2.62,7.76,0.42,11.53,0.34c-0.84-0.93-1.7-1.83-2.57-2.7c-0.99-0.88-1.81-1.92-2.51-3.02l-0.5-0.65c-0.87-0.56-1.4-1.34-1.58-2.34c-0.35-1.06-0.73-2.11-1.16-3.13c-0.54-1.31-1.08-2.61-1.61-3.91c0.82-0.91,1.65-1.8,2.46-2.71c2.79-3.28,5.16-7.31,5.64-11.61c-0.45-0.81-0.87-1.63-1.25-2.45c-0.59-1.18-1.23-2.32-1.84-3.47c1.52-1.89,3.13-3.7,4.71-5.54c1.06-1.29,1.89-2.75,2.6-4.25c1.08-2.38,2.16-4.75,3.27-7.11l0.33-0.74c0.52-1.36,1.29-2.76,2.75-3.27c0.51-0.26,1.53-0.79,2.04-1.05c2.54-1.33,5.07-2.68,7.52-4.15c0.69-2.65,0.41-5.4,0.36-8.09c2.11-1.02,4.38-1.89,6.13-3.5c0.87-0.96,1.81-1.84,2.83-2.64c1.96-1.62,2.4-4.29,2.74-6.66c0.04-1.07,0.56-1.83,1.56-2.27l0.61-0.45c0.57-0.84,1.34-1.37,2.34-1.57c1.67-1.77,2-4.3,2.48-6.58c0.51-2.74,0.96-5.53,1.55-8.23l0.14-0.59c0.38-1.78,2.18-2.65,3.49-3.67l0.84-0.63c1-0.87,2.12-1.64,3.42-1.98c1.65-0.61,3.34-1.18,4.9-2.02c0.92-1.1,1.88-2.18,2.89-3.2c1.86-1.98,3.01-4.53,3.57-7.16c0.23-1.3,0.65-2.56,1.14-3.78c1.35-4.8,0.75-9.98,2.15-14.75c0.97-1.95,2.17-3.77,3.39-5.58C318.94,360.125,320.97,355.295,320.03,350.335z M201.62,108.035c1.3-1.03,2.87,1.21,1.56,2.15C201.86,111.255,200.3,108.975,201.62,108.035z M160.23,91.855l-1.2,0.51c-2.9,2.15-6.3,3.57-9.96,3.77l0.76-0.25c-2.64,0.37-5.3,0.58-7.97,0.64c-2.68-0.07-1.45-5.11,1.01-3.92c2.06-0.02,4.12-0.03,6.19-0.08c3.98-1.16,8.33-2.5,12.34-0.78L160.23,91.855 M220.38,271.435c1.05-0.17,1.87,0.23,2.46,1.2l0.57,0.55c3.09,2.48,6.34,4.75,9.63,6.97c3.54,0.04,7-0.77,10.46-1.43c0-1.01,0.01-3.04,0.01-4.06c-0.29,0.02-0.89,0.05-1.18,0.07c-1.05,0.11-1.86-0.32-2.43-1.27c-0.5-0.45-1.51-1.37-2.02-1.82c-1.31-0.98-2.58-2.01-3.76-3.12c-0.88-0.78-1.76-1.53-2.66-2.26l-0.34,1.07c-0.08,2.57-2.4,2.54-3.98,1.18l-0.85-0.41c-0.98-0.33-1.68-0.96-2.1-1.91c-0.72-0.78-1.55-1.41-2.49-1.9c-2.11-1-4.26-1.93-6.44-2.74c-1.16-0.25-2.31-0.19-3.43,0.16c-2.3,0.78-4.55,1.68-6.82,2.49c0.46,1.39,0.93,2.79,1.4,4.18c3.95-0.84,8.1-1.22,11.75,0.89c1.19,0.34,1.6,1.09,1.23,2.26L220.38,271.435z'/></svg>"],["sub_saharan_africa","Sub-Saharan Africa","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='sub_saharan_africa' d='M488.08,345.035c5.11-10.88,14.33-19.02,20.83-28.98c3.28-6.75,5.42-14.26,5.12-21.82c-4.56,1.59-9.14,3.19-13.67,4.84c-1.21,0.87-2.79,0.27-3.09-1.19l-0.48-0.92c-1.47-2.71-2.98-5.4-4.4-8.13c-4.72-7.55-8.46-15.7-11.36-24.12c-6.5-0.32-12.99-1.01-19.5-0.67c-3.83,1.29-6.55,4.65-10.11,6.5c-5.98-1.5-10.87-5.94-16.83-7.39c-11.42-0.79-19.79,8.42-28.23,14.57c-6.29-6.06-12.33-12.36-18.54-18.5c-1.77-1.59-3.57-3.15-5.43-4.62c-4.34-2.86-9.65-3.57-14.65-4.58c-5.4,4.16-7.36,11.61-9.44,17.91c0.35,8.3,0.43,16.66-1.15,24.89c1.67,0.73,3.35,1.49,5.09,2.06c1.04,0.24,2.42,0.78,2.33,2.1c0.89,6.5,1.7,13.87,7.64,17.84c2.9,4.07,9.61,6.35,13.61,2.58c0.89-1.13,2.41-1.25,3.58-0.46c5.3,2.98,10.55-1.13,15.91-1.18c4.74,1.87,8.9,4.86,13.16,7.6c-0.62,4.54-1.44,9.09-1.16,13.7c2.11,5.98,8.03,10.05,9.24,16.42c2.56,8.84-1.93,17.43-2.92,26.09c-0.65,8.14,3.8,15.16,6.28,22.58c0.52,1.8,0.77,3.67,0.76,5.63c-0.33,7.45,3.61,13.84,5.72,20.7c0.43,4.23,3.12,7.44,5.54,10.67c5.88-2.56,13.43-1.47,18.23-6c0.35-0.95,0.99-1.63,1.92-2.04c5.03-4.33,8.65-10.45,10.18-16.92c0.91-3.6,3.23-6.52,5.33-9.49c3.47-5.2-0.62-11.99,2.91-17.22c2.82-4.1,7.5-6.21,11.65-8.73C490.87,367.495,486.8,356.435,488.08,345.035 M511.44,359.355c-1.12,0.4-2.23,0.81-3.34,1.22c2,8.17-7.02,12.62-10.6,18.7c-1.28,6.86-2.24,13.9-2.13,20.91c0.09,1.22,0.14,2.44,0.17,3.67c-0.27,1.6,0.69,3.59,2.54,3.48c0.97-0.01,1.95,0.05,2.93,0.16c1.47,0.12,2.95,0.22,4.44,0.31c2.46-9.41,4.82-18.85,7.04-28.32c1.41-5.41-1.91-11.14,0.56-16.4C512.51,361.835,511.97,360.595,511.44,359.355z'/></svg>"],["east_asia_pacific","East Asia & Pacific","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='east_asia_pacific' d='M673.78,359.585c1.46,1.17,2.93,2.37,4.62,3.23c2.09-2.16,4.08-4.44,5.93-6.82c-8.72,2.34-16.34-5.53-25.18-1.45c-1.03,0.4-1.94,0.24-2.73-0.46c-4.84-4.17-10.66-6.75-17.2-6.55c-1.27-0.05-1.79-0.68-1.57-1.9c0.17-1.64,0.37-3.28,0.48-4.91c0.03-1.18,0.1-2.34,0.2-3.5c-1.12-1.44-2.53-2.6-3.85-3.81c-1.09-6.14-1.85-12.37-3.76-18.33c-1.72-3.65-5.16-6.21-6.8-9.9c-0.54-3.21,0.4-6.45,0.62-9.65c4.63,2.68,7.54,7.26,10.73,11.39c3.93-2.52,7.66-5.55,10.13-9.58c0.92-6.9-2.27-13.36-5.55-19.17c-1.79-2.71-0.06-5.83,0.57-8.6c1.45,0,2.91,0,4.37,0.01c-1.13,2.28-2.32,4.52-3.45,6.79c1.75,1.14,3.52,2.28,5.3,3.41c2.72-4.47,3.4-10.99,8.99-12.92c5.66-1.83,11.2-5.22,12.78-11.45c0.19-1.01,0.74-1.76,1.65-2.26c2.63-2.21,3.59-5.83,3.45-9.15c-0.05-1-0.05-1.99,0.01-2.97c0.36-5.74-2.52-10.9-4.7-16.01c2.42-2.33,4.68-4.82,6.89-7.34c-1.89-0.71-3.8-1.39-5.69-2.07c2.26-1.55,4.64-2.92,6.99-4.34c2.78,5.42,4.8,11.15,6.72,16.92c2.27-1.04,4.51-2.18,6.7-3.41c-1.55-7.61,0.35-15.09,1.16-22.61c0.2-3.31,0.58-6.58,1.13-9.83c1.93-2.68,4.22-5.09,6.48-7.51c-5.43-1.11-9.5-5.07-13.27-8.84c-3.16-3.51-3.2-8.54-4.13-12.93c-2.61-0.44-5.08-0.84-7.64-1.26c-2.02,4.14-2.97,9.41-6.5,12.45c-7.78,0.26-15.41,1.65-23.11,2.61c-7.94-2.57-15.44-6.53-23.21-9.66c-0.96,2.69-1.6,5.48-2.53,8.19c-5.15-1.23-10.96-3.49-16.05-0.7c-6.92,3.8-12.21,9.89-17.81,15.33c-4.57,3.74-2.78,10.8-7.27,14.61c-2.84,3.03-7.1,4.04-10.66,5.8c0.78,2.66,1.56,5.35,2.66,7.9c3.58,6.07,10.11,11.34,9.06,19.04c1.46,0.12,2.04,0.91,1.74,2.36c1.68,0.49,3.34,1.04,5,1.62c1.47,0.32,2.05,1.18,1.75,2.57c3.69,1.22,7.36,2.51,11.14,3.41c0.09-1.88,2.77-2.14,3.26-0.34c5.16-1.63,10.4-3.01,15.74-3.96c-0.39,10.36-6.57,18.96-10.55,28.14c-0.57,3.1,1.76,5.75,3.84,7.74c1.24,0.74,1.48,2.33,0.57,3.44c-0.34,0.73-1.04,2.2-1.38,2.93c2.27-0.22,4.55-0.47,6.83-0.72c1.46,4.8,3.78,9.65,2.78,14.77c-1.06,6.75,2.27,12.96,4.23,19.18c-3.76-1.78-7.58-3.45-11.61-4.52c0.85,3.8,1.4,7.78,3.87,10.94c6.44,9.51,11.34,20.71,21.1,27.36c1.07,0.44,1.51,1.21,1.33,2.3c-0.06,0.47-0.17,1.4-0.23,1.87c1.86-0.17,3.72-0.34,5.6-0.5c1.8-0.41,3.47,0.45,5.02,1.27c6.09,1.79,12.33,3.25,18.58,4.49C669.74,362.315,671.77,360.595,673.78,359.585 M691.93,240.635c1.09-0.46,2.19-0.91,3.31-1.35c0.229-1.49,0.479-2.96,0.74-4.44c0.14-1.11,0.81-1.68,2.01-1.69c6.03-1.36,11.64-4.12,17.6-5.75c1.32-5.8,3.39-11.49,3.68-17.47c-0.03-1,0.07-1.98,0.3-2.95c0.21-1.17,0.43-2.33,0.66-3.49c3.38-2.03,5.46-5.39,6.98-8.93c-2.29-1.45-4.49-3.07-6.96-4.2c-0.58-0.22-1.74-0.65-2.32-0.87c-2.2,5.1-7.26,10.67-3.86,16.32c0.82,1.06,1.22,2.59,0.17,3.67c-2.01,4.77-6.88,6.98-10.1,10.75c-4.21,4.14-9.85,6.39-14.81,9.44C690.25,233.325,691.12,236.955,691.93,240.635 M672.63,254.455c-4.63,3.53-5.19,9.39-3.15,14.67c2.53-0.86,3.6-3.21,3.04-5.76c-0.23-1-0.06-1.93,0.5-2.79C673.27,258.525,672.84,256.475,672.63,254.455 M684.31,305.865c-1.21-2.6-4.32-3.46-6.51-4.89c-0.41-1.04-0.82-2.07-1.22-3.1c0.61,0.07,1.84,0.22,2.45,0.29c1.17,0.01,1.81,0.6,1.91,1.77l0.11,0.62c-0.18-6.63-5.98-11.05-6.71-17.51c-0.29-0.97-0.33-1.95-0.1-2.94c0.12-1.02,0.37-3.08,0.49-4.11c-2.31,0.86-4.56,1.83-6.77,2.89c1.53-0.78,1.98,1.32,1.05,2.18c-2.58,4.38,0.16,9.5,1.25,13.88c1.79,5.69,2.71,11.61,3.67,17.47c2.35,1.86,5.14,3.06,7.74,4.54C683.42,313.545,685.43,309.925,684.31,305.865 M667.62,296.795c-3.66,2.94-7.17,6.78-7.05,11.79c1.01-0.04,3.03-0.11,4.04-0.14C665.91,304.645,667.07,300.785,667.62,296.795 M770.41,322.895c-0.63,0.21-1.9,0.62-2.53,0.82c2.58,3.25,5.3,6.39,7.44,9.97c1.87-3,5.92-6.7,2.96-10.29c-0.68-0.78-0.98-1.67-0.89-2.69c-0.27-2.58-1.59-4.87-2.62-7.19c-2.53,0.54-5.05,1.13-7.6,1.51c0.02-1.65,0.04-3.31,0.02-4.95c0.14-0.55,0.42-1.65,0.56-2.2c-0.81-0.11-2.43-0.32-3.24-0.43c-0.05,4.21-0.07,8.42-0.08,12.64c2.34,0.16,4.68,0.02,7.03,0.17C773.84,320.375,771.94,323.065,770.41,322.895 M651.81,319.775c-2.78,3-6.91,4.45-9.38,7.72c-1.84,2.22,0.1,4.87,0.92,7.09c2.32,4.22,4.22,11.11,10.73,9.48c4.49,1.37,7.38-2.16,10.35-4.63c0.79,3.51,1.47,7.03,2.24,10.56c2.42-1.41,5.85-2.03,7.44-4.36c-0.31-8.07,5.5-14.08,7.37-21.54c-3.15,0.98-6.43,1.8-9.61,2.57c-1.14-0.18-3.43-0.54-4.58-0.72c-0.46-0.16-1.37-0.48-1.83-0.65c0.87-3.49,1.63-7.03,1.88-10.63c-1.52-1.11-4.58-3.35-6.1-4.47C657.38,312.615,655.24,316.865,651.81,319.775 M716.22,314.735c-0.7,2.41-1.53,4.75-2.14,7.19c2.21-0.34,4.45-0.56,6.7-0.62c2.33-0.21,4.66-0.43,6.99-0.69c0.86-0.11,1.75-0.23,2.64-0.35c2.13,3.19,4.69,6.06,7.35,8.83c0.61-5.42-2.51-10.07-5.11-14.5C727.25,315.965,721.66,315.605,716.22,314.735 M745.38,325.445c0.99-0.68,1.98-1.36,2.99-2.03c0.01-0.85,0.05-2.55,0.07-3.39c-1.24,0.36-2.47,0.74-3.68,1.14c-0.55,0.02-1.66,0.04-2.21,0.06c0.06,0.83,0.18,2.51,0.24,3.34C743.76,324.505,744.63,324.795,745.38,325.445 M754.89,329.085c1.41-1.37,2.81-2.76,4.18-4.18c-1.57-0.18-3.14-0.35-4.69-0.51C754.54,325.955,754.71,327.515,754.89,329.085 M784,335.575c0.54,0.85,0.73,1.78,0.55,2.79c0.04,4.68,0.6,11.77,6.25,13.2c1.24,0.42,2.42,1.11,3.15,2.25l0.54,0.66c-0.1-4.59-3.38-7.58-5.36-11.28c-1.65-5.98,0.69-13.84-5.5-17.62C783.7,328.915,783.47,332.245,784,335.575 M738.22,351.265c2.28-1.87,2.94-4.92,3.98-7.54c-3.94,1.24-7.93,2.31-12,3c-2.32-3.02-4.71-6.29-8.55-7.44c-4.96-2.08-10.62-5.53-16.02-2.74c-3.32-3.38-7.52-5.99-12.54-5.71c0.63,4.98,1.42,10.02,3.73,14.54l1.31-0.02c1.86-0.06,3.72,0.2,5.58,0.77c1.35,0.38,2.71,0.78,4.08,1.2c0.16,3.48,0.17,6.98-0.01,10.46c5.79,1.61,12.23,3.66,17.67-0.04c3.17,3.67,7.41,5.98,12.14,7.12c0.23-1.55,0.71-4.65,0.94-6.19c-2.38-1.46-4.77-2.91-7.15-4.37c0.24-0.97,0.5-1.92,0.77-2.88C734.16,351.565,736.26,351.985,738.22,351.265 M747.51,336.595c1.25-0.08,2.51-0.15,3.77-0.21c0.43-1.03,0.86-2.05,1.31-3.06c-1.69-0.35-3.38-0.7-5.05-1.06C747.53,333.705,747.52,335.145,747.51,336.595 M740.72,357.255c3.73,5.23,7.87,12.81,15.28,12.14c-0.18-0.56-0.54-1.67-0.72-2.22C755.01,360.005,746.17,358.795,740.72,357.255 M732.82,389.945c-3.18-4.36-3.65-9.92-6.24-14.55c-2.65-4.47-3.5-10.4-8.64-12.82c-1.37,5.26-2.32,10.61-3.11,16c0.24,1.43-1.62,2.05-2.38,0.88c-3.72-2.13-5.71-5.84-5.91-10.22c-0.44-1.1-0.59-2.38,0.05-3.43l0.46-1.11c-3.66-0.73-7.43-1.31-11.17-0.83c-4.22,1.41-5.51,6.3-7.89,9.56c-1.01-1.29-2-2.6-2.96-3.91c-4.9,4.1-13.1,6.94-12.4,14.59c-0.05,1.28-0.33,2.89-1.77,3.29c-5.3,2.55-10.89,4.52-15.89,7.66c-1.5,0.99-2.58,2.57-2.64,4.42c-1.65,13.09,5.13,25.3,5.65,38.3c1.33-0.09,2.68-0.18,4.03-0.28c0.97-0.11,1.96-0.14,2.96-0.08c9.6-0.06,17.45-6.79,26.521-8.85c4.88-1.58,8,2.36,10.39,5.67c2.44,3.52,6.3,5.52,9.75,7.89c1.16,3,1.44,6.91,4.12,9.14c3.58,0.61,7.22-0.03,10.8-0.46c3.5-0.72,8.19-0.65,10.47-4.02c0.55-1.06,1.34-1.39,2.38-0.98c-0.11-7.39,2.05-14.43,5.78-20.78c0.08-0.56,0.23-1.68,0.31-2.24c0.56-5.14-0.03-10.4-0.92-15.45C742.11,400.645,735.92,396.295,732.82,389.945 M774.13,387.045c-2.23-1.19-4.52-2.24-6.85-3.19c0.84,6.64,1.34,13.59,4.35,19.7C777.2,399.325,771.4,392.495,774.13,387.045 M794.97,401.925c-2.66,2.09,1.33,2.19,2.9,2.5c0.57,0.02,1.71,0.05,2.27,0.07c2.72-0.38,3.11-4.32,4.28-6.4c-2.6,0.35-5.12,0.95-7.56,1.79C796.5,400.815,795.87,401.495,794.97,401.925 M813.64,398.695c-2.08,2.31-3.9,4.88-5.24,7.7c-1.62,2.94,1.29,5.67,2.64,8.08c1.5-3.68,3.25-7.48,3.15-11.53C813.98,401.525,813.75,400.115,813.64,398.695 M788.49,435.135c1.1,4.84,3.229,9.63,2.34,14.71c-1.56,4.38-5.11,7.65-7.52,11.56c-2.55,4.47-7.13,7.01-11.11,9.98c0.12,4.16,2.72,9.01,7.91,6.7c3.73,0.13,5.64-3.56,5.23-6.87c-0.18-1.11,0.19-1.94,1.1-2.52c7.36-4.71,12.74-12.19,14.63-20.71c0.09-0.96,0.33-1.89,0.71-2.76C795.11,445.265,792.08,439.535,788.49,435.135 M723.63,455.055c1,4.84,2.04,9.71,3.71,14.37c5.46-2.19,8.23-7.54,7.8-13.37C731.27,456.055,727.42,455.755,723.63,455.055z'/></svg>"],["south_asia","South Asia","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='south_asia' d='M601.63,246.995c-1.07,0.51-2.16,0.62-3.26,0.34c-3.78-0.9-7.45-2.19-11.14-3.41c-1.28-0.34-1.86-1.2-1.75-2.57c-1.66-0.58-3.32-1.13-5-1.62c-1.29-0.26-1.88-1.04-1.74-2.36c1.05-7.7-5.48-12.97-9.06-19.04c-3.8,0.06-7.53,0.15-11.31,0.2c-0.73-0.14-2.2-0.42-2.94-0.56c-6.29,1.78-12.33,4.28-18.51,6.36c-3.12,8.02,0.28,16.11,2.42,23.86c2.17,4.11-1.04,7.46-2.88,10.72c3.76,0.44,7.52,0.82,11.31,1.26c3.44,5.13,8.18,9.16,12.36,13.65c2.5,5.67,2.57,12.13,5.07,17.83c2.35,5.49,3.82,11.29,5.51,17.01c1.95-0.71,3.89-1.43,5.83-2.16c0.76,2.94,1.48,5.9,2.28,8.86c1.94-0.91,3.93-1.79,5.63-3.12c0.2-5.39-4.38-9.48-4.46-14.8c-0.021-4.48-1.46-9.7,2.32-13.11c4.66-5.32,9.59-10.53,15.38-14.64c3.07,0.03,6.11,0.85,9.13,1.48c3.98-9.18,10.16-17.78,10.55-28.14C612.03,243.985,606.79,245.365,601.63,246.99 M591.761,303.9c0,6.72,0.83,13.56-0.69,20.19c1.29,0.4,2.56,0.81,3.87,1.2c3.3-6.65,2.56-14.28,0.82-21.29C594.421,303.96,593.091,303.93,591.761,303.9z'/></svg>"],["middle_east_north_africa","Middle East & North Africa","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='middle_east_north_africa' d='M539.34,248.195c-2.14-7.75-5.54-15.84-2.42-23.86c-2.55-2.9-4.72-6.23-7.82-8.55c-3.76,0.07-7.32,1.15-10.88,2.17c-3.09-0.28-5.96-1.47-8.81-2.57c-3.41-1.2-6.9-2.16-10.37-3.16c-0.29,1.63-0.88,4.87-1.17,6.5c-5.93,0.71-11.98,0.86-17.75,2.52c-2.52,0.6-2.94,3.38-3.46,5.49c-0.93,3.22-1.05,7.96-4.96,9.05c-8.68,2.12-17.59-0.32-25.24-4.46c-2.21,2.25-4.4,4.52-6.57,6.8c-4.71-2.71-9.39-5.47-14.02-8.3c-1.19-3.9-1.29-8.46-3.94-11.78c-3.08-2.15-7.27-0.19-10.57-0.3c-8.18,0.62-16.06,2.8-24.04,4.54c-1.61,0.37-3.24,0.7-4.85,1.04c-3.75,5.03-8.11,9.99-8.7,16.54c-0.25,3.94-4.05,5.46-7.03,7.06c-0.11,0.71-0.32,2.14-0.42,2.85c0.35,0.06,1.06,0.18,1.42,0.25c5,1.01,10.31,1.72,14.65,4.58c1.96,1.35,3.73,2.96,5.43,4.62c6.21,6.14,12.25,12.44,18.54,18.5c8.44-6.15,16.81-15.36,28.23-14.57c5.96,1.45,10.85,5.89,16.83,7.39c3.56-1.85,6.28-5.21,10.11-6.5c6.51-0.34,13,0.35,19.5,0.67c-1.49-4.16-3.04-8.29-4.39-12.49c7.47,11.08,12.24,23.78,15.75,36.61c1.42,2.73,2.93,5.42,4.4,8.13c9.35-5.37,19.76-9.02,27.99-16.19c3.55-4.15,6.63-8.67,9.82-13.09c-2.02-3.28-3.91-6.63-5.5-10.14c2.46,0.42,4.91,0.88,7.36,1.37C538.3,255.655,541.51,252.305,539.34,248.195z M514.19,255.825c-2.91-3.79-4.66-8.33-5.75-12.95c4.8,4.17,9.01,9.01,12.95,14C519.02,256.865,515.88,258.145,514.19,255.825z'/></svg>"],["europe_central_asia","Europe & Central Asia","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='europe_central_asia' d='M527.62,81.815c-1.81-4.6-3.69-9.97-0.39-14.54c5.21-8.59,15.11-11.99,24.07-15.18c3.03-0.96,3.76-4.4,5-6.91c-7.53-0.09-14.66,2.35-21.78,4.44c-3.29,1.39-7.55,2.13-9.06,5.83c-4.25,6.76-8.13,13.75-12.72,20.29C515.48,81.435,521.66,83.515,527.62,81.815 M341.44,55.475c2.64-5.77,2.33-12.32,3.2-18.47c2.12-5.6,7.66-8.51,12.64-11.14c-2.48-4.16-7.41-4.5-11.73-5.39c-1.93-4.7-5.32-9.04-10.31-10.7c-6.87-3.27-14.33,0.62-21.45-1.67c-0.25,1.23-0.74,3.68-0.99,4.91c-9.18-5.71-20.98-4.25-30.18,0.55c-2.57,2.44-4.15,5.811-7.13,7.86c-0.84,0.83-1.73,0.88-2.67,0.14l-1-0.64c0.11,2.5,0.33,7.51,0.44,10.01c2.76,5.82,9.96,5.83,15.44,6.91c1.62,8.65,2.63,17.41,3.47,26.16c-0.36,4.92-3.41,9.54-2.26,14.57c0.59,0.83,0.8,1.76,0.63,2.77c-1.49,7.83,3.9,13.85,10.46,16.91c2.5-5.38,5.09-10.73,7.75-16.03c6.5-1.83,12.02-5.88,18.47-7.86c3.54-1.57,8.57-2.06,9.74-6.47c1.76-4-1.85-7.38-4.19-10.16C334.89,56.945,339.65,58.825,341.44,55.475 M782.56,84.155c-0.47,1.66-0.93,3.31-1.37,4.97c-7.42-4.41-16.63-3.57-24.01-8.03c-3.6-1.87-8.34-4.57-11.86-1.13c-0.67,1.11-2.27,1.19-2.73-0.14c-1.93-2.52-4.26-4.72-6.5-6.93c-2.9-1.18-6.16-0.08-9.1-1.11c-2.08-0.67-4.09-1.6-6.23-2.06c-1.22-0.07-2.43-0.15-3.63-0.26c-3.82-0.47-6.46,2.71-8.73,5.25c-0.65,0.86-1.51,1.19-2.58,0.99c-5.28-0.07-10.45,1.31-15.52,2.62c-1.25-3.96-2.14-8.02-3.06-12.05c-3.4-0.93-6.9-1.53-10.4-1.78c-1.15,1.67-2.18,3.45-3.67,4.83c-7.39-2.12-14.71-4.59-22.08-6.8c4.31-4.31,3.24-10.23,1.69-15.56c-4.26-1.08-9.13-0.43-12.88-3.02c-2.73-1.15-5.55-4.33-8.78-2.89c-4.63,1.89-7.72,6.08-11.67,8.99c-0.94,1.22-2.53,0.86-3.63,0.13c-3.57-2.12-7.39,0.33-10.92,1.18c-3.15,1.06-6.58,1.43-9.43,3.17c-1.81,2.24-2.25,5.26-3.29,7.9c-3.35,0.92-6.69,1.79-9.97,2.88c-1.07,0.46-2.38,0.73-3.38-0.02c0.26,1.85,0.56,3.69,0.9,5.52c-1.38,0.87-2.76,1.75-4.07,2.7c-1.01,1.03-2.92,1.68-3.77,0.1c-1.22-1.48-2.42-2.97-3.62-4.46c-1.52,1.45-3,2.93-4.49,4.39c-0.29-1.5-0.56-3-0.83-4.5l-0.86,0.32c-0.58,0.08-1.73,0.23-2.3,0.31c-0.68-0.02-2.04-0.06-2.72-0.08c-1,0.05-1.99,0.06-2.97,0.03c-6.52,2.06-5,11.43-6.64,16.52c-2.74,0.12-8.21,0.37-10.95,0.49c-0.51,0.22-1.51,0.66-2.02,0.88c-6.07,4.03-13.7,2.67-20.54,3.83c-3.68,0.95-6.63,3.67-8.44,6.92c-0.37,1.29-2.96,3.74-3.3,1.27c-0.13-2.59,0.18-5.17,0.1-7.75c-1.56,0.02-3.09,0.22-4.62,0.42c-0.48,3.08-0.89,6.17-1.35,9.26c-0.96-0.03-1.91-0.06-2.85-0.08l-0.69-0.01c-0.12-0.56-0.35-1.69-0.47-2.25c0.55-4.48-4.63-5.86-7.42-8.12c-4.37-3.11-10.29-2.92-14.51-6.16c-1.89-3-4.35-6.24-8.3-5.63c-1.74,0.02-3.44,0.04-5.11,0.04c-3.89,0.05-7.2,2.34-10.38,4.3c-6.12,4.05-13.19,7.44-17,14.05c-3.09,3.72-4.11,8.54-6.6,12.59c-3.87,4.99-9.23,8.49-14.39,11.98c0.13,0.45,0.39,1.33,0.52,1.77c0.49,1.64,0.45,3.33-0.13,5.08c-0.65,4.67,0.22,9.36,1.08,13.95c3.49-1.03,7.01-2.11,10.44-3.38c-5.19,4.58-4.51,11.72-4.79,18.07c-5.61,0.48-9.03,4.69-12.28,8.67c-2.82-4.04-4.19-8.88-6.79-13.04c-3.39-4.97-2.78-11.3-4.86-16.78c-3.85,0.59-7.93,2.12-9.09,6.15c-1.5,5.26-5.89,8.7-8.52,13.26c-0.29,3.7-1.17,7.83,0.59,11.34c2.66,2.02,5.88,0.05,8.62-0.7c-1.86-2.64,2.4-3.49,1.38-0.3c-0.23,2.29-0.66,4.54-1.09,6.8c1.13,0.05,2.27,0.09,3.41,0.12c0.99-0.04,1.96,0.08,2.92,0.36c0.53,0.12,1.58,0.37,2.1,0.5c0.13,0.61,0.38,1.83,0.51,2.44c-1.7,0.42-5.09,1.26-6.79,1.68c2.46,4.73,5.97,8.77,9.08,13.07c-1.47,1.59-2.98,3.15-4.37,4.82c-0.56,1.31-2.18,1.05-2.73-0.11c-3.2-4.36-8.71-1.13-12.91-0.28l0.48,1.12c0.09,0.57,0.27,1.71,0.36,2.28c-0.18,3.27-0.21,6.55-0.1,9.82c-0.01,0.57-0.02,1.72-0.03,2.29c-1.01,5.3,2.93,9.34,6.84,12.16c1.61-0.34,3.24-0.67,4.85-1.04c3.93-1.6,8.15-3.58,10.14-7.58c3.83-9.05,11.45-15.77,20.29-19.76c4.51,6.36,11.12,11,14.27,18.37c-2.63,1.19-5.01,2.52-7.52,3.83c1.89,1.64,3.78,3.28,5.67,4.93c3.3-4.19,6.63-8.35,9.97-12.5c3.01,4.11,6.6,7.86,10.98,10.53c0.91-4.43,1.8-8.87,2.67-13.31c1.78,4.45,2.93,9.16,5.18,13.4c2.92,2.5,7.44,1.3,10.68,3.28c1.37,1.03,2.51,2.34,3.73,3.57c1.09-0.1,2.18-0.21,3.28-0.31c0.52-2.11,0.94-4.89,3.46-5.49c5.77-1.66,11.82-1.81,17.75-2.52c0.29-1.63,0.88-4.87,1.17-6.5c3.47,1,6.96,1.96,10.37,3.16c0.64-2.84,2.22-5.83,1.09-8.77c-1.88-5.67-4.27-11.17-5.61-17.01c3.46-1.03,6.89-2.32,10.5-2.77c2.05-0.38,0.94,2.57-0.5,2.53c-1.54,0.77-3.07,1.55-4.6,2.33c3.51,8.47,6.25,17.23,7.93,26.26c3.56-1.02,7.12-2.1,10.88-2.17c3.1,2.32,5.27,5.65,7.82,8.55c6.18-2.08,12.22-4.58,18.51-6.36c0.76-1.34,2.85-1.13,2.94,0.56c3.78-0.05,7.51-0.14,11.31-0.2c-1.1-2.55-1.88-5.24-2.66-7.9c3.56-1.76,7.82-2.77,10.66-5.8c4.49-3.81,2.7-10.87,7.27-14.61c5.6-5.44,10.89-11.53,17.81-15.33c5.09-2.79,10.9-0.53,16.05,0.7c0.93-2.71,1.57-5.5,2.53-8.19c7.77,3.13,15.27,7.09,23.21,9.66c7.7-0.96,15.33-2.35,23.11-2.61c3.53-3.04,4.48-8.31,6.5-12.45c2.56,0.42,5.03,0.82,7.64,1.26c0.93,4.39,0.97,9.42,4.13,12.93c3.77,3.77,7.84,7.73,13.27,8.84c-2.26,2.42-4.55,4.83-6.48,7.51c-0.55,3.25-0.93,6.52-1.13,9.83c3.57-2.16,7.68-3,11.79-3.44c2.33-3.44,4.73-6.82,7.14-10.21c3.52-4.73,3.61-10.92,5-16.44c0.34-0.46,1.02-1.38,1.36-1.84c0.11,0.38,0.34,1.14,0.46,1.52c0.39,5.9,0.36,11.82,0.59,17.73c0.58,0.22,1.74,0.65,2.32,0.87c2.51-2.36,2.13-6.16,2.76-9.21c1.33-7.43-0.54-15.01-1.69-22.31c-5.5-1.67-11.51-1.6-16.57-4.55c5.84-5.93,10.54-13.37,17.71-17.81c0.88-0.58,1.81-0.55,2.77,0.07c7.14,1.65,14.66,1.2,21.97,1.84c1.84-4.42,4.28-8.54,7.23-12.31c0.42-1.44,2.35-1.05,2.44,0.37c0.84,2.23,2.18,4.23,3.7,6.07c-4.17,5.31-8.48,10.49-13.43,15.09c0.47,7.37,1.65,14.67,3.36,21.85c0.76,0.01,2.28,0.04,3.04,0.05c5.11-6.79,9.88-13.92,13.45-21.65c1.55-3.07-0.6-6.21-1.42-9.16c3.15-1.99,6.47-3.78,9.42-6.09l0.49-0.41c0.91,0.25,2.74,0.73,3.65,0.98c0.94,0.28,1.89,0.56,2.85,0.84c5.1-6.6,13-10.06,21.08-11.21c-0.07-3.26-0.09-6.53,0.34-9.77c1.03-4.41,5.51-6.65,7.16-10.73c1.1-2.65,2.43-5.21,4.03-7.59C807.19,85.225,793.68,84.225,782.56,84.155z M385.7,162.815c-0.05-1.84-0.16-5.51-0.22-7.34c1.02,0.46,2.04,0.91,3.07,1.37C387.59,158.835,386.64,160.815,385.7,162.815z M394.6,173.925c-0.14-0.32-0.43-0.97-0.57-1.29C395.45,170.455,397.2,174.535,394.6,173.925z M438.12,204.965c-4.42-3.76-8.85-7.77-11.23-13.19c4.05,3.22,8.12,6.42,12.41,9.32C438.91,202.385,438.5,203.665,438.12,204.965z M444.704,121.556c0.179,3.023,0.504,6.094,0.636,9.14c1.19,2.4,2.7,4.63,4.09,6.94c-2.52,5.01-4.77,10.14-7.13,15.22c-5.5,0.7-10.72,2.77-16.23,3.35c1.14,1.52-2.28,2.63-2.17,0.7c-0.88-1.14-1.76-2.27-2.64-3.41c3.78,0.49,7.87,0.2,10.98-2.27c4.32-4.67,5.93-11.02,7.99-16.85c1.12-4.25-3.12-9.2,0.27-12.85c3.62-4.56,6.96-9.32,10.1-14.22c0.16,1.45,0.49,4.35,0.65,5.8C448.83,115.624,444.943,117.717,444.704,121.556z M454.54,132.865c0.94-1.11,2.72-1.21,4.05-0.85C460.19,133.855,454.77,134.815,454.54,132.865z M483.39,105.225c0.79,1.46,1.61,2.91,2.41,4.37c-3.5-0.36-7.11-0.62-10.28-2.27C478.12,106.565,480.75,105.865,483.39,105.225z M479.47,188.485c-1.11,1.45-3.02-0.54-1.66-1.66C478.93,185.465,480.92,187.385,479.47,188.485z M476.26,200.025c-1.23,1.23-2.44,1.22-3.64-0.01c-3.07,1.83-6.33,3.33-9.57,4.82c-0.51-2.02-1.2-4.04-1.19-6.15c1.32-3.52,3.58-6.61,5.46-9.86c4.19,5.28,11.54,2.83,16.76,6.08c2.16,2.88,4.09,5.95,5.91,9.07C485.23,203.475,480.48,202.345,476.26,200.025z M563.81,93.445c-1.04-1.29-1.04-3.57,0-4.86C565.41,89.035,565.41,92.995,563.81,93.445 M444.69,121.695c0.002-0.048,0.011-0.092,0.014-0.14c-0.011-0.173-0.025-0.348-0.034-0.521L444.69,121.695 M340.98,105.145c2.18,5.34,3.83,15.85,11.97,12.85c1.13-0.39,2.32-0.61,3.53-0.52c0.59,0.01,1.77,0.03,2.36,0.04c7,1.57,9.34-6.93,9.48-12.13C359.71,101.875,349.59,101.475,340.98,105.145 M413.6,206.395c0.53,2.06,1.9,4.81,4.19,5.07c0.56-0.03,1.68-0.08,2.25-0.11c0.35-0.23,1.05-0.68,1.4-0.9c-0.04-4.44-1.94-8.54-3.5-12.6C416.23,200.505,413.58,203.055,413.6,206.395 M450.56,221.285c-1.37,2.07-0.08,4.49,0.33,6.65c1.83-0.41,5.49-1.24,7.32-1.65C456.09,224.075,453.87,221.435,450.56,221.285z'/></svg>"]],
income_groups:[["lower_middle_income","Lower middle income",null],["low_income","Low income",null],["upper_middle_income","Upper middle income",null],["high_income","High income",null]],landlocked:[["landlocked","Landlocked",null],["coastline","Coastline",null]],g77_and_oecd_countries:[["others","Others",null],["oecd","OECD",null],["g77","G77",null]],main_religion_2008:[["eastern_religions","Eastern religions",null],["muslim","Muslim",null],["christian","Christian",null]]};return e[t]}function et(){return function t(e){function i(t){var e=v(t);return d?d(e.scale(t*e.sign)):e.scale(t*e.sign)}var a,n,s=[],l=[],r=.1,o=5,c=e.domain(),h=e.range(),d=null,u=function(t){return t instanceof Array?t.map(function(t){return Math.abs(t)}):Math.abs(t)},m=function(t,e){return{domain:t,sign:1,range:e,scale:d3.scale.linear().domain(t).range(e)}},g=function(t,e,i){var a=t;return i&&(a=u(t)),{domain:t,sign:i?-1:1,range:e,scale:d3.scale.log().domain(a).range(e)}},p=function(){a=h[0]<h[h.length-1];var t=a?1:-1;if(s=[],1==l.length)s=l[0][0]<=0&&l[0][1]>=0?[m(l[0],h)]:[g(l[0],h,l[0][0]<=0)];else{var i,d=d3.max(u(c)),p=u(d3.max(h)-d3.min(h)),f=1,v=0,b=0,y=0,x=0;e.domain([r,d]).range([0,p]),i=o,0!=c[0]&&u(c[0])>r&&(v=e(u(c[0]))),0!=c[c.length-1]&&u(c.length-1)>r&&(b=e(u(c[c.length-1]))),u(c[0])>r&&(y=i),u(c[c.length-1])>r&&(x=i),p=p-y-x,0!=b&&(f=u(v/b));var _,z;2==l.length?0==c[0]||u(c[0])<=r?(_=h[0]+v*f*t+x*t,s=[m(l[0],[h[0],_]),g(l[1],[_,h[1]],!n)]):(0==c[c.length-1]||u(c[c.length-1])<=r)&&(_=h[h.length-1]-(y+x)*f*t,s=[g(l[0],[h[0],_],n),m(l[1],[_,h[h.length-1]])]):(_=h[0]+p/(1/f+1)*t,z=h[0]+(p/(1/f+1)+y+x)*t,s=[g(l[0],[h[0],_],n),m(l[1],[_,z]),g(l[2],[z,h[h.length-1]],!n)])}},f=function(){if(n=c[0]<c[c.length-1],l=[],d3.min(c)>0&&d3.max(c)>0||d3.min(c)<0&&d3.max(c)<0)l=[c];else{var t,e;n?(t=c[0],e=c[c.length-1]):(t=c[c.length-1],e=c[0]);for(var i=function(t,e){n?l.push([t,e]):l.unshift([e,t])};t!=e;)-r>=e||t>=-r&&r>=e||t>=r?(i(t,e),t=e):-r>t&&e>=-r?(i(t,-r),t=-r):t>=-r&&e>=r?(i(t,r),t=r):(console.warn("Something wrong while build subdomains: "+t+" "+e),t=e)}p()},v=function(t){if(n){if(t<c[0])return s[0];if(t>c[c.length-1])return s[s.length-1];for(var e=0;e<s.length;e++)if(t>=s[e].domain[0]&&t<=s[e].domain[s[e].domain.length-1])return s[e]}else{if(t>c[0])return s[0];if(t<c[c.length-1])return s[s.length-1];for(var e=0;e<s.length;e++)if(i=s[e],t<=s[e].domain[0]&&t>=s[e].domain[s[e].domain.length-1])return s[e]}},b=function(t){if(a){if(t<h[0])return s[0];if(t>h[h.length-1])return s[s.length-1];for(var e=0;e<s.length;e++)if(t>=s[e].range[0]&&t<=s[e].range[s[e].range.length-1])return s[e]}else{if(t>h[0])return s[0];if(t<h[h.length-1])return s[s.length-1];for(var e=0;e<s.length;e++){s[e];if(t<=s[e].range[0]&&t>=s[e].range[1])return s[e]}}};return Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},i.eps=function(t){return arguments.length?(r=t,i.domain(c),i):r},i.delta=function(t){return arguments.length?(o=t,i.range(h),i):o},i.domain=function(t){if(!arguments.length)return c;switch(t.length){case 0:t=c;break;case 1:t=[t[0]/2,2*t[0]]}t[0]==t[t.length-1]&&(t[0]=t[0]/2,t[t.length-1]=2*t[t.length-1]),c=t;var e=d3.min(u(c).filter(function(t){return!!t}));return e&&(r=Math.min(r,e/100)),f(),i},i.range=function(t,e){if(!arguments.length)return h;switch(t.length){case 0:t=h;break;case 1:t=[t[0]-100,t[0]+100]}if(d&&!e)d.range(t);else{h=t;var a=d3.min(u(h).filter(function(t){return!!t}));a&&(o=Math.min(o,a/100)),p()}return i},i.interpolate=function(t){return d=d3.scale.linear().domain(c).range(h).interpolate(t),i.range(d.domain(),!0),i},i.invert=function(t){var e=b(t);return e.scale.invert(t)*e.sign},i.ticks=function(t){for(var e,i=[],a=0;a<s.length;a++)e=-1==s[a].sign?s[a].scale.ticks().reverse().map(function(t){return-1*t}):s[a].scale.ticks(),i.length>0&&e.length>0&&i[i.length-1]==e[0]&&e.splice(0,1),i.push.apply(i,e);return i},i.copy=function(){return t(e).domain(c).range(h).delta(o).eps(r)},d3.rebind(i,e,"base","rangeRound","clamp","nice","tickFormat")}(d3.scale.log().domain([.1,200]).range([0,1e3]))}function it(t,e,i){var a,n,s,l=e?".onTap":".onLongTap";d3.select(t).on("touchstart"+l,function(t,e){a=d3.event.timeStamp,n=d3.event.changedTouches[0].screenX,s=d3.event.changedTouches[0].screenY}).on("touchend"+l,function(t,l){return n=Math.abs(n-d3.event.changedTouches[0].screenX),s=Math.abs(s-d3.event.changedTouches[0].screenY),5>n&&5>s?d3.event.timeStamp-a<500?e?e(t,l):void 0:i?i(t,l):void 0:void 0})}var at={ext_resources:{}},nt={linear:function(t,e,i,a,n){return+i+(n-t)/(e-t)*(a-i)},exp:function(t,e,i,a,n){return Math.exp((Math.log(i)*(e-n)-Math.log(a)*(t-n))/(e-t))},stepBefore:function(t,e,i,a,n){return a},stepAfter:function(t,e,i,a,n){return i},stepMiddle:function(t,e,i,a,n){return(t+e)/2>n?i:a}},st=function(){var t=0;return function(e){return e?e+(t+=1):t+=1}}(),lt=function(t){return!(!t||1!==t.nodeType)},rt=Array.isArray||function(t){return"[object Array]"===toString.call(t)},ot=function(t){var e=typeof t;return"object"===e&&!!t},ct=function(t){return t instanceof Date},ht=function(t){return"string"==typeof t},dt=function(t){return ut(t)&&t!==+t},ut=function(t){return"number"==typeof t||!!t&&"object"==typeof t&&"[object Number]"===Object.prototype.toString.call(t)},mt=function(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)},gt=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0},pt=function(t,e){var i=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},a=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var e=typeof t;return"object"===e&&(e=i(t).toLowerCase()),"number"===e?t.toString().indexOf(".")>0?"float":"integer":e},n=function(t,e){if(t===e)return!0;for(var i in t){if(!e.hasOwnProperty(i))return!1;if(!r(t[i],e[i]))return!1}for(var i in e)if(!t.hasOwnProperty(i))return!1;return!0},s=function(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1;return!0},l={};l.array=s,l.object=n,l.date=function(t,e){return t.getTime()===e.getTime()},l.regexp=function(t,e){return t.toString()===e.toString()};var r=function(t,e){if(t!==e){var i=a(t),n=a(e);return i===n?l.hasOwnProperty(i)?l[i](t,e):t==e:!1}return!0};return n(t,e)},ft=function(t){for(var e=0,i=0;t;)e+=t.offsetLeft-t.scrollLeft+t.clientLeft,i+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return{x:e,y:i}},vt=function(t){for(var e=["scroll","auto"];t=t.parentNode;){var i=t.scrollHeight,a=t.clientHeight;if(i>a&&-1!==e.indexOf(d3.select(t).style("overflow")))return t}return null},bt=function(t,e){return Math.round(t/e)*e},yt=function(t){return+t.replace(/[^\d.-]/g,"")},xt=function(t,e,i){if(t){var a,n;if(rt(t))for(n=t.length,a=0;n>a&&e.apply(i,[t[a],a])!==!1;a+=1);else{var s=Object.keys(t);for(n=s.length,a=0;n>a&&e.apply(i,[t[s[a]],s[a]])!==!1;a+=1);}}},_t=function(t){var e=Array.prototype.slice.call(arguments,1);return xt(e,function(e,i){xt(e,function(i,a){e.hasOwnProperty(a)&&(t[a]=i)})}),t},zt=function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];var a,n,s=arguments[0],l=Array.prototype.slice.call(arguments,1);return xt(l,function(l){"object"!=typeof l||rt(l)||xt(Object.keys(l),function(r){return n=s[r],a=l[r],a===s?void 0:"object"!=typeof a||null===a?void(s[r]=a):rt(a)?void(s[r]=i(a)):t(a)?void(s[r]=e(a)):"object"!=typeof n||null===n||rt(n)?void(s[r]=zt({},a)):void(s[r]=zt(n,a))})}),s},Mt=function(t){var e=Array.prototype.slice.call(arguments,1);return xt(e,function(e,i){xt(e,function(i,a){e.hasOwnProperty(a)&&(t.hasOwnProperty(a)?(rt(t[a])||(t[a]=[t[a]]),t[a].push(i)):t[a]=i)})}),t},wt=function(t,e,i){if(rt(t))return t.slice(0);var a={};return xt(t,function(n,s){e&&-1===e.indexOf(s)||i&&-1!==i.indexOf(s)||t.hasOwnProperty(s)&&(a[s]=n)}),a},St=function(t){var e={};return rt(t)&&(e=[]),xt(t,function(t,i){ot(t)||rt(t)?e[i]=St(t):e[i]=t}),e},kt=function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},Et=function(t,e){var i={},a=[];e||(e=function(t){return t});for(var n=0,s=t.length;s>n;n+=1){var l=e(t[n]);i.hasOwnProperty(l)||(a.push(t[n]),i[l]=1)}return a},Tt=function(t,e){var i={},a=[];e||(e=function(t){return t});for(var n=0,s=t.length;s>n;n+=1){var l=e(t[n]);i.hasOwnProperty(l)&&a.splice(i[l],1),a.push(t[n]),i[l]=a.length-1}return a},Ot=function(t,e){var i;return xt(t,function(t){return e(t)?(i=t,!1):void 0}),i},Ct=function(t,e){for(var i,a,n=-1,s=t.length,l=-1,r=[],o=Object.keys(e),c=o.length;(n+=1)<s;){var h=t[n],d=!0;for(i=0;c>i;i+=1)if(a=o[i],!h.hasOwnProperty(a)||h[a]!==e[a]){d=!1;break}d&&(r[l+=1]=h)}return r},Lt=function(t,e,i){for(var a,n,s=-1,l=t.length,r=-1,o=[],c=Object.keys(e),h=c.length;(s+=1)<l;){var d=t[s],u=!0;for(a=0;h>a;a+=1)if(n=c[a],!d.hasOwnProperty(n)||!At(d[n],e[n],i)){u=!1;break}u&&(o[r+=1]=d)}return o},At=function(t,e,i){rt(t)||(t=[t]),i||(i="*");for(var a=!1,n=0;n<t.length;n++){var s=t[n];if(!rt(e)&&s==e){a=!0;break}if(rt(e)){for(var l=-1,r=0;r<e.length;r++){var o=e[r];if(!(rt(o)||o!=s&&o!==i)){l=r;break}if(rt(o)){var c=o[0],h=o[1]||c;if(s>=c&&h>=s){l=r;break}}}if(-1!==l){a=!0;break}}}return a},Dt=function(t){var e=!1;t.on("mousewheel",function(i,a){var n=this.scrollTop,s=this.scrollHeight,l=t.node().offsetHeight,r=d3.event.wheelDelta,o=r>0,c=function(){return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1},h=function(t){return function(){var e=d3.interpolateNumber(this.scrollTop,t);return function(t){this.scrollTop=e(t)}}};return o?o&&(r>n&&n>0?(t.transition().delay(0).duration(0).tween("scrolltween",h(0)),e=!0,setTimeout(function(){e=!1},2e3)):s==l+n&&(e=!1)):-r>s-l-n&&s!=l+n?(t.transition().delay(0).duration(0).tween("scrolltween",h(s)),e=!0,setTimeout(function(){e=!1},2e3)):0==n&&(e=!1),e?c():void 0})},Pt=function(t,e){function i(t,e){if(rt(t)){for(var a=[],n=0;n<t.length;n++)a[n]=i(t[n],e);return a}return e(t)}var a=function(t){var e=t;if(""===t)e=null;else{var i=parseFloat(t);!dt(i)&&isFinite(t)&&(e=i)}return e};return t=t.map(function(t){for(var n=Object.keys(t),s=0;s<n.length;s++){var l=n[s];t[l]=i(t[l],e[l]||a)}return t})},It=function(t){return t*t*Math.PI},Bt=function(t){return Math.sqrt(t/Math.PI)},Rt=function(t){console&&"function"==typeof console.timeStamp&&console.timeStamp(t)},Ft=function(t){return t=Array.prototype.slice.call(arguments).join(" "),console&&"function"==typeof console.warn&&console.warn(t),!0},Nt=function(t){t=Array.prototype.slice.call(arguments).join(" "),console&&"function"==typeof console.groupCollapsed&&console.groupCollapsed(t)},qt=function(){console&&"function"==typeof console.groupEnd&&console.groupEnd()},Ht=function(t){t=Array.prototype.slice.call(arguments).join(" "),console&&"function"==typeof console.error&&console.error(t)},Yt=function(t){return Math.floor(t.valueOf())===t.valueOf()?0:t.toString().split(".")[1].length||0},jt=function(t,e){t.classList?t.classList.add(e):t.className+=" "+e},Vt=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},Xt=function(t,e,i){if(i===!0)jt(t,e);else{if(i!==!1)return Kt(t,e);Vt(t,e)}},Kt=function(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)},Wt=function(t,e){var i,a,n,s=!1,l=function(){return n>Date.now()?(s=!0,i=arguments,void(a=this)):(n=Date.now()+e,s=!1,t.apply(this,arguments),void setTimeout(function(){r()},e))},r=function(){s&&(s=!1,t.apply(a,i))};return l.recallLast=r,l},Ut=function(t){return Object.keys(t)},Gt=function(t){for(var e,i=Object.keys(t),a=i.length,n=0;a>n;n+=1)(e=e||[]).push(t[i[n]]);return e},Qt=function(t){return t.reduce(function(t,e){return e>t?t:e})},Zt=function(t){return t.reduce(function(t,e){return t>e?t:e})},Jt=function(t){return $t(t)/t.length},$t=function(t){return t.reduce(function(t,e){return t+e})},te=function(t){t=t.sort(function(t,e){return t-e});var e=Math.floor((t.length-1)/2);return t.length%2?t[e]:(t[e]+t[e+1])/2},ee=function(t){return t.length?t[t.length-1]:null},ie=function(t,e){var i={};return xt(t,function(t,a){if(e.hasOwnProperty(a)){if(t!==e[a])if(mt(t)&&mt(e[a])){var n=ie(t,e[a]);Object.keys(n).length>0&&(i[a]=n)}else rt(t)&&rt(e[a])&&gt(t,e[a])||(i[a]=t)}else i[a]=t}),i},ae=function(t){var e={};return xt(t,function(t,i){mt(t)&&t._defs_?e[i]=t._defs_:mt(t)?e[i]=ae(t):e[i]=t}),e},ne=function(t,e){var i={};return xt(t,function(t,a){"marker"===a?["axis_x","axis_y","size_label"].map(function(i){var a=t[i];"object"==typeof a&&(ct(a.domainMin)&&(a.domainMin=e(a.domainMin)),ct(a.domainMax)&&(a.domainMax=e(a.domainMax)),ct(a.zoomedMin)&&(a.zoomedMin=e(a.zoomedMin)),ct(a.zoomedMax)&&(a.zoomedMax=e(a.zoomedMax)))}):"time"===a&&("object"==typeof t.value&&(t.value=e(t.value)),"object"==typeof t.start&&(t.start=e(t.start)),"object"==typeof t.end&&(t.end=e(t.end)),"object"==typeof t.startSelected&&(t.startSelected=e(t.startSelected)),"object"==typeof t.endSelected&&(t.endSelected=e(t.endSelected))),mt(t)?i[a]=ne(t,e):i[a]=t}),i},se=function(t){setTimeout(t,1)},le=function(t,e){return setTimeout(t,e)},re=function(t){return clearTimeout(t)},oe=function(t){ht(t)||(t=JSON.stringify(t));var e,i=0,a=t.length;if(0===a)return i;for(var n=0;a>n;n+=1)e=t.charCodeAt(n),i=(i<<5)-i+e,i&=i;return i.toString()},ce=function(t){if(!t||!t.length||!t[0].key)return t;for(var e={},i=0;i<t.length;i++)e[t[i].key]=ce(t[i].values);return e},he=function(){},de=function(t,e,i,a,n,s,l,r){if(!t||0===t.length)return Ft("interpolatePoint failed because incoming array is empty. It was "+i),null;if("constant"===e)return i;if("property"===e)return t[0][i];if(r){if(s-t[0][n]<=0)return t[0][i];if(s-t[t.length-1][n]>=0)return t[t.length-1][i]}else if(s<t[0][n]||s>t[t.length-1][n])return null;if(a||0===a||(a=d3.bisectLeft(t.map(function(t){return t[n]}),s)),0===a)return t[0][i];if(void 0===t[a]||null===t[a][i]||null===t[a-1][i]||""===t[a][i])return Ft("interpolatePoint failed because next/previous points are bad in "+i),null;var o=nt[l||"linear"](t[a-1][n],t[a][n],t[a-1][i],t[a][i],s);return i===n&&(o=new Date(o)),dt(o)&&(Ft("interpolatePoint failed because result is NaN. It was "+i),o=null),o},ue=function(t){var e=new XMLHttpRequest;e.open(t.method,t.url,!0),"POST"!==t.method||t.json?"POST"===t.method&&t.json&&e.setRequestHeader("Content-Type","application/json; charset=UTF-8"):e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.onload=function(){if(e.status>=200&&e.status<400){var i=t.json?JSON.parse(e.responseText):e.responseText;t.success&&t.success(i)}else t.error&&t.error()},e.onerror=function(){t.error&&t.error()},e.send(t.data)},me=function(t,e,i,a,n){e=e||[],xt(e,function(t,i){e.push(i+"="+t)}),t=e.length?t+"?"+e.join("&"):t,ue({method:"GET",url:t,success:i,error:a,json:n})},ge=function(t,e,i,a,n){ue({method:"POST",url:t,success:i,error:a,json:n,data:e})},pe=function(t){return function(){for(var e=Array.prototype.slice.call(arguments),i="",a=e.length,n=null;a--;)n=e[a],i+=n===Object(n)?JSON.stringify(n):n,t.memoize||(t.memoize={});return i in t.memoize?t.memoize[i]:t.memoize[i]=t.apply(this,e)}},fe=function(t,e,i){var a;return function(){var n=this,s=arguments,l=function(){a=null,i||t.apply(n,s)},r=i&&!a;clearTimeout(a),a=setTimeout(l,e),r&&t.apply(n,s)}},ve=function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)},be=function(t,e){var i={},a=[];return t.hasOwnProperty("children")&&(a=t.children.map(function(t){return be(t,e)}).filter(function(t){return 0!==Object.keys(t).length})),(0!=a.length||e(t))&&(i.id=t.id),0!=a.length&&(i.children=a),i},ye=function(t,e){return t.selectAll("*").remove(),t.node().appendChild(t.node().ownerDocument.importNode((new DOMParser).parseFromString(e,"application/xml").documentElement,!0)),t},xe=Object.freeze({uniqueId:st,isElement:lt,isArray:rt,isObject:ot,isDate:ct,isString:ht,isNaN:dt,isNumber:ut,isPlainObject:mt,arrayEquals:gt,comparePlainObjects:pt,getViewportPosition:ft,findScrollableAncestor:vt,roundStep:bt,strToFloat:yt,forEach:xt,extend:_t,deepExtend:zt,merge:Mt,clone:wt,deepClone:St,without:kt,unique:Et,uniqueLast:Tt,find:Ot,filter:Ct,filterAny:Lt,matchAny:At,preventAncestorScrolling:Dt,mapRows:Pt,radiusToArea:It,areaToRadius:Bt,timeStamp:Rt,warn:Ft,groupCollapsed:Nt,groupEnd:qt,error:Ht,countDecimals:Yt,addClass:jt,removeClass:Vt,classed:Xt,hasClass:Kt,throttle:Wt,keys:Ut,values:Gt,arrayMin:Qt,arrayMax:Zt,arrayMean:Jt,arraySum:$t,arrayMedian:te,arrayLast:ee,diffObject:ie,flattenDefaults:ae,flattenDates:ne,defer:se,delay:le,clearDelay:re,hashCode:oe,nestArrayToObj:ce,interpolateVector:he,interpolatePoint:de,ajax:ue,get:me,post:ge,memoize:pe,debounce:fe,isTouchDevice:ve,pruneTree:be,setIcon:ye,makeAbsoluteContext:a}),_e=!1,ze=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,Me=function(){};Me.extend=s,l.prototype.then=function(t,e){var i,a=this._next||(this._next=l()),n=this.status;if("pending"===n)return d(t)&&this._resolves.push(t),d(e)&&this._rejects.push(e),a;if("resolved"===n)return d(t)?(i=t(this.value),r(a,i)):a.resolve(t),a;if("rejected"===n){if(d(e))try{i=e(this.reason),r(a,i)}catch(s){this.reject(s)}else a.reject(e);return a}},l.prototype.resolve=function(t){if("rejected"===this.status)throw Error("Illegal call.");return this.status="resolved",this.value=t,this._resolves.length&&h(this),this},l.prototype.reject=function(t){if("resolved"===this.status)throw Error("Illegal call. "+t);return this.status="rejected",this.reason=t,this._rejects.length&&h(this),this},l.prototype["catch"]=function(t){return this.then(void 0,t)},l.cast=function(t){var e=l();return t instanceof l?o(e,t):l.resolve(t)},l.resolve=function(t){var e=l();return m(t)?c(e,t):e.resolve(t)},l.all=function(t){var e,i=t.length,a=l(),n=[],s=0;return xt(t,function(t,l){t.then(function(t){n[l]=t,(s+=1)!==i||e||a.resolve(n)},function(t){e=!0,a.reject(t)})}),a},l.any=function(t){var e,i=l();return xt(t,function(t,a){t.then(function(t){e||(i.resolve(t),e=!0)},function(t){e=!0,i.reject(t)})}),i},l.reject=function(t){if(!(t instanceof Error))throw Error("reason must be an instance of Error");var e=l();return e.reject(t),e};var we=Me.extend({init:function(t){this._name=this._name||t.reader,this._data=t.data||[],this._basepath=this._basepath||t.path||null,this._parsers=t.parsers,this._parsers&&(this._data=Pt(this._data,this._parsers))},read:function(t,e){return new l.resolve},getData:function(){return this._data}}),Se=Me.extend({init:function(){this._collection={},this._collectionPromises={}},load:function(t,e,i,a){var n=this,s=new l,r=(new l).resolve(),o=t===!0?!0:this.isCached(t,e,i),c=!1;return o||(Rt("Vizabi Data: Loading Data"),a&&"function"==typeof a.load_start&&a.load_start(),r=new l,this.loadFromReader(t,e,i).then(function(t){c=!0,o=t,r.resolve()},function(t){Ft(t),r.reject()})),r.then(function(){n._collection[o].data;c&&a&&"function"==typeof a.load_end&&a.load_end(),s.resolve(o)},function(){c&&a&&"function"==typeof a.load_end&&a.load_end(),s.reject()}),s},loadFromReader:function(t,e,i){var a=this,n=new l,s=i.reader,r=oe([t,e,i]);return this.queryQueue=this.queryQueue||[],this.queryQueue.push({query:t,queryId:r,promise:n,reader:i}),se(function(){var n=[],l=!1;if(a.queryQueue=a.queryQueue.filter(function(e){return e.query==t?(n.push(e),l=!0,!1):pt(e.query.where,t.where)&&pt(e.query.grouping,t.grouping)?(Array.prototype.push.apply(t.select,e.query.select),_t(i.parsers,e.reader.parsers),i.parsers[a.getAvailableDimension(t,"key")]=function(t){return""+t},n.push(e),!1):!0}),l){t.select=Et(t.select);var o,c,h=0;c=wt(t),o=Ut(c.grouping),gt(c.select.slice(0,o.length),o)&&(c.select=o,h=oe([c,e,i]));var d=we.get(s);if(!d)throw new Error("Unknown reader: "+s);var u=new d(i);u.read(t,e).then(function(){var e=u.getData(),i=t;e=e.map(function(t){for(var e=0;e<i.select.length;e+=1){var a=i.select[e];"undefined"==typeof t[a]&&(t[a]=null)}return t}),a._collection[r]={},a._collectionPromises[r]={};var s=a._collection[r];s.data=e,s.valid={},s.nested={},s.unique={},s.limits={},s.limitsPerFrame={},s.frames={},s.haveNoDataPointsPerKey={},s.query=i,xt(n,function(t){a._collection[t.queryId]=a._collection[r],a._collectionPromises[t.queryId]=a._collectionPromises[r],t.promise.resolve(t.queryId)}),0!==h&&(a._collection[h]=a._collection[r])},function(t){xt(n,function(e){e.promise.reject(t)})})}}),n},get:function(t,e,i,a){if(!t)return Ft("Data.js 'get' method doesn't like the queryId you gave it: "+t);if(!e||"data"==e)return this._collection[t].data;if(!i)return this._collection[t][e];var n="string"==typeof i?i:JSON.stringify(i);if(this._collection[t][e][n])return this._collection[t][e][n];switch(e){case"unique":this._collection[t][e][n]=this._getUnique(t,i);break;case"valid":this._collection[t][e][n]=this._getValid(t,i);break;case"limits":this._collection[t][e][n]=this._getLimits(t,i);break;case"nested":this._collection[t][e][n]=this._getNested(t,i);break;case"haveNoDataPointsPerKey":}return this._collection[t][e][n]},getConceptprops:function(t){return at.conceptprops&&at.conceptprops.indicatorsDB?t?at.conceptprops.indicatorsDB[t]:at.conceptprops.indicatorsDB:{}},getIndicatorsTree:function(){return at.conceptprops&&at.conceptprops.indicatorsTree?at.conceptprops.indicatorsTree:{}},getFrames:function(t,e){var i=this,a=e[0]+" - "+e[e.length-1];return this._collectionPromises[t][a]||(this._collectionPromises[t][a]={queue:this.framesQueue(e),promise:null}),this._collectionPromises[t][a]&&this._collectionPromises[t][a].promise instanceof l?this._collectionPromises[t][a].promise:(this._collectionPromises[t][a].promise=new l(function(n,s){t||s(Ft("Data.js 'get' method doesn't like the queryId you gave it: "+t)),i._getFrames(t,a,e).then(function(e){i._collection[t].frames[a]=e,n(i._collection[t].frames[a])})}),this._collectionPromises[t][a].promise)},getFrame:function(t,e,i){var a=this,n=a._collection[t].query,s=e[0]+" - "+e[e.length-1];n.select.filter(function(t){return"municipality"!=t&&"year"!=t&&"_default"!==t});return new l(function(e,n){a._collection[t].frames[s]&&a._collection[t].frames[s][i]?e(a._collection[t].frames[s]):a._collectionPromises[t][s].queue.forceFrame(i,function(){e(a._collection[t].frames[s])})})},framesQueue:function(t){return new function(){this.callbacks={},this.forcedQueue=[],this.queue=t.slice(0),this.queue.splice(0,0,this.queue.splice(this.queue.length-1,1)[0]),this.key=0,this.getNext=function(){var t=this,e=null;if(this.forcedQueue.length>0)e=this.forcedQueue.shift();else{if(0==this.queue.length)return!1;0==this.forcedQueue.length&&this.key>=this.queue.length-1&&(this.key=0),e=this.queue.splice(this.key,1).pop()}this.callbacks[e]||(this.callbacks[e]=[]);var i=function(e){if(t.callbacks[e].length>0)for(var i=0;i<t.callbacks[e].length;i++)t.callbacks[e][i]()};return{frameName:e,callback:i}},this.forceFrame=function(t,e){var i=function(t,e){for(var i=e.toString(),a=-1,n=0,s=t.length;s>n;n++)if(t[n].toString()==i){a=n;break}return a};if(this.callbacks[t])this.callbacks[t].push(e);else{var a=i(this.queue,t);-1!==a?(this.forcedQueue.unshift(this.queue.splice(a,1).pop()),"function"==typeof e&&("object"!=typeof this.callbacks[t]&&(this.callbacks[t]=[]),this.callbacks[t].push(e)),this.key=a):"object"==typeof this.callbacks[t]?this.callbacks[t].push(e):this.callbacks[t]=[e]}}}},getAvailableDimension:function(t,e){for(var i={key:["geo","municipality","province"],time:["time","year"]},a=0;a<i[e].length;a++)if(-1!==t.select.indexOf(i[e][a]))return i[e][a]},_getFrames:function(t,e,i){var a=this;return a._collection[t].frames[e]||(a._collection[t].frames[e]={}),new l(function(n,s){var l=a.getConceptprops();l||Ft("_getFrames in data.js is missing indicatorsDB, it's needed for gap filling"),i||Ft("_getFrames in data.js is missing framesArray, it's needed so much");var r,o,c,h,d,u,m,g,p,f,v=a.getAvailableDimension(a._collection[t].query,"key"),b=a.getAvailableDimension(a._collection[t].query,"time"),y={},x=a.get(t,"nested",[v,b]),_=Object.keys(x),z=a._collection[t].query,M=z.select.filter(function(t){return t!=v&&t!=b&&"_default"!==t}),w=M.length;for(g=0;g<_.length;g++)for(y[_[g]]={},f=0;w>f;f++)y[_[g]][M[f]]=null;for(f=0;w>f;f++)a._collection[t].haveNoDataPointsPerKey[M[f]]={};var S=function(t,i,s,_){var k={};if(z.where[b]){for(f=0;w>f;f++)k[M[f]]={};for(g=0;g<i.length;g++)for(m=i[g],f=0;w>f;f++)if(p=M[f],h=l[p]?l[p].interpolation:null,d=l[p]?l[p].use:"indicator",x[m]&&x[m][t]&&(x[m][t][0][p]||0===x[m][t][0][p]))k[p][m]=x[m][t][0][p];else if("none"===h)k[p][m]=null;else{if(r=y[m][p],null===r){var E=Object.keys(x[m]);r=new Array(E.length),o=0;for(var T=0,O=E.length;O>T;T++)c=x[m][E[T]],(c[0][p]||0===c[0][p])&&(r[o++]=c[0]);r.length=o,0===o?y[m][p]=[]:y[m][p]=r,0==r.length&&(a._collection[s].haveNoDataPointsPerKey[p][m]=r.length)}r&&r.length>0&&(u=null,k[p][m]=de(r,d,p,u,b,t,h))}}else{var C=a._collection[s].data;for(f=0;w>f;f++)k[M[f]]={};for(var L=0;L<C.length;L++){var A=C[L];for(f=0;w>f;f++)k[M[f]][A[v]]=A[M[f]],null==A[M[f]]&&(a._collection[s].haveNoDataPointsPerKey[M[f]][A[v]]=C.length)}}a._collection[s].frames[e][t]=k,"function"==typeof _&&_(t);var D=a._collectionPromises[s][e].queue.getNext();D?se(function(){S(D.frameName,i,s,D.callback)}):n(a._collection[s].frames[e])},k=a._collectionPromises[t][e].queue.getNext();k&&S(k.frameName,_,t,k.callback)})},_getNested:function(t,e){for(var i=d3.nest(),a=0;a<e.length;a++)i=i.key(function(t){return function(e){return e[t]}}(e[a]));return ce(i.entries(this._collection[t].data))},_getUnique:function(t,e){var i,a=this._collection[t].data;if(rt(e)){var n=a.map(function(t){return wt(t,e)});i=Et(n,function(t){return JSON.stringify(t)})}else{var n=a.map(function(t){return t[e]});i=Et(n)}return i},_getValid:function(t,e){return this._collection[t].data.filter(function(t){return t[e]||0===t[e]})},_getLimits:function(t,e){for(var i,a,n=this._collection[t].data,s=n.reduce(function(t,i){var a=ct(i[e])?i[e]:parseFloat(i[e]);return isNaN(a)||t.push(a),t},[]),l={},r=0;r<s.length;r+=1){var o=s[r];("undefined"==typeof i||i>o)&&(i=o),("undefined"==typeof a||o>a)&&(a=o)}return l.min=i||0,l.max=a||100,l},isCached:function(t,e,i){var a=oe([t,e,i]);return-1!==Object.keys(this._collection).indexOf(a)?a:!1}}),ke=!1,Ee=[],Te={},Oe=Me.extend({source:"",type:"default",init:function(t,e){this.source=t,e&&(this.type=e)}}),Ce=Oe.extend("change",{type:"change",init:function(t){this._super(t)}}),Le=Me.extend({init:function(){this._id=this._id||st("e"),this._events={},this._freeze=!1,this._freezer=[],this._freezeExceptions={}},on:function(t,e,i){if(!this.splitEventParameters(t,e,i,this.on)){var a=this.traversePath(e);a&&(a._events[t]=a._events[t]||[],"function"==typeof i?a._events[t].push(i):Ft("Can't bind event '"+t+"'. It must be a function."))}},off:function(t,e,i){if(0==arguments.length)return void(this._events={});if(!this.splitEventParameters(t,e,i,this.off)){var a=this.traversePath(e);if(a&&a._events.hasOwnProperty(t)){if("undefined"==typeof i)return void(a._events[t]=[]);var n=a._events[t].indexOf(i);n>-1?a._events[t].splice(n,1):Ft("Could not unbind function "+i.name+". Function not in bound function list.")}}},splitEventParameters:function(t,e,i,a){var n;if(rt(t)){for(n=0;n<t.length;n+=1)a.call(this,t[n],i);return!0}if(ot(t)){for(n in t)a.call(this,n,t[n]);return!0}if("function"==typeof e){if(i=e,-1!==t.indexOf(":")){var s=t.split(":");t=s[0],e=s[1]}else e=void 0;return a.call(this,t,e,i),!0}if(rt(e)){for(n=0;n<e.length;n+=1)a.call(this,t,e[n],i);return!0}if(i&&rt(i)){for(n=0;n<i.length;n+=1)a.call(this,t,e,i[n]);return!0}return!1},traversePath:function(t){if("undefined"==typeof t||rt(t)&&0==t.length)return this;if("string"==typeof t&&(t=t.split(".")),!rt(t))return Ht("Path is wrong type. Path should be a string or array but is "+typeof t+"."),null;var e=t.shift();return void 0!==this[e]?this.getModelObject(e).traversePath(t):void Ft("Can't find child \""+e+'" of the model '+this._name+".")},trigger:function(t,e){var i,a;if(rt(t))for(i=0,a=t.length;a>i;i+=1)this.trigger(t[i],e);else{var n;if(t instanceof Oe)n=t;else{var s=Oe.get(t,!0);n=s?new s(this):new Oe(this,t)}if(this._events.hasOwnProperty(n.type)){var l=this;xt(this._events[n.type],function(t){var i=function(){var i="Vizabi Event: "+n.type;Rt(i),t.apply(l,[n,e])};l._freeze||ke?ke&&Te.hasOwnProperty(n.type)||!ke&&l._freeze&&l._freezeExceptions.hasOwnProperty(n.type)?i():(l._freezer.push(i),ke&&!Ee[l._id]&&(l.freeze(),Ee[l._id]=l)):i()})}}},freeze:function(t){if(this._freeze=!0,t){rt(t)||(t=[t]);for(var e=0;e<t.length;e+=1)this._freezeExceptions[t[e]]=!0}},unfreeze:function(){for(this._freeze=!1,this._freezeExceptions={};this._freezer.length;){var t=this._freezer.shift();t()}},clearFrozen:function(){this._freeze=!1,this._freezeExceptions={},this._freezer=[]}});Le.freezeAll=p,Le.unfreezeAll=f;var Ae=Me.extend({init:function(){this.intervals={}},setInterval:function(t,e,i){this.clearInterval(t),this.intervals[t]=setInterval(e,i)},clearInterval:function(t){return t?clearInterval(this.intervals[t]):this.clearAllIntervals()},clearAllIntervals:function(){for(var t in this.intervals)this.clearInterval(t)}}),De=new Se,Pe=Le.extend({_name:"",_parent:null,_persistent:!0,init:function(t,e,i,a){Object.defineProperty(this,"value",{get:this.get,set:this.set}),Object.defineProperty(this,"persistent",{get:function(){return this._persistent}}),this._super(),this._name=t,this._parent=i,this.value=e,this.on(a)},get:function(t){return t&&!this._persistent?this._persistentVal:this._val},set:function(t,e,i){(e||this._val!==t&&JSON.stringify(this._val)!==JSON.stringify(t))&&(i="undefined"!=typeof i?i:!0,i&&(this._persistentVal=t),this._val=t,this._persistent=i,this.trigger(new Ce(this),this._name))},setTreeFreezer:function(t){t?this.freeze():this.unfreeze()}}),Ie=Le.extend({init:function(t,e,i,a){this._type=this._type||"model",this._id=this._id||st("m"),this._data={},this._parent=i,this._name=t,this._ready=!1,this._readyOnce=!1,this._loadedOnce=!1,this._loading=[],this._intervals=x(this),this._deps={parent:[],children:[]},this._space={},this._spaceDims={},this._dataId=!1,this._limits={},this._super(),e&&this.set(e),a&&this.on(a)},get:function(t){return t?v(this._data[t])?this._data[t]:this._data[t].value:this._data},set:function(t,e,i,a){var n,s=this._setting,l=!1;mt(t)?(n=t,a=i,i=e):(n={})[t]=e,this._setting=!0,this._freeze||(l=!0,this.setTreeFreezer(!0));var r=!1;for(var o in n){e=n[o];var c=mt(e)&&this._data[o]instanceof Ie,h=!mt(e)&&this._data[o]instanceof Pe;this._data[o]&&(c||h)?this._data[o].set(e,i,a):(this._data[o]=y(o,e,this),r=!0)}r&&b(this),this.validate&&!s&&this.validate(),s&&!i||(this._setting=!1,this.isHook()||this.setReady()),l&&this.setTreeFreezer(!1)},setTreeFreezer:function(t){xt(this._data,function(e){e.setTreeFreezer(t)}),t?this.freeze():this.unfreeze()},getType:function(){return this._type},getSubmodels:function(t,e){var i=t?{}:[],e=e||function(){return!0};return xt(this._data,function(a,n){a&&"undefined"!=typeof a._id&&v(a)&&e(a)&&(t?i[n]=a:i.push(a))}),i},getPlainObject:function(t){var e={};return xt(this._data,function(i,a){i instanceof Ie?e[a]=i.getPlainObject(t):e[a]=i.get(t)}),e},getModelObject:function(t){return t?this._data[t]:this},clear:function(){var t=this.getSubmodels();for(var e in t)t[e].clear();this._spaceDims={},this.setReady(!1),this.off(),this._intervals.clearAllIntervals(),this._data={}},validate:function(){},isLoading:function(t){if(this.isHook()&&(!this._loadedOnce||this._loadCall))return!0;if(t)return-1!==this._loading.indexOf(t);if(this._loading.length>0)return!0;var e,i=this.getSubmodels();for(e=0;e<i.length;e+=1)if(i[e].isLoading())return!0;for(e=0;e<this._deps.children.length;e+=1){var a=this._deps.children[e];if(a.isLoading()||!a._ready)return!0}return!1},setLoading:function(t){this.isLoading()||this.trigger("load_start"),this._loading.push(t)},setLoadingDone:function(t){this._loading=kt(this._loading,t),
this.setReady()},setReady:function(t){if(t===!1)return this._ready=!1,void(this._parent&&this._parent.setReady&&this._parent.setReady(!1));var e=this._ready;this._ready=!this.isLoading()&&!this._setting&&!this._loadCall,this._ready&&e!==this._ready&&(this._readyOnce||(this._readyOnce=!0,this.trigger("readyOnce")),this.trigger("ready"))},load:function(t){t=t||{};var e=t.splashScreen||!1,i=this,a=this._dataModel,n=this._languageModel,s=this.getQuery(e),r=new l,o=[];if(this._loadCall=!0,this.isHook()&&a&&s){this.trigger("hook_change");var c=a.getPlainObject();c.parsers=this._getAllParsers();var h=n?n.id:"en",d=new l,u={load_start:function(){i.setLoading("_hook_data"),Le.freezeAll(["load_start","resize","dom_ready"])}};se(function(){Rt("Vizabi Model: Loading Data: "+i._id),De.load(s,h,c,u).then(function(t){i._dataId=t,Rt("Vizabi Model: Data loaded: "+i._id),i.afterLoad(),d.resolve()},function(t){Ft("Problem with query: ",JSON.stringify(s)),d.reject(t)})}),o.push(d)}xt(this.getSubmodels(!0),function(e,i){o.push(e.load(t))});var m=o.length?l.all(o):new l.resolve;return m.then(function(){i.validate&&i.validate(),Rt("Vizabi Model: Model loaded: "+i._id),i._loadedOnce=!0,i._loadCall=!1,r.resolve(),se(function(){i.setReady()})},function(){i.trigger("load_error"),r.reject()}),r},afterPreload:function(){var t=this.getSubmodels();xt(t,function(t){t.afterPreload()})},afterLoad:function(){Le.unfreezeAll(),this.setLoadingDone("_hook_data")},resetDeps:function(){this._deps.children=[]},addDep:function(t){this._deps.children.push(t),t._deps.parent.push(this)},getQuery:function(t){var e,i,a,n,s;if(!this.isHook())return!0;if(Object.keys(this._space).length<1)return Ht("Error:",this._id,"can't find the space"),!0;var l="property"===this.use||"constant"===this.use,r=l?{exceptType:"time"}:{};return e=this._getAllDimensions(r),"constant"!==this.use&&(e=e.concat([this.which])),a=Et(e),i=this._getAllFilters(r,t),n=this._getGrouping(),s=l?null:this._space.time.dim,{select:a,where:i,grouping:n,orderBy:s}},isHook:function(){return!!this.use},setHooks:function(){if(this.isHook())this.hookModel();else{var t=this.getSubmodels();xt(t,function(t){t.setHooks()})}},hookModel:function(){var t=this,e=M(this);this._dataModel=_(this,"data"),this._languageModel=_(this,"language"),xt(e,function(e){t._space[e]=_(t,e),t._space[e].show&&t._space[e].on("change:show",function(e){"size"===t._type&&t.which===t.which_1&&(t.which_1=""),se(function(){t.load().then(function(){},function(t){Ft(t)})})})}),this.on("change:which",function(e){t.load()}),this.on("hook_change",function(){t._spaceDims={},t.setReady(!1)})},getSubhooks:function(t){return this.getSubmodels(t,function(t){return t.isHook()})},getHookWhich:function(t){var e=[];return this.use&&this.use===t&&e.push(this.which),xt(this.getSubmodels(),function(i){e=Et(e.concat(i.getHookWhich(t)))}),e},getIndicators:function(){return this.getHookWhich("indicator")},getProperties:function(){return this.getHookWhich("property")},getDimension:function(){return this.dim||!1},getDimensionOrWhich:function(){return this.dim||("constant"!=this.use?this.which:!1)},getFilter:function(){return{}},mapValue:function(t){return t},getNestedItems:function(t){return t?De.get(this._dataId,"nested",t):Ft("No keys provided to getNestedItems(<keys>)")},getParser:function(){return null},getDataManager:function(){return De},getLimits:function(t){return De.get(this._dataId,"limits",t)},_getAllDimensions:function(t){var e=JSON.stringify(t);if(e in this._spaceDims)return this._spaceDims[e];t=t||{};var i,a=[],n=this._space;if(!this.isHook()&&this.space){n=[];var s=this;xt(this.space,function(t){n.push(_(s,t))})}return xt(n,function(e){return t.exceptType&&e.getType()===t.exceptType?!0:t.onlyType&&e.getType()!==t.onlyType?!0:void((i=e.getDimension())&&a.push(i))}),this._spaceDims[e]=a,a},_getFirstDimension:function(t){t=t||{};var e=this._space;if(!this.isHook()&&this.space){e=[];var i=this;xt(this.space,function(t){e.push(_(i,t))})}var a=!1;return xt(e,function(e){return t.exceptType&&e.getType()!==t.exceptType?(a=e.getDimension(),!1):t.type&&e.getType()===t.type?(a=e.getDimension(),!1):t.exceptType||t.type?void 0:(a=e.getDimension(),!1)}),a},_getAllFilters:function(t,e){t=t||{};var i={};return xt(this._space,function(a){return t.exceptType&&a.getType()===t.exceptType?!0:t.onlyType&&a.getType()!==t.onlyType?!0:void(i=_t(i,a.getFilter(e)))}),i},_getGrouping:function(){var t={};return xt(this._space,function(e){t[e.dim]=e.grouping||void 0}),t},_getAllParsers:function(){function t(t){var i=t.getParser(),a=t.getDimensionOrWhich();i&&a&&(e[a]=i)}var e={};return xt(this._space,function(e){t(e)}),t(this),e},getDefaults:function(){if(this._defaults)return this._defaults;var t={};return xt(this.getSubmodels(!0),function(e,i){t[i]=e.getDefaults()}),t}});/*!
       * VIZABI Time Model
       */
Date.prototype.utc=Date.prototype.toUTCString;var Be={year:d3.time.format.utc("%Y"),month:d3.time.format.utc("%Y%m"),day:d3.time.format.utc("%Y%m%d"),hour:d3.time.format.utc("%Y-%m-%d %H"),minute:d3.time.format.utc("%Y-%m-%d %H:%M"),second:d3.time.format.utc("%Y-%m-%d %H:%M:%S"),week:w(),quarter:S()},Re=Ie.extend({_defaults:{dim:"time",value:"2015",start:"1800",end:"2016",startSelected:"1800",endSelected:"2015",playable:!0,playing:!1,loop:!1,round:"round",delay:600,delayThresholdX2:600,delayThresholdX4:600,unit:"year",step:1,immediatePlay:!1,record:!1},init:function(t,e,i,a){this._type="time";var n=St(this._defaults);e=_t(n,e),this._super(t,e,i,a);var s=this;this.timeFormat=Be[this.unit],this.dragging=!1,this.postponePause=!1,this.allSteps={},this.delayAnimations=this.delay,this.on({"change:playing":function(){s.playing===!0?s._startPlaying():s._stopPlaying()},"change:unit":function(){s.timeFormat=Be[s.unit]}})},_formatToDates:function(){for(var t=["value","start","end","startSelected","endSelected"],e=0;e<t.length;e++){var i=t[e];if(!ct(this[i])){var a=this.parseToUnit(this[i].toString(),this.unit);this.set(i,a)}}},format:function(t,e){return e=e||this.unit,Be[e]?Be[e](t):Be.year(t)},parseToUnit:function(t,e){return e=e||this.unit,Be[e]?Be[e].parse(t):null},parse:function(t){for(var e=Object.keys(Be),i=0;i<e.length;i++){var a=Be[e[i]].parse(t);if(a)return{unit:e[i],time:a}}return null},validate:function(){Be[this.unit]||(Ft(this.unit+' is not a valid time unit, using "year" instead.'),this.unit="year"),this.step<1&&(this.step=1),ct(this.start)&&ct(this.end)&&ct(this.value)&&ct(this.startSelected)&&ct(this.endSelected)||this._formatToDates(),this.end<this.start&&(this.end=new Date(this.start)),this.value<this.startSelected&&(this.value=new Date(this.startSelected)),this.value>this.endSelected&&(this.value=new Date(this.endSelected)),this.startSelected<this.start&&(this.startSelected=new Date(this.start)),this.endSelected>this.end&&(this.endSelected=new Date(this.end)),this.value<this.start?this.value=new Date(this.start):this.value>this.end&&(this.value=new Date(this.end)),this.playable===!1&&this.playing===!0&&(this.playing=!1)},play:function(){this._startPlaying()},pause:function(t){t?this.postponePause=!0:this.playing=!1},dragStart:function(){this.dragging=!0},dragStop:function(){this.dragging=!1},getRange:function(){var t=this.getIntervalAndStep();return d3.time[t.interval].utc.range(this.start,this.end,t.step)},getIntervalAndStep:function(){var t,e;switch(this.unit){case"week":t="monday",e=this.step;break;case"quarter":t="month",e=3*this.step;break;default:t=this.unit,e=this.step}return{interval:t,step:e}},getFilter:function(t){var e=this.parseToUnit(this._defaults.start,this.unit),i=this.parseToUnit(this._defaults.end,this.unit),a=this.timeFormat(e||this.start),n=this.timeFormat(i||this.end),s=this.timeFormat(this.value),l=this.getDimension(),r={};return r[l]=t?[[s]]:[[a,n]],r},getParser:function(){return this.timeFormat.parse},getAllSteps:function(){var t=""+this.start+this.end+this.step;if(this.allSteps[t])return this.allSteps[t];this.allSteps[t]=[];for(var e=this.start;e<=this.end;){var i=this.getIntervalAndStep();this.allSteps[t].push(e),e=d3.time[i.interval].utc.offset(e,i.step)}return this.allSteps[t]},snap:function(t){if(this.round){null==t&&(t="value");var e="round";"ceil"===this.round&&(e="ceil"),"floor"===this.round&&(e="floor");var i=this.getIntervalAndStep(),a=d3.time[i.interval].utc[e](this[t]);this.set(t,a,!0)}},_startPlaying:function(){if(this.playable){var t=this;this.value>=this.endSelected&&t.getModelObject("value").set(t.startSelected,null,!1),this.playing=!0,this.playInterval(this.immediatePlay),this.trigger("play")}},playInterval:function(t){if(this.playing){var e=this;this.delayAnimations=this.delay,this.delay<this.delayThresholdX2&&(this.delayAnimations*=2),this.delay<this.delayThresholdX4&&(this.delayAnimations*=2);var i=t?1:this.delayAnimations;this._intervals.setInterval("playInterval_"+this._id,function(){if(e.value>=e.endSelected)return void(e.loop?e.getModelObject("value").set(e.startSelected,null,!1):e.playing=!1);if(e._intervals.clearInterval("playInterval_"+e._id),e.postponePause||!e.playing)e.playing=!1,e.postponePause=!1,e.getModelObject("value").set(e.value,!0,!0);else{var t=e.getIntervalAndStep();e.delay<e.delayThresholdX2&&(t.step*=2),e.delay<e.delayThresholdX4&&(t.step*=2);var i=d3.time[t.interval].utc.offset(e.value,t.step);i>=e.endSelected?e.getModelObject("value").set(e.endSelected,null,!0):e.getModelObject("value").set(i,null,!1),e.playInterval()}},i)}},incrementTime:function(t){var e=this.getIntervalAndStep();return d3.time[e.interval].utc.offset(t,e.step)},_stopPlaying:function(){this._intervals.clearInterval("playInterval_"+this._id),this.trigger("pause")}}),Fe=Ie.extend({_important:!1,getTickFormatter:function(){var t=this,e="share",i="percent";return function a(n,s,l,r){if(r=t.getConceptprops().format,r===e&&(n*=100),ct(n))return t._space.time.timeFormat(n);if("time"===t.scaleType&&!ct(n))return t._space.time.timeFormat(new Date(n));if(ht(n)||!n&&0!==n)return n;if(Math.abs(n)<1e-14)return"0";var a="r",o=3,c="";if(l)return d3.format("."+o+a)(n);switch(Math.floor(Math.log(Math.abs(n))/Math.LN10+1e-14)){case-13:n=1e12*n,c="p";break;case-10:n=1e9*n,c="n";break;case-7:n=1e6*n,c="µ";break;case-6:n=1e6*n,c="µ";break;case-5:n=1e6*n,c="µ";break;case-4:break;case-3:break;case-2:break;case-1:break;case 0:break;case 1:break;case 2:break;case 3:break;case 4:n/=1e3,c="k";break;case 5:n/=1e3,c="k";break;case 6:n/=1e6,c="M";break;case 7:n/=1e6,c="M";break;case 8:n/=1e6,c="M";break;case 9:n/=1e9,c="B";break;case 10:n/=1e9,c="B";break;case 11:n/=1e9,c="B";break;case 12:n/=1e12,c="TR";break;case 13:n/=1e12,c="TR";break;case 14:n/=1e12,c="TR";break;default:return d3.format("."+o+"s")(n).replace("G","B")}var h=d3.format("."+o+a)(n);return h.indexOf(".")>-1&&(h=h.replace(/0+$/,"").replace(/\.$/,"")),h+c+(r===i||r===e?"%":"")}},getScale:function(t){return this.scale||this.buildScale(t),this.scale},buildScale:function(){if(this.isHook()){var t,e=this.scaleType||"linear";switch(this.use){case"indicator":var i=this.getLimits(this.which);t=[i.min,i.max];break;case"property":t=this.getUnique(this.which);break;default:t=[this.which]}this.scale="time"===e?d3.time.scale.utc().domain(t):d3.scale[e]().domain(t)}},gerLimitsPerFrame:function(){if("property"===this.use)return Ft("getMaxMinMean: strange that you ask min max mean of a property");if(!this.isHook)return Ft("getMaxMinMean: only works for hooks");var t={},e=null,i=this._getFirstDimension({type:"time"}),a=this._parent._parent.time.getAllSteps();if("constant"===this.use)a.forEach(function(i){e=this.which,t[i]={min:e,max:e}});else if(this.which===i)a.forEach(function(i){e=new Date(i),t[i]={min:e,max:e}});else{var n={framesArray:a,which:this.which};t=this.getDataManager().get(this._dataId,"limitsPerFrame",n)}return t},getUnique:function(t){return this.isHook()?(t||(t=this._getFirstDimension({type:"time"})),this.getDataManager().get(this._dataId,"unique",t)):void 0},getValidItems:function(){return this.getDataManager().get(this._dataId,"valid",this.which)},getNestedItems:function(t){return this.getDataManager().get(this._dataId,"nested",t)},getLimitsByDimensions:function(t){var e=this.getDataManager().get(this._dataId,"nested",t),i={},a=this.which,n=function(t,e,i){for(var n,s,l=t.reduce(function(t,e){var i=ct(e[a])?e[a]:parseFloat(e[a]);return isNaN(i)||t.push(i),t},[]),r={},o=0;o<l.length;o+=1){var c=l[o];("undefined"==typeof n||n>c)&&(n=c),("undefined"==typeof s||c>s)&&(s=c)}r.min=n||0,r.max=s||100,e[i]=r},s=function(t,e,i,a){e--,xt(t,function(t,n){e?(i[n]={},s(t,e,i[n],a)):a(t,i,n)})};return s(e,t.length,i,n),i},getConceptprops:function(){return"constant"!==this.use?this.getDataManager().getConceptprops(this.which):{}}}),Ne={ALL:"all",_default:"none"},qe=Fe.extend({_defaults:{use:null,which:null,merge:!1},init:function(t,e,i,a){this._type="model";var n=St(this._defaults);e=_t(n,e),this._super(t,e,i,a)},validate:function(){this.scale&&(this.scale=null),"indicator"===this.use&&(Ft("stack model: use must not be 'indicator'. Resetting use to 'constant' and which to '"+Ne._default),this.use="constant",this.which=Ne._default),"constant"===this.use&&-1==Gt(Ne).indexOf(this.which)&&(Ft("stack model: the requested value '"+this.which+"' is not allowed. resetting to '"+Ne._default),this.which==Ne._default)},getPalettes:function(){return Ne},buildScale:function(){}}),He={indicator:["linear","log","genericLog","time","pow"],property:["ordinal"],constant:["ordinal"]},Ye=Fe.extend({_important:!0,_defaults:{use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null},_type:"axis",init:function(t,e,i,a){var n=St(this._defaults);e=_t(n,e),this._super(t,e,i,a)},validate:function(){if(-1===He[this.use].indexOf(this.scaleType)&&(this.scaleType=He[this.use][0]),this.which_1==this.which&&this.scaleType_1==this.scaleType||(this.scale=null),this.which_1=this.which,this.scaleType_1=this.scaleType,this.scale&&this._readyOnce&&"indicator"===this.use){if("time"==this.scaleType){var t=this._space.time,e=t.beyondSplash?{min:t.beyondSplash.start,max:t.beyondSplash.end}:{min:t.start,max:t.end};(this.scale.domain()[0]<e.min||this.scale.domain()[1]>e.max)&&this.scale.domain([e.min,e.max]),null==this.zoomedMin||ct(this.zoomedMin)||(this.zoomedMin=this._space.time.parseToUnit(this.zoomedMin.toString())),null==this.zoomedMax||ct(this.zoomedMax)||(this.zoomedMax=this._space.time.parseToUnit(this.zoomedMax.toString())),ct(this.domainMin)||(this.domainMin=this.scale.domain()[0]),ct(this.domainMax)||(this.domainMax=this.scale.domain()[1])}(null==this.domainMin||this.domainMin<=0&&"log"===this.scaleType)&&(this.domainMin=this.scale.domain()[0]),(null==this.domainMax||this.domainMax<=0&&"log"===this.scaleType)&&(this.domainMax=this.scale.domain()[1]),(null==this.zoomedMin||this.zoomedMin<this.scale.domain()[0])&&(this.zoomedMin=this.scale.domain()[0]),(null==this.zoomedMax||this.zoomedMax>this.scale.domain()[1])&&(this.zoomedMax=this.scale.domain()[1]),this.scale.domain([this.domainMin,this.domainMax])}},buildScale:function(t){var e;if("time"==this.scaleType){var i=this._space.time,a=i.beyondSplash?{min:i.beyondSplash.start,max:i.beyondSplash.end}:{min:i.start,max:i.end};return e=[a.min,a.max],void(this.scale=d3.time.scale.utc().domain(e))}switch(this.use){case"indicator":var a=this.getLimits(this.which);e=[a.min,a.max],e=this.getConceptprops().domain?this.getConceptprops().domain:e,e=null!=this.domainMin&&null!=this.domainMax?[+this.domainMin,+this.domainMax]:e;break;case"property":e=this.getUnique(this.which);break;case"constant":default:e=[this.which]}var n=d3.min(e)<=0&&d3.max(e)>=0&&"log"===this.scaleType?"genericLog":this.scaleType;this.scale=d3.scale[n||"linear"]().domain(e)}}),je=Ye.extend({_defaults:{use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,extent:null},_type:"size",buildScale:function(t){this._super(t),"ordinal"!==this.scaleType&&this.scale.clamp(!0)}}),Ve=Ie.extend({getTimeLimits:function(t){var e,i,a=this,n=this._parent.time,s=[],l=[],r={};this.cachedTimeLimits||(this.cachedTimeLimits={}),xt(this.getSubhooks(),function(t){if("indicator"===t.use&&t._important){var o=t.getConceptprops();if(!o)return Ft(t._name+": "+t.which+" is not found in metadata.json.             Check that you read the correct file or server instance...             Check that the pointer 'which' of the hook is correct too");var c=o.availability,h=a.cachedTimeLimits[t._dataId+t.which];if(h)e=h.min,i=h.max;else if(c){e=n.timeFormat.parse(c[0]+"");var d=n._defaults.end||c[1];i=n.timeFormat.parse(Math.min(d,c[1])+"")}else r=t.getValidItems().map(function(t){return t[n.getDimension()]}),e=d3.min(r),i=d3.max(r);a.cachedTimeLimits[t._dataId+t.which]={min:e,max:i},s.push(e),l.push(i)}});var o=d3.max(s),c=d3.min(l);return o>c&&(o=d3.min(s),c=d3.max(l),Ft("getTimeLimits(): Availability of the indicator's data has no intersection. I give up and just return some valid time range where you'll find no data points. Enjoy!")),{min:o,max:c}},getKeys:function(t){var e=this,i=[];t=t||this._getFirstDimension();var a=this._getFirstDimension({type:"time"});return xt(this._dataCube||this.getSubhooks(!0),function(n,s){if("constant"!==n.use){var l=e.getDataManager().get(n._dataId,"nested",[t,a]),r=e.getDataManager().get(n._dataId,"haveNoDataPointsPerKey",n.which),o=Object.keys(l),c=Object.keys(r||[]);0==i.length&&(i=o),n._important&&(i=i.filter(function(t){return o.indexOf(t)>-1&&-1==c.indexOf(t)}))}}),i.map(function(e){var i={};return i[t]=e,i})},getFrame:function(t,e){var i=this;this.cachedFrames||(this.cachedFrames={}),this._dataCube=this._dataCube||this.getSubhooks(!0);var a=this._parent.time.getAllSteps(),n=a[0]+" - "+a[a.length-1],s=!1;if(xt(this._dataCube,function(t,e){t._loadCall&&(s=!0),n=n+"_"+t._dataId}),s)return e(null,t);if(t&&i.cachedFrames[n]&&i.cachedFrames[n][t])return e(i.cachedFrames[n][t],t);if(t&&a.length>1){var l=d3.bisectLeft(a,t);a[l]||Ft("The requested frame is out of range"),a[l].toString()!=t.toString()&&this._interpolateBetweenFrames(t,l,a,function(i){return e(i,t)})}i.getFrames(t).then(function(){return!t&&i.cachedFrames[n]?e(i.cachedFrames[n],t):i.cachedFrames[n][t]?e(i.cachedFrames[n][t],t):(Ft("marker.js getFrame: Data is not available for frame: "+t),e(null,t))})},_interpolateBetweenFrames:function(t,e,i,a){var n=this;if(0==e)this.getFrame(i[e],function(t){return a(t)});else{var s=i[e-1],l=i[e];this.getFrame(s,function(e){n.getFrame(l,function(i){var n=(t-s)/(l-s),r={};xt(e,function(e,a){r[a]={},xt(e,function(e,s){var l=i[a][s];ct(e)?r[a][s]=t:ut(e)?r[a][s]=null==e||null==l?null:e+(l-e)*n:r[a][s]=e})}),a(r)})})}},getFrames:function(t){var e=this,i=this._getFirstDimension(),a=this._getFirstDimension({type:"time"});this.frameQueues||(this.frameQueues={}),this.partialResult||(this.partialResult={});var n=this._parent.time.getAllSteps(),s=n[0]+" - "+n[n.length-1];return xt(this._dataCube,function(t,e){s=s+"_"+t._dataId}),(!this.frameQueues[s]||!this.frameQueues[s]instanceof l)&&(this.frameQueues[s]=new l(function(t,r){e.partialResult[s]={},n.forEach(function(t){e.partialResult[s][t]={}});var o=e.getKeys(),c=[];if(xt(e._dataCube,function(t,l){"constant"===t.use?n.forEach(function(a){e.partialResult[s][a][l]={},o.forEach(function(n){e.partialResult[s][a][l][n[i]]=t.which})}):t.which===i?n.forEach(function(t){e.partialResult[s][t][l]={},o.forEach(function(a){e.partialResult[s][t][l][a[i]]=a[i]})}):t.which===a?n.forEach(function(t){e.partialResult[s][t][l]={},o.forEach(function(a){e.partialResult[s][t][l][a[i]]=new Date(t)})}):c.push({hook:t,name:l})}),c.length>0){for(var h=[],d=0;d<c.length;d++)!function(t){var i=c[t];h.push(new l(function(t,a){e.getDataManager().getFrames(i.hook._dataId,n).then(function(a){xt(a,function(t,a){e.partialResult[s][a][i.name]=t[i.hook.which]}),t()})}))}(d);l.all(h).then(function(){e.cachedFrames[s]=e.partialResult[s],t()})}else e.cachedFrames[s]=e.partialResult[s],t()})),new l(function(r,o){if(n.length<2||!t)e.frameQueues[s].then(function(){r()});else{var c=[];xt(e._dataCube,function(r,o){"constant"!==r.use&&r.which!==i&&r.which!==a&&!function(i,a){c.push(new l(function(l,r){e.getDataManager().getFrame(i._dataId,n,t).then(function(n){e.partialResult[s][t][a]=n[t][i.which],l()})}))}(r,o)}),c.length>0&&l.all(c).then(function(){e.cachedFrames[s]||(e.cachedFrames[s]={}),e.cachedFrames[s][t]=e.partialResult[s][t],r()})}})},getValues:function(t,e,i){var a=this;if(this.isHook())return[];var n,s,l,r,o,c,h,d,o;this._dataCube=this._dataCube||this.getSubhooks(!0),t=wt(t,this._getAllDimensions()),n=this._getFirstDimension({type:"time"}),s=new Date(t[n]),t=wt(t,null,n);var u={},m=Object.keys(t),g=m.map(function(e){return t[e]});return m.length?xt(this._dataCube,function(e,p){if(c=e.use,h=e.which,"property"!==e.use&&(r=r||d3.bisectLeft(e.getUnique(n),s)),o=e.getConceptprops?e.getConceptprops().interpolation:null,l=a.getDataManager().get(e._dataId,"nested",m),xt(g,function(t){l=l[t]}),d=de(l,c,h,r,n,s,o),u[p]=e.mapValue(d),i){var f=Ct(l,t).filter(function(t){return t[n]<=s}).map(function(t){return e.mapValue(t[h])}).concat(u[p]);u[p]=f}}):xt(this._dataCube,function(m,g){l=a.getDataManager().get(m._dataId,"nested",e),u[g]={},c=m.use,h=m.which,"property"!==m.use&&(r="undefined"==typeof r?d3.bisectLeft(m.getUnique(n),s):r),o=m.getConceptprops?m.getConceptprops().interpolation:null;var p=function(e,a,l){if(r=d3.bisectLeft(e.map(function(t){return t[n]}),s),d=de(e,c,h,r,n,s,o),a[l]=m.mapValue(d),i){var u=Ct(e,t).filter(function(t){return t[n]<=s}).map(function(t){return m.mapValue(t[h])}).concat(a[l]);a[l]=u}},f=function(t,e,i,a){e--,xt(t,function(t,n){e?(i[n]={},f(t,e,i[n],a)):a(t,i,n)})};f(l,e.length,u[g],p)}),u},getConceptprops:function(){return this.getDataManager().getConceptprops()},getIndicatorsTree:function(){return this.getDataManager().getIndicatorsTree()}}),Xe=Ie.extend({_defaults:{id:"en",strings:{}},init:function(t,e,i,a){this._type="language";var n=St(this._defaults);e=_t(n,e),this._super(t,e,i,a)},getUIString:function(t,e,i){return e=e||this.id,i=i||this.strings,i&&i[e]&&(i[e][t]||""===i[e][t])?i[e][t]:(i&&i[e]||Ft("Strings are not loaded for the "+e+" language. Check if translation JSON is valid"),t)},getTFunction:function(){var t=this.id,e=this.strings,i=this;return function(a){return i.getUIString(a,t,e)}}}),Ke=Fe.extend({_defaults:{},init:function(t,e,i,a){this._type="label";var n=St(this._defaults);e=_t(n,e),this._super(t,e,i,a)}}),We=Fe.extend({_defaults:{use:null,which:null,merge:!1,manualSorting:null},init:function(t,e,i,a){this._type="model";var n=St(this._defaults);e=_t(n,e),this._super(t,e,i,a)},validate:function(){this.scale&&(this.scale=null),"property"!=this.use&&(Ft("group model: use must be 'property'. Resetting..."),this.use="property")},buildScale:function(){}}),Ue=Ie.extend({_defaults:{show:{},select:[],highlight:[],opacityHighlightDim:.1,opacitySelectDim:.3,opacityRegular:1},init:function(t,e,i,a){this._type="entities";var n=St(this._defaults);e=_t(n,e),this._visible=[],this._multiple=!0,this._super(t,e,i,a)},validate:function(t){var e=this.getDimension(),i=this._visible.map(function(t){return t[e]});i.length&&(this.select=this.select.filter(function(t){return-1!==i.indexOf(t[e])}),this.setHighlight(this.highlight.filter(function(t){return-1!==i.indexOf(t[e])})))},setVisible:function(t){this._visible=t},getVisible:function(t){return this._visible},selectMultiple:function(t){this._multiple=t},getDimension:function(){return this.dim},getFilter:function(){return this.show.getPlainObject()},getSelected:function(){var t=this.getDimension();return this.select.map(function(e){return e[t]})},selectEntity:function(t,e,i){var a=this.getDimension(),n=t[a];if(this.isSelected(t))this.select=this.select.filter(function(t){return t[a]!==n});else{var s={};s[a]=n,e&&i&&(s.trailStartTime=i(t[e])),this.select=this._multiple?this.select.concat(s):[s]}},selectEntityMD:function(t,e,i){var a=this,n=this._createValue(t);this.isSelectedMD(t)?this.select=this.select.filter(function(t){return JSON.stringify(a._createValue(t))!==JSON.stringify(n)}):(e&&i&&(n.trailStartTime=i(t[e])),this.select=this._multiple?this.select.concat(n):[n])},selectAll:function(t,e){if(this._multiple){var i,a=this.getDimension(),n=this._visible.map(function(n){return i={},i[a]=n[a],t&&e&&(i.trailStartTime=e(n[t])),i});this.select=n}},showEntity:function(t){this.clearSelected();var e=this.getDimension(),i=t[e],a=this.show[e];a&&"*"!==a[0]||(a=[]),a=a.concat([]),a=this.isShown(t)?a.filter(function(t){return t!==i}):a.concat(i),0===a.length&&(a=["*"]),this.show[e]=a.concat([])},setLabelOffset:function(t,e){if(0!==e[0]||1!==e[1]){var i=this.getDimension(),a=t[i];Ot(this.select,function(t){return t[i]===a}).labelOffset=[Math.round(1e3*e[0])/1e3,Math.round(1e3*e[1])/1e3],this.set("select",this.select,!0)}},isSelected:function(t){var e=this.getDimension(),i=t[this.getDimension()];return-1!==this.select.map(function(t){return t[e]}).indexOf(i)},isSelectedMD:function(t){var e=this,i=this._createValue(t);return-1!==this.select.map(function(t){return JSON.stringify(e._createValue(t))===JSON.stringify(i)}).indexOf(!0)},_createValue:function(t){var e=this.getDimension()?[this.getDimension()].concat(this._getAllDimensions()):this._getAllDimensions();return e.reduce(function(e,i){return e[i]=t[i],e},{})},isShown:function(t){var e=this.getDimension();return this.show[e]&&-1!==this.show[e].indexOf(t[e])},clearSelected:function(){this.select=[]},clearShow:function(){var t=this.getDimension();this.show[t]=["*"]},setHighlight:function(t){rt(t)||this.setHighlight([].concat(t)),this.getModelObject("highlight").set(t,!1,!1)},highlightEntity:function(t,e,i,a){var n=this.getDimension(),s=t[n];if(!this.isHighlighted(t)){var l={};a?l=wt(t):(l[n]=s,e&&i&&(l.trailStartTime=i(t[e]))),this.setHighlight(this.highlight.concat(l))}},unhighlightEntity:function(t){var e=this.getDimension(),i=t[e];this.isHighlighted(t)&&this.setHighlight(this.highlight.filter(function(t){return t[e]!==i}))},isHighlighted:function(t){var e=this.getDimension(),i=t[this.getDimension()],a=this.highlight.map(function(t){return t[e]});return-1!==a.indexOf(i)},clearHighlighted:function(){this.setHighlight([])}}),Ge=Ie.extend({_defaults:{reader:"csv",splash:!1},init:function(t,e,i,a){this._type="data";var n=St(this._defaults);e=_t(n,e),this._super(t,e,i,a)}}),Qe={_continuous:{0:"#B4DE79",50:"#E1CE00",100:"#F77481"},_discrete:{0:"#bcfa83",1:"#4cd843",2:"#ff8684",3:"#e83739",4:"#ffb04b",5:"#ff7f00",6:"#f599f5",7:"#c027d4",8:"#f4f459",9:"#d66425",10:"#7fb5ed",11:"#0ab8d8"},_default:{_default:"#93daec"}},Ze=Fe.extend({_defaults:{use:null,palette:{},paletteLabels:null,scaleType:null,which:null},init:function(t,e,i,a){this._type="color";var n=St(this._defaults);e=_t(n,e),this._original_palette=e.palette,this._super(t,e,i,a),this._firstLoad=!0,this._hasDefaultColor=!1},getColorShade:function(t){var e=this.getPalette();if(!t)return Ft("getColorShade() is missing arguments");if(t.colorID&&e[t.colorID]||(t.colorID="_default"),!rt(e[t.colorID]))return e[t.colorID];var i=this.getConceptprops().color,a=t.shadeID&&i&&i.shades&&i.shades[t.shadeID]?i.shades[t.shadeID]:0;return e[t.colorID][a]},afterPreload:function(){this._super()},isUserSelectable:function(){var t=this.getConceptprops().color;return null==t||null==t.selectable||t.selectable},validate:function(){var t=["log","genericLog","linear","time","pow"];(!this.scaleType||"indicator"===this.use&&-1===t.indexOf(this.scaleType))&&(this.scaleType="linear"),"indicator"!==this.use&&"ordinal"!==this.scaleType&&(this.scaleType="ordinal"),this._firstLoad!==!1||this.which_1==this.which&&this.scaleType_1==this.scaleType||(this.palette&&(this.palette._data={}),this.scale=null),this.which_1=this.which,this.scaleType_1=this.scaleType,this._firstLoad=!1},setColor:function(t,e){var i=this.getPalette();i[e]=t,this.scale.range(Gt(i)),this.palette[e]=t},mapValue:function(t){return null!=this.scale&&"property"==this.use&&this._hasDefaultColor&&-1==this.scale.domain().indexOf(t)&&(t="_default"),this._super(t)},getDefaultPalette:function(){var t,e=this.getConceptprops().color;return t=e&&e.palette?wt(e.palette):Qe[this.which]?wt(Qe[this.which]):"constant"===this.use&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(this.which)?{_default:this.which}:wt("indicator"===this.use?Qe._continuous:"property"===this.use?Qe._discrete:Qe._default)},_getPaletteLabels:function(){var t,e=this.getConceptprops().color;return e&&e.paletteLabels&&(t=wt(e.paletteLabels)),t},getPaletteLabels:function(){return this.paletteLabels.getPlainObject()},getPalette:function(){return this.palette&&0!==Object.keys(this.palette._data).length||(this.palette.set(this.getDefaultPalette(),!1,!1),this.getModelObject("paletteLabels").set(this._getPaletteLabels(),!1,!1)),this.palette.getPlainObject()},buildScale:function(){var t=this,e=t.getPalette(),i=Object.keys(e),a=Gt(e);if(this._hasDefaultColor=i.indexOf("_default")>-1,"time"==this.scaleType){var n=this._space.time,s=n.beyondSplash?{min:n.beyondSplash.start,max:n.beyondSplash.end}:{min:n.start,max:n.end},l=s.max-s.min==0;return i=i.sort(function(t,e){return t-e}),a=i.map(function(t){return l?e[i[0]]:e[t]}),i=i.map(function(t){return s.min.valueOf()+t/100*(s.max.valueOf()-s.min.valueOf())}),void(this.scale=d3.time.scale.utc().domain(i).range(a).interpolate(d3.interpolateRgb))}switch(this.use){case"indicator":var s=this.getLimits(this.which);s=[s.min,s.max],s=this.getConceptprops().domain?this.getConceptprops().domain:s;var l=s[1]-s[0]==0;i=i.sort(function(t,e){return t-e}),a=i.map(function(t){return l?e[i[0]]:e[t]}),i=i.map(function(t){return s[0]+t/100*(s[1]-s[0])});var r=d3.min(i)<=0&&d3.max(i)>=0&&"log"===this.scaleType?"genericLog":this.scaleType;if("log"==this.scaleType||"genericLog"==this.scaleType){var o=d3.scale.genericLog().domain(s).range(s);i=i.map(function(t){return o.invert(t)})}return void(this.scale=d3.scale[r||"linear"]().domain(i).range(a).interpolate(d3.interpolateRgb));default:return a=a.map(function(t){return rt(t)?t[0]:t}),void(this.scale=d3.scale.ordinal().domain(i).range(a))}}}),Je={axis:Ye,color:Ze,data:Ge,entities:Ue,group:We,hook:Fe,label:Ke,language:Xe,marker:Ve,size:je,stack:qe,time:Re},$e=Object.freeze({axis:Ye,color:Ze,data:Ge,entities:Ue,group:We,hook:Fe,label:Ke,language:Xe,marker:Ve,size:je,stack:qe,time:Re,"default":Je}),ti="vzb-loading-first",ei="vzb-loading-data",ii="vzb-error",ai={},ni=Le.extend({init:function(t,e){if(this._id=this._id||st("c"),this._ready=!1,this._readyOnce=!1,this.name=this.name||t.name,this.template=this.template||"<div></div>",this.placeholder=this.placeholder||t.placeholder,this.template_data=this.template_data||{name:this.name},this.placeholder&&!lt(this.placeholder))try{this.placeholder=e.placeholder.querySelector(this.placeholder)}catch(i){Ht("Error finding placeholder '"+this.placeholder+"' for component '"+this.name+"'")}this.parent=e||this,this.root=this.parent.root||this,this.components=this.components||[],this._components_config=this.components.map(function(t){return wt(t)}),this._frameRate=10,this.model_expects=this.model_expects||[],this.model_binds=this.model_binds||{},this.ui=this.ui||t.ui,this._super();var a=this;this.on({readyOnce:function(){"function"==typeof a.readyOnce&&a.readyOnce()},ready:function(){"function"==typeof a.ready&&a.ready()},domReady:function(){"function"==typeof a.domReady&&a.domReady()},resize:function(){"function"==typeof a.resize&&a.resize()}}),this.triggerResize=Wt(this.triggerResize,100)},preload:function(t){t.resolve()},afterPreload:function(){this.model&&this.model.afterPreload()},render:function(){function t(){Vt(i.placeholder,ti),Vt(i.placeholder,ei),jt(i.placeholder,ii),i.setError({type:"data"})}function e(){Vt(i.placeholder,ti),Vt(i.placeholder,ei),i.setReady()}var i=this;if(this.loadTemplate(),this.loadComponents(),xt(this.components,function(t){t.render(),i.on("resize",function(){t.trigger("resize")})}),this.model.on("ready",function(){e()}),this.isRoot()&&this.model){this.model.setHooks();var a=this.model&&this.model.data&&this.model.data.splash;k(this).then(function(){var n=i.model.state.time;a?(n.splash=!0,n.beyondSplash=wt(n.getPlainObject(),["start","end"]),i.model.load({splashScreen:!0}).then(function(){le(function(){i.model.setLoading("restore_orig_time"),n.start=n.beyondSplash.start,n.end=n.beyondSplash.end,delete n.beyondSplash,i.model.load().then(function(){i.model.setLoadingDone("restore_orig_time"),n.splash=!1,n.trigger("change",n.getPlainObject())})},300)},function(){t()})):i.model.load().then(function(){le(function(){n?n.trigger("change"):e()},300)},function(){t()})})}else this.model&&this.model.isLoading()||e()},setError:function(t){"function"==typeof this.error&&this.error(t)},setReady:function(t){this._readyOnce||(this.trigger("readyOnce"),this._readyOnce=!0),this._ready=!0,this.trigger("ready")},loadTemplate:function(){var t=this.template,e=this.template_data,i=this,a="";if(this.placeholder){if(e=_t(e,{t:this.getTranslationFunction(!0)}),this.template)try{a=E(t,e)}catch(n){Ht("Templating error for component: '"+this.name+"' - Check if template name is unique and correct. E.g.: 'bubblechart'"),Vt(this.placeholder,ei),jt(this.placeholder,ii),this.setError({type:"template"})}jt(this.placeholder,ei),jt(this.placeholder,ti),this.placeholder.innerHTML=a,this.element=this.placeholder.children[0],this.layout&&(this.layout.setContainer(this.element),this.layout.on("resize",function(){i._ready&&i.triggerResize()})),this.trigger("domReady")}},triggerResize:function(){this.trigger("resize")},getActiveProfile:function(t,e){var i=this.getLayoutProfile(),a=this.getPresentationMode(),n=St(t[i]);return a&&(e||{})[i]&&zt(n,e[i]),n},loadComponents:function(){var t,e,i=this;this.components=[],this.model&&this.model.resetDeps(),xt(this._components_config,function(a){if(!a.component)return void Ht("Error loading component: name not provided");if(e=ht(a.component)?ni.get(a.component):a.component){t=_t(a,{name:a.component,ui:i._uiMapping(a.placeholder,a.ui)});var n=new e(t,i),s=a.model||[];n.model=i._modelMapping(n.name,s,n.model_expects,n.model_binds),i.components.push(n)}})},isRoot:function(){return this.parent===this},findChildByName:function(t){return Ot(this.components,function(e){return e.name===t})},getLayoutProfile:function(){return this.layout?this.layout.currentProfile():this.parent.getLayoutProfile()},getPresentationMode:function(){return this.layout?this.layout.getPresentationMode():this.parent.getPresentationMode()},_uiMapping:function(t,e){if(e)return new Ie("ui",e);if(t&&this.ui){t=t.replace(".","");var i=this.ui[t];if(i)return i}return this.ui},_modelMapping:function(t,e,i,a){function n(t){for(var e=t.split("."),i=s.model,a="";e.length;)a=e.shift(),i=i[a];return{name:t,model:i,type:i?i.getType():null}}var s=this,l={};if(rt(e)&&rt(i)){i.length!==e.length&&(Nt("DIFFERENCE IN NUMBER OF MODELS EXPECTED AND RECEIVED"),Ft("Please, configure the 'model_expects' attribute accordingly in '"+t+"' or check the models passed in '"+s.name+"'.\n\nComponent: '"+s.name+"'\nSubcomponent: '"+t+"'\nNumber of Models Expected: "+i.length+"\nNumber of Models Received: "+e.length),qt()),xt(e,function(a,r){var o,c=n(a);i[r]?(o=i[r].name,!i[r].type||c.type===i[r].type||rt(i[r].type)&&-1!==i[r].type.indexOf(c.type)||(Nt("UNEXPECTED MODEL TYPE: '"+c.type+"' instead of '"+i[r].type+"'"),Ft("Please, configure the 'model_expects' attribute accordingly in '"+t+"' or check the models passed in '"+s.name+"'.\n\nComponent: '"+s.name+"'\nSubcomponent: '"+t+"'\nExpected Model: '"+i[r].type+"'\nReceived Model'"+c.type+"'\nModel order: "+r),qt())):(Nt("UNEXPECTED MODEL: '"+e[r]+"'"),Ft("Please, configure the 'model_expects' attribute accordingly in '"+t+"' or check the models passed in '"+s.name+"'.\n\nComponent: '"+s.name+"'\nSubcomponent: '"+t+"'\nNumber of Models Expected: "+i.length+"\nNumber of Models Received: "+e.length),qt(),o=c.name),l[o]=c.model});var r=e.length,o=i.length;return o>r&&(i.splice(0,r),xt(o,function(t){l[t.name]={}})),new Ie(t,l,null,a)}},getTranslationFunction:function(t){var e;try{e=this.model.get("language").getTFunction()}catch(i){this.parent&&this.parent!==this&&(e=this.parent.getTranslationFunction())}return e||(e=function(t){return t}),t?this._translatedStringFunction(e):e},_translatedStringFunction:function(t){return function(e){var i=t(e);return'<span data-vzb-translate="'+e+'">'+i+"</span>"}},translateStrings:function(){var t=this.getTranslationFunction(),e=this.placeholder.querySelectorAll("[data-vzb-translate]");0!==e.length&&xt(e,function(e){e&&e.getAttribute&&(e.innerHTML=t(e.getAttribute("data-vzb-translate")))})},isTool:function(){return"t"===this._id[0]},readyOnce:function(){},ready:function(){},resize:function(){},clear:function(){this.freeze(),this.model&&this.model.freeze(),xt(this.components,function(t){t.clear()})}});ni.isComponent=function(t){
return t._id&&("t"===t._id[0]||"c"===t._id[0])};var si="vzb-",li="presentation",ri="vzb-portrait",oi="vzb-landscape",ci=Le.extend({screen_profiles:{small:{min_width:0,min_height:0},medium:{min_width:600,min_height:400},large:{min_width:900,min_height:520}},init:function(t){this.ui=t||{},this._container=null,this._curr_profile=null,this._prev_size={};this.resizeHandler=this.resizeHandler||T.bind(this),window.addEventListener("resize",this.resizeHandler),this._super()},setSize:function(t){var e=this,i=this._container.clientWidth,a=this._container.clientHeight;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&navigator.userAgent.match(/iPhone/i)&&(this._container.style.top=0,this._container.clientWidth>this._container.clientHeight&&this._container.clientWidth<700)){var n=this._container.clientHeight,s=window.innerHeight;n-s>2&&45>=n-s&&(this._container.style.top="44px",document.body.scrollTop=44)}!t&&this._prev_size&&this._prev_size.width===i&&this._prev_size.height===a||(xt(this.screen_profiles,function(t,n){Vt(e._container,si+n),i>=t.min_width&&a>=t.min_height&&(e._curr_profile=n)}),jt(this._container,si+this._curr_profile),a>i?(jt(this._container,ri),Vt(this._container,oi)):(jt(this._container,oi),Vt(this._container,ri)),this._prev_size.width=i,this._prev_size.height=a,this.trigger("resize"))},setContainer:function(t){this._container=t,this.setSize(),this.updatePresentation()},updatePresentation:function(){this.ui.presentation?jt(this._container,si+li):Vt(this._container,si+li)},getPresentationMode:function(){return this.ui.presentation},currentProfile:function(){return this._curr_profile},clear:function(){window.removeEventListener("resize",this.resizeHandler)}}),hi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1615 0q70 0 122.5 46.5t52.5 116.5q0 63-45 151-332 629-465 752-97 91-218 91-126 0-216.5-92.5t-90.5-219.5q0-128 92-212l638-579q59-54 130-54zm-909 1034q39 76 106.5 130t150.5 76l1 71q4 213-129.5 347t-348.5 134q-123 0-218-46.5t-152.5-127.5-86.5-183-29-220q7 5 41 30t62 44.5 59 36.5 46 17q41 0 55-37 25-66 57.5-112.5t69.5-76 88-47.5 103-25.5 125-10.5z"/></svg>',di='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1216 832q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 52-38 90t-90 38q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',ui='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1664 896q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"/></svg>',mi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M883 1056q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23zm781-864v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45z"/></svg>',gi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1546 1050q46 26 59.5 77.5t-12.5 97.5l-64 110q-26 46-77.5 59.5t-97.5-12.5l-266-153v307q0 52-38 90t-90 38h-128q-52 0-90-38t-38-90v-307l-266 153q-46 26-97.5 12.5t-77.5-59.5l-64-110q-26-46-12.5-97.5t59.5-77.5l266-154-266-154q-46-26-59.5-77.5t12.5-97.5l64-110q26-46 77.5-59.5t97.5 12.5l266 153v-307q0-52 38-90t90-38h128q52 0 90 38t38 90v307l266-153q46-26 97.5-12.5t77.5 59.5l64 110q26 46 12.5 97.5t-59.5 77.5l-266 154z"/></svg>',pi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M 1381.375 17.1875 C 1375.7825 17.176804 1370.1216 17.316078 1364.4375 17.5625 C 1273.4913 21.505489 1197.0982 57.199956 1135.2188 124.6875 C 1076.5961 188.62338 1047.6964 263.96059 1048.5312 350.65625 L 835.71875 433 C 797.77288 391.67699 749.96961 361.96416 692.3125 343.84375 C 604.96227 316.39162 520.95691 323.70366 440.25 365.8125 C 359.5432 407.92133 305.45225 472.64985 278 560 C 250.54783 647.35004 257.89117 731.38694 300 812.09375 C 342.10886 892.80075 406.83755 946.89147 494.1875 974.34375 C 576.9404 1000.3512 657.38873 994.58645 735.5625 957.09375 L 959.28125 1171.4375 L 972.375 1184.4062 C 966.2931 1198.3454 961.94845 1209.2226 959.34375 1217.0625 C 956.73915 1224.9024 953.7186 1236.224 950.25 1251.0312 L 711.03125 1285.1875 C 669.59175 1209.0324 607.72526 1157.2863 525.40625 1129.9375 C 438.51381 1101.0693 354.34933 1107.021 272.96875 1147.8125 C 191.58796 1188.6039 136.49335 1252.4513 107.625 1339.3438 C 78.756758 1426.2362 84.708528 1510.3694 125.5 1591.75 C 166.29138 1673.1307 230.1387 1728.2567 317.03125 1757.125 C 403.92369 1785.9933 488.05682 1780.0415 569.4375 1739.25 C 650.81799 1698.4587 705.94425 1634.6111 734.8125 1547.7188 C 737.41718 1539.8788 740.43763 1528.5573 743.90625 1513.75 L 983.125 1479.5938 C 1024.5644 1555.7487 1086.4309 1607.4948 1168.75 1634.8438 C 1255.6425 1663.7119 1339.8069 1657.7603 1421.1875 1616.9688 C 1502.5682 1576.1772 1557.6631 1512.3299 1586.5312 1425.4375 C 1615.3996 1338.5451 1609.4477 1254.4119 1568.6562 1173.0312 C 1527.8647 1091.6506 1464.0174 1036.5244 1377.125 1007.6562 C 1294.9259 980.34721 1214.5066 984.74084 1135.8438 1020.8125 L 1120.2812 1005.9062 L 898.0625 785.96875 C 902.79653 774.40321 906.33847 765.03422 908.5 758.15625 C 920.42249 720.22 925.7916 682.90194 924.59375 646.21875 L 1130.9688 566.34375 C 1141.2015 577.59424 1149.3796 586.0106 1155.4688 591.59375 C 1222.9566 653.47326 1302.1474 682.44278 1393.0938 678.5 C 1484.04 674.55731 1560.4642 638.83151 1622.3438 571.34375 C 1684.2232 503.85591 1713.1929 424.6337 1709.25 333.6875 C 1705.3072 242.74139 1669.5816 166.34819 1602.0938 104.46875 C 1538.8238 46.456824 1465.2625 17.347946 1381.375 17.1875 z "/></svg>',fi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z"/></svg>',vi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1376 768q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-320q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45q0-106-75-181t-181-75-181 75-75 181v320h736z"/></svg>',bi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 960v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45zm755-672q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23z"/></svg>',yi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"><path d="M430.25,379.655l-75.982-43.869v59.771H120.73V151.966h59.774l-43.869-75.983L92.767,0L48.898,75.983L5.029,151.966h59.775 v271.557c0,15.443,12.52,27.965,27.963,27.965h261.5v59.773l75.982-43.869l75.982-43.867L430.25,379.655z"/></svg>',xi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1152 896q0-106-75-181t-181-75-181 75-75 181 75 181 181 75 181-75 75-181zm512-109v222q0 12-8 23t-20 13l-185 28q-19 54-39 91 35 50 107 138 10 12 10 25t-9 23q-27 37-99 108t-94 71q-12 0-26-9l-138-108q-44 23-91 38-16 136-29 186-7 28-36 28h-222q-14 0-24.5-8.5t-11.5-21.5l-28-184q-49-16-90-37l-141 107q-10 9-25 9-14 0-25-11-126-114-165-168-7-10-7-23 0-12 8-23 15-21 51-66.5t54-70.5q-27-50-41-99l-183-27q-13-2-21-12.5t-8-23.5v-222q0-12 8-23t19-13l186-28q14-46 39-92-40-57-107-138-10-12-10-24 0-10 9-23 26-36 98.5-107.5t94.5-71.5q13 0 26 10l138 107q44-23 91-38 16-136 29-186 7-28 36-28h222q14 0 24.5 8.5t11.5 21.5l28 184q49 16 90 37l142-107q9-9 24-9 13 0 25 10 129 119 165 170 7 8 7 22 0 12-8 23-15 21-51 66.5t-54 70.5q26 50 41 98l183 28q13 2 21 12.5t8 23.5z"/></svg>',_i='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54.849 54.849"><g><path d="M54.497,39.614l-10.363-4.49l-14.917,5.968c-0.537,0.214-1.165,0.319-1.793,0.319c-0.627,0-1.254-0.104-1.79-0.318     l-14.921-5.968L0.351,39.614c-0.472,0.203-0.467,0.524,0.01,0.716L26.56,50.81c0.477,0.191,1.251,0.191,1.729,0L54.488,40.33     C54.964,40.139,54.969,39.817,54.497,39.614z"/><path d="M54.497,27.512l-10.364-4.491l-14.916,5.966c-0.536,0.215-1.165,0.321-1.792,0.321c-0.628,0-1.256-0.106-1.793-0.321     l-14.918-5.966L0.351,27.512c-0.472,0.203-0.467,0.523,0.01,0.716L26.56,38.706c0.477,0.19,1.251,0.19,1.729,0l26.199-10.479     C54.964,28.036,54.969,27.716,54.497,27.512z"/><path d="M0.361,16.125l13.662,5.465l12.537,5.015c0.477,0.191,1.251,0.191,1.729,0l12.541-5.016l13.658-5.463     c0.477-0.191,0.48-0.511,0.01-0.716L28.277,4.048c-0.471-0.204-1.236-0.204-1.708,0L0.351,15.41     C-0.121,15.614-0.116,15.935,0.361,16.125z"/></g></svg>',zi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 384q-53 0-90.5 37.5t-37.5 90.5v128h-32v-93q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v429l-32-30v-172q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v224q0 47 35 82l310 296q39 39 39 102 0 26 19 45t45 19h640q26 0 45-19t19-45v-25q0-41 10-77l108-436q10-36 10-77v-246q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v32h-32v-125q0-40-25-72.5t-64-40.5q-14-2-23-2-46 0-79 33t-33 79v128h-32v-122q0-51-32.5-89.5t-82.5-43.5q-5-1-13-1zm0-128q84 0 149 50 57-34 123-34 59 0 111 27t86 76q27-7 59-7 100 0 170 71.5t70 171.5v246q0 51-13 108l-109 436q-6 24-6 71 0 80-56 136t-136 56h-640q-84 0-138-58.5t-54-142.5l-308-296q-76-73-76-175v-224q0-99 70.5-169.5t169.5-70.5q11 0 16 1 6-95 75.5-160t164.5-65q52 0 98 21 72-69 174-69z"/></svg>',Mi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.209 512.209"><path d="M507.345,439.683L288.084,37.688c-3.237-5.899-7.71-10.564-13.429-13.988c-5.705-3.427-11.893-5.142-18.554-5.142   s-12.85,1.718-18.558,5.142c-5.708,3.424-10.184,8.089-13.418,13.988L4.859,439.683c-6.663,11.998-6.473,23.989,0.57,35.98   c3.239,5.517,7.664,9.897,13.278,13.128c5.618,3.237,11.66,4.859,18.132,4.859h438.529c6.479,0,12.519-1.622,18.134-4.859   c5.62-3.23,10.038-7.611,13.278-13.128C513.823,463.665,514.015,451.681,507.345,439.683z M292.655,411.132   c0,2.662-0.91,4.897-2.71,6.704c-1.807,1.811-3.949,2.71-6.427,2.71h-54.816c-2.474,0-4.616-0.899-6.423-2.71   c-1.809-1.807-2.713-4.042-2.713-6.704v-54.248c0-2.662,0.905-4.897,2.713-6.704c1.807-1.811,3.946-2.71,6.423-2.71h54.812   c2.479,0,4.62,0.899,6.428,2.71c1.803,1.807,2.71,4.042,2.71,6.704v54.248H292.655z M292.088,304.357   c-0.198,1.902-1.198,3.47-3.001,4.709c-1.811,1.238-4.046,1.854-6.711,1.854h-52.82c-2.663,0-4.947-0.62-6.849-1.854   c-1.908-1.243-2.858-2.807-2.858-4.716l-4.853-130.47c0-2.667,0.953-4.665,2.856-5.996c2.474-2.093,4.758-3.14,6.854-3.14h62.809   c2.098,0,4.38,1.043,6.854,3.14c1.902,1.331,2.851,3.14,2.851,5.424L292.088,304.357z"/></svg>',wi='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M800 864v-448q0-14-9-23t-23-9-23 9-9 23v448q0 14 9 23t23 9 23-9 9-23zm672 352q0 26-19 45t-45 19h-429l-51 483q-2 12-10.5 20.5t-20.5 8.5h-1q-27 0-32-27l-76-485h-404q-26 0-45-19t-19-45q0-123 78.5-221.5t177.5-98.5v-512q-52 0-90-38t-38-90 38-90 90-38h640q52 0 90 38t38 90-38 90-90 38v512q99 0 177.5 98.5t78.5 221.5z"/></svg>',Si='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="17 17 483 483"> <circle stroke-width="40" cx="258.57" cy="258.57" r="220"/> <path d="M299.756,413.021v-61.78c0-3.003-0.966-5.472-2.896-7.401s-4.398-2.896-7.401-2.896h-61.78 c-3.003,0-5.47,0.965-7.4,2.896c-1.932,1.931-2.896,4.398-2.896,7.401v61.78c0,3.002,0.965,5.47,2.896,7.399 c1.931,1.931,4.396,2.896,7.4,2.896h61.779c3.003,0,5.472-0.967,7.401-2.896S299.756,416.021,299.756,413.021z"/> <path d="M382.128,196.789c0-18.877-5.952-36.36-17.856-52.449c-11.905-16.088-26.762-28.53-44.566-37.325 c-17.804-8.795-36.037-13.192-54.7-13.192c-52.127,0-91.919,22.845-119.377,68.537c-3.218,5.148-2.359,9.653,2.574,13.514 l42.474,32.177c1.502,1.287,3.54,1.931,6.114,1.931c3.433,0,6.115-1.287,8.044-3.861c11.369-14.587,20.594-24.454,27.672-29.603 c7.294-5.148,16.519-7.723,27.673-7.723c10.297,0,19.468,2.789,27.513,8.366c8.044,5.578,12.065,11.906,12.065,18.985 c0,8.151-2.146,14.694-6.437,19.628c-4.29,4.934-11.583,9.76-21.881,14.479c-13.514,6.006-25.901,15.284-37.164,27.834 c-11.263,12.549-16.894,26.01-16.894,40.382v11.583c0,3.004,0.965,5.472,2.896,7.401c1.931,1.93,4.396,2.896,7.4,2.896h61.779 c3.003,0,5.471-0.965,7.401-2.896c1.93-1.931,2.896-4.397,2.896-7.401c0-4.075,2.306-9.385,6.917-15.928 c4.612-6.542,10.458-11.852,17.537-15.927c6.863-3.861,12.119-6.918,15.768-9.171c3.646-2.252,8.579-6.008,14.802-11.263 c6.22-5.255,10.993-10.402,14.317-15.443c3.325-5.042,6.328-11.53,9.01-19.467C380.788,214.916,382.128,206.228,382.128,196.789z"/> </svg>',ki='<svg class="vzb-icon vzb-icon-pin" viewBox="-150 -250 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1149 414q0 26 -19 45l-181 181l181 181q19 19 19 45q0 27 -19 46l-90 90q-19 19 -46 19q-26 0 -45 -19l-181 -181l-181 181q-19 19 -45 19q-27 0 -46 -19l-90 -90q-19 -19 -19 -46q0 -26 19 -45l181 -181l-181 -181q-19 -19 -19 -45q0 -27 19 -46l90 -90q19 -19 46 -19 q26 0 45 19l181 181l181 -181q19 -19 45 -19q27 0 46 19l90 90q19 19 19 46z"/></svg>',Ei='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path id="flip-chart-1" d="M334.549,393.834l58.607,68.666h-45.096l-58.709-68.666H334.549z M240.333,462.5h34.333v-68.666h-34.333 V462.5z M360.5,153.5h-34.334v137.334H360.5V153.5z M121.566,462.5h45.113l58.709-68.666h-45.197L121.566,462.5z M206,273.666 h-34.333v17.168H206V273.666z M257.5,239.333h-34.333v51.5H257.5V239.333z M309,205h-34.334v85.834H309V205z M446.334,102h-17.168 v257.5H85.833V102H68.667V50.5h377.667V102z M394.834,102H120.167v223.166h274.667V102z"/></svg>',Ti='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1088 1256v240q0 16-12 28t-28 12h-240q-16 0-28-12t-12-28v-240q0-16 12-28t28-12h240q16 0 28 12t12 28zm316-600q0 54-15.5 101t-35 76.5-55 59.5-57.5 43.5-61 35.5q-41 23-68.5 65t-27.5 67q0 17-12 32.5t-28 15.5h-240q-15 0-25.5-18.5t-10.5-37.5v-45q0-83 65-156.5t143-108.5q59-27 84-56t25-76q0-42-46.5-74t-107.5-32q-65 0-108 29-35 25-107 115-13 16-31 16-12 0-25-8l-164-125q-13-10-15.5-25t5.5-28q160-266 464-266 80 0 161 31t146 83 106 127.5 41 158.5z"/></svg>',Oi='<svg class="vzb-icon" viewBox="-200 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1389 1043q31 30 14 69-17 40-59 40h-382l201 476q10 25 0 49t-34 35l-177 75q-25 10-49 0t-35-34l-191-452-312 312q-19 19-45 19-12 0-24-5-40-17-40-59v-1504q0-42 40-59 12-5 24-5 27 0 45 19z"/></svg>',Ci='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-224v224q0 13-9.5 22.5t-22.5 9.5h-64q-13 0-22.5-9.5t-9.5-22.5v-224h-224q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h224v-224q0-13 9.5-22.5t22.5-9.5h64q13 0 22.5 9.5t9.5 22.5v224h224q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',Li='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-576q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h576q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',Ai='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg"><g transform="translate(18 11)"><text transform="scale(0.9 1)" x="0" y="0">100</text><text transform="scale(0.6 1)" class="percent" x="0" y="0">%</text></g></svg>',Di='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 1280q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm-768-768q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm1024 768q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5zm-96-1088q0 20-13 38l-1056 1408q-19 26-51 26h-160q-26 0-45-19t-19-45q0-20 13-38l1056-1408q19-26 51-26h160q26 0 45 19t19 45zm-672 320q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5z"/></svg>',Pi=Object.freeze({paintbrush:hi,search:di,circle:ui,expand:mi,asterisk:gi,trails:pi,lock:fi,unlock:vi,unexpand:bi,axes:yi,gear:xi,stack:_i,drag:zi,warn:Mi,pin:wi,question:Si,close:ki,presentation:Ei,about:Ti,cursorArrow:Oi,cursorPlus:Ci,cursorMinus:Li,hundredPercent:Ai,percent:Di}),Ii="vzb-loading-first",Bi="vzb-loading-data",Ri="vzb-loading-error",Fi="vzb-placeholder",Ni="vzb-buttonlist-off",qi=Ie.extend({init:function(t,e,i,a,n){if(this._id=st("tm"),this._type="tool",this.validate=O(this,n),e=e||{},i=i||{},e=C(e,i),this._super(t,e,null,a),e.language){var s=this;this.on("change:language.id",function(){s.trigger("translate")})}}}),Hi=ni.extend({init:function(t,e){this._id=st("t"),this.template=this.template||'<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-stage"><div class="vzb-tool-viz"></div><div class="vzb-tool-timeslider"></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-datanotes vzb-hidden"></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-datawarning vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>',this.model_binds=this.model_binds||{},e=e||{},e.bind=e.bind||{};var i=this.validate.bind(this),a=this,n={change:function(t,e){a._ready&&(a.model.validate(),t.source.persistent&&a.model.trigger(new Oe(t.source,"persistentChange"),a.getMinModel()))},hook_change:function(){a.model.state.time.splash||a.beforeLoading(!0)},"change:ui.presentation":function(){a.layout.updatePresentation(),a.trigger("resize")},translate:function(t,e){a._ready&&l.all([a.preloadLanguage(),a.model.load()]).then(function(){a.model.validate(),a.translateStrings()})},load_start:function(){a.beforeLoading()},ready:function(t){a._ready&&a.afterLoading()}};_t(n,this.model_binds,e.bind),delete e.bind,this.model=new qi(this.name,e,this.default_model,n,i),this.default_model=this.default_model||{},this.ui=this.model.ui||{},this.layout=new ci(this.ui),this.ui.splash=this.model&&this.model.data&&this.model.data.splash,this._super({name:this.name||this._id,placeholder:t},this),this.render(),this._setUIModel()},ready:function(){this.checkTimeLimits()},checkTimeLimits:function(){if(this.model.state.time){var t=this.model.state.time;if(this.model.state.marker){var e=this.model.state.marker.getTimeLimits(t.getDimension());if(!e||!ct(e.min)||!ct(e.max))return Ft("checkTimeLimits(): min-max date objects look wrong: "+e.min+" "+e.max);t.start<e.min&&t.getModelObject("start").set(e.min,!1,!t.splash),t.end>e.max&&t.getModelObject("end").set(e.max,!1,!t.splash)}t.validate()}},getMinModel:function(){var t=this.model.getPlainObject(!0),e=this.default_model,i=this.model.getDefaults();e=ae(e);var a=ie(t,e);return a=ne(a,this.model.state.time.timeFormat),ie(a,i)},clear:function(){this.layout.clear(),this.setModel=this.getModel=function(){},this._super()},error:function(t){var e=t&&"data"===t.type?"Error loading chart data. <br>Please, try again soon.":"Error loading chart";this.placeholder.innerHTML='<div class="vzb-error-message"><h1>'+Mi+"</h1><p>"+e+"</p></div>"},setModel:function(t,e){e?this.model.reset(t):this.model.set(t),this._setUIModel()},getModel:function(){return this.model.getPlainObject()||{}},beforeLoading:function(t){this._readyOnce||jt(this.placeholder,Ii),t&&jt(this.placeholder,Bi)},afterLoading:function(){Vt(this.placeholder,Ii),Vt(this.placeholder,Bi)},errorLoading:function(){jt(this.placeholder,Ri)},validate:function(t){return t=this.model||t,t&&t.state?void 0:Ft("tool validation aborted: model.state looks wrong: "+t)},_setUIModel:function(){jt(this.placeholder,Fi),this.ui&&this.ui.buttons&&this.ui.buttons.length?Vt(this.element,Ni):jt(this.element,Ni)},preloadLanguage:function(){return l.resolve()}});Hi.isTool=function(t){return t._id&&"t"===t._id[0]};var Yi,ji,Vi,Xi,Ki,Wi,Ui,Gi=ni.extend({init:function(t,e){this.name="barchart",this.template="barchart.html",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"language",type:"language"}];var i=this;this.model_binds={"change:time.value":function(t){i.model.marker.getFrame(i.model.time.value,function(t){i.values=t,i.updateEntities()})},"change:marker":function(t,e){i._readyOnce&&(e.indexOf("color.palette")>-1||e.indexOf("which")>-1||e.indexOf("use")>-1||i.ready())},"change:marker.color.palette":fe(function(t){i._readyOnce&&i.updateEntities()},200)},this._super(t,e),this.xScale=null,this.yScale=null,this.cScale=d3.scale.category10(),this.xAxis=L(),this.yAxis=L()},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.xTitleEl=this.graph.select(".vzb-bc-axis-x-title"),this.bars=this.graph.select(".vzb-bc-bars"),this.year=this.element.select(".vzb-bc-year");var t=this;this.on("resize",function(){t.updateEntities()})},ready:function(){var t=this;this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.updateIndicators(),t.resize(),t.updateEntities()})},updateIndicators:function(){var t=this;this.translator=this.model.language.getTFunction(),this.duration=this.model.time.delayAnimations;var e=this.translator("indicator/"+this.model.marker.axis_y.which),i=this.translator("indicator/"+this.model.marker.axis_x.which),a=this.yTitleEl.selectAll("text").data([0]);a.enter().append("text"),a.attr("y","-6px").attr("x","-9px").attr("dx","-0.72em").text(e).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX("left").alignY("top").updateView().toggle()});var n=this.xTitleEl.selectAll("text").data([0]);n.enter().append("text"),n.attr("y","-3px").attr("dx","-0.72em").text(i).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignY("bottom").alignX("center").updateView().toggle()}),this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale();var s="geo.world_4region"==this.model.marker.axis_x.which?function(e){return t.translator("entity/geo.world_4region/"+e)}:t.model.marker.axis_x.getTickFormatter();this.yAxis.tickFormat(t.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(s)},updateEntities:function(){var t=this,e=this.model.time,i=e.getDimension(),a=this.model.entities.getDimension(),n=e.playing?e.delayAnimations:0,s={};s[i]=e.value;var l=this.model.marker.getKeys(s);this.entityBars=this.bars.selectAll(".vzb-bc-bar").data(l),this.entityBars.exit().remove(),this.entityBars.enter().append("rect").attr("class","vzb-bc-bar").on("mousemove",function(t,e){}).on("mouseout",function(t,e){}).on("click",function(t,e){});var r=(this.bars.selectAll(".vzb-bc-bar"),this.xScale.rangeBand());this.bars.selectAll(".vzb-bc-bar").attr("width",r).attr("fill",function(e){return t.cScale(t.values.color[e[a]])}).attr("x",function(e){return t.xScale(t.values.axis_x[e[a]])}).transition().duration(n).ease("linear").attr("y",function(e){return t.yScale(t.values.axis_y[e[a]])}).attr("height",function(e){return t.height-t.yScale(t.values.axis_y[e[a]])}),this.year.text(this.model.time.timeFormat(this.model.time.value))},resize:function(){var t=this;this.profiles={small:{margin:{top:30,right:20,left:40,bottom:50},padding:2,minRadius:2,maxRadius:40},medium:{margin:{top:30,right:60,left:60,bottom:60},padding:2,minRadius:3,maxRadius:60},large:{margin:{top:30,right:60,left:60,bottom:80},padding:2,minRadius:4,maxRadius:80}},this.activeProfile=this.profiles[this.getLayoutProfile()];var e=this.activeProfile.margin;if(this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.height<=0||this.width<=0)return Ft("Bar chart resize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")"),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range([this.height,0]):this.yScale.rangePoints([this.height,0],t.activeProfile.padding).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range([0,this.width]):this.xScale.rangePoints([0,this.width],t.activeProfile.padding).range(),this.yAxis.scale(this.yScale).orient("left").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,timeFormat:this.model.time.timeFormat,toolMargin:{top:5,right:e.right,left:e.left,bottom:e.bottom},limitMaxTickNumber:6}),this.xAxis.scale(this.xScale).orient("bottom").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,timeFormat:this.model.time.timeFormat,toolMargin:e,constantRakeLength:this.width}),this.xAxisEl.attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.xScale.rangeRoundBands([0,this.width],.1,.2),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis);var i=this.xAxisEl.node().getBoundingClientRect(),a=this.xTitleEl.node().getBoundingClientRect(),n=i.width/2-a.width/2,s=this.height+i.height+a.height;this.xTitleEl.attr("transform","translate("+n+","+s+")"),this.year.attr("x",this.width).attr("y",0)}}),Qi="vzb-active",Zi=ni.extend({init:function(t,e){var i=this;this.name="gapminder-zoombuttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"model"},{name:"language",type:"language"}],this._available_buttons={arrow:{title:"buttons/cursorarrow",icon:"cursorArrow",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},plus:{title:"buttons/cursorplus",icon:"cursorPlus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},minus:{title:"buttons/cursorminus",icon:"cursorMinus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hundredpercent:{title:"buttons/hundredpercent",icon:"hundredPercent",func:this.toggleHundredPercent.bind(this),required:!0}},this.model_binds={},void 0==t.ui.cursorMode&&t.ui.set("cursorMode",null,!1,!1),Object.keys(this._available_buttons).forEach(function(t){var e=i._available_buttons[t];e&&e.statebind&&(i.model_binds["change:"+e.statebind]=function(i){e.statebindfunc(t,i.source.value)})}),this._super(t,e)},readyOnce:function(){this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this._addButtons(Object.keys(this._available_buttons),[]),this.setCursorMode("arrow")},_addButtons:function(t,e){var i=this;this._components_config=[];var a=[];if(t.length){for(var n=0;n<t.length;n++){var s=t[n],l=this._available_buttons[s],r=l?s:"_default",o=wt(this._available_buttons[r]);o.id=s,o.icon=Pi[o.icon],a.push(o)}var c=this.getTranslationFunction(!0);this.element.selectAll("button").data(a).enter().append("button").attr("class",function(t){var i="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(i+=" vzb-dialog-side-btn"),i}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+c(t.title)+"</span>"});var h=this.element.selectAll(".vzb-buttonlist-btn");h.on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");i.proceedClick(t)})}},proceedClick:function(t){var e=this,i=e.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),a=i.attr("class"),n=e._available_buttons[t];if(n&&n.func)n.func(t);else{var s=-1===a.indexOf(Qi);i.classed(Qi,s);var l={};l.id=t,l.active=s,e.trigger("click",l)}},setButtonActive:function(t,e){var i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']");i.classed(Qi,e)},toggleCursorMode:function(t){var e=t;this.model.ui.set("cursorMode",e,!1,!1)},setCursorMode:function(t){var e=this.model.ui.cursorMode?this.model.ui.cursorMode:"arrow";this.element.selectAll(".vzb-buttonlist-btn").classed(Qi,function(t){return t.id==e})},toggleHundredPercent:function(t){this.root.trigger("resetZoom")}}),Ji=1,$i=2,ta={wrapper:"vzb-treemenu-wrap",wrapper_outer:"vzb-treemenu-wrap-outer",background:"vzb-treemenu-background",close:"vzb-treemenu-close",search:"vzb-treemenu-search",list:"vzb-treemenu-list",list_outer:"vzb-treemenu-list-outer",list_item:"vzb-treemenu-list-item",list_item_leaf:"vzb-treemenu-list-item-leaf",leaf:"vzb-treemenu-leaf",leaf_content:"vzb-treemenu-leaf-content",leaf_content_item:"vzb-treemenu-leaf-content-item",leaf_content_item_title:"vzb-treemenu-leaf-content-item-title",leaf_content_item_descr:"vzb-treemenu-leaf-content-item-descr",hasChild:"vzb-treemenu-list-item-children",list_item_label:"vzb-treemenu-list-item-label",list_top_level:"vzb-treemenu-list-top",search_wrap:"vzb-treemenu-search-wrap",isSpecial:"vzb-treemenu-list-item-special",hidden:"vzb-hidden",title:"vzb-treemenu-title",scaletypes:"vzb-treemenu-scaletypes",scaletypesDisabled:"vzb-treemenu-scaletypes-disabled",scaletypesActive:"vzb-treemenu-scaletypes-active",alignYt:"vzb-align-y-top",alignYb:"vzb-align-y-bottom",alignXl:"vzb-align-x-left",alignXr:"vzb-align-x-right",alignXc:"vzb-align-x-center",menuHorizontal:"vzb-treemenu-horizontal",menuVertical:"vzb-treemenu-vertical",absPosVert:"vzb-treemenu-abs-pos-vert",absPosHoriz:"vzb-treemenu-abs-pos-horiz",menuOpenLeftSide:"vzb-treemenu-open-left-side",noTransition:"notransition"},ea={MOUSE_LOCS:[],MOUSE_LOCS_TRACKED:3,DELAY:200,TOLERANCE:150,LAST_DELAY_LOC:null,TIMEOUT:null,SEARCH_PROPERTY:"id",SUBMENUS:"children",SEARCH_MIN_STR:1,RESIZE_TIMEOUT:null,MOBILE_BREAKPOINT:400,CURRENT_PATH:[],MIN_COL_WIDTH:60,MENU_DIRECTION:Ji,MAX_MENU_WIDTH:320,MENU_OPEN_LEFTSIDE:!1},ia=Me.extend({init:function(t,e){var i=this;this.parent=t,this.entity=e,this.width=ea.MIN_COL_WIDTH,this.direction=ea.MENU_DIRECTION,this._setDirectionClass(),this.menuItems=[];var a;return this.entity.empty()?this:(this.entity.each(function(){a=d3.selectAll(this.childNodes).filter(function(){return d3.select(this).classed(ta.list)})}),a.empty()&&(a=this.entity),e.selectAll("."+ta.list_item).filter(function(){return this.parentNode==a.node()}).each(function(){i.addSubmenu(d3.select(this))}),this)},setWidth:function(t,e,i){if(this.width!=t&&this.entity.node()){if(this.width=t,(this.entity.classed(ta.list_top_level)||this.entity.classed("active"))&&this.direction==Ji&&(i?this.entity.style("width",this.width+"px"):this.entity.transition().delay(0).duration(100).style("width",this.width+"px")),this.entity.classed(ta.list_top_level)&&this.entity.selectAll("."+ta.leaf).style("width",this.width-1+"px"),e)for(var a=0;a<this.menuItems.length;a++)this.menuItems[a].setWidth(this.width,e,i);return this}},setDirection:function(t,e){if(this.direction=t,this.entity.style("width","").style("height",""),
e)for(var i=0;i<this.menuItems.length;i++)this.menuItems[i].setDirection(this.direction,e);return this._setDirectionClass(),this},_setDirectionClass:function(){this.direction==Ji?(this.entity.classed(ta.menuVertical,!1),this.entity.classed(ta.menuHorizontal,!0)):(this.entity.classed(ta.menuHorizontal,!1),this.entity.classed(ta.menuVertical,!0))},addSubmenu:function(t){this.menuItems.push(new aa(this,t))},open:function(){var t=this;return this.isActive()||(t.parent.parentMenu.openSubmenuNow=!0,this.closeNeighbors(function(){t.direction==Ji?(t._openHorizontal(),t.calculateMissingWidth(0)):t._openVertical()}),t.parent.parentMenu.openSubmenuNow=!1),this},calculateMissingWidth:function(t,e){var i=this;this.entity.classed(ta.list_top_level)?t>ea.MAX_MENU_WIDTH&&"function"==typeof e&&e(t-ea.MAX_MENU_WIDTH):this.parent.parentMenu.calculateMissingWidth(t+this.width,function(t){t>0?i.reduceWidth(t,function(t){"function"==typeof e&&e(t)}):"function"==typeof e&&e(t)})},restoreWidth:function(t,e,i){var a=this;if(e)this.parent.parentMenu.restoreWidth(t,!1,i);else if(0>=t)"function"==typeof i&&i();else if(this.entity.classed(ta.list_top_level))"function"==typeof i&&i();else{var n=this.entity.node().offsetWidth,s=Math.min(t,a.width);if(s>n){var l=250*(n/s);this.entity.transition().delay(0).duration(l).style("width",s+"px").each("end",function(){}),a.parent.parentMenu.restoreWidth(t-s,!1,i)}else this.parent.parentMenu.restoreWidth(t,!1,i)}},reduceWidth:function(t,e){var i=this,a=this.entity.node().offsetWidth;if(a<=ea.MIN_COL_WIDTH)e(t-i.width+a);else{var n=Math.max(ea.MIN_COL_WIDTH,i.width-t),s=250/(i.width/n);this.entity.transition().delay(0).duration(s).style("width",n+"px").each("end",function(){e(t-i.width+n)})}},_openHorizontal:function(){var t=this;t.entity.classed("active",!0).transition().delay(0).duration(250).style("width",t.width+"px").each("end",function(){t.marqueeToggle(!0)})},_openVertical:function(){var t=this;t.entity.style("height","0px"),t.entity.transition().delay(0).duration(250).style("height",36*t.menuItems.length+"px").each("end",function(){t.entity.style("height","auto"),t.marqueeToggle(!0),t.scrollToFitView()}),t.entity.classed("active",!0)},closeAllChildren:function(t){for(var e=0,i=0;i<this.menuItems.length;i++)this.menuItems[i].isActive()&&(++e,this.menuItems[i].submenu.close(function(){0==--e&&"function"==typeof t&&t()}));0==e&&"function"==typeof t&&t()},closeNeighbors:function(t){this.parent?this.parent.closeNeighbors(t):t()},close:function(t){var e=this;this.closeAllChildren(function(){e.direction==Ji?e._closeHorizontal(t):e._closeVertical(t)})},_closeHorizontal:function(t){var e=(this.entity.node().offsetWidth,this),i=e.parent.parentMenu.openSubmenuNow;e.entity.transition().delay(0).duration(20).style("width","0px").each("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),i?"function"==typeof t&&t():e.restoreWidth(ea.MAX_MENU_WIDTH,!0,function(){"function"==typeof t&&t()})})},_closeVertical:function(t){var e=this;e.entity.transition().delay(0).duration(100).style("height","0px").each("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),"function"==typeof t&&t()})},isActive:function(){return this.entity.classed("active")},marqueeToggle:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggle(t)},marqueeToggleAll:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggleAll(t)},findItemByName:function(t){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].entity.select("."+ta.list_item_label).text()==t)return this.menuItems[e];if(this.menuItems[e].submenu){var i=this.menuItems[e].submenu.findItemByName(t);if(i)return i}}return null},getTopMenu:function(){return this.parent?this.parent.parentMenu.getTopMenu():this},scrollToFitView:function(){var t=this.getTopMenu().entity.node().parentNode,e=this.entity.node().parentNode,i=t.getBoundingClientRect(),a=e.getBoundingClientRect(),n=a.top-i.top;if(n+a.height>i.height){var s=a.height>i.height?i.height-10:a.height+10,l=t.scrollTop+s-i.height+n,r=function(t){return function(){var e=d3.interpolateNumber(this.scrollTop,t);return function(t){this.scrollTop=e(t)}}};d3.select(t).transition().duration(20).tween("scrolltoptween",r(l))}}}),aa=Me.extend({init:function(t,e){var i=this;this.parentMenu=t,this.entity=e;var a=e.select("."+ta.list_outer);a.node()&&(this.submenu=new ia(this,a));this.entity.select("."+ta.list_item_label).on("mouseenter",function(){ve()||i.parentMenu.direction==Ji&&(i.openSubmenu(),i.marqueeToggle(!0))}).on("click.item",function(){if(!ve())if(d3.event.stopPropagation(),i.parentMenu.direction==Ji)i.openSubmenu();else{var t=d3.select(this);if(!t.attr("children"))return;i.toggleSubmenu()}}).onTap(function(t){if(d3.event.stopPropagation(),i.parentMenu.direction==$i){var e=i.entity.select("."+ta.list_item_label);if(!e.attr("children"))return}i.toggleSubmenu()});return this},setWidth:function(t,e,i){return this.submenu&&e&&this.submenu.setWidth(t,e,i),this},setDirection:function(t,e){return this.submenu&&e&&this.submenu.setDirection(t,e),this},toggleSubmenu:function(){this.submenu&&(this.submenu.isActive()?this.submenu.close():this.submenu.open())},openSubmenu:function(){this.submenu?this.submenu.open():this.closeNeighbors()},closeNeighbors:function(t){this.parentMenu.closeAllChildren(t)},isActive:function(){return this.submenu&&this.submenu.isActive()},marqueeToggleAll:function(t){var e=this.entity.selectAll("."+ta.list_item_label);e.each(function(){var e=d3.select(this).select("span"),i=d3.select(this.parentNode);if(i.classed("marquee",!1),e.style("left",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var a=30;e.style("left",-a-e.node().scrollWidth+"px"),i.classed("marquee",!0)}})},marqueeToggle:function(t){var e=this.entity.select("."+ta.list_item_label).select("span");if(this.entity.classed("marquee",!1),e.style("left",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var i=30;e.style("left",-i-e.node().scrollWidth+"px"),this.entity.classed("marquee",!0)}}}),na=function(t){console.log("Indicator selector: stub callback fired. New indicator is ",t)},sa="center",la="center",ra=ni.extend({tree:function(t){return arguments.length?(Yi=t,this):Yi},lang:function(t){return arguments.length?(Vi=t,this):Vi},langStrings:function(t){return arguments.length?(ji=t,this):ji},callback:function(t){return arguments.length?(na=t,this):na},markerID:function(t){return arguments.length?(Xi=t,this):Xi},alignX:function(t){return arguments.length?(sa=t,this):sa},alignY:function(t){return arguments.length?(la=t,this):la},top:function(t){return arguments.length?(Ki=t,this):Ki},left:function(t){return arguments.length?(Wi=t,this):Wi},init:function(t,e){var i=this;this.name="gapminder-treemenu",this.model_expects=[{name:"marker",type:"model"},{name:"language",type:"language"}],this.context=e,this.menuEntity=null,this.model_binds={"change:marker":function(t,e){-1==e.indexOf(Xi+".which")&&-1==e.indexOf(Xi+".scaleType")||i.updateView()},"change:language.strings":function(t){i.updateView()}},this._super(t,e),this.ui=_t({},this.ui)},ready:function(){this.updateView()},readyOnce:function(){this.element=d3.select(this.placeholder);var t=this;this.element.selectAll("div").remove(),this.element.append("div").attr("class",ta.background).on("click",function(){d3.event.stopPropagation(),t.toggle()}),this.wrapperOuter=this.element.append("div").classed(ta.wrapper_outer,!0).classed(ta.noTransition,!0),this.wrapper=this.wrapperOuter.append("div").classed(ta.wrapper,!0).classed(ta.noTransition,!0).classed("vzb-dialog-scrollable",!0),this.wrapper.on("click",function(){d3.event.stopPropagation()}),this.wrapper.append("div").attr("class",ta.close).html(ki).on("click",function(){d3.event.stopPropagation(),t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class",ta.close+"-icon"),this.wrapper.append("div").classed(ta.scaletypes,!0).append("span"),this.wrapper.append("div").classed(ta.title,!0).append("span"),this.wrapper.append("div").classed(ta.search_wrap,!0).append("input").classed(ta.search,!0).attr("type","search").attr("id",ta.search),d3.select("body").on("mousemove",t._mousemoveDocument),this.wrapper.on("mouseleave",function(){}),t._enableSearch(),t.resize()},resize:function(){var t=this;this.profiles={small:{col_width:200},medium:{col_width:200},large:{col_width:200}},this.wrapper.classed(ta.noTransition,!0),this.wrapper.node().scrollTop=0,this.activeProfile=this.profiles[this.getLayoutProfile()],ea.IS_MOBILE="small"===this.getLayoutProfile(),this.menuEntity&&(this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),ea.IS_MOBILE?this.menuEntity.direction!=$i&&this.menuEntity.setDirection($i,!0):this.menuEntity.direction!=Ji&&this.menuEntity.setDirection(Ji,!0)),this.width=t.element.node().offsetWidth,this.height=t.element.node().offsetHeight;var e=this.wrapperOuter.node().getBoundingClientRect(),i=e.width,a=e.height;if(i)if(ea.IS_MOBILE)this.clearPos();else{(Ki||Wi)&&(this.wrapperOuter.node().offsetTop<10&&this.wrapperOuter.style("top","10px"),this.height-t.wrapperOuter.node().offsetTop-a<0&&(a>this.height&&(a=this.height-20),this.wrapperOuter.style({top:this.height-a-10+"px",bottom:"auto"})),Ki&&(Ki=t.wrapperOuter.node().offsetTop));var n;n=this.wrapperOuter.classed(ta.alignYb)?this.wrapperOuter.node().offsetTop+this.wrapperOuter.node().offsetHeight:this.height-this.wrapperOuter.node().offsetTop,this.wrapper.style("max-height",n-10+"px"),this.wrapperOuter.classed(ta.alignXc,"center"===sa),this.wrapperOuter.style("margin-left","center"===sa?"-"+i/2+"px":null),"center"===sa?ea.MAX_MENU_WIDTH=this.width/2-.5*i-10:ea.MAX_MENU_WIDTH=this.width-this.wrapperOuter.node().offsetLeft-i-10;var s=this.activeProfile.col_width+2*ea.MIN_COL_WIDTH,l=this.wrapperOuter.node().offsetLeft;ea.MENU_OPEN_LEFTSIDE=ea.MAX_MENU_WIDTH<s&&l>ea.MAX_MENU_WIDTH+10,ea.MENU_OPEN_LEFTSIDE?(s+10>l&&(l=s+10),ea.MAX_MENU_WIDTH=l-10):ea.MAX_MENU_WIDTH<s&&(l-=s-ea.MAX_MENU_WIDTH,ea.MAX_MENU_WIDTH=s),Wi?Wi=l:l!=this.wrapperOuter.node().offsetLeft&&this.wrapperOuter.style({left:"auto",right:this.width-l-e.width+"px"}),(Wi||Ki)&&this.setPos(),this.wrapperOuter.classed("vzb-treemenu-open-left-side",!ea.IS_MOBILE&&ea.MENU_OPEN_LEFTSIDE)}return this.wrapper.node().offsetHeight,this.wrapper.classed(ta.noTransition,!1),this},toggle:function(){var t=this,e=!this.element.classed(ta.hidden);this.element.classed(ta.hidden,e),e?(this.clearPos(),this.menuEntity.marqueeToggle(!1)):((Ki||Wi)&&this.setPos(),this.resize(),this.scrollToSelected()),this.wrapper.classed(ta.noTransition,e),this.parent.components.forEach(function(i){"gapminder-dialogs"==i.name?d3.select(i.placeholder.parentNode).classed("vzb-blur",!e):i.element.classed?i.element.classed("vzb-blur",i!=t&&!e):d3.select(i.element).classed("vzb-blur",i!=t&&!e)}),this.width=t.element.node().offsetWidth},scrollToSelected:function(){var t=this,e=function(t,e){t.scrollTop=0;var i=t.getBoundingClientRect(),a=e.getBoundingClientRect(),n=a.bottom-i.top-t.offsetHeight+10;t.scrollTop=n};if(this.menuEntity.direction==$i)e(this.wrapper.node(),Ui),t.menuEntity.marqueeToggleAll(!0);else{var i=this.menuEntity.findItemByName(d3.select(Ui).select("span").text());i.submenu.calculateMissingWidth(0,function(){t.menuEntity.marqueeToggleAll(!0)});for(var a,n=Ui;!Kt(n,ta.list_top_level);)"LI"==n.tagName&&(a=Kt(n.parentNode,ta.list_top_level)?n.parentNode.parentNode:n.parentNode,e(a,n)),n=n.parentNode}},setPos:function(){var t=this.wrapperOuter.node().getBoundingClientRect();if(Ki&&(this.wrapperOuter.style({top:Ki+"px",bottom:"auto"}),this.wrapperOuter.classed(ta.absPosVert,Ki)),Wi){var e=this.element.node().offsetWidth-Wi-t.width;e=10>e?10:e,this.wrapperOuter.style({right:e+"px",left:"auto"}),this.wrapperOuter.classed(ta.absPosHoriz,e)}},clearPos:function(){Ki="",Wi="",this.wrapperOuter.attr("style",""),this.wrapperOuter.classed(ta.absPosVert,""),this.wrapperOuter.classed(ta.absPosHoriz,""),this.wrapperOuter.classed(ta.menuOpenLeftSide,""),this.wrapper.style("max-height","")},_enableSearch:function(){var t=this,e=this.wrapper.select("."+ta.search),i=function(e){var i={_id:"root",children:[]},a=function(e,i,a){var n=t.model.language.id;if(t.langStrings()){var s=t.langStrings()[n]["indicator/"+i[a][ea.SEARCH_PROPERTY]]||t.langStrings()[n]["indicator/"+t.model.marker[Xi]._type+"/"+i[a][ea.SEARCH_PROPERTY]];if(s&&s.toLowerCase().indexOf(e.toLowerCase())>=0)return!0}return!1},n=function(t){for(var s=0;s<t.length;s++){var l=!1;l=a(e,t,s),l&&i.children.push(t[s]),!l&&t[s][ea.SUBMENUS]&&n(t[s][ea.SUBMENUS])}};return n(t.dataFiltered.children),i},a=!1,n=fe(function(){var n=e.node().value;(a||""!=n)&&(a=""!=n,n.length>=ea.SEARCH_MIN_STR?t.redraw(i(n),!0):t.redraw())},250);e.on("input",n)},_selectIndicator:function(t){na("which",t,Xi),this.toggle()},redraw:function(t,e){var i,a=this,n=a.model.marker.getConceptprops(),s=a.model.marker[Xi]._type;if(e)i=t;else{null==t&&(t=Yi);var l=Ut(n).filter(function(t){if(a.model.marker[Xi].allow&&a.model.marker[Xi].allow.names&&-1!=a.model.marker[Xi].allow.names.indexOf("!"+t))return!1;if(!a.model.marker[Xi].allow||!a.model.marker[Xi].allow.scales)return!0;if("*"==a.model.marker[Xi].allow.scales[0])return!0;if(!n[t].scales)return!0;for(var e=n[t].scales.length-1;e>=0;e--)if(a.model.marker[Xi].allow.scales.indexOf(n[t].scales[e])>-1)return!0;return!1});i=be(t,function(t){return l.indexOf(t.id)>-1}),this.dataFiltered=i}this.wrapper.select("ul").remove(),this.element.select("."+ta.title).select("span").text(this.translator("buttons/"+Xi)),this.element.select("."+ta.search).attr("placeholder",this.translator("placeholder/search")+"...");var r=function(t,e,i){if(e.children){var n=i?t:t.append("div").classed(ta.list_outer,!0),l=n.append("ul").classed(ta.list,!i).classed(ta.list_top_level,i).classed("vzb-dialog-scrollable",!0).selectAll("li").data(e.children,function(t){return t.id}).enter().append("li");l.append("span").classed(ta.list_item_label,!0).attr("children",function(t){return t.children?"true":null}).on("click",function(t){var e=d3.select(this);e.attr("children")||(d3.event.stopPropagation(),a._selectIndicator(t.id))}).append("span").text(function(t){var e=a.translator("indicator"+("_default"===t.id?"/"+s:"")+"/"+t.id);return-1!==e.indexOf("indicator/")&&Ft("translation missing: "+e),e}),l.classed(ta.list_item,!0).classed(ta.hasChild,function(t){return t.children}).classed(ta.isSpecial,function(t){return t.special}).each(function(t){var e=d3.select(this);if(!t.children){var i=e.append("div").attr("class",ta.menuHorizontal+" "+ta.list_outer+" "+ta.list_item_leaf);i.on("click",function(t){a._selectIndicator(t.id)});var n=i.append("div").classed(ta.leaf+" "+ta.leaf_content+" vzb-dialog-scrollable",!0);n.append("span").classed(ta.leaf_content_item+" "+ta.leaf_content_item_title,!0).text(function(t){var e=a.translator("indicator"+("_default"===t.id?"/"+s:"")+"/"+t.id);return-1!==e.indexOf("indicator/")&&Ft("translation missing: "+e),e});var l,o=n.append("span").classed(ta.leaf_content_item,!0).text(function(t){var e=a.translator("unit"+("_default"===t.id?"/"+s:"")+"/"+t.id);return l=-1!==e.indexOf("unit/")||""===e,-1!==e.indexOf("unit/")&&Ft("translation missing: "+e),a.translator("hints/units")+": "+e});o.classed("vzb-hidden",l);var c,h=n.append("span").classed(ta.leaf_content_item+" "+ta.leaf_content_item_descr,!0).text(function(t){var e=a.translator("description"+("_default"===t.id?"/"+s:"")+"/"+t.id);return c=-1!==e.indexOf("description/"),c&&Ft("translation missing: "+e),l&&c?a.translator("hints/nodescr"):e});h.classed("vzb-hidden",c&&!l)}if(t.id==a.model.marker[Xi].which){var d=this.parentNode;for(d3.select(this).classed("item-active",!0).select("."+ta.list_item_leaf).classed("active",!0);!Kt(d,ta.list_top_level);)"UL"==d.tagName&&d3.select(d.parentNode).classed("active",!0),"LI"==d.tagName&&d3.select(d).classed("item-active",!0),d=d.parentNode;Ui=this}r(e,t)})}};if(ea.IS_MOBILE?ea.MENU_DIRECTION=$i:ea.MENU_DIRECTION=Ji,r(this.wrapper,i,!0),this.menuEntity=new ia(null,this.wrapper.selectAll("."+ta.list_top_level)),this.menuEntity&&this.menuEntity.setDirection(ea.MENU_DIRECTION),this.menuEntity&&this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),!e){var o="_default";if(l.indexOf(this.model.marker[Xi].which)>-1&&(o=this.model.marker[Xi].which),!n[o].scales)return this.element.select("."+ta.scaletypes).classed(ta.hidden,!0),!0;var c=n[o].scales.filter(function(t){return a.model.marker[Xi].allow&&a.model.marker[Xi].allow.scales?"*"==a.model.marker[Xi].allow.scales[0]?!0:a.model.marker[Xi].allow.scales.indexOf(t)>-1:!0});if(0==c.length)this.element.select("."+ta.scaletypes).classed(ta.hidden,!0);else{var h=this.element.select("."+ta.scaletypes).classed(ta.hidden,!1).selectAll("span").data(c,function(t){return t});h.exit().remove(),h.enter().append("span").on("click",function(t){d3.event.stopPropagation(),a._setModel("scaleType",t,Xi)}),h.classed(ta.scaletypesDisabled,c.length<2).classed(ta.scaletypesActive,function(t){return t==a.model.marker[Xi].scaleType&&c.length>1}).text(function(t){return a.translator("scaletype/"+t)})}}return this},updateView:function(){var t=this,e=t.model.language.id;if(Xi){this.wrapperOuter.classed(ta.absPosVert,Ki),this.wrapperOuter.classed(ta.alignYt,"top"===la),this.wrapperOuter.classed(ta.alignYb,"bottom"===la),this.wrapperOuter.classed(ta.absPosHoriz,Wi),this.wrapperOuter.classed(ta.alignXl,"left"===sa),this.wrapperOuter.classed(ta.alignXr,"right"===sa);var i=ji?ji:{};i[e]=t.model.language.strings[e],this.translator=this.model.language.getTFunction();var a=this._setModel.bind(this);return this.langStrings(i).lang(e).callback(a).tree(this.model.marker.getIndicatorsTree()).redraw(),this.wrapper.select("."+ta.search).node().value="",this}},_setModel:function(t,e,i){var a=this.model.marker.getConceptprops(),n=this.model.marker[i],s={};s[t]=e,"which"==t&&(s.use=a[e].use,a[e].scales&&(s.scaleType=a[e].scales[0])),"axis"!==n.getType()&&"size"!==n.getType()||(s.domainMin=null,s.domainMax=null,s.zoomedMin=null,s.zoomedMax=null),n.set(s)}}),oa=1,ca="vzb-playing",ha="vzb-ts-loading",da="vzb-ts-hide-play-button",ua="vzb-ts-dragging",ma="vzb-ts-axis-aligned",ga="vzb-ts-show-value",pa="vzb-ts-show-value-when-drag-play",fa={small:{margin:{top:7,right:15,bottom:10,left:15},radius:8,label_spacing:10},medium:{margin:{top:16,right:15,bottom:10,left:15},radius:9,label_spacing:12},large:{margin:{top:14,right:15,bottom:10,left:15},radius:11,label_spacing:14}},va={medium:{margin:{top:9}},large:{margin:{}}},ba=ni.extend({init:function(t,e){this.name="gapminder-timeslider",this.template=this.template||"timeslider.html",this.prevPosition=null,this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"}];var i=this;this._splash=t.ui.splash,this.model_binds={"change:time":function(t,e){if(i._splash!==i.model.time.splash&&(i._splash=i.model.time.splash,i.readyOnce(),i.ready()),!i._splash&&i.slide){if(-1!==["time.start","time.end"].indexOf(e)){if(!i.xScale)return;i.changeLimits()}i._optionClasses()}},"change:time.value":function(t,e){!i._splash&&i.slide&&(i.model.time.dragging||i._setHandle(i.model.time.playing))},"change:time.start":function(t,e){!i._splash&&i.slide&&(i.model.time.dragging||i._setHandle(i.model.time.playing))},"change:time.end":function(t,e){!i._splash&&i.slide&&(i.model.time.dragging||i._setHandle(i.model.time.playing))},"change:time.startSelected":function(t,e){!i._splash&&i.slide&&i.updateSelectedStartLimiter()},"change:time.endSelected":function(t,e){!i._splash&&i.slide&&i.updateSelectedEndLimiter()},"change:entities.select":function(t,e){i.setSelectedLimits()}},this.ui=_t({show_limits:!1,show_value:!1,show_value_when_drag_play:!0,show_button:!0,class_axis_aligned:!1},t.ui,this.ui),this._super(t,e),this.width=0,this.height=0,this.getValueWidth=pe(this.getValueWidth),this._setTime=Wt(this._setTime,50)},readyOnce:function(){if(!this._splash){var t=this;this.element=rt(this.element)?this.element:d3.select(this.element),this.element.classed(ha,!1),this.slider_outer=this.element.select(".vzb-ts-slider"),this.slider=this.slider_outer.select("g"),this.axis=this.element.select(".vzb-ts-slider-axis"),this.select=this.element.select(".vzb-ts-slider-select"),this.slide=this.element.select(".vzb-ts-slider-slide"),this.handle=this.slide.select(".vzb-ts-slider-handle"),this.valueText=this.slide.select(".vzb-ts-slider-value"),this.xScale=d3.time.scale.utc().clamp(!0),this.xAxis=d3.svg.axis().orient("bottom").tickSize(0),this.valueText.attr("text-anchor","middle").attr("dy","-0.7em");var e=t._getBrushed(),i=t._getBrushedEnd();this.brush=d3.svg.brush().x(this.xScale).extent([0,0]).on("brush",function(){e.call(this)}).on("brushend",function(){i.call(this)}),this.slide.call(this.brush),this.slider_outer.on("mousewheel",function(){return t.model.time.dragging?(d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1):void 0}),this.slide.selectAll(".extent,.resize").remove(),this._setSelectedLimitsId=0,this._needRecalcSelectedLimits=!0,xt(t.model.marker.getSubhooks(),function(e){e._important&&e.on("change:which",function(){t._needRecalcSelectedLimits=!0,t.model.time.startSelected=t.model.time.start,t.model.time.endSelected=t.model.time.end})}),this.root.on("ready",function(){t._needRecalcSelectedLimits&&(t._needRecalcSelectedLimits=!1,t.setSelectedLimits(!0))}),this.model.time.startSelected>this.model.time.start&&t.updateSelectedStartLimiter(),this.model.time.endSelected<this.model.time.end&&t.updateSelectedEndLimiter(),this.parent.on("myEvent",function(e,i){var a=t.getLayoutProfile();i.profile&&i.profile.margin&&(fa[a].margin=i.profile.margin),t.element.select(".vzb-ts-slider-wrapper").style("right",i.mRight-fa[a].margin.right+"px"),t.xScale.range([0,i.rangeMax]),t.resize()})}},ready:function(){if(!this._splash){var t=this.element.select(".vzb-ts-btn-play"),e=this.element.select(".vzb-ts-btn-pause"),i=this;this.model.time;t.on("click",function(){i.model.time.play()}),e.on("click",function(){i.model.time.pause("soft")}),this.changeLimits(),this.changeTime(),this.resize()}},changeLimits:function(){var t=this.model.time.start,e=this.model.time.end;this.xScale.domain([t,e]),this.xAxis.tickValues([t,e]).tickFormat(this.model.time.timeFormat)},changeTime:function(){this.ui.format=this.model.time.unit;this.model.time.value;this._optionClasses()},resize:function(){this.model.time.pause(),this.profile=this.getActiveProfile(fa,va);var t=parseInt(this.slider_outer.style("width"),10)||0,e=parseInt(this.slider_outer.style("height"),10)||0;this.width=t-this.profile.margin.left-this.profile.margin.right,this.height=e-this.profile.margin.bottom-this.profile.margin.top;var i=this;this.slider.attr("transform","translate("+this.profile.margin.left+","+this.profile.margin.top+")"),(this.xScale.range()[1]=1)&&this.xScale.range([0,this.width]),this.xAxis=this.xAxis.scale(this.xScale).tickPadding(this.profile.label_spacing),this.axis.attr("transform","translate(0,"+this.height/2+")").call(this.xAxis),this.select.attr("transform","translate(0,"+this.height/2+")"),this.slide.select(".background").attr("height",this.height),this.handle.attr("transform","translate(0,"+this.height/2+")").attr("r",this.profile.radius),this.sliderWidth=i.slider.node().getBoundingClientRect().width,this.resizeSelectedLimiters(),this._setHandle()},setSelectedLimits:function(t){var e=this;this._setSelectedLimitsId++;var i=this._setSelectedLimitsId,a=e.model.entities.select;if(0==a.length)return e.model.time.startSelected=new Date(e.model.time.start),void(e.model.time.endSelected=new Date(e.model.time.end));var n=e.model.entities.getDimension(),s=e.model.time.getAllSteps(),r=[],o=[];xt(e.model.marker.getSubhooks(),function(t){"constant"!=t.use&&t._important&&o.push(t._name)});var c=function(t){for(var e=0,i=a.length;i>e;e++){for(var s=0,l=0,r=o.length;r>l;l++)(t[o[l]][a[e][n]]||0===t[o[l]][a[e][n]])&&s++;if(s==o.length)return!0}return!1},h=function(t,i){var a=t();null!=a&&e.model.marker.getFrame(s[a],function(e){c(e)?i(a):h(t,i)})},d=[];d.push(new l),h(function(){var t=s.length,e=0;return function(){return t>e?e++:null}}(),function(t){r[0]=s[t],d[0].resolve()}),d.push(new l),h(function(){var t=s.length-1;return function(){return t>=0?t--:null}}(),function(t){r[1]=s[t],d[1].resolve()}),l.all(d).then(function(){i==e._setSelectedLimitsId&&e.model.time.set({startSelected:r[0],endSelected:r[1]},t)})},updateSelectedStartLimiter:function(){this.select.select("#clip-start").remove(),this.select.select(".selected-start").remove(),this.model.time.startSelected>this.model.time.start&&(this.select.append("clipPath").attr("id","clip-start").append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-start)").classed("selected-start",!0),this.resizeSelectedLimiters())},updateSelectedEndLimiter:function(){this.select.select("#clip-end").remove(),this.select.select(".selected-end").remove(),this.model.time.endSelected<this.model.time.end&&(this.select.append("clipPath").attr("id","clip-end").append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-end)").classed("selected-end",!0),this.resizeSelectedLimiters())},resizeSelectedLimiters:function(){this.select.select(".selected-start").attr("d","M0,0H"+this.xScale(this.model.time.startSelected)),this.select.select("#clip-start").select("rect").attr("x",-this.height/2).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.startSelected)+this.height/2),this.select.select(".selected-end").attr("d","M"+this.xScale(this.model.time.endSelected)+",0H"+this.xScale(this.model.time.end)),this.select.select("#clip-end").select("rect").attr("x",this.xScale(this.model.time.endSelected)).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.end)-this.xScale(this.model.time.endSelected)+this.height/2)},getValueWidth:function(t,e){return this.valueText.node().getBoundingClientRect().width},_getBrushed:function(){var t=this;return function(){t.model.time.playing&&t.model.time.pause(),t._optionClasses(),t.element.classed(ua,!0);var e=t.brush.extent()[0];if(d3.event.sourceEvent){d3.event.sourceEvent.preventDefault(),t.model.time.dragStart();var i=bt(Math.round(d3.mouse(this)[0]),oa);e=t.xScale.invert(i);var a=t.width;i>a?i=a:0>i&&(i=0),t.handle.attr("cx",i),t.valueText.attr("transform","translate("+i+","+t.height/2+")"),t.valueText.text(t.model.time.timeFormat(e))}e-t.model.time.value!==0&&t._setTime(e)}},_getBrushedEnd:function(){var t=this;return function(){t._setTime.recallLast(),t.element.classed(ua,!1),t.model.time.dragStop(),t.model.time.snap()}},_setHandle:function(t){var e=this,i=this.model.time.value;this.slide.call(this.brush.extent([i,i])),this.element.classed("vzb-ts-disabled",this.model.time.end<=this.model.time.start);var a=this.xScale(i);null==e.prevPosition&&(e.prevPosition=a);var n=a>e.prevPosition?this.model.time.delayAnimations:0;t?(this.handle.attr("cx",e.prevPosition).transition().duration(n).ease("linear").attr("cx",a),this.valueText.attr("transform","translate("+e.prevPosition+","+this.height/2+")").transition("text").delay(n).text(this.model.time.timeFormat(i)),this.valueText.transition().duration(n).ease("linear").attr("transform","translate("+a+","+this.height/2+")")):(this.handle.interrupt().attr("cx",a),this.valueText.interrupt().interrupt("text").transition("text"),this.valueText.attr("transform","translate("+a+","+this.height/2+")").text(this.model.time.timeFormat(i))),e.prevPosition=a},_setTime:function(t){var e=this,i=!this.model.time.dragging&&!this.model.time.playing;e.model.time.getModelObject("value").set(t,!1,i)},_optionClasses:function(){var t=this.ui.show_limits,e=this.ui.show_value,i=this.ui.show_value_when_drag_play,a=this.ui.axis_aligned,n=this.ui.show_button&&this.model.time.playable;t||this.xAxis.tickValues([]).ticks(0),this.element.classed(da,!n),this.element.classed(ca,this.model.time.playing),this.element.classed(ga,e),this.element.classed(pa,i),this.element.classed(ma,a)}}),ya={EXTENT_MIN:0,EXTENT_MAX:1,TEXT_PARAMS:{TOP:18,LEFT:10,MAX_WIDTH:42,MAX_HEIGHT:16},BAR_WIDTH:6,THUMB_RADIUS:10,THUMB_STROKE_WIDTH:4,INTRO_DURATION:250,MARGIN:{TOP:2,LEFT:5,RIGHT:5}},xa={small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20}},_a=ni.extend({init:function(t,e){function i(t,e){var i=n.model.size.extent||[ya.EXTENT_MIN,ya.EXTENT_MAX];n._updateLabels(i),n.sliderEl.call(n.brush.extent(i)),i[0]==i[1]&&n.sliderEl.selectAll(".resize").style("display","block")}function a(t){n.modelUse=n.model.size.use;var e=n.model.size.extent||[ya.EXTENT_MIN,ya.EXTENT_MAX];if("constant"!=n.modelUse)n.sizeScaleMinMax=n.model.size.getScale().domain(),n.sliderEl.selectAll(".w").classed("vzb-hidden",!1),n.sliderEl.select(".extent").classed("vzb-hidden",!1),n.sliderEl.select(".background").classed("vzb-pointerevents-none",!1),n._setLabelsText();else if(n.sliderEl.selectAll(".w").classed("vzb-hidden",!0),n.sliderEl.select(".extent").classed("vzb-hidden",!0),n.sliderEl.select(".background").classed("vzb-pointerevents-none",!0),!n.model.size.which){var i=n.propertyActiveProfile;e[1]=(i["default"]-i.min)/(i.max-i.min),n.model.size.which="_default"}n.sliderEl.call(n.brush.extent([e[0],e[1]])),n.sliderEl.call(n.brush.event)}this.name="sizeslider",this.template=this.template||"sizeslider.html",this.propertyName=t.propertyname,this.model_expects=[{name:"size",type:"size"},{name:"language",type:"language"}];var n=this;this.model_binds={"change:size.domainMin":i,"change:size.domainMax":i,"change:size.extent":i,ready:a},this._setModel=Wt(this._setModel,50),this._super(t,e)},readyOnce:function(){var t=this,e=t.model.size.extent||[ya.EXTENT_MIN,ya.EXTENT_MAX];this.element=d3.select(this.element),this.sliderSvg=this.element.select(".vzb-szs-svg"),this.sliderWrap=this.sliderSvg.select(".vzb-szs-slider-wrap"),this.sliderEl=this.sliderWrap.select(".vzb-szs-slider");var i=({v:ya.TEXT_PARAMS.TOP,h:ya.TEXT_PARAMS.LEFT},ya.TEXT_PARAMS.MAX_WIDTH,ya.TEXT_PARAMS.MAX_HEIGHT),a=ya.BAR_WIDTH,n=ya.THUMB_RADIUS,s=(ya.THUMB_STROKE_WIDTH,{top:ya.MARGIN.TOP+1.25*a,left:n,right:n,bottom:a+i}),l=this.element.node().offsetWidth;this.padding=s,this.propertyActiveProfile=this.getPropertyActiveProfile(),this.translator=this.model.language.getTFunction(),this.propertyScale=d3.scale.linear().domain([ya.EXTENT_MIN,ya.EXTENT_MAX]).range([this.propertyActiveProfile.min,this.propertyActiveProfile.max]).clamp(!0),this.xScale=d3.scale.linear().domain([ya.EXTENT_MIN,ya.EXTENT_MAX]).range([0,l-s.left-s.right]).clamp(!0),this.brush=d3.svg.brush().x(this.xScale).extent([ya.EXTENT_MIN,ya.EXTENT_MAX]).on("brush",function(){t._setFromExtent(!0,!1,!1)}).on("brushend",function(){t.sliderEl.selectAll(".resize").style("display",null),t._setFromExtent(!0,!0)}),this.sliderEl.call(t.brush),this.sliderEl.selectAll(".background").attr("style",""),this.sliderThumbs=this.sliderEl.selectAll(".resize").sort(d3.descending).classed("vzb-szs-slider-thumb",!0),this.sliderThumbs.append("g").attr("class","vzb-szs-slider-thumb-badge").append("path").attr("d",function(t,e){return"M0 "+.5*a+"l"+-n+" "+1.5*n+"h"+2*n+"Z"}),this.sliderThumbs.append("path").attr("class","vzb-szs-slider-thumb-arc"),this.sliderEl.selectAll("text").data([0,0]).enter().append("text").attr("class",function(t,e){return"vzb-szs-slider-thumb-label "+(e?"e":"w")}).attr("dy",1.25*-a+"px").attr("text-anchor",function(t,e){return 1-e?"start":"end"}),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-szs-slider-thumb-label"),this.sliderEl.selectAll("rect").attr("height",a).attr("rx",.25*a).attr("ry",.25*a).attr("transform","translate(0,"+.5*-a+")"),this.sliderEl.select(".extent").classed("vzb-szs-slider-extent",!0),this.on("resize",function(){
t.propertyActiveProfile=t.getPropertyActiveProfile(),t.propertyScale.range([t.propertyActiveProfile.min,t.propertyActiveProfile.max]);var e=t.element.node().offsetWidth;t.xScale.range([0,e-t.padding.left-t.padding.right]),t._updateSize(),t.sliderEl.call(t.brush.extent(t.brush.extent())),t._setFromExtent(!1,!1,!1)}),this._updateSize(),this.sliderEl.call(this.brush.extent(e)),t._setFromExtent(!1,!1,!1),t.sizeScaleMinMax=t.model.size.getScale().domain(),t.sizeScaleMinMax&&t._setLabelsText()},getPropertyActiveProfile:function(){var t=xa[this.getLayoutProfile()];return{min:t["min"+this.propertyName],max:t["max"+this.propertyName],"default":t["default"+this.propertyName]}},_updateSize:function(){this.sliderSvg.attr("height",this.propertyActiveProfile.max+this.padding.top+this.padding.bottom).attr("width","100%"),this.sliderWrap.attr("transform","translate("+this.padding.left+","+(this.propertyActiveProfile.max+this.padding.top)+")")},_updateLabels:function(t){var e=this,i=function(t,i){var a=e.xScale(i),n=0;return"translate("+a+","+n+")"};this.sliderLabelsEl.data(t).attr("transform",i).attr("font-size",function(t,i){return e.propertyScale(t)}),"constant"===e.model.size.use&&this.sliderLabelsEl.data(t).text(function(t){return~~e.propertyScale(t)+(e.translator(e.ui.constantUnit)||"")})},_setLabelsText:function(){var t=this;t.sliderLabelsEl.data([t.model.size.getTickFormatter()(t.sizeScaleMinMax[0]),t.model.size.getTickFormatter()(t.sizeScaleMinMax[1])]).text(function(t){return t})},_setFromExtent:function(t,e,i){var a=this.brush.extent();this._updateLabels(a),t&&this._setModel(a,e,i)},_setModel:function(t,e,i){t=[+t[0].toFixed(2),+t[1].toFixed(2)],this.model.size.set({extent:t},e,i)}}),za=ni.extend({init:function(t,e){this.template='<div class="vzb-ss-holder"><input type="range" id="vzb-ss-slider" class="vzb-ss-slider" step="1"></div>',this.model_expects=[{name:"submodel"}];var i=this;this.name="gapminder-simpleSlider",this.arg=t.arg,this.thumb_size=t.thumb_size,this.slider_properties=t.properties,this.model_binds={},this.model_binds["change:submodel."+this.arg]=function(t){i.updateView()},this._super(t,e),this._setModel=Wt(this._setModel,50)},readyOnce:function(){var t=0,e=1,i=.1,a=t,n=this;this.element=d3.select(this.element),this.slider=this.element.selectAll("#vzb-ss-slider"),this.elementSize=this.element.node().getBoundingClientRect(),this.sliderSize=this.slider.node().getBoundingClientRect(),this.slider.style("left",this.elementSize.left-this.sliderSize.left+"px"),this.slider_properties&&(null!=this.slider_properties.min&&(t=this.slider_properties.min),null!=this.slider_properties.max&&(e=this.slider_properties.max),null!=this.slider_properties.step&&(i=this.slider_properties.step),this.slider_properties.scale&&(a=this.slider_properties.scale(t))),this.roundTo=i>1?0:Math.round(Math.abs(Math.log(i)/Math.LN10)),this.thumb_size&&(this.slider.classed("vzb-ss-slider",!1),this.slider.classed("vzb-ss-slider-"+this.thumb_size,!0)),this.slider.attr("min",t).attr("max",e).attr("step",i).attr("value",a).on("input",function(){var t=+d3.event.target.value;n._setModel(t,!1,!1)}).on("change",function(){var t=+d3.event.target.value;n._setModel(t,!0)}),this.updateView()},updateView:function(){var t,e=this.model.submodel[this.arg],i=this.slider_properties;i&&(t=i.scale),t&&(e=t.invert(e)),this.slider.node().value=e},_setModel:function(t,e,i){this.slider_properties&&this.slider_properties.scale&&(t=this.slider_properties.scale(t)),this.model.submodel.getModelObject(this.arg).set(t.toFixed(this.roundTo),e,i)}}),Ma=ni.extend({init:function(t,e){this.template='<span class="vzb-sc-holder vzb-dialog-checkbox"><input type="checkbox"><label></label></span>';var i=this;this.name="gapminder-simplecheckbox",this.checkbox=t.checkbox,this.submodel=t.submodel,this.model_expects=[{name:"mdl"},{name:"language",type:"language"}],this.model_binds={"change:mdl":function(t){i.updateView()},"change:language.strings":function(t){i.updateView()}};var a=this.submodel?this.submodel+":":"";this.model_binds["change:mdl."+a+this.checkbox]=function(){i.updateView()},this._super(t,e)},ready:function(){this.parentModel=this.submodel?this.model.mdl[this.submodel]:this.model.mdl,this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element);var e="-check-"+1e3*Math.random();this.labelEl=this.element.select("label").attr("for",e),this.checkEl=this.element.select("input").attr("id",e).on("change",function(){t._setModel(d3.select(this).property("checked"))})},updateView:function(){this.translator=this.model.language.getTFunction(),this.labelEl.text(this.translator("check/"+this.checkbox)),this.checkEl.property("checked",!!this.parentModel[this.checkbox])},_setModel:function(t){this.parentModel[this.checkbox]=t}}),wa="domainMin",Sa="domainMax",ka="zoomedMin",Ea="zoomedMax",Ta=ni.extend({init:function(t,e){this.name="gapminder-minmaxinputs",this.template="minmaxinputs.html";var i=this;this.model_expects=[{name:"marker",type:"model"},{name:"time",type:"time"},{name:"language",type:"language"}],this.markerID=t.markerID,t.markerID||Ft("minmaxinputs.js complains on 'markerID' property: "+t.markerID),this.model_binds={},this.model_binds["change:language.strings"]=function(t){i.updateView()},this.model_binds["change:marker."+this.markerID]=function(t){i.updateView()},this.model_binds.ready=function(t){i.updateView()},this._super(t,e),this.ui=_t({selectDomainMinMax:!1,selectZoomedMinMax:!1},this.ui.getPlainObject())},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.el_domain_labelMin=this.element.select(".vzb-mmi-domainmin-label"),this.el_domain_labelMax=this.element.select(".vzb-mmi-domainmax-label"),this.el_domain_fieldMin=this.element.select(".vzb-mmi-domainmin"),this.el_domain_fieldMax=this.element.select(".vzb-mmi-domainmax"),this.el_break=this.element.select(".vzb-mmi-break"),this.el_zoomed_labelMin=this.element.select(".vzb-mmi-zoomedmin-label"),this.el_zoomed_labelMax=this.element.select(".vzb-mmi-zoomedmax-label"),this.el_zoomed_fieldMin=this.element.select(".vzb-mmi-zoomedmin"),this.el_zoomed_fieldMax=this.element.select(".vzb-mmi-zoomedmax"),t.el_domain_fieldMin.on("change",function(){t._setModel(wa,this.value)}),t.el_domain_fieldMax.on("change",function(){t._setModel(Sa,this.value)}),t.el_zoomed_fieldMin.on("change",function(){t._setModel(ka,this.value)}),t.el_zoomed_fieldMax.on("change",function(){t._setModel(Ea,this.value)}),this.element.selectAll("input").on("keypress",function(t){13==d3.event.which&&document.activeElement.blur()})},updateView:function(){var t=this;this.translator=this.model.language.getTFunction(),this.el_domain_labelMin.text(this.translator("min")+":"),this.el_domain_labelMax.text(this.translator("max")+":"),this.el_zoomed_labelMin.text(this.translator("min")+":"),this.el_zoomed_labelMax.text(this.translator("max")+":"),this.el_domain_labelMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_labelMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_break.classed("vzb-hidden",!(this.ui.selectDomainMinMax&&this.ui.selectZoomedMinMax)),this.el_zoomed_labelMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_labelMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax);var e=function(e){return e||0===e?ct(e)?t.model.time.timeFormat(e):d3.format(".2r")(e):e};this.el_domain_fieldMin.property("value",e(this.model.marker[this.markerID].getScale().domain()[0])),this.el_domain_fieldMax.property("value",e(this.model.marker[this.markerID].getScale().domain()[1])),this.el_zoomed_fieldMin.property("value",e(this.model.marker[this.markerID].zoomedMin)),this.el_zoomed_fieldMax.property("value",e(this.model.marker[this.markerID].zoomedMax))},_setModel:function(t,e){this.model.marker[this.markerID][t]=yt(e)}}),Oa=function(t){return function(){function e(t){return t.call(l).each(function(t,e){var i=d3.select(this);i.append("rect").attr("class","vzb-label-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),i.append("rect").attr("class","vzb-label-fill vzb-tooltip-border"),i.append("text").attr("class",n+"-label-content vzb-label-shadow"),i.append("text").attr("class",n+"-label-content");var a=i.append("g").attr("class",n+"-label-x vzb-transparent");ye(a,ki),a.insert("circle","svg"),a.select("svg").attr("class",n+"-label-x-icon").attr("width","0px").attr("height","0px"),a.on("click",function(){s.model.entities.clearHighlighted(),d3.event.defaultPrevented||s.model.entities.selectEntity(t)})}).on("mouseover",function(t){if(!ve()){s.model.entities.highlightEntity(t,null,null,!0);var e=s.KEY||s.model.entities.getDimension();s.entityLabels.sort(function(i,a){return i[e]!=t[e]?-1:1}),d3.select(this).selectAll("."+n+"-label-x").classed("vzb-transparent",!1)}}).on("mouseout",function(t){ve()||(s.model.entities.clearHighlighted(),d3.select(this).selectAll("."+n+"-label-x").classed("vzb-transparent",!0))}).on("click",function(t){if(ve()){var e=d3.select(this).selectAll("."+n+"-label-x");e.classed("vzb-transparent",!e.classed("vzb-transparent"))}}),e}function i(t,e,i,n,l,r,o,c,h,d){var u=s.cached[t[s.KEY]],m=d3.select(i),g=!n&&0!==n||!l&&0!==l||!r&&0!==r||!o&&0!==o;if(g)return m.classed("vzb-invisible",g),void d.classed("vzb-invisible",g);var p=s._toolContext.width,f=s._toolContext.height,v=u.rectBBox,b=v.width,y=v.height;0>=n-b?(n=b,u.labelX_=(n-s.xScale(u.labelX0))/p):n+5>p&&(n=p-5,u.labelX_=(n-s.xScale(u.labelX0))/p),0>=l-.75*y?(l=.75*y,u.labelY_=(l-s.yScale(u.labelY0))/f):l+.35*y>f&&(l=f-.35*y,u.labelY_=(l-s.yScale(u.labelY0))/f),null==c&&(c=s._toolContext.duration),c?h&&!t.hidden?(m.classed("vzb-invisible",t.hidden),m.attr("transform","translate("+n+","+l+")").style("opacity",0).transition().duration(c).ease("exp").style("opacity",1).each("interrupt",function(){m.style("opacity",1)}),d.classed("vzb-invisible",t.hidden),d.attr("transform","translate("+n+","+l+")").style("opacity",0).transition().duration(c).ease("exp").style("opacity",1).each("interrupt",function(){d.style("opacity",1)})):h&&t.hidden?(m.style("opacity",1).transition().duration(c).ease("exp").style("opacity",0).each("end",function(){m.style("opacity",1).classed("vzb-invisible",t.hidden)}),d.style("opacity",1).transition().duration(c).ease("exp").style("opacity",0).each("end",function(){d.style("opacity",1).classed("vzb-invisible",t.hidden)})):(m.transition().duration(c).ease("linear").attr("transform","translate("+n+","+l+")"),d.transition().duration(c).ease("linear").attr("transform","translate("+n+","+l+")")):(m.interrupt().attr("transform","translate("+n+","+l+")"),d.interrupt().attr("transform","translate("+n+","+l+")"),h&&m.classed("vzb-invisible",t.hidden),h&&d.classed("vzb-invisible",t.hidden));var x=r-n,_=o-l,z=m.select("text").node().getBBox(),M=.5*-z.width,w=.2*-y,S=s.model.ui.chart.labels,k=S.removeLabelBox?z:v,E=s.activeProfile.labelLeashCoeff||0,T=a({x:x,y:_,r:u.scaledS0},{x:M,y:w,width:2*k.height*E+k.width,height:k.height*(2*E+1)});if(d.select("line").classed("vzb-invisible",T),!T){if(S.removeLabelBox){var O=180*Math.atan2(x-M,_-w)/Math.PI,C=O>=0&&180>=O?.5*k.width:.5*-k.width,L=Math.abs(O)<=90?.55*k.height:.45*-k.height;M+=Math.abs(x-M)>.5*z.width?C:0,w+=Math.abs(_-w)>.5*z.height?L:.05*z.height}var A=Math.abs(x)>Math.abs(_)?Math.abs(x)/p:Math.abs(_)/f;d.select("line").style("stroke-dasharray","0 "+u.scaledS0+" "+~~(A+2)+"00%"),d.selectAll("line").attr("x1",x).attr("y1",_).attr("x2",M).attr("y2",w)}}function a(t,e){var i=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y),n=.5*e.width,s=.5*e.height;if(i>n+t.r)return!1;if(a>s+t.r)return!1;if(n>=i)return!0;if(s>=a)return!0;var l=Math.pow(i-n,2)+Math.pow(a-s,2);return l<=Math.pow(t.r,2)}var n,s=t;e.setCssPrefix=function(t){return n=t,e};var l=d3.behavior.drag().on("dragstart",function(t,e){d3.event.sourceEvent.stopPropagation();s.KEY}).on("drag",function(t,i){var a=s.KEY;if(s.model.ui.chart.labels.dragging){this.druging||(s.druging=t[a]);var n=s.cached[t[a]];n.labelFixed=!0;var l=s._toolContext.width,r=s._toolContext.height;n.labelX_+=d3.event.dx/l,n.labelY_+=d3.event.dy/r;var o=s.xScale(n.labelX0)+n.labelX_*l,c=s.yScale(n.labelY0)+n.labelY_*r,h=s.xScale(n.labelX0),d=s.yScale(n.labelY0),u=s.entityLines.filter(function(e){return e[a]==t[a]});e._repositionLabels(t,i,this,o,c,h,d,0,null,u)}}).on("dragend",function(t,e){var i=s.KEY;if(s.druging){var a=s.cached[t[i]];s.druging=null,a.labelOffset[0]=a.labelX_,a.labelOffset[1]=a.labelY_,s.model.entities.setLabelOffset(t,[a.labelX_,a.labelY_])}});return e.line=function(t){t.append("line").attr("class",n+"-label-line")},e._repositionLabels=i,e}()},Ca={TOOL_CONTEXT:null,LABELS_CONTAINER_CLASS:"",LINES_CONTAINER_CLASS:"",CSS_PREFIX:""},La=ni.extend({init:function(t,e){var i=this;this.name="gapminder-labels",this.model_expects=[{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"ui",type:"model"}],this.context=e,this.model_binds={"change:entities.select":function(){i._readyOnce&&i.selectDataPoints()}},e.model.state.marker.size_label&&(this.model_binds["change:marker.size_label.extent"]=function(t,e){i._readyOnce&&(i.updateLabelSizeLimits(),i.updateLabelsOnlyTextSize())}),e.model.ui.chart.labels.hasOwnProperty("removeLabelBox")&&(this.model_binds["change:ui.chart.labels.removeLabelBox"]=function(t,e){i._readyOnce&&i.updateLabelsOnlyTextSize()}),this._super(t,e),this.ui=_t({},this.ui),this.label=Oa(this),this._xScale=null,this._yScale=null,this._closeCrossHeight=0,this.labelSizeTextScale=null},ready:function(){this.updateLabelSizeLimits(),this.updateIndicators()},readyOnce:function(){this.KEY=this.model.entities.getDimension(),this.cached={},this._toolContext=Ca.TOOL_CONTEXT,this._cssPrefix=Ca.CSS_PREFIX,this.label.setCssPrefix(Ca.CSS_PREFIX),this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),this.labelsContainer=this.rootEl.select("."+Ca.LABELS_CONTAINER_CLASS),this.linesContainer=this.rootEl.select("."+Ca.LINES_CONTAINER_CLASS),this.updateIndicators(),this.updateSize(),this.selectDataPoints()},config:function(t){_t(Ca,t)},updateLabelSizeLimits:function(){var t=this;if(this.model.marker.size_label){var e=this.model.marker.size_label.extent||[0,1],i=this.activeProfile.minLabelTextSize,a=this.activeProfile.maxLabelTextSize,n=a-i;this.minLabelTextSize=Math.max(i+n*e[0],i),this.maxLabelTextSize=Math.max(i+n*e[1],i),"constant"==this.model.marker.size_label.use&&(this.minLabelTextSize=this.maxLabelTextSize),"ordinal"!==this.model.marker.size_label.scaleType||"constant"==this.model.marker.size_label.use?this.labelSizeTextScale.range([t.minLabelTextSize,t.maxLabelTextSize]):this.labelSizeTextScale.rangePoints([t.minLabelTextSize,t.maxLabelTextSize],0).range()}},updateIndicators:function(){this.model.marker.size_label&&(this.labelSizeTextScale=this.model.marker.size_label.getScale())},setScales:function(t,e){this._readyOnce&&(this._xScale=t,this._yScale=e)},setCloseCrossHeight:function(t){this._closeCrossHeight=t},xScale:function(t){return this._xScale?this._xScale(t):t*this._toolContext.width},yScale:function(t){return this._yScale?this._yScale(t):t*this._toolContext.height},selectDataPoints:function(){var t=this,e=this.KEY,i=this._cssPrefix;this.entityLabels=this.labelsContainer.selectAll("."+i+"-entity").data(t.model.entities.select,function(t){return t[e]}),this.entityLines=this.linesContainer.selectAll("."+i+"-entity").data(t.model.entities.select,function(t){return t[e]}),this.entityLabels.exit().each(function(i){null!=t.cached[i[e]]&&(t.cached[i[e]]=void 0)}).remove(),this.entityLines.exit().remove(),this.entityLines.enter().append("g").attr("class",function(t,a){return i+"-entity line-"+t[e]}).each(function(e,i){t.label.line(d3.select(this))}),this.entityLabels.enter().append("g").attr("class",function(t,a){return i+"-entity label-"+t[e]}).each(function(i,a){t.cached[i[e]]={},t.label(d3.select(this))})},showCloseCross:function(t,e){var i=this.KEY;this.entityLabels.filter(function(e){return e[i]==t[i]}).select("."+this._cssPrefix+"-label-x").classed("vzb-transparent",!e)},highlight:function(t,e){var i=this.KEY,a=this.entityLabels;t&&(a=a.filter(function(e){return e[i]==t[i]})),a.classed("vzb-highlighted",e)},updateLabel:function(t,e,i,a,n,s,l,r,o,c,h){var d=this,u=this.KEY;if(t[u]!=d.druging){var m=Ca.CSS_PREFIX;Ca.TOOL_CONTEXT;if(d.model.entities.isSelected(t)&&null!=d.entityLabels){null==d.cached[t[u]]&&this.selectDataPoints();var g=d.cached[t[u]];if(i&&_t(g,i),null!=g.scaledS0&&null!=g.labelX0&&null!=g.labelY0||(s&&(g.scaledS0=Bt(this._toolContext.sScale(s))),g.labelX0=a,g.labelY0=n,g.valueLST=o,g.scaledC0=null!=l?this._toolContext.cScale(l):this._toolContext.COLOR_WHITEISH),null==g.labelX_||null==g.labelY_){var p=Ot(d.model.entities.select,function(e){return e[u]==t[u]});g.labelOffset=p.labelOffset||[0,0]}var f=!g.labelX0&&0!==g.labelX0||!g.labelY0&&0!==g.labelY0||!g.scaledS0&&0!==g.scaledS0,v=d.entityLines.filter(function(e){return e[u]==t[u]});d.entityLabels.filter(function(e){return e[u]==t[u]}).each(function(i){var a=d3.select(this);if(f)return a.classed("vzb-invisible",f),void v.classed("vzb-invisible",f);var n=a.selectAll("."+m+"-label-content").text(r);d._updateLabelSize(t,e,a,o,n),d.positionLabel(t,e,this,c,h,v)})}}},_updateLabelSize:function(t,e,i,a,n){var s=this,l=this.KEY,r=s.cached[t[l]],o=Ca.CSS_PREFIX,c=(Ca.TOOL_CONTEXT,s.model.ui.chart.labels||{});i.classed("vzb-label-boxremoved",c.removeLabelBox);var h=n||i.selectAll("."+o+"-label-content");if(null!=a&&s.labelSizeTextScale){var d=s.labelSizeTextScale.range(),u=d[0]+Math.sqrt((s.labelSizeTextScale(a)-d[0])*(d[1]-d[0]));h.attr("font-size",u+"px")}var m=h[0][0].getBBox(),g=i.selectAll("rect");if(!r.textWidth||r.textWidth!=m.width){r.textWidth=m.width;var p=s._closeCrossHeight||m.height,f=i.select("."+o+"-label-x").attr("transform","translate(4,"+.85*-m.height+")");f.select("circle").attr("cx",0).attr("cy",0).attr("r",.5*p),f.select("svg").attr("x",.5*-p).attr("y",p*-.5).attr("width",p).attr("height",p),g.attr("width",m.width+8).attr("height",1.2*m.height).attr("x",-m.width-4).attr("y",.85*-m.height).attr("rx",.2*m.height).attr("ry",.2*m.height),r.rectBBox=g.node().getBBox()}var v=i.select(".vzb-label-glow");v.attr("stroke")!==r.scaledC0&&v.attr("stroke",r.scaledC0)},updateLabelsOnlyTextSize:function(){var t=this,e=this.KEY;this.entityLabels.each(function(i,a){t.cached[i[e]];t._updateLabelSize(i,a,d3.select(this),t._toolContext.frame.size_label[i[e]]);var n=t.entityLines.filter(function(t){return t[e]==i[e]});t.positionLabel(i,a,this,0,null,n)})},updateLabelOnlyPosition:function(t,e,i){var a=this,n=this.KEY,s=this.cached[t[n]];i&&_t(s,i);var l=a.entityLines.filter(function(e){return e[n]==t[n]});this.entityLabels.filter(function(e){return e[n]==t[n]}).each(function(i){a.positionLabel(t,e,this,0,null,l)})},updateLabelOnlyColor:function(t,e,i){var a=this,n=this.KEY,s=this.cached[t[n]];i&&_t(s,i);var l=a.entityLabels.filter(function(e){return e[n]==t[n]});a._updateLabelSize(t,e,l,null)},positionLabel:function(t,e,i,a,n,s){var l=this.KEY,r=this.cached[t[l]],o=this._toolContext.width,c=this._toolContext.height,h=this.xScale(r.labelX0),d=this.yScale(r.labelY0);r.labelOffset||(r.labelOffset=[0,0]),r.labelX_=r.labelOffset[0]||(.75*-r.scaledS0-5)/o,r.labelY_=r.labelOffset[1]||(.75*-r.scaledS0-11)/c;var u=h+r.labelX_*o;0==r.labelOffset[0]&&(u-r.rectBBox.width<=0?(r.labelX_=(.75*r.scaledS0+r.rectBBox.width)/o,u=h+r.labelX_*o):u+15>o&&(r.labelX_=(o-15-h)/o,u=h+r.labelX_*o));var m=d+r.labelY_*c;0==r.labelOffset[1]&&(m-r.rectBBox.height<=0?(r.labelY_=(.75*r.scaledS0+r.rectBBox.height)/c,m=d+r.labelY_*c):m+10>c&&(r.labelY_=(c-10-d)/c,m=d+r.labelY_*c)),this.label._repositionLabels(t,e,i,u,m,h,d,a,n,s)},updateSize:function(){var t={small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12,labelLeashCoeff:.4},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20,labelLeashCoeff:.2}};this.activeProfile=this.getActiveProfile(t),this.updateLabelSizeLimits()}}),Aa=ni.extend({init:function(t,e){this.name="gapminder-indicatorpicker",this.template='<span class="vzb-ip-holder"><span class="vzb-ip-select"></span><span class="vzb-ip-info"></span></span>';var i=this;this.model_expects=[{name:"marker",type:"model"},{name:"language",type:"language"}],this.markerID=t.markerID,t.markerID||Ft("indicatorpicker.js complains on 'markerID' property: "+t.markerID),this.model_binds={"change:language.strings":function(t){i.updateView()},ready:function(t){i.updateView()}},this.markerID&&(this.model_binds["change:marker."+this.markerID+".which"]=function(t){i.updateView()}),this._super(t,e)},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.el_select=d3.select(this.element).select(".vzb-ip-select"),this.el_select.on("click",function(){var e=t.el_select.node().getBoundingClientRect(),i=t.root.element instanceof Array?t.root.element:d3.select(t.root.element),a=i.node().getBoundingClientRect(),n=t.root.findChildByName("gapminder-treemenu"),s=n.activeProfile.col_width,l=parseInt(n.wrapper.style("padding-left"),10)||0,r=parseInt(n.wrapper.style("padding-right"),10)||0,o=e.bottom-a.top,c=e.left-a.left-.5*(l+r+s-e.width);n.markerID(t.markerID).alignX("left").alignY("top").top(o).left(c).updateView().toggle()}),this.infoEl=d3.select(this.element).select(".vzb-ip-info"),ye(this.infoEl,Si).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){t.root.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=t.el_select.node().getBoundingClientRect(),i=t.root.element.getBoundingClientRect(),a=e.bottom-i.top,n=e.left-i.left+e.width;t.root.findChildByName("gapminder-datanotes").setHook(t.markerID).show().setPos(n,a)}),this.infoEl.on("mouseout",function(){t.root.findChildByName("gapminder-datanotes").hide()})},updateView:function(){if(this._readyOnce){var t=this,e=this.model.language.getTFunction(),i=this.model.marker[this.markerID].which,a=this.model.marker[this.markerID]._type;this.el_select.text(e("indicator"+("_default"===i?"/"+a:"")+"/"+i));var n=e("description/"+i)=="description/"+i&&e("sourceName/"+i)=="sourceName/"+i&&!t.model.marker[t.markerID].getConceptprops().sourceLink;this.infoEl.classed("vzb-hidden",n)}}}),Da=ni.extend({init:function(t,e){this.template='<span class="vzb-dl-holder"><ul class="vzb-draggable list vzb-dialog-scrollable"></ul></span>';var i=this;this.name="draggableList",this.dataArrFn=t.dataArrFn,this.lang=t.lang,this.model_expects=[{name:"group",type:"model"},{name:"language",type:"language"},{name:"chart",type:"model"}],this.groupID=t.groupID,this.isEnabled=t.isEnabled,this.draggable=!0,t.groupID||Ft("draggablelist.js complains on 'groupID' property: "+t.groupID),this.model_binds={"change:language.strings":function(t){i.updateView()}},this.model_binds["change:group."+this.groupID]=function(t){i.updateView()},this.model_binds["change:chart."+this.isEnabled]=function(t){i.draggable=i.model.chart[i.isEnabled],i.updateView()},this._super(t,e),this.updateData=fe(this.updateData,1e3),this.itemDragger=d3.behavior.drag().on("dragstart",function(t,e){!i.dataUpdateFlag&&i.draggable&&(d3.event.sourceEvent.stopPropagation(),i.parentBoundRect=i.element.node().getBoundingClientRect(),i.element.selectAll("div").each(function(e,a){var n=this.getBoundingClientRect();e._y=n.top,e._top=0,t.data===e.data&&(e._height=n.height,i.selectedNode=this)}),d3.select(i.selectedNode).classed("dragged",!0))}).on("drag",function(t,e){if(!i.dataUpdateFlag&&i.draggable){t._top+=d3.event.dy;var a=t._y+t._top;a>i.parentBoundRect.top&&a+t._height<i.parentBoundRect.top+i.parentBoundRect.height&&i.itemsEl.style("top",function(i,n){var s=0;return e>n&&i._y+.5*t._height>a?s=t._height:n>e&&i._y-.5*t._height<a&&(s=-t._height),n!=e&&(i._top=s),i._top+"px"})}}).on("dragend",function(t,e){!i.dataUpdateFlag&&i.draggable&&i.getData()})},ready:function(){var t=this;this.updateView(),this.itemsEl=this.element.selectAll("div"),this.itemsEl.call(t.itemDragger);this.itemsEl.select("li").on("mouseover",function(){d3.select(this).classed("hover",!0)}).on("mouseout",function(){d3.select(this).classed("hover",!1)}).on("touchstart",function(){d3.event.preventDefault()})},updateView:function(){var t=this;this.translator=this.model.language.getTFunction(),this.items=this.element.selectAll("div").data(function(){return t.dataArrFn().map(function(t){return{data:t}})});var e=t.draggable?!0:null;this.items.enter().append("div").append("li"),this.items.select("li").classed("hover",!1).each(function(e,i){d3.select(this).attr("data",e.data).text(t.translator(t.lang+e.data))}),this.items.exit().remove(),this.element.selectAll("div").style("top","").attr("draggable",e).classed("dragged",!1),this.dataUpdateFlag=!1},getData:function(){var t=[],e=this.element.selectAll("div").data();t=e.sort(function(t,e){return t._y+t._top-(e._y+e._top)}).map(function(t){return t.data}),gt(this.dataArrFn(),t)?this.updateView():(this.dataUpdateFlag=!0,this.updateData(t))},updateData:function(t){this.dataArrFn(t)},readyOnce:function(){this.element=d3.select(this.element).select(".list")}}),Pa=ni.extend({init:function(t,e){this.name=this.name||"",this.model_expects=this.model_expects||[{name:"state",type:"model"},{name:"ui",type:"model"},{name:"language",type:"language"}],this.template=this.name+".html",this._super(t,e)},readyOnce:function(){this.element=d3.select(this.element),this.titleEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-title"),this.buttonsEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-buttons"),this.contentEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-content")},ready:function(){var t=this;this.placeholderEl=d3.select(this.placeholder),this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),this.dragHandler=this.placeholderEl.select("[data-click='dragDialog']"),this.dragHandler.html(zi),this.pinIcon=this.placeholderEl.select("[data-click='pinDialog']"),this.pinIcon.html(wi),this.dragContainerEl=d3.select(".vzb-tool"),this.topPos="";var e=this.getLayoutProfile(),i=A(this.placeholderEl,this.dragContainerEl,10),a=d3.behavior.drag().on("dragstart",function(){var e=t.placeholderEl.node().offsetTop;t.placeholderEl.style({top:e+"px",bottom:"auto"}),t.trigger("dragstart"),i.dragStart(d3.event)}).on("drag",function(){t.trigger("drag"),i.drag(d3.event)}).on("dragend",function(){t.rightPos=t.placeholderEl.style("right"),t.topPos=t.placeholderEl.style("top"),t.trigger("dragend")});this.dragHandler.call(a),this.dragHandler.classed("vzb-hidden","small"===e),this.pinIcon.classed("vzb-hidden","small"===e),this.resize()},resize:function(){if(this.placeholderEl&&this.dragContainerEl&&this.placeholderEl.classed("vzb-top-dialog")){this.placeholderEl.classed("notransition",!0);var t=this.getLayoutProfile();if("small"!==t){var e=parseInt(this.dragContainerEl.style("width"),10),i=parseInt(this.rightPos,10),a=parseInt(this.rootEl.style("height"),10),n=parseInt(this.topPos,10),s=parseInt(this.placeholderEl.style("width"),10),l=parseInt(this.placeholderEl.style("height"),10),r=parseInt(this.placeholderEl.style("margin-right"),10)||0;ut(i)&&i>e-s-r&&this.rightPos&&(this.rightPos=e-s-r+"px",this.isOpen&&this.placeholderEl.style("right",this.rightPos)),ut(n)&&ut(l)&&n>=0&&n>a-l&&this.topPos&&(this.topPos=(a-l>0?a-l:0)+"px",this.isOpen&&this.placeholderEl.style("top",this.topPos)),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&this.placeholderEl.style("bottom","auto"),this.rootEl.classed("vzb-landscape"),this.element.style("max-height","")}else this.rightPos="",this.topPos="",this.placeholderEl.attr("style","");this.dragHandler.classed("vzb-hidden","small"===t),this.pinIcon.classed("vzb-hidden","small"===t),this._setMaxHeight()}},_setMaxHeight:function(){var t=this.root.element.offsetHeight;if("small"!==this.getLayoutProfile())if(!this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")){var e=parseInt(this.placeholderEl.style("bottom"),10);t-=e}else{var i=this.topPos?parseInt(this.topPos,10):this.placeholderEl[0][0].offsetTop;t-=i}else t=this.rootEl.classed("vzb-portrait")?t-50:t-10;this.element.style("max-height",t+"px");var a=t-this.titleEl.node().offsetHeight-this.buttonsEl.node().offsetHeight;this.contentEl.style("max-height",a+"px")},beforeOpen:function(){var t=this;if(this.transitionEvents=["webkitTransitionEnd","transitionend","msTransitionEnd","oTransitionEnd"],this.transitionEvents.forEach(function(e){t.placeholderEl.on(e,t.transitionEnd.bind(t,e))}),this.placeholderEl.classed("notransition",!0),this.placeholderEl.style({top:"",bottom:""}),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")){var e=this.placeholderEl.node().offsetTop;this.placeholderEl.style({top:e+"px",bottom:"auto"})}else"small"!==this.getLayoutProfile();this.placeholderEl.node().offsetTop,this.placeholderEl.classed("notransition",!1),"small"===this.getLayoutProfile()?this.placeholderEl.style("top",""):this.rootEl.classed("vzb-landscape")},open:function(){this.isOpen=!0,"small"!==this.getLayoutProfile()&&this.topPos&&(this.placeholderEl.style("top",this.topPos),this.placeholderEl.style("right",this.rightPos))},beforeClose:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()&&this.placeholderEl.style("top","auto"),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&(this.topPos0=this.topPos?this.placeholderEl.node().parentNode.offsetHeight-this.placeholderEl.node().offsetHeight+"px":""),this.placeholderEl.classed("notransition",!1),this.placeholderEl.node().offsetHeight},close:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()||(this.placeholderEl.style("top",""),this.placeholderEl.style("right","")),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&this.placeholderEl.style({top:this.topPos0,right:""}),this.isOpen=!1,this.trigger("close")},transitionEnd:function(t){var e=this;this.transitionEvents.forEach(function(t){e.placeholderEl.on(t,null)}),this.isOpen&&this.placeholderEl.classed("notransition",!0)}}),Ia=Pa.extend({init:function(t,e){this.name="zoom",this.components=[{component:Zi,placeholder:".vzb-dialog-zoom-buttonlist",model:["state","ui","language"]},{component:Ma,placeholder:".vzb-zoomonscrolling-switch",model:["ui","language"],checkbox:"zoomOnScrolling"},{component:Ma,placeholder:".vzb-adaptminmaxzoom-switch",model:["ui","language"],checkbox:"adaptMinMaxZoom"}],this._super(t,e)}}),Ba=Pa.extend({init:function(t,e){this.name="stack";var i=this;this.components=[{component:Da,placeholder:".vzb-dialog-draggablelist",model:["state.marker.group","language","ui.chart"],groupID:"manualSorting",isEnabled:"manualSortingEnabled",dataArrFn:i.manualSorting.bind(i),lang:"entity/geo.world_4region/"}],this.model_binds={"change:state.marker.stack":function(t){i.updateView()},"change:state.marker.group":function(t){i.updateView()}},this._super(t,e)},readyOnce:function(){this._super();var t=this;this.group=this.model.state.marker.group,this.stack=this.model.state.marker.stack,this.howToStackEl=this.element.select(".vzb-howtostack").selectAll("input").on("change",function(){t.setModel("stack",d3.select(this).node().value)}),this.howToMergeEl=this.element.select(".vzb-howtomerge").selectAll("input").on("change",function(){t.setModel("merge",d3.select(this).node().value)}),this.updateView()},updateView:function(){var t=this;this.howToStackEl.property("checked",function(){
return d3.select(this).node().value===t.stack.which}),t.ui.chart.manualSortingEnabled="all"==t.stack.which,this.howToMergeEl.property("checked",function(){return"none"===d3.select(this).node().value?!t.group.merge&&!t.stack.merge:"grouped"===d3.select(this).node().value?t.group.merge:"stacked"===d3.select(this).node().value?t.stack.merge:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"grouped"===d3.select(this).node().value?"none"===t.stack.which?!0:null:"stacked"===d3.select(this).node().value?"all"===t.stack.which?null:!0:void 0})},manualSorting:function(t){return 0===arguments.length?this.model.state.marker.group.manualSorting:void(this.model.state.marker.group.manualSorting=t)},setModel:function(t,e){var i={stack:{},group:{}};if("merge"===t)switch(e){case"none":i.group.merge=!1,i.stack.merge=!1;break;case"grouped":i.group.merge=!0,i.stack.merge=!1;break;case"stacked":i.group.merge=!1,i.stack.merge=!0}"stack"===t&&(i.stack.which=e,"all"!==e&&"none"!==e?i.stack.use="property":i.stack.use="constant","none"===e&&this.group.merge&&(i.group.merge=!1),"all"!==e&&this.stack.merge&&(i.stack.merge=!1)),this.model.state.marker.set(i)}}),Ra=Pa.extend({init:function(t,e){this.name="speed",this.components=[{component:za,placeholder:".vzb-dialog-placeholder",model:["state.time"],arg:"delay",properties:{min:1,max:5,step:.1,scale:d3.scale.linear().domain([1,2,3,4,5]).range([1200,900,450,200,75])}}],this._super(t,e)}}),Fa=Pa.extend({init:function(t,e){this.name="size",this.components=[{component:Aa,placeholder:".vzb-saxis-selector",model:["state.marker","language"],markerID:"size"}],t.ui.chart&&0===t.ui.chart.sizeSelectorActive||this.components.push({component:wn,placeholder:".vzb-dialog-bubblesize",model:["state.marker.size"],ui:{show_button:!1}}),this._super(t,e)}}),Na=Pa.extend({init:function(t,e){this.name="show";var i=this;this.model_binds={"change:state.entities.show":function(t){i.redraw()}},this._super(t,e)},readyOnce:function(){this._super(),this.list=this.element.select(".vzb-show-list"),this.input_search=this.element.select("#vzb-show-search"),this.deselect_all=this.element.select("#vzb-show-deselect"),this.KEY=this.model.state.entities.getDimension(),this.TIMEDIM=this.model.state.time.getDimension();var t=this;this.input_search.on("input",function(){t.showHideSearch()}),this.deselect_all.on("click",function(){t.deselectEntities()}),this.root.on("ready",function(){t.redraw()})},open:function(){this._super(),this.input_search.node().value="",this.showHideSearch()},ready:function(){this._super(),this.redraw(),Dt(this.element.select(".vzb-dialog-scrollable"))},redraw:function(){var t=this;this.translator=this.model.language.getTFunction(),this.model.state.marker_allpossible.getFrame(this.model.state.time.value,function(e){if(e){var i=Ut(e.label).map(function(i){var a={};return a[t.KEY]=i,a.label=e.label[i],a});i.sort(function(t,e){return t.label<e.label?-1:1}),t.list.html("");var a=t.list.selectAll(".vzb-show-item").data(i).enter().append("div").attr("class","vzb-show-item vzb-dialog-checkbox");a.append("input").attr("type","checkbox").attr("class","vzb-show-item").attr("id",function(e){return"-show-"+e[t.KEY]}).property("checked",function(e){return t.model.state.entities.isShown(e)}).on("change",function(e){t.model.state.entities.showEntity(e),t.showHideDeselect()}),a.append("label").attr("for",function(e){return"-show-"+e[t.KEY]}).text(function(t){return t.label}),t.input_search.attr("placeholder",t.translator("placeholder/search")+"..."),t.showHideSearch(),t.showHideDeselect()}})},showHideSearch:function(){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-show-item").classed("vzb-hidden",function(e){var i=e.label.toLowerCase();return-1===i.indexOf(t)})},showHideDeselect:function(){var t=this.model.state.entities.show[this.KEY];this.deselect_all.classed("vzb-hidden",!t||"*"===t[0])},deselectEntities:function(){this.model.state.entities.clearShow(),this.showHideDeselect()},transitionEnd:function(t){this._super(t),ve()||this.input_search.node().focus()}}),qa=Pa.extend({init:function(t,e){this.name="presentation",this.components=[{component:Ma,placeholder:".vzb-presentationmode-switch",model:["ui","language"],checkbox:"presentation"}],this._super(t,e)}}),Ha=Pa.extend({init:function(t,e){this.name="opacity",this.components=[{component:za,placeholder:".vzb-dialog-bubbleopacity-regular",model:["state.entities"],arg:"opacityRegular",properties:{step:.01}},{component:za,placeholder:".vzb-dialog-bubbleopacity-selectdim",model:["state.entities"],arg:"opacitySelectDim",properties:{step:.01}}],this._super(t,e)}}),Ya="vzb-active",ja="vzb-hidden",Va="vzb-active-locked",Xa="vzb-unavailable",Ka="vzb-force-fullscreen",Wa="vzb-container-fullscreen",Ua=ni.extend({init:function(t,e){var i=this;this.name=this.name||"gapminder-buttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"model"},{name:"language",type:"language"}],this._available_buttons={find:{title:"buttons/find",icon:"search",required:!1},show:{title:"buttons/show",icon:"asterisk",required:!1},moreoptions:{title:"buttons/more_options",icon:"gear",required:!0},colors:{title:"buttons/colors",icon:"paintbrush",required:!1},size:{title:"buttons/size",icon:"circle",required:!1},fullscreen:{title:"buttons/expand",icon:"expand",func:this.toggleFullScreen.bind(this),required:!0},trails:{title:"buttons/trails",icon:"trails",func:this.toggleBubbleTrails.bind(this),required:!1,statebind:"ui.chart.trails",statebindfunc:this.setBubbleTrails.bind(this)},lock:{title:"buttons/lock",icon:"lock",func:this.toggleBubbleLock.bind(this),required:!1,statebind:"ui.chart.lockNonSelected",statebindfunc:this.setBubbleLock.bind(this)},inpercent:{title:"buttons/inpercent",icon:"percent",func:this.toggleInpercent.bind(this),required:!1,statebind:"ui.chart.inpercent",statebindfunc:this.setInpercent.bind(this)},presentation:{title:"buttons/presentation",icon:"presentation",func:this.togglePresentationMode.bind(this),required:!1,statebind:"ui.presentation",statebindfunc:this.setPresentationMode.bind(this)},about:{title:"buttons/about",icon:"about",required:!1},axes:{title:"buttons/axes",icon:"axes",required:!1},axesmc:{title:"buttons/axesmc",icon:"axes",required:!1},stack:{title:"buttons/stack",icon:"stack",required:!1},_default:{title:"Button",icon:"asterisk",required:!1}},this._active_comp=!1,this.model_binds={"change:state.entities.select":function(t){i._readyOnce&&(i.setBubbleTrails(),i.setBubbleLock(),i._toggleButtons())},"change:ui.chart":function(t,e){e.indexOf("lockActive")>-1&&i.setBubbleLock()}},t.ui.buttons.forEach(function(t){var e=i._available_buttons[t];e&&e.statebind&&(i.model_binds["change:"+e.statebind]=function(i){e.statebindfunc(t,i.source.value)})}),this.validatePopupButtons(t.ui.buttons,t.ui.dialogs),this._super(t,e)},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.root.findChildByName("gapminder-dialogs").on("close",function(e,i){t.setButtonActive(i.id,!1)});var e=(this.model.ui.dialogs||{}).sidebar||[],i=[].concat(this.model.ui.buttons);this.model.ui.buttons=i,this._addButtons(i,e),this._prev_body_overflow=document.body.style.overflow,this.setBubbleTrails(),this.setBubbleLock(),this.setInpercent(),this.setPresentationMode(),this._toggleButtons()},proceedClick:function(t){var e=this,i=e.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),a=i.attr("class"),n=e._available_buttons[t];if(n&&n.func)n.func(t);else{var s=-1===a.indexOf(Ya);i.classed(Ya,s);var l={};l.id=t,l.active=s,e.trigger("click",l)}},validatePopupButtons:function(t,e){for(var i=this,a=e.popup,n=t.filter(function(t){return i._available_buttons[t]&&!i._available_buttons[t].func}),s=0,l=n.length;l>s;s++)if(-1==a.indexOf(n[s]))return Ht('Buttonlist: bad buttons config: "'+n[s]+'" is missing in popups list');return!1},_showAllButtons:function(){var t=this.element.selectAll(".vzb-buttonlist-btn");t.each(function(t,e){var i=d3.select(this);i.style("display","")})},_toggleButtons:function(){var t=this,e=this.parent.element.node?this.parent.element:d3.select(this.parent.element),i=(this.model.ui.dialogs||{}).sidebar||[];t._showAllButtons();var a=this.element.selectAll(".vzb-buttonlist-btn"),n=(this.element.node().getBoundingClientRect(),[]),s=[],l=80,r=80,o=this.element.node().getBoundingClientRect().width,c=this.element.node().getBoundingClientRect().height,h=0,d=0;a.each(function(e,a){var o=e,c=d3.select(this),u=-1!==i.indexOf(o.id),m={top:parseInt(c.style("margin-top")),right:parseInt(c.style("margin-right")),left:parseInt(c.style("margin-left")),bottom:parseInt(c.style("margin-bottom"))};l=c.node().getBoundingClientRect().width+m.right+m.left,r=c.node().getBoundingClientRect().height+m.top+m.bottom,c.classed(ja)||(u&&"large"===t.getLayoutProfile()?c.style("display","none"):(h+=l,d+=r,o.required?s.push(c):n.push(c)))});var u=h-o,m=d-c,g=1;e.classed("vzb-large")&&e.classed("vzb-dialog-expand-true")||e.classed("vzb-small")&&e.classed("vzb-portrait")?(u>0&&10>=u&&(o+=u),g=Math.floor(o/l)-s.length,0>g&&(g=0)):(m>0&&10>=m&&(c+=m),g=Math.floor(c/r)-s.length,0>g&&(g=0)),n.reverse();for(var p=[],f=0,v=n.length-g;v>f;f++)n[f].style("display","none"),p.push(n[f].attr("data-btn"));var b={};b.hiddenButtons=p,t.trigger("toggle",b)},_addButtons:function(t,e){var i=this;this._components_config=[];var a=[];if(t.length){for(var n=0;n<t.length;n++){var s=t[n],l=this._available_buttons[s],r=l?s:"_default",o=wt(this._available_buttons[r]);o.id=s,o.icon=Pi[o.icon],a.push(o)}var c=this.getTranslationFunction(!0);this.element.selectAll("button").data(a).enter().append("button").attr("class",function(t){var i="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(i+=" vzb-dialog-side-btn"),i}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+c(t.title)+"</span>"});var h=this.element.selectAll(".vzb-buttonlist-btn");h.on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");i.proceedClick(t)})}},scrollToEnd:function(){var t=0,e=d3.select(".vzb-tool");e.classed("vzb-portrait")&&e.classed("vzb-small")?(this.model.state.entities.select.length>0&&(t=this.element[0][0].scrollWidth),this.element[0][0].scrollLeft=t):(this.model.state.entities.select.length>0&&(t=this.element[0][0].scrollHeight),this.element[0][0].scrollTop=t)},resize:function(){"small"===this.getLayoutProfile()&&this.model.ui.presentation&&this.togglePresentationMode(),this._toggleButtons()},setButtonActive:function(t,e){var i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']");i.classed(Ya,e)},toggleBubbleTrails:function(){this.model.ui.chart.trails=!this.model.ui.chart.trails,this.setBubbleTrails()},setBubbleTrails:function(){var t=(this.model.ui.chart||{}).trails;if(t||t===!1){var e="trails",i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+e+"']");if(!i.node())return Ft("setBubbleTrails: no button '"+e+"' found in DOM. doing nothing");i.classed(Va,t),i.classed(ja,0==this.model.state.entities.select.length)}},toggleBubbleLock:function(t){var e=(this.model.ui.chart||{}).lockActive;if(0!=this.model.state.entities.select.length||e){var i=this.model.ui.chart.lockNonSelected,a=this.model.state.time;i=i?0:a.timeFormat(a.value),this.model.ui.chart.lockNonSelected=i,this.setBubbleLock()}},setBubbleLock:function(){var t=(this.model.ui.chart||{}).lockNonSelected,e=(this.model.ui.chart||{}).lockActive;if(t||0===t){0===t||0!==this.model.state.entities.select.length||e||(t=this.model.ui.chart.lockNonSelected=0);var i="lock",a=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+i+"']");if(!a.node())return Ft("setBubbleLock: no button '"+i+"' found in DOM. doing nothing");var n=this.model.language.getTFunction();a.classed(Xa,0==this.model.state.entities.select.length&&!e),"undefined"==typeof e?a.classed(ja,0==this.model.state.entities.select.length):a.classed(ja,!e),a.classed(Va,t),a.select(".vzb-buttonlist-btn-title").text(t?t:n("buttons/lock")),a.select(".vzb-buttonlist-btn-icon").html(Pi[t?"lock":"unlock"])}},toggleInpercent:function(){this.model.ui.chart.inpercent=!this.model.ui.chart.inpercent,this.setInpercent()},setInpercent:function(){var t="inpercent",e=(this.model.language.getTFunction(),this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"));e.classed(Va,this.model.ui.chart.inpercent)},togglePresentationMode:function(){this.model.ui.presentation=!this.model.ui.presentation,this.setPresentationMode()},setPresentationMode:function(){var t="presentation",e=(this.model.language.getTFunction(),this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"));e.classed(Va,this.model.ui.presentation)},toggleFullScreen:function(t){if(window){for(var e=this,i=e.placeholder,a=!1,n=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),s=!this.model.ui.fullscreen,l=s?"hidden":this._prev_body_overflow;!(a=Kt(i,"vzb-placeholder"));)e=e.parent,i=e.placeholder;s?(R(i),I.call(this,this.toggleFullScreen.bind(this,t))):F.call(this),Xt(i,Ka,s),"undefined"!=typeof container&&Xt(container,Wa,s),this.model.ui.fullscreen=s;var r=this.model.language.getTFunction();n.classed(Va,s),n.select(".vzb-buttonlist-btn-icon").html(Pi[s?"unexpand":"expand"]),n.select(".vzb-buttonlist-btn-title>span").text(r("buttons/"+(s?"unexpand":"expand"))).attr("data-vzb-translate","buttons/"+(s?"unexpand":"expand")),document.body.style.overflow=l,this.root.layout.resizeHandler()}}}),Ga="vzb-active",Qa=Ua.extend({init:function(t,e){this.name="gapminder-optionsbuttonlist",this._super(t,e)},readyOnce:function(){var t=this;Object.keys(this._available_buttons).forEach(function(e){var i=t._available_buttons[e];i.required=!i.required}),this.buttonListComp=this.root.findChildByName("gapminder-buttonlist"),this.buttonListComp.on("click",function(e,i){var a=t.element.selectAll(".vzb-buttonlist-btn[data-btn='"+i.id+"']");a.classed(Ga,i.active)}),this.buttonListComp.on("toggle",function(e,i){var a=t.element.selectAll(".vzb-buttonlist-btn"),n=0;a.each(function(t){var e=d3.select(this),a=-1==i.hiddenButtons.indexOf(t.id);e.style("display",a?"none":""),a||n++})}),this._super()},proceedClick:function(t){var e=this;this.buttonListComp.proceedClick(t);var i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").datum();i.func&&le(function(){e.root.findChildByName("gapminder-dialogs").closeAllDialogs()},200)},_toggleButtons:function(){}}),Za=Pa.extend({init:function(t,e){this.name="moreoptions",this.components=[{component:Qa,placeholder:".vzb-dialog-options-buttonlist",model:["state","ui","language"]}],this._super(t,e)},readyOnce:function(){this._super();var t=this;this.accordionEl=this.contentEl.select(".vzb-accordion"),this.on("dragend",function(){t._setMaxHeight()});var e=(this.model.ui.dialogs||{}).popup||[],i=(this.model.ui.dialogs||{}).moreoptions||[];if(i===!0&&(i=e,(this.model.ui.dialogs||{}).moreoptions=i),this._addDialogs(i),this.accordionEl){var a=this.accordionEl.selectAll(".vzb-accordion-section").select(".vzb-dialog-title>span:first-child");a.on("click",function(e){var i=(t.components[e.component].element,t.components[e.component].placeholderEl),a=t.accordionEl.select(".vzb-accordion-active");a&&a.classed("vzb-accordion-active",!1),i.node()!==a.node()&&i.classed("vzb-accordion-active",!0)})}},_addDialogs:function(t){this._components_config=[];var e=[];if(t.length){for(var i=0;i<t.length;i++)if("moreoptions"!==t[i]){var a=t[i],n=St(this.parent._available_dialogs[a]);if(n&&n.dialog){var s=this._components_config;s.push({component:n.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+a+'"]',model:["state","ui","language"]}),n.component=s.length-1,n.id=a,e.push(n)}}this.accordionEl.selectAll("div").data(e).enter().append("div").attr("class",function(t){var e="vzb-dialogs-dialog vzb-moreoptions vzb-accordion-section";return e}).attr("data-dlg",function(t){return t.id}),this.loadComponents();var l=this;xt(this.components,function(t){t.render(),l.on("resize",function(){t.trigger("resize")})})}}}),Ja=Pa.extend({init:function(t,e){this.name="label",this.components=[{component:_a,placeholder:".vzb-dialog-sizeslider",model:["state.marker.size_label","language"],propertyname:"LabelTextSize",ui:{constantUnit:"unit/pixels"}},{component:Aa,placeholder:".vzb-saxis-selector",model:["state.marker","language"],markerID:"size_label"},{component:Ma,placeholder:".vzb-removelabelbox-switch",model:["ui.chart","language"],checkbox:"removeLabelBox",submodel:"labels"}],this._super(t,e)}}),$a=Pa.extend({init:function(t,e){this.name="find";var i=this;this.components=[{component:za,placeholder:".vzb-dialog-bubbleopacity",model:["state.entities"],arg:"opacitySelectDim",properties:{step:.01}}],this.model_binds={"change:state.entities.select":function(t){i.selectDataPoints(),i.showHideDeselect()},"change:state.time.playing":function(t){i.model.state.time.playing||(i.time=i.model.state.time.value,i.model.state.marker.getFrame(i.time,function(t){t&&i.redrawDataPoints(t)}))},"change:state.time.value":function(t){(i.placeholderEl.classed("vzb-active")||i.placeholderEl.classed("vzb-sidebar"))&&(i.time=i.model.state.time.value,i.model.state.marker.getFrame(i.time,function(t){t&&i.redrawDataPoints(t)}))},"change:language.strings":function(){i.translator=i.model.language.getTFunction(),i.input_search.attr("placeholder",i.translator("placeholder/search")+"...")}},this._super(t,e)},readyOnce:function(){this._super(),this.list=this.element.select(".vzb-find-list"),this.input_search=this.element.select("#vzb-find-search"),this.deselect_all=this.element.select("#vzb-find-deselect"),this.opacity_nonselected=this.element.select(".vzb-dialog-bubbleopacity"),this.KEY=this.model.state.entities.getDimension();var t=this;this.input_search.on("keyup",function(){var e=d3.event;13==e.keyCode&&"select all"==t.input_search.node().value&&(t.input_search.node().value="",ve()||t.model.state.entities.clearHighlighted(),t.model.state.entities.selectAll())}),this.input_search.on("input",function(){t.showHideSearch()}),this.deselect_all.on("click",function(){t.deselectEntities()}),this.translator=this.model.language.getTFunction(),this.input_search.attr("placeholder",this.translator("placeholder/search")+"..."),this.root.on("ready",function(){t.ready()})},open:function(){var t=this;this._super(),this.input_search.node().value="",this.showHideSearch(),this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(e){e&&t.redrawDataPoints(e)})},ready:function(){this._super();var t=this,e=this.KEY;this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(i){if(i){var a=t.model.state.marker.getKeys().map(function(t){var a={};return a[e]=t[e],a.brokenData=!1,a.name=i.label[t[e]],a});a.sort(function(t,e){return t.name<e.name?-1:1}),t.list.html(""),t.items=t.list.selectAll(".vzb-find-item").data(a).enter().append("div").attr("class","vzb-find-item vzb-dialog-checkbox"),t.items.append("input").attr("type","checkbox").attr("class","vzb-find-item").attr("id",function(t){return"-find-"+t[e]}).on("change",function(e){ve()||t.model.state.entities.clearHighlighted(),t.model.state.entities.selectEntity(e),ve()||e.brokenData||t.model.state.entities.highlightEntity(e)}),t.items.append("label").attr("for",function(t){return"-find-"+t[e]}).text(function(t){return t.name}).on("mouseover",function(e){ve()||e.brokenData||t.model.state.entities.highlightEntity(e)}).on("mouseout",function(e){ve()||t.model.state.entities.clearHighlighted()}),Dt(t.element.select(".vzb-dialog-scrollable")),t.redrawDataPoints(i),t.selectDataPoints(),t.showHideSearch(),t.showHideDeselect()}})},redrawDataPoints:function(t){var e=this,i=this.KEY;e.items.each(function(a){var n=d3.select(this).select("label");a.brokenData=!1,xt(t,function(t,n){"color"===n||"size_label"===n||"constant"===e.model.state.marker[n].use||t[a[i]]||0===t[a[i]]||(a.brokenData=!0)}),n.classed("vzb-find-item-brokendata",a.brokenData).attr("title",a.brokenData?e.model.state.time.timeFormat(e.time)+": "+e.translator("hints/nodata"):"")})},selectDataPoints:function(){var t=this.KEY,e=this.model.state.entities.getSelected();this.items.selectAll("input").property("checked",function(i){return-1!==e.indexOf(i[t])})},showHideSearch:function(){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-find-item").classed("vzb-hidden",function(e){var i=(e.name||"").toLowerCase();return-1===i.indexOf(t)})},showHideDeselect:function(){var t=!!this.model.state.entities.select.length;this.deselect_all.classed("vzb-hidden",!t),this.opacity_nonselected.classed("vzb-hidden",!t)},deselectEntities:function(){this.model.state.entities.clearSelected()},transitionEnd:function(t){this._super(t),ve()||this.input_search.node().focus()}}),tn=Pa.extend({init:function(t,e){this.name="colors",this.components=[{component:Aa,placeholder:".vzb-caxis-selector",model:["state.marker","language"],markerID:"color"},{component:_n,placeholder:".vzb-clegend-container",model:["state","language"]}],this._super(t,e)}}),en=Pa.extend({init:function(t,e){this.name="axesmc";var i=this;this.model_binds={"change:ui.chart.xLogStops":function(){i.updateView()},"change:ui.chart.yMaxMethod":function(){i.updateView()}},this.components=[{component:Ta,placeholder:".vzb-xlimits-container",model:["state.marker","state.time","language"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(t,e)},readyOnce:function(){this._super();var t=this;this.yMaxRadio=this.element.select(".vzb-yaxis-container").selectAll("input").on("change",function(){t.setModel("yMaxMethod",d3.select(this).node().value)}),this.xLogStops=this.element.select(".vzb-xaxis-container").selectAll("input").on("change",function(){t.setModel("xLogStops",d3.select(this).node().value)}),this.probeFieldEl=this.element.select(".vzb-probe-field").on("change",function(){var e=parseFloat(this.value.replace(",","."));return!e||e<=t.model.state.marker.axis_x.tailCutX?void(this.value=t.model.ui.chart.probeX):(e>t.model.state.marker.axis_x.domainMax&&(e=t.model.state.marker.axis_x.domainMax),this.value=e,void t.setModel("probeX",e))}),this.updateView()},updateView:function(){var t=this;this.yMaxRadio.property("checked",function(){return d3.select(this).node().value===t.model.ui.chart.yMaxMethod}),this.xLogStops.property("checked",function(){return-1!==t.model.ui.chart.xLogStops.indexOf(+d3.select(this).node().value)}),this.probeFieldEl.property("value",this.model.ui.chart.probeX)},setModel:function(t,e){var i;"yMaxMethod"==t&&(i=e),"xLogStops"==t&&(i=[],this.xLogStops.each(function(){d3.select(this).property("checked")&&i.push(+d3.select(this).node().value)})),"probeX"==t&&(i=e),this.model.ui.chart[t]=i}}),an=Pa.extend({init:function(t,e){this.name="axes";this.components=[{component:Aa,placeholder:".vzb-xaxis-selector",model:["state.marker","language"],markerID:"axis_x"},{component:Ta,placeholder:".vzb-xaxis-minmax",model:["state.marker","state.time","language"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}},{component:Aa,placeholder:".vzb-yaxis-selector",model:["state.marker","language"],markerID:"axis_y"},{component:Ta,placeholder:".vzb-yaxis-minmax",model:["state.marker","state.time","language"],markerID:"axis_y",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(t,e)}}),nn=Pa.extend({init:function(t,e){this.name="about",this._super(t,e)},readyOnce:function(){var t=at.version,e=new Date(parseInt(at.build));this.element=d3.select(this.element),this.element.select(".vzb-about-text0").html("This chart is made with Vizabi,"),this.element.select(".vzb-about-text1").html("a project by <a href='http://gapminder.org'>Gapminder Foundation</a>"),this.element.select(".vzb-about-version").html("<a href='https://github.com/Gapminder/vizabi/releases/tag/v"+t+"'>Version: "+t+" (alpha)</a>"),this.element.select(".vzb-about-updated").html("Build: "+d3.time.format("%Y-%m-%d at %H:%M")(e)),this.element.select(".vzb-about-text2").html("Alpha version: don't expect too much!"),this.element.select(".vzb-about-report").html("<a href='https://getsatisfaction.com/gapminder/'>Report a problem</a>"),this.element.select(".vzb-about-credits").html("<a href='https://github.com/Gapminder/vizabi/graphs/contributors'>Contributors</a>")}}),sn="vzb-active",ln=ni.extend({init:function(t,e){this.name="gapminder-dialogs",this._curr_dialog_index=20,this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"model"},{name:"language",type:"language"}],this._available_dialogs={find:{dialog:$a},show:{dialog:Na},moreoptions:{dialog:Za},colors:{dialog:tn},size:{dialog:Fa},label:{dialog:Ja},zoom:{dialog:Ia},axes:{dialog:an},axesmc:{dialog:en},stack:{dialog:Ba},speed:{dialog:Ra},opacity:{dialog:Ha},presentation:{dialog:qa},about:{dialog:nn}},this._super(t,e)},domReady:function(){var t=(this.model.ui.dialogs||{}).popup||[],e=(this.model.ui.dialogs||{}).sidebar||[];this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),e===!0&&(e=t,(this.model.ui.dialogs||{}).sidebar=e),0!==e.length&&this.rootEl.classed("vzb-dialog-expand-true",!0),this.dialog_popup=t,this.dialog_sidebar=e},readyOnce:function(){var t=this;if(this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this._addDialogs(this.dialog_popup,this.dialog_sidebar),this.resize(),0!==this.dialog_popup.length){this.root.findChildByName("gapminder-buttonlist").on("click",function(e,i){t._available_dialogs[i.id]&&(i.active?t.openDialog(i.id):t.closeDialog(i.id))});var e=this.element.selectAll(".vzb-top-dialog").filter(function(e){return t.dialog_popup.indexOf(e.id)>-1}),i=e.select(".vzb-top-dialog>.vzb-dialog-modal>.vzb-dialog-buttons>[data-click='closeDialog']");i.on("click",function(e,i){t.closeDialog(e.id)});var a=e.select(".vzb-top-dialog>.vzb-dialog-modal>[data-click='pinDialog']");a.on("click",function(e,i){t.pinDialog(e.id)}),this.rootEl.node().addEventListener("click",function(){t.closeAllDialogs()}),this.rootEl.on("mousedown",function(e){if(this._active_comp){for(var i=d3.event.target,a=!0;i;){if(i.classList.contains("vzb-dialog-modal")){a=!1;break}i=i.parentElement}a&&t.closeAllDialogs()}})}this.element.on("click",function(){d3.event.stopPropagation()})},resize:function(){var t=this,e=this.getLayoutProfile();this.element.selectAll(".vzb-top-dialog").each(function(i){var a=d3.select(this),n=a.attr("class").replace(" vzb-popup","").replace(" vzb-sidebar","");"large"===e&&t.dialog_sidebar.indexOf(i.id)>-1?n+=" vzb-sidebar":t.dialog_popup.indexOf(i.id)>-1&&(n+=" vzb-popup"),a.attr("class",n)})},_addDialogs:function(t,e){var i=(this.getLayoutProfile(),[]);i=t?i.concat(t):i,i=e?i.concat(e):i,i=Et(i),this._components_config=[];var a=[];if(i.length){for(var n=0;n<i.length;n++){var s=i[n],l=this._available_dialogs[s];if(l&&l.dialog){var r=this._components_config;r.push({component:l.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+s+'"]',model:["state","ui","language"]}),l.component=r.length-1}l.id=s,a.push(l)}this.element.selectAll("div").data(a).enter().append("div").attr("data-dlg",function(t){return t.id}).attr("class","vzb-top-dialog vzb-dialogs-dialog vzb-dialog-shadow"),this.loadComponents();var o=this;xt(this.components,function(t){t.render(),o.on("resize",function(){t.trigger("resize")}),t.on("dragstart",function(){o.bringForward(t.name)}),t.on("close",function(){this.placeholderEl.each(function(t){var e={};e.id=t.id,o.trigger("close",e)})})})}},bringForward:function(t){var e=this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");e.style("z-index",this._curr_dialog_index),this._curr_dialog_index+=10},openDialog:function(t){var e="small"===this.getLayoutProfile();this.closeAllDialogs(e);var i=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp.beforeOpen(),i.classed(sn,!0),this.bringForward(t),this._active_comp.open()},pinDialog:function(t){var e=this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._available_dialogs[t].ispin?(e.classed("pinned",!1),this._available_dialogs[t].ispin=!1):(e.classed("pinned",!0),this._available_dialogs[t].ispin=!0)},closeDialog:function(t){var e=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp&&!this._active_comp.isOpen||(this._available_dialogs[t].ispin&&this.pinDialog(t),this._active_comp&&this._active_comp.beforeClose(),e.classed(sn,!1),this._active_comp&&this._active_comp.close(),this._active_comp=!1)},closeAllDialogs:function(t){var e=this,i=t?".vzb-popup.vzb-dialogs-dialog.vzb-active":".vzb-popup.vzb-dialogs-dialog.vzb-active:not(.pinned)",a=this.element.selectAll(i);a.each(function(t){e.closeDialog(t.id)})}}),rn=!0,on=ni.extend({init:function(t,e){var i=this;this.name="gapminder-datawarning",this.model_expects=[{name:"language",type:"language"}],this.context=e,this.model_binds={"change:language.strings":function(t){i.ready()}},this._super(t,e),this.ui=_t({},this.ui)},ready:function(){},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.translator=this.model.language.getTFunction(),this.element.selectAll("div").remove(),this.element.append("div").attr("class","vzb-data-warning-background").on("click",function(){t.toggle(!0)});var e=this.element.append("div").attr("class","vzb-data-warning-box");e.append("div").html(ki).on("click",function(){t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-warning-close");var i=e.append("div").attr("class","vzb-data-warning-link").html(Mi);i.append("div").text("Data doubts"),this.parent.datawarning_content.title&&e.append("div").attr("class","vzb-data-warning-title").html(this.parent.datawarning_content.title),e.append("div").attr("class","vzb-data-warning-body vzb-dialog-scrollable").html(this.parent.datawarning_content.body)},toggle:function(t){null==t&&(t=!rn),rn=t,this.element.classed("vzb-hidden",rn);var e=this;this.parent.components.forEach(function(t){t.element.classed("vzb-blur",t!=e&&!rn)})}}),cn=!0,hn=!1,dn=!1,un=0,mn=0,gn=null,pn=null,fn=ni.extend({init:function(t,e){var i=this;this.name="gapminder-datanotes",this.model_expects=[{name:"marker",type:"model"},{name:"language",type:"language"}],this.context=e,this.model_binds={"change:language.strings":function(t){i.ready()}},this._super(t,e),this.ui=_t({},this.ui),this.close=this.close.bind(this)},ready:function(){this.translator=this.model.language.getTFunction()},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove();var e=this.element;e.append("div").html(ki).on("click",function(){d3.event.stopPropagation(),t.close()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-notes-close").classed("vzb-hidden",!0),e.append("div").attr("class","vzb-data-notes-body vzb-dialog-scrollable"),e.append("div").attr("class","vzb-data-notes-link")},resize:function(){this.close()},close:function(){cn||this.pin(!1).hide()},setHook:function(t){return this._readyOnce?dn?(pn=t,this):(gn&&this.model.marker[gn].off("change:which",this.close),gn=pn=t,this.model.marker[gn].on("change:which",this.close),this.setValues(),this):this},setValues:function(){if(gn){var t=this.model.marker[gn],e=this.translator("description/"+t.which),i=e!="description/"+t.which;i&&this.element.select(".vzb-data-notes-body").text(e),this.element.select(".vzb-data-notes-body").classed("vzb-hidden",!i);var a=t.getConceptprops().sourceLink;if(this.element.select(".vzb-data-notes-link").classed("vzb-hidden",!a),a){var n=this.translator("hints/source"),s=this.translator("sourceName/"+t.which),l=s!="sourceName/"+t.which;this.element.select(".vzb-data-notes-link").html("<span>"+(l?n+":":"")+'<a href="'+a+'" target="_blank">'+(l?s:n)+"</a></span>");
}hn=null!=a||i}},setPos:function(t,e,i){if(un=t,mn=e,dn&&!i)return this;var a,n,s=this.parent.element.offsetHeight,l=this.element.node().offsetWidth,r=this.element.node().offsetHeight,o=un-l,c=mn;return 10>o&&(o=10,a=!0),c+r+10>s&&(c=s-r-10,n=!0),a&&n&&(c=mn-r-30),this.element.style({top:c+"px",left:o+"px"}),this},pin:function(t){return cn?this:(dn=!dn,null!=t&&(dn=t),this.element.select(".vzb-data-notes-close").classed("vzb-hidden",!dn),this.element.classed("vzb-data-notes-pinned",dn),gn!=pn&&this.setHook(pn),this.element.select(".vzb-data-notes-body").node().scrollTop=0,hn?this.setPos(un,mn,!0):this.hide())},toggle:function(t){return dn||!gn?this:(null==t&&(t=!cn),cn=t,this.element.classed("vzb-hidden",cn||!hn),this)},show:function(){return this.toggle(!1)},hide:function(){return this.toggle(!0)}}),vn=null,bn=.8,yn=.5,xn=1,_n=ni.extend({init:function(t,e){var i=this;this.template='<div class="vzb-cl-outer"></div>',this.name="colorlegend",this.model_expects=[{name:"state",type:"model"},{name:"language",type:"language"}],this.needsUpdate=!1,this.which_1=!1,this.scaleType_1=!1,this.model_binds={"change:state.marker.color.scaleType":function(t,e){i._readyOnce&&i.updateView()},"change:state.marker.color.which":function(t,e){i._readyOnce&&(i.model.state.entities_minimap?i.forwardModelUpdate():i.updateView())},"change:state.marker.color.palette":function(t,e){i._readyOnce&&i.updateView()},"change:language.strings":function(t){this.translator=this.model.language.getTFunction(),i.updateView()}},this._super(t,e)},forwardModelUpdate:function(){"property"===this.colorModel.use&&(this.model.state.entities_minimap.show[this.KEY+".cat"]=[this.colorModel.which.replace(this.KEY+".","")])},readyOnce:function(){this.element=d3.select(this.element),this.translator=this.model.language.getTFunction(),this.markerModel=this.model.state.marker_minimap?this.model.state.marker_minimap:this.model.state.marker,this.listColorsEl=this.element.append("div").attr("class","vzb-cl-holder").append("div").attr("class","vzb-cl-colorlist"),this.rainbowEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow"),this.minimapEl=this.listColorsEl.append("div").attr("class","vzb-cl-minimap"),this.labelScaleEl=this.listColorsEl.append("div").attr("class","vzb-cl-labelscale"),this.labelScaleSVG=this.labelScaleEl.append("svg"),this.labelScaleG=this.labelScaleSVG.append("g"),this.unitDiv=this.labelScaleEl.append("div").attr("class","vzb-cl-unit"),this.unitText=this.unitDiv.append("text").attr("class","vzb-cl-unit-text"),this.minimapSVG=this.minimapEl.append("svg"),this.minimapG=this.minimapSVG.append("g"),this.colorPicker=N(),this.root.element instanceof Array?this.root.element:d3.select(this.root.element).call(this.colorPicker),this.KEY=this.model.state.entities.getDimension(),this.colorModel=this.model.state.marker.color,bn=this.model.state.entities.opacityRegular,yn=this.model.state.entities.opacitySelectDim,xn=1},ready:function(){var t=this;if(this.model.state.marker_minimap){var e=this.model.state.marker_minimap._getFirstDimension(),i=this.model.state.time,a={};a[i.getDimension()]=i.value,t.frame=this.model.state.marker_minimap.getValues(a,[e])}t.updateView()},updateView:function(){var t=this,e=this.KEY,i=this.colorModel.getPalette(),a=Ut((this.frame||{}).geoshape||{}).length&&"property"==this.colorModel.use,n=[];if(this.model.state.marker_minimap)var s=this.model.state.marker_minimap._getFirstDimension(),n=this.model.state.marker_minimap.getKeys(s);n.forEach(function(e){((t.frame||{}).geoshape||{})[e[t.KEY]]||(a=!1)}),this.labelScaleEl.classed("vzb-hidden",!0);var l=this.listColorsEl.selectAll(".vzb-cl-option");if(l.classed("vzb-hidden",a||"_default"==this.colorModel.which),this.rainbowEl.classed("vzb-hidden",a||"indicator"!==this.colorModel.use),this.minimapEl.classed("vzb-hidden",!a),a){var r=this.minimapEl.append("div").attr("class","vzb-temp");this.minimapSVG.attr("viewBox",null),this.minimapSVG.selectAll("g").remove(),this.minimapG=this.minimapSVG.append("g"),this.minimapG.selectAll("path").data(n,function(t){return t[e]}).enter().append("path").style("opacity",bn).on("mouseover",t._interact().mouseover).on("mouseout",t._interact().mouseout).on("click",t._interact().click).each(function(e){r.html(t.frame.geoshape[e[t.KEY]]);var a=i[e[t.KEY]];d3.select(this).attr("d",r.select("svg").select("path").attr("d")).style("fill",rt(a)?a[0]:a),r.html("")});var o=this.minimapG.node().getBBox();this.minimapSVG.attr("viewBox","0 0 "+1.05*o.width+" "+1.05*o.height),r.remove()}else if(l="_default"==this.colorModel.which?l.data([]):"indicator"!=this.colorModel.use&&n.length?l.data(n,function(t){return t[s]}):l.data(Ut(this.colorModel.getScale().range()),function(t){return t}),l.exit().remove(),l.enter().append("div").attr("class","vzb-cl-option").each(function(){d3.select(this).append("div").attr("class","vzb-cl-color-sample"),d3.select(this).append("div").attr("class","vzb-cl-color-legend")}).on("mouseover",t._interact().mouseover).on("mouseout",t._interact().mouseout).on("click",t._interact().click),l.each(function(e,a){d3.select(this).select(".vzb-cl-color-sample").style("background-color",i[e[t.KEY]||e[s]||e]).style("border","1px solid "+i[e[t.KEY]||e[s]||e])}),"indicator"==this.colorModel.use){var c,h,d,u=this.rainbowEl.node().getBoundingClientRect().width,m=Object.keys(i).map(parseFloat),g=this.colorModel.getTickFormatter(),p=null,f=this.colorModel.paletteLabels;if(f){p="optimistic",c=f.map(function(t){return parseFloat(t)});var v=d3.max(c);h=c.map(function(t){return t/v*u})}else{c=t.colorModel.getScale().domain();var v=d3.max(m);h=m.map(function(t){return t/v*u})}d=d3.scale["time"==this.colorModel.scaleType?"linear":this.colorModel.scaleType]().domain(c).range(h);var b=parseInt(this.rainbowEl.style("left")||0,10),y=parseInt(this.rainbowEl.style("right")||0,10);this.labelScaleSVG.style("width",b+u+y+"px"),this.labelScaleG.attr("transform","translate("+b+",0)");var x=L();x.scale(d).orient("bottom").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.colorModel.scaleType,toolMargin:{right:y,left:b},showOuter:!0,formatter:g,cssFontSize:"11px",fitIntoScale:p}),this.labelScaleEl.classed("vzb-hidden",!1),this.labelScaleG.call(x);var _=t.colorModel.getScale().range(),z=m.map(function(t,e){return _[e]+" "+d3.format("%")(.01*t)}).join(", ");this.rainbowEl.style("background","linear-gradient(90deg,"+z+")");var M=this.translator("unit/"+this.colorModel.which);this.unitDiv.classed("vzb-hidden",""==M),this.unitText.text(M),l.classed("vzb-hidden",!0)}else l.each(function(e,i){d3.select(this).select(".vzb-cl-color-legend").text(t.frame.label[e[t.KEY]||e[s]])}),l.classed("vzb-cl-compact",!(this.colorModel.getConceptprops().color||{}).palette)},_interact:function(){var t=this,e=this.KEY,i=this.colorModel.getPalette(),a=this.colorModel.getDefaultPalette();return{mouseover:function(i,a){if("indicator"!==t.colorModel.use){var n=d3.select(this),s=i[e];t.listColorsEl.selectAll(".vzb-cl-option").style("opacity",yn),t.minimapG.selectAll("path").style("opacity",yn),n.style("opacity",xn);var l=t.colorModel.getNestedItems([e]),r=Gt(l).map(function(t){return t[t.length-1]}).filter(function(e){return e[t.colorModel.which]==s}).map(function(t){return wt(t,[e])});t.model.state.entities.setHighlight(r)}},mouseout:function(e,i){"indicator"!==t.colorModel.use&&(t.listColorsEl.selectAll(".vzb-cl-option").style("opacity",bn),t.minimapG.selectAll("path").style("opacity",bn),t.model.state.entities.clearHighlighted())},click:function(n,s){if(t.colorModel.isUserSelectable()){var l=(d3.select(this),"indicator"===t.colorModel.use?n:n[e]||n);t.colorPicker.colorOld(i[l]).colorDef(a[l]).callback(function(e){t.colorModel.setColor(e,l)}).fitToScreen([d3.event.pageX,d3.event.pageY]).show(!0)}}}},resize:function(){this.colorPicker.resize(d3.select(".vzb-colorpicker-svg"))}}),zn={EXTENT_MIN:0,EXTENT_MAX:1,TEXT_PARAMS:{TOP:11,LEFT:10,MAX_WIDTH:42,MAX_HEIGHT:16},BAR_WIDTH:6,THUMB_RADIUS:10,THUMB_STROKE_WIDTH:4,INTRO_DURATION:250},Mn={small:{minRadius:.5,maxRadius:40},medium:{minRadius:1,maxRadius:55},large:{minRadius:1,maxRadius:65}},wn=ni.extend({init:function(t,e){function i(t,e){var i=n.model.size.extent||[zn.EXTENT_MIN,zn.EXTENT_MAX];n._updateLabels(i),n.sliderEl.call(n.brush.extent(i)),i[0]==i[1]&&n.sliderEl.selectAll(".resize").style("display","block")}function a(t){n.sizeScaleMinMax=n.model.size.getScale().domain(),n._setLabelsText()}this.name="bubblesize",this.template=this.template||"bubblesize.html",this.model_expects=[{name:"size",type:"size"}];var n=this;this.model_binds={"change:size.domainMin":i,"change:size.domainMax":i,"change:size.extent":i,ready:a},this._setModel=Wt(this._setModel,50),this._super(t,e)},readyOnce:function(){var t=this,e=t.model.size.extent||[zn.EXTENT_MIN,zn.EXTENT_MAX];this.showArcs=t.model.size.showArcs!==!1,this.element=d3.select(this.element),this.sliderSvg=this.element.select(".vzb-bs-svg"),this.sliderWrap=this.sliderSvg.select(".vzb-bs-slider-wrap"),this.sliderEl=this.sliderWrap.select(".vzb-bs-slider");var i={v:zn.TEXT_PARAMS.TOP,h:zn.TEXT_PARAMS.LEFT},a=zn.TEXT_PARAMS.MAX_WIDTH,n=zn.TEXT_PARAMS.MAX_HEIGHT,s=zn.BAR_WIDTH,l=zn.THUMB_RADIUS,r=zn.THUMB_STROKE_WIDTH,o={top:r,left:i.h+a,right:i.h+a,bottom:s+n};this.padding=o;var c=this.getMinMaxBubbleRadius();this.xScale=d3.scale.linear().domain([zn.EXTENT_MIN,zn.EXTENT_MAX]).range([2*c.min,2*c.max]).clamp(!0),this.brush=d3.svg.brush().x(this.xScale).extent([zn.EXTENT_MIN,zn.EXTENT_MIN]).on("brush",function(){t._setFromExtent(!0,!1,!1)}).on("brushend",function(){t.sliderEl.selectAll(".resize").style("display",null),t._setFromExtent(!0,!0)}),this.sliderEl.call(t.brush),this.sliderEl.selectAll(".background").attr("style",""),this.sliderThumbs=this.sliderEl.selectAll(".resize").sort(d3.descending).classed("vzb-bs-slider-thumb",!0),this.sliderThumbs.append("g").attr("class","vzb-bs-slider-thumb-badge").append("path").attr("d","M0 "+.5*s+"l"+-l+" "+1.5*l+"h"+2*l+"Z"),t.showArcs&&this.sliderThumbs.append("path").attr("class","vzb-bs-slider-thumb-arc"),this.sliderEl.selectAll("text").data([0,0]).enter().append("text").attr("class","vzb-bs-slider-thumb-label").attr("text-anchor",function(t,e){return e?"start":"end"}).attr("dy",function(t,e){return e?"-0.7em":"1.4em"}),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-bs-slider-thumb-label"),this.sliderEl.selectAll("rect").attr("height",s).attr("rx",.25*s).attr("ry",.25*s).attr("transform","translate(0,"+.5*-s+")"),this.sliderEl.select(".extent").classed("vzb-bs-slider-extent",!0),this.on("resize",function(){t.xScale.range([2*t.getMinMaxBubbleRadius().min,2*t.getMinMaxBubbleRadius().max]),t._updateSize(),t.sliderEl.call(t.brush.extent(t.brush.extent())),t._setFromExtent(!1,!1,!1)}),this._updateSize(),this.sliderEl.call(this.brush.extent(e)),t._setFromExtent(!1,!1,!1),t.sizeScaleMinMax=t.model.size.getScale().domain(),t.sizeScaleMinMax&&t._setLabelsText()},getMinMaxBubbleRadius:function(){return{min:Mn[this.getLayoutProfile()].minRadius,max:Mn[this.getLayoutProfile()].maxRadius}},_updateSize:function(){var t=this.showArcs?this.getMinMaxBubbleRadius().max:2*zn.TEXT_PARAMS.TOP;this.sliderSvg.attr("height",t+this.padding.top+this.padding.bottom).attr("width",2*this.getMinMaxBubbleRadius().max+this.padding.left+this.padding.right),this.sliderWrap.attr("transform","translate("+this.padding.left+","+(t+this.padding.top)+")")},_updateArcs:function(t){if(this.showArcs){var e=this,i=d3.svg.arc().outerRadius(function(t){return.5*e.xScale(t)}).innerRadius(function(t){return.5*e.xScale(t)}).startAngle(.5*-Math.PI).endAngle(.5*Math.PI);this.sliderThumbs.select(".vzb-bs-slider-thumb-arc").data(t).attr("d",i).attr("transform",function(t){return"translate("+.5*-e.xScale(t)+",0)"})}},_updateLabels:function(t){var e=this,i=function(t,i){var a={v:zn.TEXT_PARAMS.TOP,h:zn.TEXT_PARAMS.LEFT},n=a.h*(i?.5:-1)+e.xScale(t),s=0;return"translate("+n+","+s+")"};this.sliderLabelsEl.data(t).attr("transform",i)},_setLabelsText:function(){var t=this;t.sliderLabelsEl.data([t.model.size.getTickFormatter()(t.sizeScaleMinMax[0]),t.model.size.getTickFormatter()(t.sizeScaleMinMax[1])]).text(function(t){return t})},_setFromExtent:function(t,e,i){var a=this.brush.extent();this._updateArcs(a),this._updateLabels(a),t&&this._setModel(a,e,i)},_setModel:function(t,e,i){t=[+t[0].toFixed(2),+t[1].toFixed(2)],this.model.size.set({extent:t},e,i)}}),Sn={bubblesize:wn,buttonlist:Ua,colorlegend:_n,datanotes:fn,datawarning:on,_dialog:Pa,dialogs:ln,draggablelist:Da,indicatorpicker:Aa,labels:La,minmaxinputs:Ta,simplecheckbox:Ma,simpleslider:za,sizeslider:_a,timeslider:ba,treemenu:ra,zoombuttonlist:Zi},kn=Object.freeze({bubblesize:wn,buttonlist:Ua,colorlegend:_n,datanotes:fn,datawarning:on,_dialog:Pa,dialogs:ln,draggablelist:Da,indicatorpicker:Aa,labels:La,minmaxinputs:Ta,simplecheckbox:Ma,simpleslider:za,sizeslider:_a,timeslider:ba,treemenu:ra,zoombuttonlist:Zi,"default":Sn}),En=Hi.extend("BarChart",{init:function(t,e){this.name="barchart",this.components=[{component:Gi,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","language"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"]},{component:ln,placeholder:".vzb-tool-dialogs",model:["state","ui","language"]},{component:Ua,placeholder:".vzb-tool-buttonlist",model:["state","ui","language"]},{component:ra,placeholder:".vzb-tool-treemenu",model:["state.marker","language"]}],this._super(t,e)},default_model:{state:{time:{},entities:{dim:"geo",show:{_defs_:{geo:["*"],"geo.cat":["region"]}}},marker:{space:["entities","time"],label:{use:"property",which:"geo.name"},axis_y:{use:"indicator",which:"lex"},axis_x:{use:"property",which:"geo.name"},color:{use:"property",which:"geo.world_4region"}}}}}),Tn=Me.extend({init:function(t,e){this.context=t,this.width=0,this.height=0,this.topOffset=0,this.leftOffset=0,this.bottomOffset=0,this.rightOffset=0,this.fontSize=0,this.fontWidth=0,this.fontHeight=0,this.xAlign="center",this.yAlign="center",this.symbols=[],e&&this.setConditions(e)},setConditions:function(t){return!isNaN(parseFloat(t.rightOffset))&&isFinite(t.rightOffset)&&(this.rifgtOffset=t.rightOffset),!isNaN(parseFloat(t.leftOffset))&&isFinite(t.leftOffset)&&(this.leftOffset=t.leftOffset),!isNaN(parseFloat(t.topOffset))&&isFinite(t.topOffset)&&(this.topOffset=t.topOffset),!isNaN(parseFloat(t.bottomOffset))&&isFinite(t.bottomOffset)&&(this.bottomOffset=t.bottomOffset),t.xAlign&&(this.xAlign=t.xAlign),t.yAlign&&(this.yAlign=t.yAlign),this},resize:function(t,e,i,a,n){this.width=t,this.height=e,this.fontSize=i,a&&(this.topOffset=a),n&&(this.leftOffset=n),this.fontSize>this.height&&(this.fontSize=this.height);var s=this.context.append("text").text("0").style("font-size",this.fontSize+"px");this.fontWidth=s[0][0].getBBox().width,this.fontHeight=.72*this.fontSize,d3.select(s[0][0]).remove(),this.__resizeText()},setText:function(t,e){var i=t.split("");return i.length!=this.symbols.length&&(e=!0),this.symbols=t.split(""),this.context.selectAll("text").data(this.symbols).exit().remove(),this.context.selectAll("text").data(this.symbols).enter().append("text").text(function(t){return t}),this.context.selectAll("text").each(function(t,e){d3.select(this).text(t)}),e?this.__resizeText():this},__resizeText:function(){var t=this;return this.context.attr("transform","translate("+this.__getLeftOffset()+","+this.__getTopOffset()+")"),this.context.selectAll("text").each(function(e,i){d3.select(this).attr("x",t.fontWidth*i).style("font-size",t.fontSize+"px").style("text-anchor","middle")}),this},__getLeftOffset:function(){switch(this.xAlign){case"right":return this.width-this.fontWidth*this.symbols.length+this.fontWidth/2;case"left":return this.fontWidth/2;default:return this.fontWidth/2+(this.width-this.fontWidth*this.symbols.length)/2}},__getTopOffset:function(){switch(this.yAlign){case"top":return this.fontHeight+this.topOffset;case"bottom":return this.height-this.bottomOffset;default:return this.fontHeight+(this.height-this.fontHeight)/2+this.topOffset}}}),On=ni.extend({init:function(t,e){this.name="barrankchart-component",this.template="barrank.html",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"language",type:"language"},{name:"ui",type:"model"}];var i=this;this.model_binds={"change:time.value":function(t){i._readyOnce&&i.onTimeChange()},"change:entities.select":function(t){i._readyOnce&&i.selectBars()},"change:marker.axis_x.scaleType":function(t){i._readyOnce&&i.draw()},"change:marker.color.palette":function(){}},this._super(t,e),this.xScale=null,this.cScale=d3.scale.category10(),this.xAxis=L()},onTimeChange:function(){var t=this;this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.loadData(),t.draw()})},readyOnce:function(){this.element=d3.select(this.element),this.header=this.element.select(".vzb-br-header"),this.barViewport=this.element.select(".barsviewport"),this.barSvg=this.element.select(".vzb-br-bars-svg"),this.barContainer=this.element.select(".vzb-br-bars"),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter()),this.ready(),this.selectBars()},readyRuns:0,ready:function(){var t=this;2!=++this.readyRuns&&this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.loadData(),t.draw()})},resize:function(){this.draw()},loadData:function(){this.sortedEntities=this.sortByIndicator(this.values.axis_x);var t=this.model.language.getTFunction();this.header.select(".vzb-br-title").text(t("indicator/"+this.model.marker.axis_x.which)+" "+this.model.time.timeFormat(this.model.time.value)),this.header.select(".vzb-br-total").text("Σ = "+this.model.marker.axis_x.getTickFormatter()(this.total)),this.xScale=this.model.marker.axis_x.getScale(!1),this.cScale=this.model.marker.color.getScale()},draw:function(){this.drawAxes()||this.drawData()},drawAxes:function(){this.barHeight=20;var t={top:60,bottom:40,left:90,right:20};if(this.height=parseInt(this.element.style("height"),10)-t.top-t.bottom||0,this.width=parseInt(this.element.style("width"),10)-t.left-t.right||0,this.height<=0||this.width<=0)return Ft("Bar rank chart drawAxes() abort: vizabi container is too little or has display:none");this.barContainer.attr("transform","translate("+t.left+", 0)"),this.barViewport.style("height",this.height+"px"),this.header.attr("height",t.top).select(".vzb-br-title").attr("dominant-baseline","middle").attr("y",t.top/2).attr("x",t.left),this.header.select(".vzb-br-total").attr("text-anchor","end").attr("dominant-baseline","middle").attr("y",t.top/2).attr("x",this.width+t.left),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range([0,this.width]):this.xScale.rangePoints([0,this.width]).range();var e=this.model.marker.axis_x.getLimits(this.model.marker.axis_x.which);this.xScale=this.xScale.domain([e.min,e.max])},drawData:function(){function t(t,e){return(a.barHeight+n)*e}function e(t){return t.entity}function i(t,e){0===t.size()&&e();var i=0;t.each(function(){++i}).each("end",function(){--i||e.apply(this,arguments)})}var a=this,n=2,s=this.model.time.playing?this.model.time.delayAnimations:0,l=this.barContainer.selectAll(".vzb-br-bar").data(this.sortedEntities,e).order();this.createAndDeleteBars(l),this.barContainer.selectAll(".vzb-br-bar").data(this.sortedEntities,e).order().each(function(t,e){var i=d3.select(this),n=a.xScale(t.value),l=a.model.marker.axis_x.getTickFormatter()(t.value);t.index=e,i.selectAll("rect").transition().duration(s).ease("linear").attr("width",n>0?n:0),i.selectAll(".vzb-br-value").text(l),i.selectAll("title").text(a.values.label[t.entity]+" ("+l+")")}).transition().duration(s).ease("linear").attr("transform",function(e,i){return"translate(0, "+t(e,i)+")"}).call(i,function(){function e(t){return function(){var e=d3.interpolateNumber(this.scrollTop,t);return function(t){this.scrollTop=e(t)}}}var i=a.barContainer.node().getBoundingClientRect().height;if(a.barSvg.attr("height",i+"px"),a.model.time.playing){var n=a.barContainer.select(".vzb-selected");if(!n.empty()){var l=n.datum(),r=t(l,l.index),o=a.barViewport.node().scrollTop,c=o+a.height,h=!1;o>r&&(h=r),r+a.barHeight>c&&(h=r+a.barHeight-a.height),h&&a.barViewport.transition().duration(s).tween("scrollfor"+l.entity,e(h))}}})},createAndDeleteBars:function(t){var e=this;t.exit().remove();var i=t.enter().append("g").attr("class","vzb-br-bar").attr("id",function(t){return"vzb-br-bar-"+t.entity}).on("mousemove",function(t){e.setHover(t,!0)}).on("mouseout",function(t){e.setHover(t,!1)}).on("click",function(t){xt(e.model.marker.space,function(i){"time"!==e.model[i].getDimension()&&e.model[i].selectEntity(t)})});i.append("rect").attr("x",0).attr("rx",this.barHeight/4).attr("ry",this.barHeight/4).attr("stroke","white").attr("stroke-opacity",0).attr("stroke-width",2).attr("height",this.barHeight).style("fill",function(t){var i=e.cScale(e.values.color[t.entity]);return d3.rgb(i)}),i.append("text").attr("class","vzb-br-label").attr("x",-5).attr("y",this.barHeight/2).attr("text-anchor","end").attr("dominant-baseline","middle").text(function(t,i){var a=e.values.label[t.entity];return a.length<12?a:a.substring(0,9)+"..."}).style("fill",function(t){var i=e.cScale(e.values.color[t.entity]);return d3.rgb(i).darker(2)}).append("title"),i.append("text").attr("class","vzb-br-value").attr("x",5).attr("y",this.barHeight/2).attr("dominant-baseline","middle").style("fill",function(t){var i=e.cScale(e.values.color[t.entity]);return d3.rgb(i).darker(2)})},drawColors:function(){function t(t){var e=i.cScale(i.values.color[t.entity]);return d3.rgb(e)}function e(e){return t(e).darker(2)}var i=this;this.barContainer.selectAll(".vzb-br-bar>rect").style("fill",t),this.barContainer.selectAll(".vzb-br-bar>text").style("fill",e)},sortByIndicator:function(t){var e=this,i=[];return this.total=0,xt(t,function(t,a){var n={entity:a,value:t};n[e.model.entities.dim]=a,i.push(n),e.total+=t}),i.sort(function(t,e){return e.value-t.value}),i},setHover:function(t,e){this.barContainer.classed("vzb-dimmed",e),this.barContainer.select("#vzb-br-bar-"+t.entity).classed("vzb-hovered",e)},selectBars:function(){var t=this,e=this.model.entities.dim,i=this.model.entities.select;this.barContainer.classed("vzb-dimmed-selected",!1),this.barContainer.selectAll(".vzb-br-bar.vzb-selected").classed("vzb-selected",!1),i.length&&(this.barContainer.classed("vzb-dimmed-selected",!0),xt(i,function(i){t.barContainer.select("#vzb-br-bar-"+i[e]).classed("vzb-selected",!0)}))}}),Cn=Hi.extend("BarRankChart",{init:function(t,e){this.name="barrankchart",this.components=[{component:On,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","language","ui"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"]},{component:ln,placeholder:".vzb-tool-dialogs",model:["state","ui","language"]},{component:Ua,placeholder:".vzb-tool-buttonlist",model:["state","ui","language"]},{component:ra,placeholder:".vzb-tool-treemenu",model:["state.marker","language"]}],this._super(t,e)}}),Ln=function(){function t(t,e){function i(e){var i,a=t.arcs[0>e?~e:e],n=a[0];return t.transform?(i=[0,0],a.forEach(function(t){i[0]+=t[0],i[1]+=t[1]})):i=a[a.length-1],0>e?[i,n]:[n,i]}function a(t,e){for(var i in t){var a=t[i];delete e[a.start],delete a.start,delete a.end,a.forEach(function(t){n[0>t?~t:t]=1}),r.push(a)}}var n={},s={},l={},r=[],o=-1;return e.forEach(function(i,a){var n,s=t.arcs[0>i?~i:i];s.length<3&&!s[1][0]&&!s[1][1]&&(n=e[++o],e[o]=i,e[a]=n)}),e.forEach(function(t){var e,a,n=i(t),r=n[0],o=n[1];if(e=l[r])if(delete l[e.end],e.push(t),e.end=o,a=s[o]){delete s[a.start];var c=a===e?e:e.concat(a);s[c.start=e.start]=l[c.end=a.end]=c}else s[e.start]=l[e.end]=e;else if(e=s[o])if(delete s[e.start],e.unshift(t),e.start=r,a=l[r]){delete l[a.end];var h=a===e?e:a.concat(e);s[h.start=a.start]=l[h.end=e.end]=h}else s[e.start]=l[e.end]=e;else e=[t],s[e.start=r]=l[e.end=o]=e}),a(l,s),a(s,l),e.forEach(function(t){n[0>t?~t:t]||r.push([t])}),r}function e(e,i,a){function n(t){var e=0>t?~t:t;(h[e]||(h[e]=[])).push({i:t,g:c})}function s(t){t.forEach(n)}function l(t){t.forEach(s)}function r(t){"GeometryCollection"===t.type?t.geometries.forEach(r):t.type in d&&(c=t,d[t.type](t.arcs))}var o=[];if(arguments.length>1){var c,h=[],d={LineString:s,MultiLineString:l,Polygon:l,MultiPolygon:function(t){t.forEach(l)}};r(i),h.forEach(arguments.length<3?function(t){o.push(t[0].i)}:function(t){a(t[0].g,t[t.length-1].g)&&o.push(t[0].i)})}else for(var u=0,m=e.arcs.length;m>u;++u)o.push(u);return{type:"MultiLineString",arcs:t(e,o)}}function i(e,i){function a(t){t.forEach(function(e){e.forEach(function(e){(r[e=0>e?~e:e]||(r[e]=[])).push(t)})}),o.push(t)}function s(t){return d(l(e,{type:"Polygon",arcs:[t]}).coordinates[0])>0}var r={},o=[],c=[];return i.forEach(function(t){"Polygon"===t.type?a(t.arcs):"MultiPolygon"===t.type&&t.arcs.forEach(a)}),o.forEach(function(t){if(!t._){var e=[],i=[t];for(t._=1,c.push(e);t=i.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){r[0>t?~t:t].forEach(function(t){t._||(t._=1,i.push(t))})})})}}),o.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:c.map(function(i){var a=[];if(i.forEach(function(t){t.forEach(function(t){t.forEach(function(t){r[0>t?~t:t].length<2&&a.push(t)})})}),a=t(e,a),(n=a.length)>1)for(var l,o=s(i[0][0]),c=0;c<n;++c)if(o===s(a[c])){l=a[0],a[0]=a[c],a[c]=l;break}return a})}}function a(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return s(t,e)})}:s(t,e)}function s(t,e){var i={type:"Feature",id:e.id,properties:e.properties||{},geometry:l(t,e)};return null==e.id&&delete i.id,i}function l(t,e){function i(t,e){e.length&&e.pop();for(var i,a=h[0>t?~t:t],n=0,s=a.length;s>n;++n)e.push(i=a[n].slice()),c(i,n);0>t&&r(e,s)}function a(t){return t=t.slice(),c(t,0),t}function n(t){for(var e=[],a=0,n=t.length;n>a;++a)i(t[a],e);return e.length<2&&e.push(e[0].slice()),e}function s(t){for(var e=n(t);e.length<4;)e.push(e[0].slice());return e}function l(t){return t.map(s)}function o(t){var e=t.type;return"GeometryCollection"===e?{type:e,geometries:t.geometries.map(o)}:e in d?{type:e,coordinates:d[e](t)}:null}var c=p(t.transform),h=t.arcs,d={Point:function(t){return a(t.coordinates)},MultiPoint:function(t){return t.coordinates.map(a)},LineString:function(t){return n(t.arcs)},MultiLineString:function(t){return t.arcs.map(n)},Polygon:function(t){return l(t.arcs)},MultiPolygon:function(t){return t.arcs.map(l)}};return o(e)}function r(t,e){for(var i,a=t.length,n=a-e;n<--a;)i=t[n],t[n++]=t[a],t[a]=i}function o(t,e){for(var i=0,a=t.length;a>i;){var n=i+a>>>1;t[n]<e?i=n+1:a=n}return i}function c(t){function e(t,e){t.forEach(function(t){0>t&&(t=~t);var i=n[t];i?i.push(e):n[t]=[e]})}function i(t,i){t.forEach(function(t){e(t,i)})}function a(t,e){"GeometryCollection"===t.type?t.geometries.forEach(function(t){a(t,e)}):t.type in l&&l[t.type](t.arcs,e)}var n={},s=t.map(function(){return[]}),l={LineString:e,MultiLineString:i,Polygon:i,MultiPolygon:function(t,e){t.forEach(function(t){i(t,e)})}};t.forEach(a);for(var r in n)for(var c=n[r],h=c.length,d=0;h>d;++d)for(var u=d+1;h>u;++u){var m,g=c[d],p=c[u];(m=s[g])[r=o(m,p)]!==p&&m.splice(r,0,p),(m=s[p])[r=o(m,g)]!==g&&m.splice(r,0,g)}return s}function h(t,e){function i(t){s.remove(t),t[1][2]=e(t),s.push(t)}var a=p(t.transform),n=f(t.transform),s=g();return e||(e=u),t.arcs.forEach(function(t){for(var l,r,o=[],c=0,h=0,d=t.length;d>h;++h)r=t[h],a(t[h]=[r[0],r[1],1/0],h);for(var h=1,d=t.length-1;d>h;++h)l=t.slice(h-1,h+2),l[1][2]=e(l),o.push(l),s.push(l);for(var h=0,d=o.length;d>h;++h)l=o[h],l.previous=o[h-1],l.next=o[h+1];for(;l=s.pop();){var u=l.previous,m=l.next;l[1][2]<c?l[1][2]=c:c=l[1][2],u&&(u.next=m,u[2]=l[2],i(u)),m&&(m.previous=u,m[0]=l[0],i(m))}t.forEach(n)}),t}function d(t){for(var e,i=-1,a=t.length,n=t[a-1],s=0;++i<a;)e=n,n=t[i],s+=e[0]*n[1]-e[1]*n[0];return.5*s}function u(t){var e=t[0],i=t[1],a=t[2];return Math.abs((e[0]-a[0])*(i[1]-e[1])-(e[0]-i[0])*(a[1]-e[1]))}function m(t,e){return t[1][2]-e[1][2]}function g(){function t(t,e){for(;e>0;){var i=(e+1>>1)-1,n=a[i];if(m(t,n)>=0)break;a[n._=e]=n,a[t._=e=i]=t}}function e(t,e){for(;;){var i=e+1<<1,s=i-1,l=e,r=a[l];if(n>s&&m(a[s],r)<0&&(r=a[l=s]),n>i&&m(a[i],r)<0&&(r=a[l=i]),l===e)break;a[r._=e]=r,a[t._=e=l]=t}}var i={},a=[],n=0;return i.push=function(e){return t(a[e._=n]=e,n++),n},i.pop=function(){if(!(0>=n)){var t,i=a[0];return--n>0&&(t=a[n],e(a[t._=0]=t,0)),i}},i.remove=function(i){var s,l=i._;if(a[l]===i)return l!==--n&&(s=a[n],(m(s,i)<0?t:e)(a[s._=l]=s,l)),l},i}function p(t){if(!t)return v;var e,i,a=t.scale[0],n=t.scale[1],s=t.translate[0],l=t.translate[1];return function(t,r){r||(e=i=0),t[0]=(e+=t[0])*a+s,t[1]=(i+=t[1])*n+l}}function f(t){if(!t)return v;var e,i,a=t.scale[0],n=t.scale[1],s=t.translate[0],l=t.translate[1];return function(t,r){r||(e=i=0);var o=(t[0]-s)/a|0,c=(t[1]-l)/n|0;t[0]=o-e,t[1]=c-i,e=o,i=c}}function v(){}var b={version:"1.6.19",mesh:function(t){return l(t,e.apply(this,arguments))},meshArcs:e,merge:function(t){return l(t,i.apply(this,arguments))},mergeArcs:i,feature:a,neighbors:c,presimplify:h};return b}();!function(t){function e(t,e){if(0===e)return 0;var i=t/e;return e>0?1/Math.sqrt(1+i*i):-1/Math.sqrt(1+i*i)}function i(t,e){if(0===e)return 1;var i=t/e;return e>0?i/Math.sqrt(1+i*i):-i/Math.sqrt(1+i*i)}function a(t){return t instanceof Array?t.map(a):"string"==typeof t||"number"==typeof t?t:n(t)}function n(t){var e={};for(var i in t)e[i]=a(t[i]);return e}function s(t,e){function i(t,e){e.length&&e.pop(),l[0>t?~t:t]||console.log("fail");for(var i=l[0>t?~t:t],a=0,n=i.length;n>a;++a)e.push(i[a]);0>t&&r(e,n)}function a(t){for(var e=[],a=0,n=t.length;n>a;++a)i(t[a],e);return e}function n(t){return t.map(a)}function s(t){return t=Object.create(t),t.coordinates=o[t.type](t.arcs),t}var l=t.arcs?t.arcs:t,o={LineString:a,MultiLineString:n,Polygon:n,MultiPolygon:function(t){return t.map(n)}};return"GeometryCollection"===e.type?(e=Object.create(e),e.geometries=e.geometries.map(s),e):s(e)}function r(t,e){for(var i,a=t.length,n=a-e;n<--a;)i=t[n],t[n++]=t[a],t[a]=i}d3.cartogram=function(){function t(t,d,u){var m=function(t,e,i){return new l(function(a,n){var s=t.map(i.area),l=d3.sum(s),r=0,o=0,c=function(a,n){var r=Math.abs(s[a]),o=+e[a],c=l*o/u,h=Math.sqrt(r/Math.PI),d=Math.sqrt(c/Math.PI)-h,m=Math.max(r,c)/Math.min(r,c);n({id:t[a].id,area:r,centroid:i.centroid(t[a]),value:o,desired:c,radius:h,mass:d,sizeError:m})},h=function(e){return e>=t.length?a({meta:d,sizeError:r/o}):void c(e,function(t){d.push(t),r+=t.sizeError,o++,e%400==0?se(function(){h(++e)}):h(++e)})},d=[];h(0)})};return new l(function(g,p){t=a(t);var f,v,b,y,x,_=o(t.transform),z=t.arcs.length,M=new Array(z),w=new l,S=function(e,i){return new l(function(a,n){for(y=0;i>y;)t.arcs[e][y][0]=f+=t.arcs[e][y][0],t.arcs[e][y][1]=v+=t.arcs[e][y][1],x[y]=null===r?_(t.arcs[e][y]):r(_(t.arcs[e][y])),y++;a(x)})},k=function(e,i){return e>=i?w.resolve(M):(f=0,v=0,b=t.arcs[e].length,y=0,x=new Array(b),void S(e,b).then(function(t){M[e++]=t,e%400==0?se(function(){k(e,i)}):k(e,i)}))};k(0,z),w.then(function(a){var r=d3.geo.path().projection(null),o=s(a,{type:"GeometryCollection",geometries:d}).geometries.map(function(e){return{type:"Feature",id:e.id,properties:c.call(null,e,t),geometry:e}}),p=o.map(h);u||(u=d3.sum(p)),0>=n&&g({features:o,arcs:a});var f=function(t,n){return t>=n?v.resolve():void m(o,p,r).then(function(s){var l=1/(1+s.sizeError),r=function(t,n){for(var r,o,c,h,d,u,m,g,p,f,v,b,y,x;n>t;){for(r=a[t].length,o=0;r>o;){for(c=[0,0],h=s.meta.length,d=0;h>d;)u=s.meta[d].centroid,m=s.meta[d].mass,g=s.meta[d].radius,p=g*g,f=a[t][o][0]-u[0],v=a[t][o][1]-u[1],b=f*f+v*v,y=Math.sqrt(b),x=y>g?m*g/y:m*(b/p)*(4-3*y/g),c[0]+=x*e(v,f),c[1]+=x*i(v,f),d++;a[t][o][0]+=c[0]*l,a[t][o][1]+=c[1]*l,o++}t++}},o=function(e){if(e>=a.length)return s.sizeError<=1?void f(n,n):void se(function(){f(++t,n)});var i=Math.min(e+400,a.length);r(e,i),se(function(){
o(i)})};o(0)})},v=new l;f(0,n),v.then(function(){g({features:o,arcs:a})})})})}var n=8,r=d3.geo.albers(),c=function(t){return{}},h=function(t){return 1};return t.path=d3.geo.path().projection(null),t.iterations=function(e){return arguments.length?(n=e,t):n},t.value=function(e){return arguments.length?(h=d3.functor(e),t):h},t.projection=function(e){return arguments.length?(r=e,t):r},t.feature=function(t,e){return{type:"Feature",id:e.id,properties:c.call(null,e,t),geometry:{type:e.type,coordinates:Ln.feature(t,e).geometry.coordinates}}},t.meshArcs=function(t,e,i){function a(t){var e=0>t?~t:t;(c[e]||(c[e]=[])).push({i:t,g:o})}function n(t){t.forEach(a)}function s(t){t.forEach(n)}function l(t){"GeometryCollection"===t.type?t.geometries.forEach(l):t.type in h&&(o=t,h[t.type](t.arcs))}var r=[];if(arguments.length>1){var o,c=[],h={LineString:n,MultiLineString:s,Polygon:s,MultiPolygon:function(t){t.forEach(s)}};l(e),c.forEach(arguments.length<3?function(t){r.push(t[0].i)}:function(t){i(t[0].g,t[t.length-1].g)&&r.push(t[0].i)})}else for(var d=0,u=t.arcs.length;u>d;++d)r.push(d);return r},t.stitchArcs=function(t,e){function i(e){var i,a=t.arcs[0>e?~e:e],n=a[0];return t.transform?(i=[0,0],a.forEach(function(t){i[0]+=t[0],i[1]+=t[1]})):i=a[a.length-1],0>e?[i,n]:[n,i]}function a(t,e){for(var i in t){var a=t[i];delete e[a.start],delete a.start,delete a.end,a.forEach(function(t){n[0>t?~t:t]=1}),o.push(a)}}var n={},l={},r={},o=[],c=-1;return e.forEach(function(i,a){var n,s=t.arcs[0>i?~i:i];s.length<3&&!s[1][0]&&!s[1][1]&&(n=e[++c],e[c]=i,e[a]=n)}),e.forEach(function(t){var e,a,n=i(t),s=n[0],o=n[1];if(e=r[s])if(delete r[e.end],e.push(t),e.end=o,a=l[o]){delete l[a.start];var c=a===e?e:e.concat(a);l[c.start=e.start]=r[c.end=a.end]=c}else l[e.start]=r[e.end]=e;else if(e=l[o])if(delete l[e.start],e.unshift(t),e.start=s,a=r[s]){delete r[a.end];var h=a===e?e:a.concat(e);l[h.start=a.start]=r[h.end=e.end]=h}else l[e.start]=r[e.end]=e;else e=[t],l[e.start=s]=r[e.end=o]=e}),a(r,l),a(l,r),e.forEach(function(t){n[0>t?~t:t]||o.push([t])}),s(t,{type:"MultiLineString",arcs:o})},t.features=function(e,i){return i.map(function(i){return t.feature(e,i)})},t.properties=function(e){return arguments.length?(c=d3.functor(e),t):c},t};var o=d3.cartogram.transformer=function(t){function e(t){return[t[0]*i+n,t[1]*a+s]}var i=t.scale[0],a=t.scale[1],n=t.translate[0],s=t.translate[1];return e.invert=function(t){return[(t[0]-n)/i,(t[1]-s)/a]},e}}(this);var An=ni.extend({init:function(t,e){this.name="bubblemap",this.template="bubblemap.html",this.bubblesDrawing=null;var i=function(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t};this.isMobile=i(),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"language",type:"language"},{name:"ui",type:"model"}];var a=this;this.model_binds={"change:time.value":function(t){a._readyOnce&&(a.year.setText(a.model.time.timeFormat(a.model.time.value)),a.model.marker.getFrame(a.model.time.value,a.frameChanged.bind(a)))},"change:entities.highlight":function(t){a._readyOnce&&(a.highlightEntities(),a.updateOpacity())},"change:marker":function(t,e){a._readyOnce&&e.indexOf("scaleType")>-1&&a.redrawDataPoints(null,!1)},"change:marker.size.extent":function(t,e){a._readyOnce&&a.entityBubbles&&(a.updateMarkerSizeLimits(),a.redrawDataPoints(null,!1))},"change:marker.color.palette":function(t,e){a._readyOnce&&a.redrawDataPoints(null,!1)},"change:entities.select":function(t){a._readyOnce&&(a.selectEntities(),a.redrawDataPoints(null,!1),a.updateOpacity(),a.updateDoubtOpacity())},"change:entities.opacitySelectDim":function(t){a.updateOpacity()},"change:entities.opacityRegular":function(t){a.updateOpacity()}},this._super(t,e),this.sScale=null,this.cScale=d3.scale.category10(),a.COLOR_WHITEISH="#fdfdfd",this.defaultWidth=960,this.defaultHeight=500,this.boundBox=[[.02,0],[1,.85]],q()},afterPreload:function(){this.world||Ft("bubble map afterPreload: missing country shapes "+this.world);var t=this.defaultWidth,e=this.defaultHeight,i=this.world,a=this.projection=d3.geo.robinson().scale(150).translate([t/2,e/2]).precision(.1),n=this.bgPath=d3.geo.path().projection(a),s=this.mapGraph=d3.select(this.element).select(".vzb-bmc-map-graph").attr("width",t).attr("height",e);s.html(""),s.insert("path",".graticule").datum(Ln.feature(i,i.objects.land)).attr("class","land").attr("d",n),s.insert("path",".graticule").datum(Ln.mesh(i,i.objects.countries,function(t,e){return t!==e})).attr("class","boundary").attr("d",n),this.labels=this.parent.findChildByName("gapminder-labels"),this.labels.config({CSS_PREFIX:"vzb-bmc",TOOL_CONTEXT:this,LABELS_CONTAINER_CLASS:"vzb-bmc-labels",LINES_CONTAINER_CLASS:"vzb-bmc-lines"})},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bmc-graph"),this.mapSvg=this.element.select(".vzb-bmc-map-background"),this.bubbleContainerCrop=this.graph.select(".vzb-bmc-bubbles-crop"),this.bubbleContainer=this.graph.select(".vzb-bmc-bubbles"),this.labelListContainer=this.graph.select(".vzb-bmc-bubble-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yTitleEl=this.graph.select(".vzb-bmc-axis-y-title"),this.cTitleEl=this.graph.select(".vzb-bmc-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-bmc-axis-y-info"),this.cInfoEl=this.graph.select(".vzb-bmc-axis-c-info"),this.entityBubbles=null,this.tooltip=this.element.select(".vzb-bmc-tooltip"),this.yearEl=this.graph.select(".vzb-bmc-year"),this.year=new Tn(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom",bottomOffset:5});var t=this;this.on("resize",function(){t.updateSize()||(t.updateMarkerSizeLimits(),t.labels.updateSize(),t.redrawDataPoints())}),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.updateUIStrings(),this.wScale=d3.scale.linear().domain(this.parent.datawarning_content.doubtDomain).range(this.parent.datawarning_content.doubtRange)},ready:function(){var t=this;this.updateUIStrings(),this.updateIndicators(),this.updateSize(),this.updateMarkerSizeLimits(),this.model.marker.getFrame(this.model.time.value,function(e,i){return i.toString()!=t.model.time.value.toString()?void se(function(){t.ready()}):void(e&&(t.values=e,t.updateEntities(),t.updateTime(),t.redrawDataPoints(),t.highlightEntities(),t.selectEntities(),t.updateDoubtOpacity(),t.updateOpacity(),t.year.setText(t.model.time.timeFormat(t.model.time.value))))})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateDoubtOpacity(),this.redrawDataPoints(null,!1))},updateUIStrings:function(){var t=this;this.translator=this.model.language.getTFunction();this.model.marker.size.getConceptprops();this.strings={title:{S:this.translator("indicator/"+t.model.marker.size.which),C:this.translator("indicator/"+t.model.marker.color.which)}},this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX("left").alignY("top").updateView().toggle()}),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX("left").alignY("top").updateView().toggle()}),ye(this.dataWarningEl,Mi).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(Si).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=a(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(i.x,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.cInfoEl.html(Si).select("svg").attr("width","0px").attr("height","0px"),this.cInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.cInfoEl.on("mouseover",function(){var e=this.getBBox(),i=a(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(i.x,i.y)}),this.cInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateTitleNumbers:function(){var t,e=this;if(e.isMobile&&e.model.entities.select&&1===e.model.entities.select.length&&(t=e.model.entities.select[0]),e.hovered||t){var i=e.hovered||t,a=e.model.marker.size.getTickFormatter(),n=e.model.marker.color.getTickFormatter(),s=e.translator("unit/"+e.model.marker.size.which),l=e.translator("unit/"+e.model.marker.color.which);s==="unit/"+e.model.marker.size.which&&(s=""),l==="unit/"+e.model.marker.color.which&&(l="");var r=e.values.size[i[e.KEY]],o=e.values.color[i[e.KEY]];e.yTitleEl.select("text").text(e.translator("buttons/size")+": "+a(r)+" "+s),e.cTitleEl.select("text").text(e.translator("buttons/color")+": "+(o||0===o?n(o)+" "+l:e.translator("hints/nodata"))),this.yInfoEl.classed("vzb-hidden",!0),this.cInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C),this.yInfoEl.classed("vzb-hidden",!1),this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden"))},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateOpacity:function(){var t=this,e=1,i=.3,a=this.model.entities.opacityRegular,n=this.model.entities.opacityRegular,s=this.model.entities.opacitySelectDim;this.entityBubbles.style("opacity",function(l){return t.someHighlighted&&t.model.entities.isHighlighted(l)?e:t.someSelected?t.model.entities.isSelected(l)?a:s:t.someHighlighted?i:n}),this.entityBubbles.classed("vzb-selected",function(e){return t.model.entities.isSelected(e)});var l=t.someSelected&&t.model.entities.opacitySelectDim<.01;l!==this.someSelectedAndOpacityZero_1&&this.entityBubbles.style("pointer-events",function(e){return!l||t.model.entities.isSelected(e)?"visible":"none"}),this.someSelectedAndOpacityZero_1=t.someSelected&&t.model.entities.opacitySelectDim<.01},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale()},updateEntities:function(){var t=this,e=this.KEY,i=this.TIMEDIM,a=function(a){return a=a||"",t.model.marker.getKeys().map(function(s){var l={};return l[e]=s[e],l[i]=n,l.sortValue=t.values.size[s[e]]||0,l[e]=a+s[e],l}).sort(function(t,e){return e.sortValue-t.sortValue})},n=this.model.time.end;this.model.entities.setVisible(a.call(this)),this.unselectBubblesWithNoData(),this.entityBubbles=this.bubbleContainer.selectAll(".vzb-bmc-bubble").data(this.model.entities.getVisible(),function(t){return t[e]}).order(),this.entityBubbles.exit().remove(),this.entityBubbles.enter().append("circle").attr("class","vzb-bmc-bubble").on("mouseover",function(e,i){ve()||t._interact()._mouseover(e,i)}).on("mouseout",function(e,i){ve()||t._interact()._mouseout(e,i)}).on("click",function(e,i){ve()||(t._interact()._click(e,i),t.highlightEntities())}).onTap(function(e,i){t._interact()._click(e,i),d3.event.stopPropagation()}).onLongTap(function(t,e){})},unselectBubblesWithNoData:function(t){var e=this,i=this.KEY;t||(t=this.values),t&&t.size&&this.model.entities.select.forEach(function(a){t.size[a[i]]||0===t.size[a[i]]||e.model.entities.selectEntity(a)})},redrawDataPoints:function(t,e){var i=this;t||(t=this.duration),e||(e=!0),this.entityBubbles.each(function(a,n){var s=d3.select(this),l=i.values.lng[a[i.KEY]],r=i.values.lat[a[i.KEY]],o=i.values.size[a[i.KEY]],c=i.values.color[a[i.KEY]],h=i.values.label[a[i.KEY]];a.hidden_1=a.hidden,a.hidden=!o||null==l||null==r,a.hidden!==a.hidden_1&&s.classed("vzb-hidden",a.hidden),a.hidden?i._updateLabel(a,n,0,0,o,c,h,t):(a.r=Bt(i.sScale(o||0)),a.label=h,s.classed("vzb-hidden",!1).attr("fill",null!=c?i.cScale(c):i.COLOR_WHITEISH),e&&(a.cLoc=i.skew(i.projection([l||0,r||0])),s.attr("cx",a.cLoc[0]).attr("cy",a.cLoc[1])),t?s.transition().duration(t).ease("linear").attr("r",a.r):s.interrupt().attr("r",a.r),i._updateLabel(a,n,a.cLoc[0],a.cLoc[1],o,c,a.label,t))})},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.updateTitleNumbers()},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text").style("font-size",null),e=this.cTitleEl.select("text").style("font-size",null),t=this.yTitleEl.select("text"),e=this.cTitleEl.select("text"),i=t.node().getBBox(),a=this.cTitleEl.classed("vzb-hidden")?i:e.node().getBBox(),n=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(i.width,a.width);Math.max(i.width,a.width)>this.width?(t.style("font-size",n+"px"),e.style("font-size",n+"px")):(t.style("font-size",null),e.style("font-size",null))},updateSize:function(){var t,e,i=this,a={small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16,minRadius:.5,maxRadius:30},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20,minRadius:1,maxRadius:55},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22,minRadius:1,maxRadius:65}},n={medium:{infoElHeight:26},large:{infoElHeight:32}};this.activeProfile=this.getActiveProfile(a,n),t=this.activeProfile.margin,e=this.activeProfile.infoElHeight;var s=this.height=parseInt(this.element.style("height"),10)-t.top-t.bottom||0,l=this.width=parseInt(this.element.style("width"),10)-t.left-t.right||0;if(this.height<=0||this.width<=0)return Ft("Bubble map updateSize() abort: vizabi container is too little or has display:none");var r=this.boundBox,o=[r[0][0]*this.defaultWidth,r[0][1]*this.defaultHeight,Math.abs(r[1][0]-r[0][0])*this.defaultWidth,Math.abs(r[1][1]-r[0][1])*this.defaultHeight];this.graph.attr("transform","translate("+t.left+","+t.top+")"),this.year.resize(this.width,this.height,Math.min(this.width/2.5,Math.max(this.height/4,this.width/4))/2.5),this.mapSvg.attr("width",l).attr("height",s).attr("viewBox",o.join(" ")).attr("preserveAspectRatio","none").attr("x",t.left).attr("y",t.top).style("transform","translate3d("+t.left+"px,"+t.top+"px,0)");this.skew=function(){var t=o,e=[t[0]+t[2]/2,t[1]+t[3]/2],i=t[2]||.001,a=t[3]||.001;return function(t){var n=(t[0]-e[0])/i*l+l/2,r=(t[1]-e[1])/a*s+s/2;return[n,r]}}();this.yTitleEl.style("font-size",e).attr("transform","translate(0,"+t.top+")");var c=this.yTitleEl.select("text").node().getBBox();this.cTitleEl.attr("transform","translate(0,"+(t.top+c.height)+")").classed("vzb-hidden",-1!=this.model.marker.color.which.indexOf(i.KEY)||"constant"==this.model.marker.color.use);var h=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*h.height).attr("height",.75*h.height).attr("x",-h.width-1.2*h.height).attr("y",.65*-h.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*h.height)+")").select("text"),this.yInfoEl.select("svg").node()){var d=this.yTitleEl.node().getBBox(),u=d3.transform(this.yTitleEl.attr("transform")).translate;this.yInfoEl.select("svg").attr("width",e).attr("height",e),this.yInfoEl.attr("transform","translate("+(d.x+u[0]+d.width+.4*e)+","+(u[1]-.8*e)+")")}if(this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden")),!this.cInfoEl.classed("vzb-hidden")&&this.cInfoEl.select("svg").node()){var d=this.cTitleEl.node().getBBox(),u=d3.transform(this.cTitleEl.attr("transform")).translate;this.cInfoEl.select("svg").attr("width",e).attr("height",e),this.cInfoEl.attr("transform","translate("+(d.x+u[0]+d.width+.4*e)+","+(u[1]-.8*e)+")")}},updateMarkerSizeLimits:function(){var t=this,e=this.model.marker.size.extent||[0,1],i=this.activeProfile.minRadius,a=this.activeProfile.maxRadius;this.minRadius=Math.max(a*e[0],i),this.maxRadius=Math.max(a*e[1],i),"ordinal"!==this.model.marker.size.scaleType?this.sScale.range([It(t.minRadius),It(t.maxRadius)]):this.sScale.rangePoints([It(t.minRadius),It(t.maxRadius)],0).range()},_interact:function(){var t=this;return{_mouseover:function(e,i){t.model.time.dragging||(t.model.entities.highlightEntity(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.entities.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,i){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.entities.clearHighlighted())},_click:function(e,i){t.model.entities.selectEntity(e)}}},highlightEntities:function(){this.someHighlighted=this.model.entities.highlight.length>0},_updateLabel:function(t,e,i,a,n,s,l,r){var o=this,c=this.KEY;if(t[c]!=o.druging&&(null==r&&(r=o.duration),o.model.entities.isSelected(t))){var h=t.hidden!==t.hidden_1,d=null,u={};u.labelX0=i/this.width,u.labelY0=a/this.height,u.scaledS0=n?Bt(o.sScale(n)):null,u.scaledC0=null!=s?o.cScale(s):o.COLOR_WHITEISH,this.labels.updateLabel(t,e,u,i/this.width,a/this.height,n,s,l,d,r,h)}},selectEntities:function(){var t=this;this.KEY;this.someSelected=this.model.entities.select.length>0,t.hovered&&!t.model.entities.isSelected(t.hovered)||t._setTooltip()},_setTooltip:function(t){if(t){var e,i,a=t.label,n=t.cLoc[0],s=t.cLoc[1],l=t.r,r=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),o=-1,c=-1,h=0,d=0;l&&(h=.71*l,d=.71*l),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(a);var u=this.tooltip.select("text")[0][0].getBBox();n-h-u.width<0?(o=1,n+=u.width+5):n-=5,s-d-u.height<0?(c=1,s+=u.height):s-=11,l?(e=n+h*o,i=s+d*c):(e=n+h*o,i=s+d*c),this.tooltip.attr("transform","translate("+(e?e:r[0])+","+(i?i:r[1])+")"),this.tooltip.select("rect").attr("width",u.width+8).attr("height",1.2*u.height).attr("x",-u.width-4).attr("y",.85*-u.height).attr("rx",.2*u.height).attr("ry",.2*u.height)}else this.tooltip.classed("vzb-hidden",!0)}}),Dn=Hi.extend("BubbleMap",{init:function(t,e){this.name="bubblemap",this.components=[{component:An,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","language","ui"]},{component:La,placeholder:".vzb-tool-labels",model:["state.entities","state.marker","ui"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"]},{component:ln,placeholder:".vzb-tool-dialogs",model:["state","ui","language"]},{component:Ua,placeholder:".vzb-tool-buttonlist",model:["state","ui","language"]},{component:ra,placeholder:".vzb-tool-treemenu",model:["state.marker","language"]},{component:on,placeholder:".vzb-tool-datawarning",model:["language"]},{component:fn,placeholder:".vzb-tool-datanotes",model:["state.marker","language"]}],this._super(t,e)},default_model:{state:{time:{},entities:{dim:"geo",show:{_defs_:{geo:["*"],"geo.cat":["region"]}}},marker:{space:["entities","time"],label:{use:"property",which:"geo.name"},axis_y:{use:"indicator",which:"lex"},axis_x:{use:"property",which:"geo.name"},color:{use:"property",which:"geo.world_4region"}}},ui:{chart:{labels:{dragging:!0}},presentation:!0}}}),Pn="",In=[],Bn='<?xml version="1.0" encoding="utf-8"?>',Rn=Me.extend({init:function(t){this.context=t,this.shapes=[],this.groups=[],this.counter=0,this.name="",this.label=""},reset:function(){this.container.remove(),this.context.element.selectAll(".vzb-export-redball").remove(),this.context.element.selectAll(".vzb-export-counter").remove(),this.counter=0},prefix:function(t){return arguments.length?(Pn=t,this):Pn},deleteClasses:function(t){return arguments.length?(In=t,this):In},open:function(t,e){var i=this;this.svg&&this.reset(),t||(t=this.context.element),e||(e=this.context.name),this.name=e;var a=parseInt(t.style("width"),10)||0,n=parseInt(t.style("height"),10)||0;this.container=t.append("div").attr("class","vzb-svg-export"),this.svg=this.container.node().appendChild(t.select("svg").node().cloneNode(!0)),this.svg=d3.select(this.svg),this.svg.attr("viewBox","0 0 "+a+" "+n).attr("version","1.1").attr("param1","http://www.w3.org/2000/svg").attr("param2","http://www.w3.org/1999/xlink").attr("x","0px").attr("y","0px").attr("style","enable-background:new 0 0 "+a+" "+n).attr("xml:space","preserve"),this.redBall=t.append("div").attr("class","vzb-export-redball").style("position","absolute").style("top","20px").style("right","20px").style("width","20px").style("height","20px").style("background","red").style("color","white").style("text-align","center").style("border-radius","10px").style("font-size","14px").style("line-height","20px").style("opacity",.8).style("cursor","pointer").on("mouseover",function(){d3.select(this).style("opacity",1).text("▼"),i.counterEl.text("Download")}).on("mouseout",function(){d3.select(this).style("opacity",.8).text(""),i.counterEl.text(i.label)}).on("click",function(){i.close()}),this.counterEl=t.append("div").attr("class","vzb-export-counter").style("position","absolute").style("top","20px").style("right","45px").style("color","red").style("opacity",.8).style("line-height","20px").style("font-size","14px").style("text-align","center"),this.root=this.svg.select("."+Pn+"graph"),this.root.selectAll("g, text, svg, line, rect").filter(function(){var t=d3.select(this),e=!1;return In.forEach(function(i){e=e||t.classed(i)}),e}).remove(),this.svg.selectAll(".tick line").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+Pn+"axis-x path").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+Pn+"axis-y path").attr("fill","none").attr("stroke","#999")},write:function(t){var e="time";if(this.root||this.open(),!(this.shapes.indexOf(t.id+"_"+t.time)>-1)){this.shapes.push(t.id+"_"+t.time),-1==this.groups.indexOf(t[e])&&(this.root.append("g").attr("id","g_"+t[e]),this.groups.push(t[e])),null==t.opacity&&(t.opacity=.5),null==t.fill&&(t.fill="#ff80dd");var i=this.root.select("#g_"+t[e]).append(t.type).attr("id",t.id+"_"+t.time).style("fill",t.fill).style("opacity",t.opacity);switch(t.type){case"path":i.attr("d",t.d);break;case"circle":i.attr("cx",t.cx).attr("cy",t.cy).attr("r",t.r)}this.counter++,this.redBall.style("opacity",this.counter%10/12+.2),this.label=t.type+" shapes: "+this.counter,this.counterEl.text(this.label)}},close:function(){var t=Bn+" "+this.container.node().innerHTML.replace("param1","xmlns").replace("param2","xmlns:xlink").replace(/\d+(\.\d+)/g,function(t){return Math.round(100*+t)/100+""});if(t.length/1024/1024>2)alert("The file size is "+Math.round(t.length/1024)+"kB, which is too large to download. Will try to print it in the console instead..."),console.log(t);else{var e=document.createElement("a");e.download=this.name+" "+this.counter+" shapes.svg",e.href="data:,"+t,e.click()}}}),Fn=Me.extend({init:function(t){this.context=t,this.xScaleFactor=1,this.xScaleShift=0},rescale:function(t){return Math.exp(this.xScaleFactor*Math.log(t)+this.xScaleShift)},unscale:function(t){return Math.exp((Math.log(t)-this.xScaleShift)/this.xScaleFactor)},generateMesh:function(t,e,i){var a="linear"===e?i[0]:Math.log(this.unscale(i[0])),n="linear"===e?i[1]:Math.log(this.unscale(i[1])),s=(n-a)/t,l=d3.range(a,n,s).concat(n);return l="linear"!==e?l.map(function(t){return Math.exp(t)}):l.filter(function(t){return t>0})},gdpToMu:function(t,e,i,a){return Math.log(t/365)-e*e/2},giniToSigma:function(t){return this.normsinv((t/100+1)/2)*Math.pow(2,.5)},pdf:{normal:function(t,e,i){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(i)-Math.pow(t-e,2)/(2*i*i))},lognormal:function(t,e,i){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(i)-Math.pow(Math.log(t)-e,2)/(2*i*i))}},normsinv:function(t){var e=[-39.69683028665376,220.9460984245205,-275.9285104469687,138.357751867269,-30.66479806614716,2.506628277459239],i=[-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572],a=[-.007784894002430293,-.3223964580411365,-2.400758277161838,-2.549732539343734,4.374664141464968,2.938163982698783],n=[.007784695709041462,.3224671290700398,2.445134137142996,3.754408661907416],s=.02425,l=1-s;if(s>t){var r=Math.sqrt(-2*Math.log(t));return(((((a[0]*r+a[1])*r+a[2])*r+a[3])*r+a[4])*r+a[5])/((((n[0]*r+n[1])*r+n[2])*r+n[3])*r+1)}if(t>l){var r=Math.sqrt(-2*Math.log(1-t));return-(((((a[0]*r+a[1])*r+a[2])*r+a[3])*r+a[4])*r+a[5])/((((n[0]*r+n[1])*r+n[2])*r+n[3])*r+1)}var r=t-.5,o=r*r;return(((((e[0]*o+e[1])*o+e[2])*o+e[3])*o+e[4])*o+e[5])*r/(((((i[0]*o+i[1])*o+i[2])*o+i[3])*o+i[4])*o+1)}}),Nn=Me.extend({init:function(t){this.context=t},rebuild:function(t){var e=this.context,i=e.mountainPointers.concat(e.groupedPointers).concat(e.stackedPointers).filter(function(t){return e.model.entities.isSelected(t)}).sort(function(t,e){return t.sortValue&&e.sortValue?t.sortValue[1]===e.sortValue[1]?d3.descending(t.sortValue[0],e.sortValue[0]):d3.descending(t.sortValue[1],e.sortValue[1]):t.aggrLevel!=e.aggrLevel?d3.descending(t.aggrLevel,e.aggrLevel):t.aggrLevel&&e.aggrLevel?d3.descending(t.yMax,e.yMax):0});e.selectList=e.mountainLabelContainer.selectAll("g.vzb-mc-label").data(Et(i,function(t){return t.KEY()})),e.selectList.exit().remove(),e.selectList.enter().append("g").attr("class","vzb-mc-label").each(function(t,i){var a=d3.select(this);a.append("circle").attr("class","vzb-mc-label-legend"),a.append("text").attr("class","vzb-mc-label-shadow vzb-mc-label-text"),a.append("text").attr("class","vzb-mc-label-text"),a.append("g").attr("class","vzb-mc-label-x vzb-label-shadow vzb-invisible").on("click",function(t,i){ve()||(d3.event.stopPropagation(),e.model.entities.clearHighlighted(),e.model.entities.selectEntity(t),d3.event.stopPropagation())}).onTap(function(t,i){d3.select("#"+t.geo+"-label").remove(),e.model.entities.clearHighlighted(),e.model.entities.selectEntity(t)});var n=a.select("g.vzb-mc-label-x");ve()?(n.append("rect"),n.append("text").attr("class","vzb-mc-label-x-text").text("Deselect")):(ye(n,ki).select("svg").attr("class","vzb-mc-label-x-icon").attr("width","0px").attr("height","0px"),n.insert("circle","svg"))}).on("mousemove",function(t,i){ve()||e.model.entities.highlightEntity(t)}).on("mouseout",function(t,i){ve()||e.model.entities.clearHighlighted()}).on("click",function(t,i){ve()||(e.model.entities.clearHighlighted(),e.model.entities.selectEntity(t))})},redraw:function(){var t=this.context;if(t.selectList&&t.someSelected){var e=t.mountainLabelContainer.append("g").attr("class","vzb-mc-label").append("text").text("0"),i=1.2*e[0][0].getBBox().height,a=parseFloat(e.style("font-size"))/i;d3.select(e[0][0].parentNode).remove();var n=t.model.marker.axis_y.getTickFormatter(),s=t.yTitleEl.select("text").node().getBBox().height||0,l=(t.height-3*s)/(t.selectList.data().length+2);i>l&&(i=l);var r="null",o=0;t.selectList.attr("transform",function(t,e){t.aggrLevel!=r&&(o+=i);var a=i*e+1.5*s+o;return r=t.aggrLevel,"translate(0,"+a+")"}).each(function(e,s){var r=d3.select(this).attr("id",e.geo+"-label"),o=e.key?t.translator("entity/geo.world_4region/"+e.key):t.values.label[e.KEY()],c=t.values.axis_y[e.KEY()],h=o+": "+n(c)+(0===s?" "+t.translator("mount/people"):""),d=r.selectAll(".vzb-mc-label-text").attr("x",i).attr("y",i).text(h).style("font-size",i===l?i*a+"px":null),u=d[0][0].getBBox(),m=r.select(".vzb-mc-label-x");if(ve()){var g=m.select("text").node().getBBox();m.classed("vzb-revert-color",!0).select(".vzb-mc-label-x-text").classed("vzb-revert-color",!0).attr("x",u.width+1.12*u.height+.5*g.width).attr("y",.55*u.height),m.select("rect").attr("width",g.width+.6*u.height).attr("height",u.height).attr("x",u.width+.9*u.height).attr("y",0).attr("rx",.25*u.height).attr("ry",.25*u.height)}else m.attr("x",u.width+1.1*u.height).attr("y",u.height/3),m.select("circle").attr("r",.4*u.height).attr("cx",u.width+1.1*u.height).attr("cy",u.height/3),m.select("svg").attr("x",u.width+u.height*(1.1-.4)).attr("y",u.height*(1/3-.4)).attr("width",.8*u.height).attr("height",.8*u.height);r.select(".vzb-mc-label-legend").attr("r",i/3).attr("cx",.4*i).attr("cy",i/1.5).style("fill",t.cScale(t.values.color[e.KEY()])),r.onTap(function(e,i){d3.event.stopPropagation(),t.model.entities.highlightEntity(e),setTimeout(function(){t.model.entities.unhighlightEntity(e)},2e3)})})}}}),qn=Me.extend({init:function(t){this.context=t},redraw:function(t){var e=this.context;if(t||(t={}),t.level||(t.level=e.model.ui.chart.probeX),e.probeEl.classed("vzb-hidden",!t.level),t.level){e.xAxisEl.call(e.xAxis.highlightValue(t.full?t.level:"none"));var i=0,a=0,n=0,s=function(s){i+=e.values.axis_y[s.KEY()],e.cached[s.KEY()].forEach(function(i){a+=i.y,e._math.rescale(i.x)<t.level&&(n+=i.y)})};"all"===e.model.marker.stack.which?e.stackedPointers.forEach(s):"none"===e.model.marker.stack.which?e.mountainPointers.forEach(s):e.groupedPointers.forEach(s);var l=d3.format(".3r"),r=e.model.marker.axis_y.getTickFormatter();e.heightOfLabels=e.heightOfLabels||.66*e.height,e.probeTextEl.each(function(i,a){if(8===a){var n=d3.select(this);t.full||e.model.ui.chart.probeX!=e.model.marker.axis_x.tailFatX?n.classed("vzb-hidden",!0):(n.text(e.translator("mount/extremepoverty")).classed("vzb-hidden",!1).attr("x",-e.height).attr("y",e.xScale(t.level)).attr("dy","-1em").attr("dx","0.5em").attr("transform","rotate(-90)"),e.heightOfLabels=e.height-n.node().getBBox().width-1.75*n.node().getBBox().height)}}),e.probeTextEl.each(function(s,o){if(8!==o){var c,h=d3.select(this);0!==o&&4!==o||(c=l(n/a*100)+"%"),1!==o&&5!==o||(c=l(100-n/a*100)+"%"),2!==o&&6!==o||(c=r(i*n/a)),3!==o&&7!==o||(c=r(i*(1-n/a))+" "+e.translator("mount/people")),h.text(c).classed("vzb-hidden",!t.full&&0!==o&&4!==o).attr("x",e.xScale(t.level)+([0,4,2,6].indexOf(o)>-1?-5:5)).attr("y",e.heightOfLabels).attr("dy",[0,1,4,5].indexOf(o)>-1?0:"1.5em");
}}),e.probeLineEl.attr("x1",e.xScale(t.level)).attr("x2",e.xScale(t.level)).attr("y1",e.height+6).attr("y2",0)}}}),Hn=.001,Yn=ni.extend({init:function(t,e){var i=this;this.name="mountainchart",this.template="mountainchart.html",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"language",type:"language"},{name:"ui",type:"model"}],this.model_binds={"change:time.value":function(t){i._readyOnce&&(i.year.setText(i.model.time.value.getUTCFullYear().toString()),i.model.marker.getFrame(i.model.time.value,i.frameChanged.bind(i)))},"change:time.playing":function(t){i.model.time.playing||i.redrawDataPoints()},"change:marker.axis_x.xScaleFactor":function(){i.ready()},"change:marker.axis_x.xScaleShift":function(){i.ready()},"change:marker.axis_x.tailFatX":function(){i.ready()},"change:marker.axis_x.tailCutX":function(){i.ready()},"change:marker.axis_x.tailFade":function(){i.ready()},"change:ui.chart.probeX":function(){i.ready()},"change:ui.chart.xPoints":function(){i.ready()},"change:ui.chart.xLogStops":function(){i.updateSize()},"change:ui.chart.yMaxMethod":function(){i._adjustMaxY({force:!0}),i.redrawDataPoints()},"change:time.record":function(t){i.model.time.record?i._export.open(this.element,this.name):i._export.reset()},"change:entities.highlight":function(t){i._readyOnce&&(i.highlightEntities(),i.updateOpacity())},"change:entities.select":function(t){i._readyOnce&&(i.selectEntities(),i._selectlist.redraw(),i.updateOpacity(),i.updateDoubtOpacity(),i.redrawDataPoints())},"change:entities.opacitySelectDim":function(t){i.updateOpacity()},"change:entities.opacityRegular":function(t){i.updateOpacity()},"change:marker":function(t,e){return i._readyOnce?e.indexOf("scaleType")>-1?void i.ready():e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1?(i.zoomToMaxMin(),i.redrawDataPoints(),void i._probe.redraw()):void 0:void 0},"change:marker.group":function(t,e){i._readyOnce&&(e.indexOf("group.merge")>-1||i.ready())},"change:marker.group.merge":function(t){i._readyOnce&&(i.updateTime(),i.redrawDataPoints())},"change:marker.stack":function(t){i._readyOnce&&i.ready()},"change:marker.color.palette":function(t){i._readyOnce&&(i.redrawDataPointsOnlyColors(),i._selectlist.redraw())}},this._super(t,e),this._math=new Fn(this),this._export=new Rn(this),this._export.prefix("vzb-mc-").deleteClasses(["vzb-mc-mountains-mergestacked","vzb-mc-mountains-mergegrouped","vzb-mc-mountains","vzb-mc-year","vzb-mc-mountains-labels","vzb-mc-axis-labels"]),this._probe=new qn(this),this._selectlist=new Nn(this),this.area=d3.svg.area().interpolate("basis").x(function(t){return i.xScale(i._math.rescale(t.x))}).y0(function(t){return i.yScale(t.y0)}).y1(function(t){return i.yScale(t.y0+t.y)}),this.stack=d3.layout.stack().order("reverse").values(function(t){return i.cached[t.KEY()]}).out(function(t,e,i){t.y0=e}),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=L(),this.rangeRatio=1,this.rangeShift=0,this.cached={},this.mesh=[],this.yMax=0},domReady:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-mc-graph"),this.xAxisEl=this.graph.select(".vzb-mc-axis-x"),this.xTitleEl=this.graph.select(".vzb-mc-axis-x-title"),this.yTitleEl=this.graph.select(".vzb-mc-axis-y-title"),this.infoEl=this.graph.select(".vzb-mc-axis-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yearEl=this.graph.select(".vzb-mc-year"),this.year=new Tn(this.yearEl),this.mountainMergeStackedContainer=this.graph.select(".vzb-mc-mountains-mergestacked"),this.mountainMergeGroupedContainer=this.graph.select(".vzb-mc-mountains-mergegrouped"),this.mountainAtomicContainer=this.graph.select(".vzb-mc-mountains"),this.mountainLabelContainer=this.graph.select(".vzb-mc-mountains-labels"),this.tooltip=this.element.select(".vzb-mc-tooltip"),this.eventAreaEl=this.element.select(".vzb-mc-eventarea"),this.probeEl=this.element.select(".vzb-mc-probe"),this.probeLineEl=this.probeEl.select("line"),this.probeTextEl=this.probeEl.selectAll("text"),this.element.onTap(function(e,i){t._interact()._mouseout(e,i)})},afterPreload:function(){var t=this,e=t.model.time.value.getUTCFullYear(),i=t.model.time.end.getUTCFullYear();if(this._math.xScaleFactor=this.model.marker.axis_x.xScaleFactor,this._math.xScaleShift=this.model.marker.axis_x.xScaleShift,this.precomputedShapes&&this.precomputedShapes[e]&&this.precomputedShapes[i]){var a=this.precomputedShapes["immediate"==this.model.ui.chart.yMaxMethod?e:i].yMax,n=this.precomputedShapes[e].shape;a&&n&&0!==n.length&&(this.xScale=d3.scale.log().domain([this.model.marker.axis_x.domainMin,this.model.marker.axis_x.domainMax]),this.yScale=d3.scale.linear().domain([0,Math.round(a)]),t.updateSize(n.length),t.zoomToMaxMin(),n=n.map(function(e,i){return{x:t.mesh[i],y0:0,y:+e}}),this.mountainAtomicContainer.selectAll(".vzb-mc-prerender").data([0]).enter().append("path").attr("class","vzb-mc-prerender").style("fill","pink").style("opacity",0).attr("d",t.area(n)).transition().duration(1e3).ease("linear").style("opacity",1))}},readyOnce:function(){this.eventAreaEl.on("mousemove",function(){t.model.time.dragging||t._probe.redraw({level:t.xScale.invert(d3.mouse(this)[0]),full:!0})}).on("mouseout",function(){t.model.time.dragging||t._probe.redraw()});var t=this;this.on("resize",function(){t.updateSize()||(t.updateTime(),t.redrawDataPoints(),t._selectlist.redraw(),t._probe.redraw())}),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.mountainAtomicContainer.select(".vzb-mc-prerender").remove(),this.year.setText(this.model.time.value.getUTCFullYear().toString()),this.wScale=d3.scale.linear().domain(this.parent.datawarning_content.doubtDomain).range(this.parent.datawarning_content.doubtRange)},ready:function(){var t=this;this._math.xScaleFactor=this.model.marker.axis_x.xScaleFactor,this._math.xScaleShift=this.model.marker.axis_x.xScaleShift,this.updateUIStrings(),this.updateIndicators(),this.model.marker.getFrame(this.model.time.value,function(e){e&&(t.values=e,t.updateEntities(),t.updateSize(),t.zoomToMaxMin(),t._spawnMasks(),t.updateTime(),t._adjustMaxY({force:!0}),t.redrawDataPoints(),t.redrawDataPointsOnlyColors(),t.highlightEntities(),t.selectEntities(),t._selectlist.redraw(),t.updateOpacity(),t.updateDoubtOpacity(),t._probe.redraw())})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&(this.values=t,this.updateTime(),this.redrawDataPoints(),this._selectlist.redraw(),this._probe.redraw(),this.updateDoubtOpacity())},updateSize:function(t){var e,i,a={small:{margin:{top:10,right:10,left:10,bottom:18},infoElHeight:16},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22}},n={medium:{margin:{top:20,right:20,left:20,bottom:50},infoElHeight:26},large:{margin:{top:30,right:30,left:30,bottom:50},infoElHeight:32}};if(this.activeProfile=this.getActiveProfile(a,n),e=this.activeProfile.margin,i=this.activeProfile.infoElHeight,this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.height<=0||this.width<=0)return Ft("Mountain chart updateSize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")");var s={topOffset:"large"===this.getLayoutProfile()?2*e.top:0,xAlign:"large"===this.getLayoutProfile()?"right":"center",yAlign:"large"===this.getLayoutProfile()?"top":"center"},l="large"===this.getLayoutProfile()?this.width/6:Math.max(this.height/4,this.width/4);this.year.setConditions(s).resize(this.width,this.height,l),this.yScale.range([this.height,0]),this.xScale.range([this.rangeShift,this.width*this.rangeRatio+this.rangeShift]);var r=this._readyOnce?this.model.marker.axis_x.scaleType:"log";this.xAxis.scale(this.xScale).orient("bottom").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:r,toolMargin:e,pivotingLimit:1.5*e.bottom,method:this.xAxis.METHOD_REPEATING,stops:this._readyOnce?this.model.ui.chart.xLogStops:[1],formatter:this.model.marker.axis_x.getTickFormatter()}),this.xAxisEl.attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.xTitleEl.select("text").attr("transform","translate("+this.width+","+this.height+")").attr("dy","-0.36em"),this.yTitleEl.style("font-size",i+"px").attr("transform","translate(0,"+e.top+")");var o=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",o.height).attr("height",o.height).attr("x",.1*o.height).attr("y",1*-o.height+1),this.dataWarningEl.attr("transform","translate(0,"+(e.top+1.5*o.height)+")").select("text").attr("dx",1.5*o.height),this.infoEl.select("svg").node()){var c=this.yTitleEl.node().getBBox(),h=d3.transform(this.yTitleEl.attr("transform")).translate;this.infoEl.select("svg").attr("width",i+"px").attr("height",i+"px"),this.infoEl.attr("transform","translate("+(c.x+h[0]+c.width+.4*i)+","+(h[1]-.8*i)+")")}this.eventAreaEl.attr("y",this.height).attr("width",this.width).attr("height",e.bottom),t||(t=this.model.ui.chart.xPoints),this.mesh=this._math.generateMesh(t,r,this.xScale.domain())},zoomToMaxMin:function(){if(null!=this.model.marker.axis_x.zoomedMin&&null!=this.model.marker.axis_x.zoomedMax){var t=this.xScale(this.model.marker.axis_x.zoomedMin),e=this.xScale(this.model.marker.axis_x.zoomedMax);this.rangeRatio=this.width/(e-t)*this.rangeRatio,this.rangeShift=(this.rangeShift-t)/(e-t)*this.width,this.xScale.range([this.rangeShift,this.width*this.rangeRatio+this.rangeShift]),this.xAxisEl.call(this.xAxis)}},updateUIStrings:function(){var t=this;this.translator=this.model.language.getTFunction();this.model.marker.axis_x.getConceptprops();this.xTitleEl.select("text").text(this.translator("unit/mountainchart_hardcoded_income_per_day")),this.yTitleEl.select("text").text(this.translator("mount/title")),ye(this.dataWarningEl,Mi).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").text(this.translator("hints/dataWarning")),ye(this.infoEl,Si).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=this.getBBox(),i=a(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x,i.y)}),this.infoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()})},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateIndicators:function(){var t=this;this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),this.xAxis.tickFormat(t.model.marker.axis_x.getTickFormatter())},updateEntities:function(){var t=this;this.mountainPointers=this.model.marker.getKeys().filter(function(e){return t.values.axis_x[e[t.KEY]]&&t.values.axis_y[e[t.KEY]]&&t.values.axis_s[e[t.KEY]]}).map(function(e){var i={};return i[t.KEY]=e[t.KEY],i.KEY=function(){return this[t.KEY]},i.sortValue=[t.values.axis_y[i.KEY()]||0,0],i.aggrLevel=0,i}),this.groupedPointers=d3.nest().key(function(e){return"property"===t.model.marker.stack.use?t.values.stack[e.KEY()]:t.values.group[e.KEY()]}).sortValues(function(t,e){return e.sortValue[0]-t.sortValue[0]}).entries(this.mountainPointers);var e=this.model.marker.group.manualSorting;this.groupedPointers.forEach(function(i){var a=d3.sum(i.values.map(function(t){return t.sortValue[0]}));e&&e.length>1&&(a=e.length-1-e.indexOf(i.key)),i.values.forEach(function(t){t.sortValue[1]=a}),i[t.model.entities.getDimension()]=i.key,i.KEY=function(){return this.key},i.aggrLevel=1});var i={};t.groupedPointers.map(function(t){i[t.key]=t.values[0].sortValue[1]}),"none"===t.model.marker.stack.which?(this.stackedPointers=[],this.mountainPointers.sort(function(t,e){return e.sortValue[0]-t.sortValue[0]})):(this.stackedPointers=d3.nest().key(function(e){return t.values.stack[e.KEY()]}).key(function(e){return t.values.group[e.KEY()]}).sortKeys(function(t,e){return i[e]-i[t]}).sortValues(function(t,e){return e.sortValue[0]-t.sortValue[0]}).entries(this.mountainPointers),this.mountainPointers.sort(function(t,e){return e.sortValue[1]-t.sortValue[1]}),this.stackedPointers.forEach(function(e){e.KEY=function(){return this.key},e[t.model.entities.getDimension()]=e.key,e.aggrLevel=2})),this.mountainsMergeStacked=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel2").data(this.stackedPointers),this.mountainsMergeGrouped=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel1").data(this.groupedPointers),this.mountainsAtomic=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel0").data(this.mountainPointers),this.mountainsMergeStacked.exit().remove(),this.mountainsMergeGrouped.exit().remove(),this.mountainsAtomic.exit().remove(),this.mountainsMergeStacked.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel2"),this.mountainsMergeGrouped.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel1"),this.mountainsAtomic.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel0"),this.mountains=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain"),this.mountains.on("mousemove",function(e,i){ve()||t._interact()._mousemove(e,i)}).on("mouseout",function(e,i){ve()||t._interact()._mouseout(e,i)}).on("click",function(e,i){ve()||(t._interact()._click(e,i),t.highlightEntities())}).onTap(function(e,i){t._interact()._click(e,i),d3.event.stopPropagation()}).onLongTap(function(t,e){})},_interact:function(){var t=this;return{_mousemove:function(e,i){if(!t.model.time.dragging&&!t.model.time.playing){t.model.entities.highlightEntity(e);d3.mouse(t.graph.node()).map(function(t){return parseInt(t)});t._setTooltip(e.key?t.translator("entity/geo.world_4region/"+e.key):t.values.label[e.KEY()])}},_mouseout:function(e,i){t.model.time.dragging||t.model.time.playing||(t._setTooltip(""),t.model.entities.clearHighlighted())},_click:function(e,i){t.model.time.dragging||t.model.time.playing||t.model.entities.selectEntity(e)}}},highlightEntities:function(){var t=this;this.someHighlighted=this.model.entities.highlight.length>0,this.selectList&&this.someSelected&&(this.selectList.classed("vzb-highlight",function(e){return t.model.entities.isHighlighted(e)}),this.selectList.each(function(e,i){d3.select(this).selectAll(".vzb-mc-label-x").classed("vzb-invisible",function(i){return!t.model.entities.isHighlighted(e)})}))},selectEntities:function(){this.someSelected=this.model.entities.select.length>0,this._selectlist.rebuild()},_sumLeafPointersByMarker:function(t,e){var i=this;return t.key?d3.sum(t.values.map(function(t){return i._sumLeafPointersByMarker(t,e)})):i.values[e][t.KEY()]},updateOpacity:function(){var t=this,e=1,i=.3,a=this.model.entities.opacityRegular,n=this.model.entities.opacityRegular,s=this.model.entities.opacitySelectDim;this.mountains.style("opacity",function(l){return t.someHighlighted&&t.model.entities.isHighlighted(l)?e:t.someSelected?t.model.entities.isSelected(l)?a:s:t.someHighlighted?i:n}),this.mountains.classed("vzb-selected",function(e){return t.model.entities.isSelected(e)});var l=t.someSelected&&t.model.entities.opacitySelectDim<.01;l!==this.someSelectedAndOpacityZero_1&&this.mountainsAtomic.style("pointer-events",function(e){return!l||t.model.entities.isSelected(e)?"visible":"none"}),this.someSelectedAndOpacityZero_1=t.someSelected&&t.model.entities.opacitySelectDim<.01},updateTime:function(t){var e=this;this.time=this.model.time.value,null==t&&(t=this.time),this.yMax=0,this.mountainPointers.forEach(function(t,i){var a=e._spawn(e.values,t);e.cached[t.KEY()]=a,t.hidden=0===a.length}),"none"!==e.model.marker.stack.which&&this.stackedPointers.forEach(function(t){var i=[];t.values.forEach(function(t){i=i.concat(t.values.filter(function(t){return!t.hidden}))}),e.stack(i)}),this.mountainPointers.forEach(function(t){t.yMax=d3.max(e.cached[t.KEY()].map(function(t){return t.y0+t.y})),e.yMax<t.yMax&&(e.yMax=t.yMax)});var i=e.model.marker.group.merge,a=e.model.marker.stack.merge;(e.model.time.dragging||e.model.time.playing)&&"none"!==this.model.marker.stack.which;this.stackedPointers.forEach(function(t){var i=e._getFirstLastPointersInStack(t);e.cached[t.key]=e._getVerticesOfaMergedShape(i),e.values.color[t.key]="_default",e.values.axis_y[t.key]=e._sumLeafPointersByMarker(t,"axis_y"),t.yMax=i.first.yMax}),this.groupedPointers.forEach(function(t){var i=e._getFirstLastPointersInStack(t);e.cached[t.key]=e._getVerticesOfaMergedShape(i),e.values.color[t.key]=e.values.color[i.first.KEY()],e.values.axis_y[t.key]=e._sumLeafPointersByMarker(t,"axis_y"),t.yMax=i.first.yMax}),a||i||"property"!==this.model.marker.stack.use||this.groupedPointers.forEach(function(t){var e=t.values.filter(function(t){return!t.hidden});t.yMax=e[0].yMax,t.values.forEach(function(e){e.yMaxGroup=t.yMax})})},_getFirstLastPointersInStack:function(t){var e,i;if(t.values[0].values){e=t.values[0].values.filter(function(t){return!t.hidden}),i=t.values[t.values.length-1].values.filter(function(t){return!t.hidden});var a=e[0],n=i[i.length-1]}else{e=t.values.filter(function(t){return!t.hidden});var a=e[0],n=e[e.length-1]}return(!e.length||i&&!i.length)&&Ft("mountain chart failed to generate shapes. check the incoming data"),{first:a,last:n}},_getVerticesOfaMergedShape:function(t){var e=this,i=t.first.KEY(),a=t.last.KEY();return e.mesh.map(function(t,n){var s=e.cached[i][n].y0+e.cached[i][n].y-e.cached[a][n].y0,l=e.cached[a][n].y0;return{x:t,y0:l,y:s}})},_spawnMasks:function(){var t=this,e=this._math.unscale(this.model.marker.axis_x.tailFatX),i=this._math.unscale(this.model.marker.axis_x.tailCutX),a=this.model.marker.axis_x.tailFade,n=2*Math.PI/(Math.log(e)-Math.log(i)),s=Math.PI-Math.log(e)*n;this.spawnMask=[],this.cosineShape=[],this.cosineArea=0,this.mesh.map(function(l,r){t.spawnMask[r]=i>l?1:l>7*a?0:Math.exp((i-l)/a),t.cosineShape[r]=l>i&&e>l?1+Math.cos(Math.log(l)*n+s):0,t.cosineArea+=t.cosineShape[r]})},_spawn:function(t,e){var i=this,a=t.axis_y[e.KEY()],n=i._math.giniToSigma(t.axis_s[e.KEY()]),s=i._math.gdpToMu(t.axis_x[e.KEY()],n);if(!a||!s||!n)return[];var l=[],r=0;this.mesh.map(function(t,e){l[e]=i._math.pdf.lognormal(t,s,n),r+=i.spawnMask[e]*l[e]});var o=this.mesh.map(function(t,e){return{x:t,y0:0,y:a*(l[e]*(1-i.spawnMask[e])+i.cosineShape[e]/i.cosineArea*r)}});return o},_adjustMaxY:function(t){t||(t={});var e=this,i=this.model.ui.chart.yMaxMethod;if("immediate"===i||t.force)if("latest"===i){var a=e.values;e.model.marker.getFrame(e.model.time.end,function(t){t&&(e.values=t,e.updateTime(),e.values=a,e.yScale.domain([0,Math.round(e.yMax)]),e.updateTime())})}else e.yMax||Ft("Setting yMax to "+e.yMax+". You failed again :-/"),e.yScale.domain([0,Math.round(e.yMax)])},redrawDataPoints:function(){var t=this,e=this.model.marker.group.merge,i=this.model.marker.stack.merge,a=this.model.marker.stack.which,n=(this.model.time.dragging||this.model.time.playing)&&"none"!==a&&!(this.model.time.value-this.model.time.end==0&&!this.model.time.loop);this._adjustMaxY(),this.mountainsMergeStacked.each(function(e){var a=d3.select(this),n=!i;t._renderShape(a,e.KEY(),n)}),this.mountainsMergeGrouped.each(function(a){var s=d3.select(this),l=!e&&!n||i&&!t.model.entities.isSelected(a);t._renderShape(s,a.KEY(),l)}),this.mountainsAtomic.each(function(a,s){var l=d3.select(this),r=a.hidden||(e||i||n)&&!t.model.entities.isSelected(a);t._renderShape(l,a.KEY(),r)}),"none"===a?this.mountainsAtomic.sort(function(t,e){return e.yMax-t.yMax}):"all"===a||(e||n?this.mountainsMergeGrouped.sort(function(t,e){return e.yMax-t.yMax}):this.mountainsAtomic.sort(function(t,e){return e.yMaxGroup-t.yMaxGroup}))},redrawDataPointsOnlyColors:function(){var t=this;this.mountains.style("fill",function(e){return t.values.color[e.KEY()]?t.cScale(t.values.color[e.KEY()]):"transparent"})},_renderShape:function(t,e,i){var a=this.model.marker.stack.which,n=this;if(t.classed("vzb-hidden",i),i)return void("none"!==a&&t.style("stroke-opacity",0));var s={};s[this.KEY]=e,this.model.entities.isSelected(s)?t.attr("d",this.area(this.cached[e].filter(function(t){return t.y>n.values.axis_y[e]*Hn}))):t.attr("d",this.area(this.cached[e])),"indicator"===this.model.marker.color.use&&t.style("fill",this.values.color[e]?n.cScale(this.values.color[e]):"transparent"),"none"!==a&&t.transition().duration(900*Math.random()+100).ease("circle").style("stroke-opacity",.5),this.model.time.record&&this._export.write({type:"path",id:e,time:this.model.time.value.getUTCFullYear(),fill:this.cScale(this.values.color[e]),d:this.area(this.cached[e])})},_setTooltip:function(t){if(t){var e=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)});this.tooltip.classed("vzb-hidden",!1).attr("transform","translate("+e[0]+","+e[1]+")").selectAll("text").attr("text-anchor","middle").attr("alignment-baseline","middle").text(t);var i=this.tooltip.select("text")[0][0].getBBox();this.tooltip.select("rect").attr("width",i.width+8).attr("height",i.height+8).attr("x",-i.width-25).attr("y",-i.height-25).attr("rx",.2*i.height).attr("ry",.2*i.height),this.tooltip.selectAll("text").attr("x",-i.width-25+(i.width+8)/2).attr("y",-i.height-25+(i.height+11)/2);var a=e[0]-i.width-25>0?e[0]:i.width+25,n=e[1]-i.height-25>0?e[1]:i.height+25;this.tooltip.attr("transform","translate("+a+","+n+")")}else this.tooltip.classed("vzb-hidden",!0)}}),jn=Hi.extend("MountainChart",{init:function(t,e){this.name="mountainchart",this.components=[{component:Yn,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","language","ui"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"]},{component:ln,placeholder:".vzb-tool-dialogs",model:["state","ui","language"]},{component:Ua,placeholder:".vzb-tool-buttonlist",model:["state","ui","language"]},{component:ra,placeholder:".vzb-tool-treemenu",model:["state.marker","language"]},{component:on,placeholder:".vzb-tool-datawarning",model:["language"]},{component:fn,placeholder:".vzb-tool-datanotes",model:["state.marker","language"]}],this._super(t,e)}}),Vn=ni.extend({init:function(t,e){var i=this;this.name="linechart",this.template="linechart.html",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"language",type:"language"}],this.model_binds={"change:time.value":function(){i._readyOnce&&(i.updateTime(),i.redrawDataPoints())},"change:time.playing":function(){i.model.time.playing&&ve()&&!i.tooltip.classed("vzb-hidden")&&i.tooltip.classed("vzb-hidden",!0)},"change:time.start":function(){i._readyOnce&&i.updateShow()},"change:time.end":function(){i._readyOnce&&i.updateShow()},"change:marker":function(t,e){if(i._readyOnce){if(e.indexOf("domainMin")>-1||e.indexOf("domainMax")>-1||e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1){if(!i.yScale||!i.xScale)return;return i.zoomToMaxMin(),i.updateShow(),i.updateSize(),i.updateTime(),void i.redrawDataPoints()}e.indexOf("which")>-1||e.indexOf("use")>-1||i.ready()}},"change:entities.highlight":function(){i._readyOnce&&i.highlightLines()},"change:entities.select":function(){i._readyOnce&&i.highlightLines()},"change:entities.opacitySelectDim":function(){i._readyOnce&&i.highlightLines()},"change:entities.opacityRegular":function(){i._readyOnce&&i.highlightLines()}},this._super(t,e),this.xScale=null,this.yScale=null,this.rangeXRatio=1,this.rangeXShift=0,this.rangeYRatio=1,this.rangeYShift=0,this.xAxis=L().orient("bottom"),this.yAxis=L().orient("left"),this.isDataPreprocessed=!1,this.timeUpdatedOnce=!1,this.sizeUpdatedOnce=!1,this.getNearestKey=pe(this.getNearestKey)},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-lc-graph"),this.yAxisElContainer=this.graph.select(".vzb-lc-axis-y"),this.yAxisEl=this.yAxisElContainer.select("g"),this.xAxisElContainer=this.graph.select(".vzb-lc-axis-x"),this.xAxisEl=this.xAxisElContainer.select("g"),this.xTitleEl=this.graph.select(".vzb-lc-axis-x-title"),this.yTitleEl=this.graph.select(".vzb-lc-axis-y-title"),this.yInfoEl=this.graph.select(".vzb-lc-axis-y-info"),this.xValueEl=this.graph.select(".vzb-lc-axis-x-value"),this.yValueEl=this.graph.select(".vzb-lc-axis-y-value"),this.linesContainerCrop=this.graph.select(".vzb-lc-lines-crop"),this.linesContainer=this.graph.select(".vzb-lc-lines"),this.labelsContainerCrop=this.graph.select(".vzb-lc-labels-crop"),this.labelsContainer=this.graph.select(".vzb-lc-labels"),this.verticalNow=this.labelsContainer.select(".vzb-lc-vertical-now"),this.tooltip=this.element.select(".vzb-tooltip"),this.projectionX=this.graph.select(".vzb-lc-projection-x"),this.projectionY=this.graph.select(".vzb-lc-projection-y"),this.entityLines=null,this.entityLabels=null,this.totalLength_1={},this.KEY=this.model.entities.getDimension(),ye(this.yInfoEl,Si).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=a(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.on("resize",function(){t.updateSize()||(t.updateTime(),t.redrawDataPoints())})},ready:function(){this.updateUIStrings();var t=this;this.model.marker.getFrame(null,function(e){t.all_values=e,t.model.marker.getFrame(t.model.time.value,function(e){t.values=e,t.all_steps=t.model.time.getAllSteps(),t.updateShow(),t.updateTime(),t.updateSize(),t.zoomToMaxMin(),t.redrawDataPoints(),t.linesContainerCrop.on("mousemove",t.entityMousemove.bind(t,null,null,t)).on("mouseleave",t.entityMouseout.bind(t,null,null,t))})})},updateUIStrings:function(){var t=this;this.translator=this.model.language.getTFunction(),this.strings={title:{Y:this.translator("indicator/"+this.model.marker.axis_y.which),X:this.translator("indicator/"+this.model.marker.axis_x.which),C:this.translator("indicator/"+this.model.marker.color.which)},unit:{Y:this.translator("unit/"+this.model.marker.axis_y.which),X:this.translator("unit/"+this.model.marker.axis_x.which),C:this.translator("unit/"+this.model.marker.color.which)}},this.strings.unit.Y==="unit/"+this.model.marker.axis_y.which&&(this.strings.unit.Y=""),this.strings.unit.X==="unit/"+this.model.marker.axis_x.which&&(this.strings.unit.X=""),this.strings.unit.C==="unit/"+this.model.marker.color.which&&(this.strings.unit.C=""),this.strings.unit.Y&&(this.strings.unit.Y=", "+this.strings.unit.Y),this.strings.unit.X&&(this.strings.unit.X=", "+this.strings.unit.X),this.strings.unit.C&&(this.strings.unit.C=", "+this.strings.unit.C);var e=this.xTitleEl.selectAll("text").data([0]);e.enter().append("text");var i=this.yTitleEl.selectAll("text").data([0]);i.enter().append("text"),i.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX("left").alignY("top").updateView().toggle()})},updateShow:function(){var t=this,e=this.KEY;this.cached={},this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),this.yAxis.tickSize(6,0).tickFormat(this.model.marker.axis_y.getTickFormatter()),this.xAxis.tickSize(6,0).tickFormat(this.model.marker.axis_x.getTickFormatter()),this.collisionResolver=H().selector(".vzb-lc-label").value("valueY").scale(this.yScale).KEY(e),this.line=d3.svg.line().interpolate("cardinal").x(function(e){return t.xScale(e[0])}).y(function(e){return t.yScale(e[1])})},updateTime:function(){var t=this,e=(this.KEY,null===this.time?this.model.time.value:this.time);this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-e>0?this.model.time.delayAnimations:0;var i=this.model.time.getDimension(),a={};a[i]=this.time,this.data=this.model.marker.getKeys(),this.prev_steps=this.all_steps.filter(function(e){return e<t.time}),this.entityLines=this.linesContainer.selectAll(".vzb-lc-entity").data(this.data),this.entityLabels=this.labelsContainer.selectAll(".vzb-lc-entity").data(this.data),this.timeUpdatedOnce=!0},updateSize:function(){var t=this,e=this.values,i=this.KEY,a=2,n={small:{margin:{top:30,right:20,left:55,bottom:30},infoElHeight:16,yAxisTitleBottomMargin:6,tick_spacing:60,text_padding:8,lollipopRadius:6,limitMaxTickNumberX:5},medium:{margin:{top:40,right:60,left:65,bottom:40},infoElHeight:20,yAxisTitleBottomMargin:6,tick_spacing:80,text_padding:12,lollipopRadius:7,limitMaxTickNumberX:10},large:{margin:{top:50,right:60,left:70,bottom:50},infoElHeight:22,yAxisTitleBottomMargin:6,tick_spacing:100,text_padding:20,lollipopRadius:9,limitMaxTickNumberX:0}},s={medium:{margin:{top:80,bottom:80,left:100},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:26},large:{margin:{top:80,bottom:100,left:100},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:32,hideSTitle:!0}},l={small:{margin:{top:9,right:15,bottom:10,left:10}},medium:{margin:{top:9,right:15,bottom:10,left:20}},large:{margin:{top:9,right:15,bottom:10,left:25}}};this.activeProfile=this.getActiveProfile(n,s),this.margin=this.activeProfile.margin,this.tick_spacing=this.activeProfile.tick_spacing;var r=this.activeProfile.infoElHeight,o=this.model.marker.getKeys().map(function(t,a){return e.label[t[i]]}),c=0,h=this.linesContainer.selectAll(".samplingView").data(o);if(h.enter().append("text").attr("class","samplingView vzb-lc-labelname").style("opacity",0).text(function(t){return t.length<13?t:t.substring(0,10)+"..."}).each(function(t){c>this.getComputedTextLength()||(c=this.getComputedTextLength())}).remove(),this.margin.right=Math.max(this.margin.right,c+this.activeProfile.text_padding+20),this.height=parseInt(this.element.style("height"),10)-this.margin.top-this.margin.bottom||0,this.width=parseInt(this.element.style("width"),10)-this.margin.left-this.margin.right||0,this.linesContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsContainerCrop.attr("width",this.width+this.margin.right).attr("height",Math.max(0,this.height)),this.height<=0||this.width<=0)return Ft("Line chart updateSize() abort: vizabi container is too little or has display:none");this.collisionResolver.height(this.height),this.graph.attr("transform","translate("+this.margin.left+","+this.margin.top+")"),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range([this.height*this.rangeYRatio+this.rangeYShift,this.rangeYShift]):this.yScale.rangePoints([this.height*this.rangeYRatio+this.rangeYShift,this.rangeYShift],a).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range([this.rangeXShift,this.width*this.rangeXRatio+this.rangeXShift]):this.xScale.rangePoints([[this.rangeXShift,this.width*this.rangeXRatio+this.rangeXShift]],a).range(),this.yAxis.scale(this.yScale).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,timeFormat:this.model.time.timeFormat,toolMargin:{top:5,bottom:5,left:this.margin.left,right:this.margin.right},limitMaxTickNumber:6,formatter:this.model.marker.axis_y.getTickFormatter()}),this.xAxis.scale(this.xScale).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,limitMaxTickNumber:this.activeProfile.limitMaxTickNumberX,toolMargin:{left:5,right:5,top:this.margin.top,bottom:this.margin.bottom},formatter:this.model.marker.axis_x.getTickFormatter()}),this.xAxisElContainer.attr("width",this.width+1).attr("height",this.activeProfile.margin.bottom).attr("y",this.height-1).attr("x",-1),
this.xAxisEl.attr("transform","translate(1,1)"),this.yAxisElContainer.attr("width",this.activeProfile.margin.left).attr("height",Math.max(0,this.height)).attr("x",-this.activeProfile.margin.left),this.yAxisEl.attr("transform","translate("+(this.activeProfile.margin.left-1)+",0)"),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis),this.xValueEl.attr("transform","translate(0,"+this.height+")").attr("y",this.xAxis.tickPadding()+this.xAxis.tickSize());var d=this.yAxisElContainer.select("g").node().getBBox().width;this.yTitleEl.style("font-size",r+"px").attr("transform","translate("+-d+", -"+this.activeProfile.yAxisTitleBottomMargin+")");var u=this.yTitleEl.select("text").text(this.strings.title.Y+this.strings.unit.Y);if(u.node().getBBox().width>this.width&&u.text(this.strings.title.Y),this.yInfoEl.select("svg").node()){var m=this.yTitleEl.node().getBBox(),g=d3.transform(this.yTitleEl.attr("transform")).translate;this.yInfoEl.select("svg").attr("width",r+"px").attr("height",r+"px"),this.yInfoEl.attr("transform","translate("+(m.x+g[0]+m.width+.4*r)+","+(g[1]-.8*r)+")")}this.xTitleEl.style("font-size",r+"px").attr("transform","translate("+this.width+","+this.height+")");var p=this.xTitleEl.select("text").text(this.strings.title.X+this.strings.unit.X);p.node().getBBox().width>this.width-100&&p.text(this.strings.title.X),this.verticalNow.attr("y1",this.yScale.range()[0]).attr("y2",this.yScale.range()[1]).attr("x1",0).attr("x2",0),this.projectionX.attr("y1",t.yScale.range()[0]),this.projectionY.attr("x2",t.xScale.range()[0]),ve()&&(t.tooltip.classed("vzb-hidden",!0),t.verticalNow.style("opacity",1),t.projectionX.style("opacity",0),t.projectionY.style("opacity",0),t.xAxisEl.call(t.xAxis.highlightValue(t.time)),t.yAxisEl.call(t.yAxis.highlightValue("none")),t.graph.selectAll(".vzb-lc-entity").each(function(){d3.select(this).classed("vzb-dimmed",!1).classed("vzb-hovered",!1)}),t.hoveringNow=null);var f={rangeMax:this.xScale.range()[1],mRight:this.margin.right,profile:l[this.getLayoutProfile()]};this.parent.trigger("myEvent",f),this.sizeUpdatedOnce=!0},redrawDataPoints:function(){var t=this,e=this.KEY;this.model.marker.getFrame(this.time,function(i,a){t.timeUpdatedOnce||t.updateTime(),t.sizeUpdatedOnce||t.updateSize(),t.entityLabels.exit().remove(),t.entityLines.exit().remove(),t.entityLines.enter().append("g").attr("class","vzb-lc-entity").each(function(t,e){var i=d3.select(this);i.append("path").attr("class","vzb-lc-line-shadow").attr("transform","translate(0,2)"),i.append("path").attr("class","vzb-lc-line")}),t.entityLabels.enter().append("g").attr("class","vzb-lc-entity").each(function(t,a){var n=d3.select(this);i.label[t[e]];n.append("circle").attr("class","vzb-lc-circle").attr("cx",0);var s=n.append("g").attr("class","vzb-lc-label");s.append("text").attr("class","vzb-lc-labelname").attr("dy",".35em"),s.append("text").attr("class","vzb-lc-label-value").attr("dy","1.6em")}),t.entityLines.each(function(n,s){var l=d3.select(this),r=(i.label[n[e]],t.cScale(i.color[n[e]])),o="geo.world_4region"==t.model.marker.color.which?t.model.marker.color.getColorShade({colorID:i.color[n[e]],shadeID:"shade"}):d3.rgb(r).darker(.5).toString(),c=t.prev_steps.map(function(i,a){return[+i,t.all_values[i]?+t.all_values[i].axis_y[n[e]]:null]}).filter(function(t){return t[1]||0===t[1]});c.push([+a,+i.axis_y[n[e]]]),t.cached[n[e]]={valueY:c[c.length-1][1]};var h=l.select(".vzb-lc-line");t.model.time.playing&&null===t.totalLength_1[n[e]]&&(t.totalLength_1[n[e]]=h.node().getTotalLength());var d=l.select(".vzb-lc-line-shadow").style("stroke",o).attr("d",t.line(c));h.style("stroke",r).attr("d",t.line(c));var u=h.node().getTotalLength();t.model.time.playing?(d.interrupt().attr("stroke-dasharray",u).attr("stroke-dashoffset",u-t.totalLength_1[n[e]]).transition().delay(0).duration(t.duration).ease("linear").attr("stroke-dashoffset",0),h.interrupt().attr("stroke-dasharray",u).attr("stroke-dashoffset",u-t.totalLength_1[n[e]]).transition().delay(0).duration(t.duration).ease("linear").attr("stroke-dashoffset",0),t.totalLength_1[n[e]]=u):(t.totalLength_1[n[e]]=null,d.attr("stroke-dasharray","none").attr("stroke-dashoffset","none"),h.attr("stroke-dasharray","none").attr("stroke-dashoffset","none"))}),t.entityLabels.each(function(a,n){var s=d3.select(this),l=i.label[a[e]],r=t.cScale(i.color[a[e]]),o="geo.world_4region"==t.model.marker.color.which?t.model.marker.color.getColorShade({colorID:i.color[a[e]],shadeID:"shade"}):d3.rgb(r).darker(.5).toString();s.select(".vzb-lc-circle").style("fill",r).transition().duration(t.duration).ease("linear").attr("r",t.activeProfile.lollipopRadius).attr("cy",t.yScale(t.cached[a[e]].valueY)+1),s.select(".vzb-lc-label").transition().duration(t.duration).ease("linear").attr("transform","translate(0,"+t.yScale(t.cached[a[e]].valueY)+")");var c=t.yAxis.tickFormat()(t.cached[a[e]].valueY),h=l.length<13?l:l.substring(0,10)+"...",d=t.ui.chart.labels.min_number_of_entities_when_values_hide,u=s.select(".vzb-lc-labelname").style("fill",o).attr("dx",t.activeProfile.text_padding).text(h+" "+(t.data.length<d?c:""));if(s.select(".vzb-lc-label-value").style("fill",o).attr("dx",t.activeProfile.text_padding).text(""),t.data.length<d){var m=t.xScale(t.time)+u[0][0].getComputedTextLength()+t.activeProfile.text_padding,g=t.width+t.margin.right;m>g&&(s.select(".vzb-lc-labelname").text(h),s.select(".vzb-lc-label-value").text(c))}}),t.labelsContainer.transition().duration(t.duration).ease("linear").attr("transform","translate("+t.xScale(d3.min([t.model.marker.axis_x.zoomedMax,t.time]))+",0)"),t.hoveringNow||t.time-t.model.time.start===0?t.verticalNow.style("opacity",0):(t.ui.chart.hideXAxisValue||t.xAxisEl.call(t.xAxis.highlightValue(a).highlightTransDuration(t.duration)),t.verticalNow.style("opacity",1)),0==t.duration&&d3.timer.flush(),clearTimeout(t.collisionTimeout),t.collisionTimeout=setTimeout(function(){t.entityLabels.call(t.collisionResolver.data(t.cached))},1.5*t.model.time.delayAnimations)})},entityMousemove:function(t,e,i,a){var n=i,s=n.KEY,l=(n.values,d3.mouse(n.element.node()).map(function(t){return parseInt(t)})),r=n.xScale.invert(l[0]-n.margin.left);n.time-r<0?r=n.time:r<this.model.time.start&&(r=this.model.time.start);var o,c=(n.model.time.getDimension(),l[1]-n.margin.bottom);ct(r)||(r=this.model.time.timeFormat.parse(r)),this.model.marker.getFrame(r,function(e){var i=n.getNearestKey(c,e.axis_y,n.yScale.bind(n));if(o=e.axis_y[i],t||(t={}),t[s]=i,n.model.entities.isHighlighted(t)||(n.model.entities.clearHighlighted(),n.model.entities.highlightEntity(t)),n.hoveringNow=t,!dt(o)){var a=n.xScale(r),l=n.yScale(o);n.ui.chart.whenHovering.showTooltip&&n.tooltip.style("left",a+n.margin.left+"px").style("bottom",n.height-l+n.margin.bottom+"px").text(n.yAxis.tickFormat()(o)).classed("vzb-hidden",!1),n.ui.chart.whenHovering.hideVerticalNow&&n.verticalNow.style("opacity",0),n.ui.chart.whenHovering.showProjectionLineX&&n.projectionX.style("opacity",1).attr("y2",l).attr("x1",a).attr("x2",a),n.ui.chart.whenHovering.showProjectionLineY&&n.projectionY.style("opacity",1).attr("y1",l).attr("y2",l).attr("x1",a),n.ui.chart.whenHovering.higlightValueX&&n.xAxisEl.call(n.xAxis.highlightValue(r).highlightTransDuration(0)),n.ui.chart.whenHovering.higlightValueY&&n.yAxisEl.call(n.yAxis.highlightValue(o).highlightTransDuration(0)),clearTimeout(n.unhoverTimeout)}})},entityMouseout:function(t,e,i){var a=i;d3.event.relatedTarget&&d3.select(d3.event.relatedTarget).classed("vzb-tooltip")||(a.unhoverTimeout=setTimeout(function(){a.tooltip.classed("vzb-hidden",!0),a.verticalNow.style("opacity",1),a.projectionX.style("opacity",0),a.projectionY.style("opacity",0),a.xAxisEl.call(a.xAxis.highlightValue(a.time)),a.yAxisEl.call(a.yAxis.highlightValue("none")),a.model.entities.clearHighlighted(),a.hoveringNow=null},300))},highlightLines:function(){var t=this,e=1,i=.3,a=this.model.entities.opacityRegular,n=this.model.entities.opacityRegular,s=this.model.entities.opacitySelectDim,l=this.model.entities.highlight.length>0,r=this.model.entities.select.length>0;this.graph.selectAll(".vzb-lc-entity").each(function(){d3.select(this).style("opacity",function(o){return t.model.entities.isHighlighted(o)?e:r?t.model.entities.isSelected(o)?a:s:l?i:n})})},zoomToMaxMin:function(){if(null==this.model.marker.axis_y.zoomedMin&&(this.model.marker.axis_y.zoomedMin=this.yScale.domain()[0]),null==this.model.marker.axis_y.zoomedMin&&(this.model.marker.axis_y.zoomedMin=this.yScale.domain()[1]),null!=this.model.marker.axis_x.zoomedMin&&null!=this.model.marker.axis_x.zoomedMax){var t=this.xScale(this.model.marker.axis_x.zoomedMin),e=this.xScale(this.model.marker.axis_x.zoomedMax);this.rangeXRatio=this.width/(e-t)*this.rangeXRatio,this.rangeXShift=(this.rangeXShift-t)/(e-t)*this.width,this.xScale.range([this.rangeXShift,this.width*this.rangeXRatio+this.rangeXShift]),this.xAxisEl.call(this.xAxis)}if(null!=this.model.marker.axis_y.zoomedMin&&null!=this.model.marker.axis_y.zoomedMax){var i=this.yScale(this.model.marker.axis_y.zoomedMin),a=this.yScale(this.model.marker.axis_y.zoomedMax);this.rangeYRatio=this.height/(i-a)*this.rangeYRatio,this.rangeYShift=(this.height-i)/(i-a)*this.rangeYShift,this.yScale.range([this.height*this.rangeYRatio+this.rangeYShift,this.rangeYShift]),this.yAxisEl.call(this.yAxis)}},getNearestKey:function(t,e,i){for(var a=Object.keys(e),n=a[0],s=1;s<a.length;s++){var l=a[s];Math.abs((i?i(e[l]):e[l])-t)<Math.abs((i?i(e[n]):e[n])-t)&&(n=l)}return n}}),Xn=Hi.extend("LineChart",{init:function(t,e){this.name="linechart",this.components=[{component:Vn,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","language"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"],ui:{show_value_when_drag_play:!1,axis_aligned:!0}},{component:ln,placeholder:".vzb-tool-dialogs",model:["state","ui","language"]},{component:Ua,placeholder:".vzb-tool-buttonlist",model:["state","ui","language"]},{component:ra,placeholder:".vzb-tool-treemenu",model:["state.marker","language"]},{component:fn,placeholder:".vzb-tool-datanotes",model:["state.marker","language"]}],this._super(t,e)},default_model:{state:{time:{start:1990,end:2012,value:2012,step:1},entities:{dim:"geo",show:{_defs_:{geo:["*"],"geo.cat":["region"]}}},marker:{space:["entities","time"],label:{use:"property",which:"geo.name"},axis_y:{use:"indicator",which:"gdp_pc",scaleType:"log"},axis_x:{use:"indicator",which:"time",scaleType:"time"},color:{use:"property",which:"geo.world_4region"}}},ui:{"vzb-tool-line-chart":{labels:{min_number_of_entities_when_values_hide:10},whenHovering:{hideVerticalNow:!0,showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0,showTooltip:!0}}}}}),Kn=Me.extend({init:function(t){this.context=t,this._isCreated=null,this.actionsQueue={},this.entityTrails={}},toggle:function(t){var e=this.context;t?(e._trails.create(),e._trails.run(["resize","recolor","opacityHandler","findVisible","reveal"])):(e._trails.run("remove"),e.model.entities.select.forEach(function(t){t.trailStartTime=null}))},create:function(t){var e=this.context,i=this,a=e.KEY;return this._isCreated=new l(function(n,s){if(e.model.ui.chart.trails){var r=e.model.time.getAllSteps(),o=[];t=null==t?e.model.entities.select:[t];var c=e.bubbleContainer.selectAll("g.vzb-bc-entity").data(e.model.entities.select,function(t){return t[a]});c.exit().remove(),c.enter().insert("g",function(t){return this.querySelector(".bubble-"+t[a])}).attr("class",function(t){return"vzb-bc-entity trail-"+t[a]}).each(function(t,n){var s=new l;t.firstAvailableSegment=null,o.push(s);var c=r.map(function(e){return{t:e,key:t[a]}});i.entityTrails[t[a]]&&i._remove(i.entityTrails[t[a]],null,t),i.entityTrails[t[a]]=d3.select(this).selectAll("g").data(c),i.entityTrails[t[a]].exit().remove(),i.entityTrails[t[a]].enter().append("g").attr("class","vzb-bc-trailsegment").on("mouseover",function(i,n){if(!ve()){var s={};s[a]=i.key,s.time=i.t,e._axisProjections(s),e.labels.highlight(t,!0);var l=e.model.time.timeFormat(i.t),r=Ot(e.model.entities.select,function(e){return e[a]==t[a]});e.model.marker.getFrame(s.time,function(t){var i=e.xScale(t.axis_x[s[a]]),n=e.yScale(t.axis_y[s[a]]),o=Bt(e.sScale(t.size[s[a]])),c=null!=t.color[s[a]]?e.cScale(t.color[s[a]]):e.COLOR_WHITEISH;l!==r.trailStartTime&&e._setTooltip(l,i,n,o+3,c),e._setBubbleCrown(i,n,o,c)}),d3.select(this).style("opacity",1)}}).on("mouseout",function(t,i){ve()||(e._axisProjections(),e._setTooltip(),e._setBubbleCrown(),e.labels.highlight(null,!1),d3.select(this).style("opacity",e.model.entities.opacityRegular))}).each(function(t,e){var i=d3.select(this);i.append("circle"),i.append("line")}),s.resolve()}),o.length>0?l.all(o).then(function(t){n(!0)}):n(!0)}}),this._isCreated},_addActions:function(t,e){var i=this.context,a=this,n=i.KEY;t.forEach(function(t){a.actionsQueue[t[n]]||(a.actionsQueue[t[n]]=[]),a.actionsQueue[t[n]]=[].concat(a.actionsQueue[t[n]].filter(function(t){return-1==e.indexOf(t)}),e)})},_getNextAction:function(t){return this.actionsQueue[t].shift()},run:function(t,e,i){var a=this.context,n=this,s=a.KEY;this._isCreated&&!a.model.time.splash&&this._isCreated.then(function(){(a.model.ui.chart.trails&&a.model.entities.select.length||"remove"==t)&&(i||(i=0),e=null==e?a.model.entities.select:[e],n._addActions(e,t),e.forEach(function(t){var e=n.entityTrails[t[s]],r=function(o){var c=n._getNextAction(t[s]);if(c){var h=a._trails["_"+c](e,i,t);h&&h instanceof l?h.then(function(){r(o+1)}):r(o+1)}};r(0)}))})},_remove:function(t,e,i){this.actionsQueue[i[this.context.KEY]]=[],t&&(d3.select(this.entityTrails[i[this.context.KEY]].node().parentNode).remove(),this.entityTrails[i[this.context.KEY]]=null)},_resize:function(t,e,i){var a=this.context;a.model.time.splash||t.each(function(t,e){if(null!=t.valueY&&null!=t.valueX&&null!=t.valueS){var i=d3.select(this);if(i.select("circle").attr("cy",a.yScale(t.valueY)).attr("cx",a.xScale(t.valueX)).attr("r",Bt(a.sScale(t.valueS))),this.nextSibling){var n=d3.select(this.nextSibling).datum();if(null!=n&&null!=n.valueY&&null!=n.valueX){var s=Math.sqrt(Math.pow(a.xScale(t.valueX)-a.xScale(n.valueX),2)+Math.pow(a.yScale(t.valueY)-a.yScale(n.valueY),2));i.select("line").attr("x1",a.xScale(n.valueX)).attr("y1",a.yScale(n.valueY)).attr("x2",a.xScale(t.valueX)).attr("y2",a.yScale(t.valueY)).style("stroke-dasharray",s).style("stroke-dashoffset",Bt(a.sScale(t.valueS)))}}}})},_recolor:function(t,e,i){var a=this.context;t.each(function(t,e){var i=d3.select(this),n="geo.world_4region"==a.model.marker.color.which?a.model.marker.color.getColorShade({colorID:t.valueC,shadeID:"shade"}):null!=t.valueC?a.cScale(t.valueC):a.COLOR_BLACKISH;i.select("circle").style("fill",null!=t.valueC?a.cScale(t.valueC):a.COLOR_WHITEISH),i.select("line").style("stroke",n)})},_opacityHandler:function(t,e,i){var a=this.context;t.each(function(t,e){var n=d3.select(this);n.style("opacity",i.opacity||a.model.entities.opacityRegular)})},_findVisible:function(t,e,i){var a=this.context,n=a.KEY,s=a.model.time.timeFormat.parse(""+i.trailStartTime);if(a.time-s<0){i.trailStartTime=a.model.time.timeFormat(a.time),s=a.model.time.timeFormat.parse(""+i.trailStartTime);var l=a.labels.cached[i[n]];l.labelX0=a.frame.axis_x[i[n]],l.labelY0=a.frame.axis_y[i[n]];var r=a.frame.size[i[n]];l.scaledS0=r?Bt(a.sScale(r)):null;var o=a.frame.color[i[n]];l.scaledC0=null!=o?a.cScale(o):a.COLOR_WHITEISH,a._updateLabel(i,0,a.frame.axis_x[i[n]],a.frame.axis_y[i[n]],a.frame.size[i[n]],a.frame.color[i[n]],a.frame.label[i[n]],a.frame.size_label[i[n]],0,!0)}t.each(function(t,e){var n=t.transparent;t.transparent=null==i.trailStartTime||t.t-a.time>0||s-t.t>0||i.trailStartTime-a.model.time.timeFormat(a.time)>=0,(n!=t.transparent||Math.abs(a.model.time.timeFormat(t.t)-a.model.time.timeFormat(a.time))<2)&&(t.visibilityChanged=!0)})},_reveal:function(t,e,i){var a=this.context,n=a.KEY,s=a.model.time.timeFormat.parse(""+i.trailStartTime),r=function(t,r){return new l(function(l,o){var c=d3.select(t[0][r]),h=c.datum();h.transparent?(c.classed("vzb-invisible",h.transparent),l()):h.visibilityChanged?a.model.marker.getFrame(h.t,function(o){if(!o)return l();if(h.valueY=o.axis_y[i[n]],h.valueX=o.axis_x[i[n]],h.valueS=o.size[i[n]],h.valueC=o.color[i[n]],null==h.valueY||null==h.valueX||null==h.valueS)a.time-s>0&&(!i.firstAvailableSegment||i.firstAvailableSegment-h.t>0)&&(i.trailStartTime=a.model.time.timeFormat(a.model.time.incrementTime(s)),s=a.model.time.timeFormat.parse(""+i.trailStartTime)),l();else{(!i.firstAvailableSegment||i.firstAvailableSegment-h.t>0)&&(i.firstAvailableSegment=h.t);var d=a.labels.cached[i[n]];if(s&&s.toString()==h.t.toString()){d.labelX0=h.valueX,d.labelY0=h.valueY;var u=h.valueS;d.scaledS0=u?Bt(a.sScale(u)):null,d.scaledC0=null!=h.valueC?a.cScale(h.valueC):a.COLOR_WHITEISH,a._updateLabel(i,r,h.valueX,h.valueY,h.valueS,h.valueC,o.label[i[n]],o.size_label[i[n]],0,!0)}c.select("circle").attr("cy",a.yScale(h.valueY)).attr("cx",a.xScale(h.valueX)).attr("r",Bt(a.sScale(h.valueS))).style("fill",null!=h.valueC?a.cScale(h.valueC):a.COLOR_WHITEISH),c.select("line").attr("x2",a.xScale(h.valueX)).attr("y2",a.yScale(h.valueY)).attr("x1",a.xScale(h.valueX)).attr("y1",a.yScale(h.valueY)),a.time-h.t>0?(h.visibilityChanged=!1,c.classed("vzb-invisible",h.transparent)):c.classed("vzb-invisible",!0);var m=t[0][r+1];if(null==m||a.time.toString()==h.t.toString())l();else{m=m.__data__;var g=m.t;a.time-m.t<0&&(h.visibilityChanged=!0,g=a.time),a.model.marker.getFrame(g,function(t){if(h.valueY=o.axis_y[i[n]],h.valueX=o.axis_x[i[n]],h.valueS=o.size[i[n]],h.valueC=o.color[i[n]],t&&null!=h.valueY&&null!=h.valueX&&null!=h.valueS)if(null==t.axis_x[i[n]]||null==t.axis_y[i[n]])l();else{var s="geo.world_4region"==a.model.marker.color.which?a.model.marker.color.getColorShade({colorID:h.valueC,shadeID:"shade"}):null!=h.valueC?a.cScale(h.valueC):a.COLOR_BLACKISH,r=Math.sqrt(Math.pow(a.xScale(h.valueX)-a.xScale(t.axis_x[i[n]]),2)+Math.pow(a.yScale(h.valueY)-a.yScale(t.axis_y[i[n]]),2));c.select("line").transition().duration(e).ease("linear").attr("x1",a.xScale(t.axis_x[i[n]])).attr("y1",a.yScale(t.axis_y[i[n]])).attr("x2",a.xScale(h.valueX)).attr("y2",a.yScale(h.valueY)).style("stroke-dasharray",r).style("stroke-dashoffset",Bt(a.sScale(h.valueS))).style("stroke",s),l()}else l()})}}}):l()})},o=new l,c=function(t,e){return 0>e||e>=t[0].length?o.resolve():void r(t,e).then(function(){c(t,e+1)})};return c(t,0),o}}),Wn=Me.extend({init:function(t){this.context=t,this.dragRectangle=d3.behavior.drag(),this.zoomer=d3.behavior.zoom(),this.dragLock=!1,this.dragRectangle.on("dragstart",this.drag().start).on("drag",this.drag().go).on("dragend",this.drag().stop),this.zoomer.scaleExtent([1,100]).on("zoomstart",this.zoom().start).on("zoom",this.zoom().go).on("zoomend",this.zoom().stop),this.zoomer.ratioX=1,this.zoomer.ratioY=1,t._zoomedXYMinMax={axis_x:{zoomedMin:null,zoomedMax:null},axis_y:{zoomedMin:null,zoomedMax:null}}},drag:function(){var t=this.context,e=this;return{start:function(i,a){!d3.event.sourceEvent.ctrlKey&&!d3.event.sourceEvent.metaKey&&"plus"!==t.ui.cursorMode||("touchmove"===d3.event.sourceEvent.type||"touchstart"===d3.event.sourceEvent.type)&&(d3.event.sourceEvent.touches.length>1||d3.event.sourceEvent.targetTouches.length>1)||(e.dragLock=!0,this.origin={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},t.zoomRect.classed("vzb-invisible",!1))},go:function(i,a){if(!e.dragLock||("touchmove"===d3.event.sourceEvent.type||"touchstart"===d3.event.sourceEvent.type)&&(d3.event.sourceEvent.touches.length>1||d3.event.sourceEvent.targetTouches.length>1))return e.dragLock=!1,void t.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0);var n=this.origin,s={x:d3.event.x,y:d3.event.y};t.zoomRect.attr("x",Math.min(s.x,n.x)).attr("y",Math.min(s.y,n.y)).attr("width",Math.abs(s.x-n.x)).attr("height",Math.abs(s.y-n.y))},stop:function(i){if(e.dragLock){e.dragLock=!1,t.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0),this.target={x:d3.mouse(this)[0],y:d3.mouse(this)[1]};var a=d3.event.sourceEvent.ctrlKey||d3.event.sourceEvent.metaKey||"plus"===t.ui.cursorMode;e._zoomOnRectangle(d3.select(this),this.origin.x,this.origin.y,this.target.x,this.target.y,a,500)}}}},zoom:function(){var t=this.context,e=this.zoomer,i=this;return{start:function(){this.savedScale=e.scale()},go:function(){var a=d3.event.sourceEvent;if((null==a||!a.ctrlKey&&!a.metaKey)&&(null===a||"touchmove"!==a.type&&"touchstart"!==a.type||!(a.touches.length>1||a.targetTouches.length>1)||(i.dragLock=!1),!i.dragLock)){if(null!=a&&("wheel"===a.type||"mousewheel"===a.type)&&!t.ui.zoomOnScrolling)return t.scrollableAncestor&&(t.scrollableAncestor.scrollTop+=a.deltaY||-a.wheelDelta),d3.event.scale=null,e.scale(this.savedScale),void(this.quitZoom=!0);this.quitZoom=!1,t.model._data.entities.clearHighlighted(),t._setTooltip();var n=d3.event.scale,s=d3.event.translate,l=e.ratioY,r=e.ratioX;t.draggingNow=!0,(isNaN(n)||null==n)&&(n=e.scale()),(isNaN(n)||null==n)&&(n=1),1===n&&null!==a&&(("wheel"===a.type||"mousewheel"===a.type)&&(a.deltaY||-a.wheelDelta)>0||"touchmove"===a.type&&a.touches.length>1)&&(e.ratioX=1,r=1,e.ratioY=1,l=1),(isNaN(s[0])||isNaN(s[1])||null==s[0]||null==s[1])&&(s=e.translate()),(isNaN(s[0])||isNaN(s[1])||null==s[0]||null==s[1])&&(s=[0,0]),1>n*l&&(l=1/n,e.ratioY=l),1>n*r&&(r=1/n,e.ratioX=r),s[0]>0&&(s[0]=0),s[1]>0&&(s[1]=0),s[0]<(1-n*r)*t.width&&(s[0]=(1-n*r)*t.width),s[1]<(1-n*l)*t.height&&(s[1]=(1-n*l)*t.height);var o=t.width*n*r,c=t.height*n*l,h=[0*n*r+s[0],o+s[0]],d=[c+s[1],0*n*l+s[1]],u=t._rangeBump(h),m=t._rangeBump(d),g=(u[0]-h[0])*n*r,p=(u[1]-h[1])*n*r,f=(m[0]-d[0])*n*l,v=(m[1]-d[1])*n*l;h[0]=h[0]+g,h[1]=h[1]+p,d[0]=d[0]+f,d[1]=d[1]+v;var b=[0,t.width],y=[t.height,0],x=t._rangeBump(b),_=t._rangeBump(y);h[0]>x[0]&&(s[0]=x[0]-g),h[1]<x[1]&&(s[0]=x[1]-p-o),d[0]<_[0]&&(s[1]=_[0]-f-c),d[1]>_[1]&&(s[1]=_[1]-v),e.translate(s),h[0]>x[0]&&(h[1]=h[1]-Math.abs(h[0]-x[0]),h[0]=x[0]),h[1]<x[1]&&(h[0]=h[0]+Math.abs(h[1]-x[1]),h[1]=x[1]),d[0]<_[0]&&(d[1]=d[1]+Math.abs(d[0]-_[0]),d[0]=_[0]),d[1]>_[1]&&(d[0]=d[0]-Math.abs(d[1]-_[1]),d[1]=_[1]),"ordinal"===t.model.marker.axis_x.scaleType?t.xScale.rangeBands(h):t.xScale.range(h),"ordinal"===t.model.marker.axis_y.scaleType?t.yScale.rangeBands(d):t.yScale.range(d);var z=function(t){return ct(t)?t:d3.round(t,2)},M=x,w=_;M[0]=b[0]>h[0]?b[0]:h[0],M[1]=b[1]<h[1]?b[1]:h[1],w[0]=y[0]<d[0]?y[0]:d[0],w[1]=y[1]>d[1]?y[1]:d[1],t._zoomedXYMinMax={axis_x:{zoomedMin:z(t.xScale.invert(M[0])),zoomedMax:z(t.xScale.invert(M[1]))},axis_y:{zoomedMin:z(t.yScale.invert(w[0])),zoomedMax:z(t.yScale.invert(w[1]))}},t.model.marker.set(t._zoomedXYMinMax,null,!1);var S=t.yAxis.labelerOptions(),k=t.xAxis.labelerOptions();S.limitMaxTickNumber=2>n*l?7:n*l*7,k.limitMaxTickNumber=2>n*r?7:n*r*7,S.transitionDuration=e.duration,k.transitionDuration=e.duration,t.xAxisEl.call(t.xAxis.labelerOptions(k)),t.yAxisEl.call(t.yAxis.labelerOptions(S)),t.redrawDataPoints(e.duration),t._trails.run("resize",null,e.duration),e.duration=0}},stop:function(){t.draggingNow=!1,this.quitZoom||t.model.marker.set(t._zoomedXYMinMax,!0,!0)}}},expandCanvas:function(t){var e=this.context;t||(t=e.duration);var i=d3.extent(Gt(e.frame.axis_x)),a=d3.extent(Gt(e.frame.axis_y)),n=Bt(e.sScale(d3.extent(Gt(e.frame.size))[1]))||0;if(!i[0]&&0!==i[0]||!i[1]&&0!==i[1]||!a[0]&&0!==a[0]||!a[1]&&0!==a[1])return Ft("panZoom.expandCanvas: X or Y min/max are broken. Aborting with no action");var s={x1:e.xScale(i[0])-n,y1:e.yScale(a[0])+n,x2:e.xScale(i[1])+n,y2:e.yScale(a[1])-n},l=[0,e.width],r=[e.height,0],o={x1:l[0],x2:l[1],y1:r[0],y2:r[1]},c=0;if(!e.isCanvasPreviouslyExpanded||s.x1<o.x1*(1-c)||s.x2>o.x2*(1+c)||s.y2<o.y2*(1-c)||s.y1>o.y1*(1+c)){if(e.isCanvasPreviouslyExpanded){var h=e._rangeBump(l),d=e._rangeBump(r),u=e.xScale.copy().range(h),m=e.yScale.copy().range(d),g=[u.invert(l[0]),u.invert(l[1])],p=[m.invert(r[0]),m.invert(r[1])];s.x1>0?s.x1=0:e.xScale.invert(s.x1)<g[0]&&(s.x1=e.xScale(g[0])),s.x2<e.width?s.x2=e.width:e.xScale.invert(s.x2)>g[1]&&(s.x2=e.xScale(g[1])),s.y1<e.height?s.y1=e.height:e.yScale.invert(s.y1)<p[0]&&(s.y1=e.yScale(p[0])),s.y2>0?s.y2=0:e.yScale.invert(s.y2)>p[1]&&(s.y2=e.yScale(p[1]))}e.isCanvasPreviouslyExpanded=!0,this._zoomOnRectangle(e.element,s.x1,s.y1,s.x2,s.y2,!1,t)}else e.redrawDataPoints(t)},zoomToMaxMin:function(t,e,i,a,n){var s=this.context,l=t,r=e,o=i,c=a,h=[0,s.width],d=[s.height,0],u=s.xScale.domain(),m=s.yScale.domain();l<u[0]&&(l=u[0]),r>u[1]&&(r=u[1]),o<m[0]&&(o=m[0]),c>m[1]&&(c=m[1]);var g=Number.EPSILON?Number.EPSILON:2.220446049250313e-16;s.xScale.invert(h[0])<u[0]&&Math.abs(l-u[0])<g&&(l=s.xScale.invert(h[0])),s.xScale.invert(h[1])>u[1]&&Math.abs(r-u[1])<g&&(r=s.xScale.invert(h[1])),s.yScale.invert(d[0])<m[0]&&Math.abs(o-m[0])<g&&(o=s.yScale.invert(d[0])),s.yScale.invert(d[1])>m[1]&&Math.abs(c-m[1])<g&&(c=s.yScale.invert(d[1]));var p=[s.xScale(l),s.xScale(r)],f=[s.yScale(o),s.yScale(c)];this._zoomOnRectangle(s.element,p[0],f[0],p[1],f[1],!1,n)},_zoomOnRectangle:function(t,e,i,a,n,s,l){var r=this.context,o=this.zoomer,c=e,h=i,d=a,u=n;s&&o.translate([o.translate()[0]+c-d,o.translate()[1]+h-u]);var m=[0,r.width],g=[r.height,0],p=r.xScale.domain(),f=r.yScale.domain();if(r.xScale.invert(c)<p[0]?c=this._scaleCoordinate(c,m[1]-d,r.xScale.range()[0],m[1]):r.xScale.invert(d)<p[0]&&(d=this._scaleCoordinate(d,m[1]-c,r.xScale.range()[0],m[1])),r.xScale.invert(d)>p[1]?d=this._scaleCoordinate(d,c-m[0],r.xScale.range()[1],m[0]):r.xScale.invert(c)>p[1]&&(c=this._scaleCoordinate(c,d-m[0],r.xScale.range()[1],m[0])),r.yScale.invert(h)<f[0]?h=this._scaleCoordinate(h,u-g[1],r.yScale.range()[0],g[1]):r.yScale.invert(u)<f[0]&&(u=this._scaleCoordinate(u,h-g[1],r.yScale.range()[0],g[1])),r.yScale.invert(u)>f[1]?u=this._scaleCoordinate(u,g[0]-h,r.yScale.range()[1],g[0]):r.yScale.invert(h)>f[1]&&(h=this._scaleCoordinate(h,g[0]-u,r.yScale.range()[1],g[0])),!(Math.abs(c-d)<10||Math.abs(h-u)<10)){var v=o.scaleExtent()[1];if(Math.abs(c-d)>Math.abs(h-u)){var b=r.height/Math.abs(h-u)*o.scale();b>v&&(b=v);var y=r.width/Math.abs(c-d)*o.scale()/b*o.ratioX,x=o.ratioY}else{var b=r.width/Math.abs(c-d)*o.scale();b>v&&(b=v);var x=r.height/Math.abs(h-u)*o.scale()/b*o.ratioY,y=o.ratioX}var _=[(o.translate()[0]-Math.min(c,d))/o.scale()/o.ratioX*b*y,(o.translate()[1]-Math.min(h,u))/o.scale()/o.ratioY*b*x];o.scale(b),o.ratioY=x,o.ratioX=y,o.translate(_),o.duration=l?l:0,o.event(t)}},_scaleCoordinate:function(t,e,i,a){var n=e/Math.abs(i-a);return(t-i)*(1-n)+i},_scaleToMin:function(t,e,i,a){var n=(t-e)*i,s=Math.max(a,e-a),l=Math.max(n,s);return l},zoomByIncrement:function(t,e){var i=this.context,a=this.zoomer.scale(),n=[this.zoomer.translate()[0],this.zoomer.translate()[1]],s=d3.mouse(i.element.node()),l=Math.log(a)/Math.LN2;"plus"!=t&&t||(l=Math.floor(l)+1),"minus"==t&&(l=Math.ceil(l)-1);var r=[(s[0]-n[0])/a,(s[1]-n[1])/a],o=this.zoomer.scaleExtent();a=Math.max(o[0],Math.min(o[1],Math.pow(2,l))),r=[r[0]*a+n[0],r[1]*a+n[1]],n[0]+=s[0]-r[0],n[1]+=s[1]-r[1],this.zoomer.scale(a),this.zoomer.translate([n[0],n[1]]),this.zoomer.duration=e||0,this.zoomer.event(i.element)},resetZoomState:function(t){this.zoomer.scale(1),this.zoomer.ratioY=1,this.zoomer.ratioX=1,this.zoomer.translate([0,0])},reset:function(t,e){var i=this.context;i.isCanvasPreviouslyExpanded=!1,this.zoomer.scale(1),this.zoomer.ratioY=1,this.zoomer.ratioX=1,this.zoomer.translate([0,0]),this.zoomer.duration=e||0,this.zoomer.event(t||i.element)},rerun:function(t){var e=this.context;this.zoomer.event(t||e.element)}}),Un=ni.extend({init:function(t,e){var i=this;this.name="bubblechart",this.template="bubblechart.html",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"language",type:"language"},{name:"ui",type:"model"}],this.model_binds={"change:time.start":function(t,e){"time"===i.model.marker.color.scaleType&&(i.model.marker.color.scale=null)},"change:time.record":function(){i.model.time.record?i._export.open(this.element,this.name):i._export.reset()},"change:ui.chart.trails":function(t){i._trails.toggle(i.model.ui.chart.trails),i.redrawDataPoints()},"change:ui.chart.lockNonSelected":function(t){i.redrawDataPoints(500)},"change:marker":function(t,e){if(i._readyOnce){if(e.indexOf("scaleType")>-1)return void i.ready();if(-1===e.indexOf("marker.color")&&-1===e.indexOf("marker.size")&&-1===e.indexOf("marker.size_label")){if(e.indexOf("domainMin")>-1||e.indexOf("domainMax")>-1){if(!i.yScale||!i.xScale)return;return i.updateSize(),i.updateMarkerSizeLimits(),i._trails.run("findVisible"),i.redrawDataPoints(),void i._trails.run("resize")}if(e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1){if(i.draggingNow)return;if(i._zoomedXYMinMax.axis_x.zoomedMin==i.model.marker.axis_x.zoomedMin&&i._zoomedXYMinMax.axis_x.zoomedMax==i.model.marker.axis_x.zoomedMax&&i._zoomedXYMinMax.axis_y.zoomedMin==i.model.marker.axis_y.zoomedMin&&i._zoomedXYMinMax.axis_y.zoomedMax==i.model.marker.axis_y.zoomedMax)return;return void i._panZoom.zoomToMaxMin(i.model.marker.axis_x.zoomedMin,i.model.marker.axis_x.zoomedMax,i.model.marker.axis_y.zoomedMin,i.model.marker.axis_y.zoomedMax,500)}}}},"change:entities.select":function(){i._readyOnce&&i.entityBubbles&&(i.selectDataPoints(),i.redrawDataPoints(),i._trails.create(),i._trails.run(["resize","recolor","opacityHandler","findVisible","reveal"]),i.updateBubbleOpacity(),i._updateDoubtOpacity())},"change:entities.highlight":function(){i._readyOnce&&i.highlightDataPoints()},"change:time.value":function(){i._readyOnce&&(i.calculationQueue?i.calculationQueue.push(i.model.time.value.toString()):i.calculationQueue=[i.model.time.value.toString()],function(t){i.model.marker.getFrame(t,function(t,e){if(i._frameIsValid(t)){var a=i.calculationQueue.indexOf(e.toString());-1!=a&&(i.calculationQueue.splice(0,a+1),i.frameChanged(t,e))}})}(i.model.time.value))},"change:ui.adaptMinMaxZoom":function(){i.model.ui.adaptMinMaxZoom?i._panZoom.expandCanvas(500):i._panZoom.reset()},"change:marker.size.extent":function(t,e){i._readyOnce&&(i.updateMarkerSizeLimits(),i._trails.run("findVisible"),i.redrawDataPointsOnlySize(),i._trails.run("resize"))},"change:marker.color":function(t,e){i._readyOnce&&(i.redrawDataPointsOnlyColors(),i._trails.run("recolor"))},"change:entities.opacitySelectDim":function(){i.updateBubbleOpacity()},"change:entities.opacityRegular":function(){i.updateBubbleOpacity(),i._trails.run("opacityHandler")},"change:ui.cursorMode":function(){var t=i.element.select("svg");"plus"===i.model.ui.cursorMode?(t.classed("vzb-zoomin",!0),t.classed("vzb-zoomout",!1)):"minus"===i.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!0)):(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1))},ready:function(){}},this._super(t,e),this.xScale=null,this.yScale=null,this.sScale=null,this.cScale=null,this.xAxis=L(),this.yAxis=L(),i.COLOR_BLACKISH="#333",i.COLOR_WHITEISH="#fdfdfd",this.isCanvasPreviouslyExpanded=!1,this.draggingNow=null,this._trails=new Kn(this),this._panZoom=new Wn(this),this._export=new Rn(this),this._export.prefix("vzb-bc-").deleteClasses(["vzb-bc-bubbles-crop","vzb-hidden","vzb-bc-year","vzb-bc-zoom-rect","vzb-bc-projection-x","vzb-bc-projection-y","vzb-bc-axis-c-title"])},afterPreload:function(){this.labels=this.parent.findChildByName("gapminder-labels"),this.labels.config({CSS_PREFIX:"vzb-bc",TOOL_CONTEXT:this,LABELS_CONTAINER_CLASS:"vzb-bc-labels",LINES_CONTAINER_CLASS:"vzb-bc-lines"})},_rangeBump:function(t,e){var i=this.activeProfile.maxRadius/2;if(e=e?-1:1,rt(t)&&t.length>1){var a=t[0],n=t[t.length-1];return n>a?(a+=i*e,n-=i*e,a>n&&(a=n=(a+n)/2)):a>n?(a-=i*e,n+=i*e,n>a&&(a=n=(a+n)/2)):Ft("rangeBump error: the input scale range has 0 length. that sucks"),[a,n]}Ft("rangeBump error: input is not an array or empty")},readyOnce:function(){var t=this;this._readyOnce=!1,this.scrollableAncestor=vt(this.element),this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisElContainer=this.graph.select(".vzb-bc-axis-y"),
this.yAxisEl=this.yAxisElContainer.select("g"),this.xAxisElContainer=this.graph.select(".vzb-bc-axis-x"),this.xAxisEl=this.xAxisElContainer.select("g"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.xTitleEl=this.graph.select(".vzb-bc-axis-x-title"),this.sTitleEl=this.graph.select(".vzb-bc-axis-s-title"),this.cTitleEl=this.graph.select(".vzb-bc-axis-c-title"),this.yearEl=this.graph.select(".vzb-bc-year"),this.year=new Tn(this.yearEl),this.yInfoEl=this.graph.select(".vzb-bc-axis-y-info"),this.xInfoEl=this.graph.select(".vzb-bc-axis-x-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.projectionX=this.graph.select(".vzb-bc-projection-x"),this.projectionY=this.graph.select(".vzb-bc-projection-y"),this.trailsContainer=this.graph.select(".vzb-bc-trails"),this.bubbleContainerCrop=this.graph.select(".vzb-bc-bubbles-crop"),this.labelsContainerCrop=this.graph.select(".vzb-bc-labels-crop"),this.bubbleContainer=this.graph.select(".vzb-bc-bubbles"),this.labelsContainer=this.graph.select(".vzb-bc-labels"),this.linesContainer=this.graph.select(".vzb-bc-lines"),this.zoomRect=this.element.select(".vzb-bc-zoom-rect"),this.eventArea=this.element.select(".vzb-bc-eventarea"),this.entityBubbles=null,this.bubbleCrown=this.element.select(".vzb-bc-bubble-crown"),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),this.tooltip=this.element.select(".vzb-bc-tooltip"),this.tooltip.select(".vzb-tooltip-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),this.tooltipMobile=this.element.select(".vzb-tooltip-mobile"),this.on("resize",function(){t.updateSize()||(t.updateMarkerSizeLimits(),t.labels.updateSize(),t._trails.run("findVisible"),t._panZoom.rerun())}),d3.select("body").on("keydown",function(){"arrow"===t.model.ui.cursorMode&&(d3.event.metaKey||d3.event.ctrlKey)&&t.element.select("svg").classed("vzb-zoomin",!0)}).on("keyup",function(){"arrow"===t.model.ui.cursorMode&&(d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1))}),this.root.on("resetZoom",function(){t._panZoom.reset(null,500)}),this.bubbleContainerCrop.call(this._panZoom.zoomer).call(this._panZoom.dragRectangle).on("dblclick.zoom",null).on("mouseup",function(){t.draggingNow=!1}).on("click",function(){var e=t.model.ui.cursorMode;d3.event.defaultPrevented||"arrow"===e||t._panZoom.zoomByIncrement(e,500)}),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.updateUIStrings(),this.wScale=d3.scale.linear().domain(this.parent.datawarning_content.doubtDomain).range(this.parent.datawarning_content.doubtRange),t._readyOnce=!0},_frameIsValid:function(t){return!(!t||0===Object.keys(t.axis_y).length||0===Object.keys(t.axis_x).length||0===Object.keys(t.size).length)},ready:function(){var t=this;this.updateUIStrings();this.model.time.end;this.model.marker.getFrame(this.model.time.value,function(e,i){return i.toString()!=t.model.time.value.toString()?void se(function(){t.ready()}):void(t._frameIsValid(e)&&(t.frame=e,t.updateTime(),t.updateIndicators(),t.updateSize(),t.updateEntities(),t.redrawDataPoints(),t.selectDataPoints(),t._trails.create(),t.updateMarkerSizeLimits(),t.updateBubbleOpacity(),t.zoomToMarkerMaxMin(),t._trails.run(["recolor","opacityHandler","findVisible","reveal"]),t.model.ui.adaptMinMaxZoom&&t._panZoom.expandCanvas()))})},zoomToMarkerMaxMin:function(){this._panZoom.resetZoomState();var t=this.model.marker.axis_x,e=this.model.marker.axis_y,i=t.getScale().domain(),a=e.getScale().domain(),n=t.zoomedMin?t.zoomedMin:i[0],s=t.zoomedMax?t.zoomedMax:i[1],l=e.zoomedMin?e.zoomedMin:a[0],r=e.zoomedMax?e.zoomedMax:a[1];this._panZoom.zoomToMaxMin(n,s,l,r)},updateIndicators:function(){var t=this;this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale(),this.labels.setScales(this.xScale,this.yScale),this.yAxis.tickFormat(t.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(t.model.marker.axis_x.getTickFormatter())},frameChanged:function(t,e){this.frame=t,this.updateTime(),this._updateDoubtOpacity(),this._trails.run("findVisible"),this.model.ui.adaptMinMaxZoom?this._panZoom.expandCanvas():this.redrawDataPoints(),this._trails.run("reveal",null,this.duration),this.tooltipMobile.classed("vzb-hidden",!0)},updateUIStrings:function(){var t=this;this.translator=this.model.language.getTFunction(),this.strings={title:{Y:this.translator("indicator/"+this.model.marker.axis_y.which),X:this.translator("indicator/"+this.model.marker.axis_x.which),S:this.translator("indicator/"+this.model.marker.size.which),C:this.translator("indicator/"+this.model.marker.color.which)},unit:{Y:this.translator("unit/"+this.model.marker.axis_y.which),X:this.translator("unit/"+this.model.marker.axis_x.which),S:this.translator("unit/"+this.model.marker.size.which),C:this.translator("unit/"+this.model.marker.color.which)}},this.strings.unit.Y==="unit/"+this.model.marker.axis_y.which&&(this.strings.unit.Y=""),this.strings.unit.X==="unit/"+this.model.marker.axis_x.which&&(this.strings.unit.X=""),this.strings.unit.S==="unit/"+this.model.marker.size.which&&(this.strings.unit.S=""),this.strings.unit.C==="unit/"+this.model.marker.color.which&&(this.strings.unit.C=""),this.strings.unit.Y&&(this.strings.unit.Y=", "+this.strings.unit.Y),this.strings.unit.X&&(this.strings.unit.X=", "+this.strings.unit.X),this.strings.unit.S&&(this.strings.unit.S=", "+this.strings.unit.S),this.strings.unit.C&&(this.strings.unit.C=", "+this.strings.unit.C);var e=this.yTitleEl.selectAll("text").data([0]);e.enter().append("text"),e.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX("left").alignY("top").updateView().toggle()});var i=this.xTitleEl.selectAll("text").data([0]);i.enter().append("text"),i.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX("left").alignY("bottom").updateView().toggle()});var n=this.sTitleEl.selectAll("text").data([0]);n.enter().append("text"),n.attr("text-anchor","end"),ye(this.dataWarningEl,Mi).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),ye(this.yInfoEl,Si).select("svg").attr("width","0px").attr("height","0px"),ye(this.xInfoEl,Si).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=a(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),i=a(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(i.x,i.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t._updateDoubtOpacity(1)}).on("mouseout",function(){t._updateDoubtOpacity()})},_updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.model.time.timeFormat(this.time))),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateEntities:function(){var t=this,e=this.KEY,i=this.TIMEDIM,a=function(a){return a=a||"",t.model.marker.getKeys().map(function(s){var l={};return l[e]=s[e],l[i]=n,l.sortValue=t.frame.size[s[e]]||0,l[e]=a+s[e],l}).sort(function(t,e){return e.sortValue-t.sortValue})},n=this.model.time.end;this.model.entities.setVisible(a.call(this)),this.model.time.splash||this.unselectBubblesWithNoData(),this.entityBubbles=this.bubbleContainer.selectAll(".vzb-bc-entity").data(this.model.entities.getVisible(),function(t){return t&&!t.trailStartTime?t[e]:null}),this.entityBubbles.exit().remove(),this.entityBubbles.enter().append("circle").attr("class",function(t){return"vzb-bc-entity bubble-"+t[e]}).on("mouseover",function(e,i){ve()||"arrow"!==t.model.ui.cursorMode||t._bubblesInteract().mouseover(e,i)}).on("mouseout",function(e,i){ve()||"arrow"!==t.model.ui.cursorMode||t._bubblesInteract().mouseout(e,i)}).on("click",function(e,i){ve()||"arrow"!==t.model.ui.cursorMode||t._bubblesInteract().click(e,i)}).onTap(function(e,i){d3.event.stopPropagation(),t._bubblesInteract().click(e,i)}).onLongTap(function(t,e){}),this.entityBubbles.order()},unselectBubblesWithNoData:function(t){var e=this,i=this.KEY;t||(t=this.frame),t&&t.axis_y&&t.axis_x&&t.size&&this.model.entities.select.forEach(function(a){(!t.axis_y[a[i]]&&0!==t.axis_y[a[i]]||!t.axis_x[a[i]]&&0!==t.axis_x[a[i]]||!t.size[a[i]]&&0!==t.size[a[i]])&&e.model.entities.selectEntity(a)})},_bubblesInteract:function(){var t=this;this.KEY,this.TIMEDIM;return{mouseover:function(e,i){t.model.entities.highlightEntity(e),t.labels.showCloseCross(e,!0)},mouseout:function(e,i){t.model.entities.clearHighlighted(),t.labels.showCloseCross(e,!1)},click:function(e,i){if(!t.draggingNow){var a=t.model.entities.isSelected(e);t.model.entities.selectEntity(e),ve()||(a&&t.model.entities.highlightEntity(e),t.highlightDataPoints())}}}},updateTime:function(){var t=this;if(this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.duration){var e=t.time;this.yearDelayId=le(function(){t.year.setText(t.model.time.timeFormat(e))},this.duration)}else this.yearDelayId&&(re(this.yearDelayId),this.yearDelayId=null),t.year.setText(t.model.time.timeFormat(t.time))},updateSize:function(){var t={small:{margin:{top:30,right:10,left:40,bottom:35},padding:2,minRadius:.5,maxRadius:30,infoElHeight:16,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:4},medium:{margin:{top:40,right:15,left:60,bottom:55},padding:2,minRadius:1,maxRadius:55,infoElHeight:20,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:5},large:{margin:{top:50,right:20,left:60,bottom:60},padding:2,minRadius:1,maxRadius:65,infoElHeight:22,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:5,hideSTitle:!0}},e={medium:{margin:{top:80,bottom:80,left:100},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:26},large:{margin:{top:80,bottom:100,left:100},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:32,hideSTitle:!0}},i=this;this.activeProfile=this.getActiveProfile(t,e);var a=this.activeProfile.margin,n=this.activeProfile.infoElHeight;if(i.labels.setCloseCrossHeight(1.2*i.activeProfile.infoElHeight),this.height=parseInt(this.element.style("height"),10)-a.top-a.bottom||0,this.width=parseInt(this.element.style("width"),10)-a.left-a.right||0,this.height<=0||this.width<=0)return Ft("Bubble chart updateSize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+a.left+","+a.top+")"),this.year.resize(this.width,this.height,Math.min(this.width/2.5,Math.max(this.height/3,this.width/3))),this.eventArea.attr("width",this.width).attr("height",Math.max(0,this.height)),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range(this._rangeBump([this.height,0])):this.yScale.rangePoints([this.height,0],i.activeProfile.padding).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range(this._rangeBump([0,this.width])):this.xScale.rangePoints([0,this.width],i.activeProfile.padding).range(),this.yAxis.scale(this.yScale).orient("left").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:a,limitMaxTickNumber:6,bump:this.activeProfile.maxRadius/2,constantRakeLength:this.height,formatter:this.model.marker.axis_y.getTickFormatter()}),this.xAxis.scale(this.xScale).orient("bottom").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:a,bump:this.activeProfile.maxRadius/2,constantRakeLength:this.width,formatter:this.model.marker.axis_x.getTickFormatter()}),this.bubbleContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.xAxisElContainer.attr("width",this.width+1).attr("height",this.activeProfile.margin.bottom).attr("y",this.height-1).attr("x",-1),this.xAxisEl.attr("transform","translate(1,1)"),this.yAxisElContainer.attr("width",this.activeProfile.margin.left).attr("height",Math.max(0,this.height)).attr("x",-this.activeProfile.margin.left),this.yAxisEl.attr("transform","translate("+(this.activeProfile.margin.left-1)+",0)"),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis),this.projectionX.attr("y1",i.yScale.range()[0]+this.activeProfile.maxRadius/2),this.projectionY.attr("x2",i.xScale.range()[0]-this.activeProfile.maxRadius/2),this._updateSTitle();var s=this.yAxisElContainer.select("g").node().getBBox().width;this.yTitleEl.style("font-size",n+"px").attr("transform","translate("+-s+", -"+this.activeProfile.yAxisTitleBottomMargin+")"),this.xTitleEl.style("font-size",n+"px").attr("transform","translate(0,"+(this.height+a.bottom-this.activeProfile.xAxisTitleBottomMargin)+")"),this.sTitleEl.attr("transform","translate("+this.width+",20) rotate(-90)");var l=this.yTitleEl.select("text").text(this.strings.title.Y+this.strings.unit.Y);l.node().getBBox().width>this.width&&l.text(this.strings.title.Y);var r=this.xTitleEl.select("text").text(this.strings.title.X+this.strings.unit.X);if(r.node().getBBox().width>this.width-100&&r.text(this.strings.title.X),this.yInfoEl.select("svg").node()){var o=this.yTitleEl.node().getBBox(),c=d3.transform(this.yTitleEl.attr("transform")).translate;this.yInfoEl.select("svg").attr("width",n+"px").attr("height",n+"px"),this.yInfoEl.attr("transform","translate("+(o.x+c[0]+o.width+.4*n)+","+(c[1]-.8*n)+")")}if(this.xInfoEl.select("svg").node()){var o=this.xTitleEl.node().getBBox(),c=d3.transform(this.xTitleEl.attr("transform")).translate;this.xInfoEl.select("svg").attr("width",n+"px").attr("height",n+"px"),this.xInfoEl.attr("transform","translate("+(o.x+c[0]+o.width+.4*n)+","+(c[1]-.8*n)+")")}this._resizeDataWarning()},_resizeDataWarning:function(){this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height+this.activeProfile.margin.bottom-this.activeProfile.xAxisTitleBottomMargin)+")");var t=this.dataWarningEl.select("text").style("font-size",null),e=t.node().getBBox().width+3*t.node().getBBox().height,i=this.width-this.xTitleEl.node().getBBox().width-this.activeProfile.infoElHeight,a=parseInt(t.style("font-size"))*i/e;t.style("font-size",e>i?a+"px":null);var n=t.node().getBBox();this.dataWarningEl.select("svg").attr("width",.75*n.height).attr("height",.75*n.height).attr("x",-n.width-1.2*n.height).attr("y",.65*-n.height)},updateMarkerSizeLimits:function(){var t=this,e=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return Ft("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var i=this.activeProfile.minRadius,a=this.activeProfile.maxRadius;this.minRadius=Math.max(a*e[0],i),this.maxRadius=Math.max(a*e[1],i),"ordinal"!==this.model.marker.size.scaleType?this.sScale.range([It(t.minRadius),It(t.maxRadius)]):this.sScale.rangePoints([It(t.minRadius),It(t.maxRadius)],0).range()},redrawDataPointsOnlyColors:function(){var t,e=this,i=this.KEY,a=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(a=this.model.time.timeFormat.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(a,function(a){return e._frameIsValid(a)?(t=e.frame,void e.entityBubbles.each(function(n,s){var l=e.model.entities.isSelected(n),r=l?t.color[n[i]]:a.color[n[i]],o=null!=r?e.cScale(r):e.COLOR_WHITEISH;if(d3.select(this).style("fill",o),l){var c=Ot(e.model.entities.select,function(t){return t[i]==n[i]}),h=e.model.time.timeFormat.parse(""+c.trailStartTime);e.model.marker.getFrame(h,function(t){if(!t)return Ft("redrawDataPointsOnlyColor: empty data received from marker.getFrames(). doing nothing");var a={};if(e.model.ui.chart.trails&&h-e.time!=0){var l=t.color[n[i]];a.scaledC0=null!=l?e.cScale(l):e.COLOR_WHITEISH}else a.scaledC0=o;e.labels.updateLabelOnlyColor(n,s,a)})}})):Ft("redrawDataPointsOnlyColor: empty data received from marker.getFrames(). doing nothing")})},redrawDataPointsOnlySize:function(){var t,e=this,i=this.KEY,a=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(a=this.model.time.timeFormat.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(a,function(a){return e._frameIsValid(a)?(t=e.frame,void e.entityBubbles.each(function(n,s){var l=e.model.entities.isSelected(n),r=l?t.size[n[i]]:a.size[n[i]];if(null!=r){var o=Bt(e.sScale(r));if(d3.select(this).attr("r",o),l){var c=Ot(e.model.entities.select,function(t){return t[i]==n[i]}),h=e.model.time.timeFormat.parse(""+c.trailStartTime);e.model.marker.getFrame(h,function(t){if(!t)return Ft("redrawDataPointsOnlySize: empty data received from marker.getFrames(). doing nothing");var a={};e.model.ui.chart.trails&&h-e.time!=0?a.scaledS0=Bt(e.sScale(t.size[n[i]])):a.scaledS0=o,e.labels.updateLabelOnlyPosition(n,s,a)})}}})):Ft("redrawDataPointsOnlySize: empty data received from marker.getFrames(). doing nothing")})},redrawDataPoints:function(t){var e=this;this.KEY;if(null==t&&(t=e.duration),this.model.ui.chart.lockNonSelected&&this.someSelected){var i=this.model.time.timeFormat.parse(""+this.model.ui.chart.lockNonSelected);this.model.marker.getFrame(i,function(i){return i?void e.entityBubbles.each(function(a,n){var s=e.model.entities.isSelected(a)?e.frame:i;e._updateBubble(a,s,n,d3.select(this),t)}):Ft("redrawDataPoints: empty data received from marker.getFrames(). doing nothing")})}else e.entityBubbles.each(function(i,a){e._updateBubble(i,e.frame,a,d3.select(this),t)})},_updateBubble:function(t,e,i,a,n){var s=this,l=this.KEY,r=!1,o=e.axis_y[t[l]],c=e.axis_x[t[l]],h=e.size[t[l]],d=e.label[t[l]],u=e.color[t[l]],m=e.size_label[t[l]];if(!d&&0!==d||!o&&0!==o||!c&&0!==c||!h&&0!==h){if(t.hidden||(t.hidden=!0,r=!0),r)if(n){var g=a.style("opacity");a.transition().duration(n).ease("exp").style("opacity",0).each("end",function(){a.classed("vzb-invisible",t.hidden),a.style("opacity",g)})}else a.classed("vzb-invisible",t.hidden)}else{(t.hidden||a.classed("vzb-invisible"))&&(t.hidden=!1,r=!0);var p=Bt(s.sScale(h));if(a.style("fill",null!=u?s.cScale(u):s.COLOR_WHITEISH),n)if(r){var g=a.style("opacity");a.classed("vzb-invisible",t.hidden),a.style("opacity",0).attr("cy",s.yScale(o)).attr("cx",s.xScale(c)).attr("r",p).transition().duration(n).ease("exp").style("opacity",g)}else a.transition().duration(n).ease("linear").attr("cy",s.yScale(o)).attr("cx",s.xScale(c)).attr("r",p);else a.interrupt().attr("cy",s.yScale(o)).attr("cx",s.xScale(c)).attr("r",p),r&&a.classed("vzb-invisible",t.hidden);this.model.time.record&&s._export.write({type:"circle",id:t[l],time:this.model.time.value.getUTCFullYear(),fill:null!=u?s.cScale(u):s.COLOR_WHITEISH,cx:s.xScale(c),cy:s.yScale(o),r:p})}s._updateLabel(t,i,c,o,h,u,d,m,n,r)},_updateLabel:function(t,e,i,a,n,s,l,r,o,c){var h=this,d=this.KEY;if(h.model.entities.isSelected(t)){var u=null,m=Ot(h.model.entities.select,function(e){return e[d]==t[d]}),g=h.model.time.timeFormat(h.time);if(!this.model.ui.chart.trails||m.trailStartTime==g||null==m.trailStartTime){this.model.ui.chart.trails&&null==m.trailStartTime&&(m.trailStartTime=g);var u={};u.labelX0=i,u.labelY0=a,u.scaledC0=null!=s?h.cScale(s):h.COLOR_WHITEISH,u.scaledS0=n?Bt(h.sScale(n)):null}var p=h.model.time.timeFormat.parse(""+m.trailStartTime),f=l+(h.model.ui.chart.trails?" "+m.trailStartTime:"");c&&t.hidden&&h.model.ui.chart.trails&&p&&p<h.time&&(c=!1),t.hidden&&!h.model.ui.chart.trails&&(c=!0),this.labels.updateLabel(t,e,u,i,a,n,s,f,r,o,c)}},_updateSTitle:function(t,e){if(this.activeProfile.hideSTitle)return void this.sTitleEl.classed("vzb-invisible",!0);this.sTitleEl.classed("vzb-invisible")&&this.sTitleEl.classed("vzb-invisible",!1);var i="constant"!==this.model.marker.size.use,a="constant"!==this.model.marker.color.use,n=this.sTitleEl.select("text").style("font-size",null).text((i?this.translator("buttons/size")+": "+(t?t:this.strings.title.S):"")+(i&&a?", ":"")+(a?this.translator("buttons/colors")+": "+(e?e:this.strings.title.C):"")),s=n.node().getBBox().width,l=this.height-30,r=parseInt(n.style("font-size"))*l/s;n.style("font-size",s>l?r+"px":null)},selectDataPoints:function(){var t=this;this.KEY;t._setTooltip(),t._setBubbleCrown(),t.someSelected=t.model.entities.select.length>0},_setBubbleCrown:function(t,e,i,a,n){null!=t?(this.bubbleCrown.classed("vzb-hidden",!1),this.bubbleCrown.select(".vzb-crown").attr("cx",t).attr("cy",e).attr("r",i).attr("fill",n?"none":a),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("cx",t).attr("cy",e).attr("r",i+10).attr("stroke",a)):this.bubbleCrown.classed("vzb-hidden",!0)},_setTooltip:function(t,e,i,a,n){if(t){var s,l,r=-1,o=-1,c=0,h=0;a&&(c=.71*a,h=.71*a),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(t);var d=this.tooltip.select("text")[0][0].getBBox();e-c-d.width<0?(r=1,e+=d.width+5):e-=5,i-h-d.height<0?(o=1,i+=d.height):i-=11,a?(s=e+c*r,l=i+h*o):(s=e+c*r,l=i+h*o),this.tooltip.attr("transform","translate("+s+","+l+")"),this.tooltip.selectAll("rect").attr("width",d.width+8).attr("height",1.2*d.height).attr("x",-d.width-4).attr("y",.85*-d.height).attr("rx",.2*d.height).attr("ry",.2*d.height),this.tooltip.select(".vzb-tooltip-glow").attr("stroke",n)}else this.tooltip.classed("vzb-hidden",!0)},_axisProjections:function(t){var e=this,i=this.TIMEDIM,a=this.KEY;null!=t?this.model.marker.getFrame(t[i],function(i){var n=i.axis_y[t[a]],s=i.axis_x[t[a]],l=i.size[t[a]],r=Bt(e.sScale(l));!n&&0!==n||!s&&0!==s||!l&&0!==l||(e.ui.chart.whenHovering.showProjectionLineX&&e.xScale(s)>0&&e.xScale(s)<e.width&&e.yScale(n)+r<e.height&&e.projectionX.style("opacity",1).attr("y2",e.yScale(n)+r).attr("x1",e.xScale(s)).attr("x2",e.xScale(s)),e.ui.chart.whenHovering.showProjectionLineY&&e.yScale(n)>0&&e.yScale(n)<e.height&&e.xScale(s)-r>0&&e.projectionY.style("opacity",1).attr("y1",e.yScale(n)).attr("y2",e.yScale(n)).attr("x1",e.xScale(s)-r),e.ui.chart.whenHovering.higlightValueX&&e.xAxisEl.call(e.xAxis.highlightValue(s)),e.ui.chart.whenHovering.higlightValueY&&e.yAxisEl.call(e.yAxis.highlightValue(n)))}):(this.projectionX.style("opacity",0),this.projectionY.style("opacity",0),this.xAxisEl.call(this.xAxis.highlightValue("none")),this.yAxisEl.call(this.yAxis.highlightValue("none")))},highlightDataPoints:function(){var t=this,e=this.TIMEDIM,i=this.KEY;if(this.someHighlighted=this.model.entities.highlight.length>0,this.updateBubbleOpacity(),1===this.model.entities.highlight.length){var a=wt(this.model.entities.highlight[0]);t.model.ui.chart.lockNonSelected&&t.someSelected&&!t.model.entities.isSelected(a)?a[e]=t.model.time.timeFormat.parse(""+t.model.ui.chart.lockNonSelected):a[e]=t.model.time.timeFormat.parse(""+a.trailStartTime)||t.time,t.model.marker.getFrame(a[e],function(n){var s=t.xScale(n.axis_x[a[i]]),l=t.yScale(n.axis_y[a[i]]),r=Bt(t.sScale(n.size[a[i]])),o=null!=n.color[a[i]]?t.cScale(n.color[a[i]]):t.COLOR_WHITEISH,c=!1,h=t.translator("unit/"+t.model.marker.size.which),d=t.translator("unit/"+t.model.marker.color.which);h==="unit/"+t.model.marker.size.which&&(h=""),d==="unit/"+t.model.marker.color.which&&(d="");var u=t.model.marker.size.getTickFormatter(),m=t.model.marker.color.getTickFormatter();t._updateSTitle(u(n.size[a[i]])+" "+h,n.color[a[i]]||0===n.color[a[i]]?m(n.color[a[i]])+" "+d:t.translator("hints/nodata")),(0>s+r||s-r>t.width||0>l+r||l-r>t.height)&&(c=!0);var g="",p=!1;if(t.model.entities.isSelected(a)&&t.model.ui.chart.trails){g=t.model.time.timeFormat(t.time);var f=Ot(t.model.entities.select,function(t){return t[i]==a[i]});p=g!==f.trailStartTime&&!d3.select(d3.event.target).classed("bubble-"+a[i]),g=g!==f.trailStartTime&&t.time===a[e]?g:""}else g=t.model.entities.isSelected(a)?"":n.label[a[i]];if(t.labels.highlight(a,!0),t.model.entities.isSelected(a)){var v=!a.trailStartTime||a.trailStartTime==t.model.time.timeFormat(t.time);t._setBubbleCrown(s,l,r,o,v)}c||p||t._axisProjections(a),!g||c||p||t._setTooltip(g,s,l,r+3,o);var f=Ot(t.model.entities.select,function(t){return t[i]==a[i]});if(f){var b=wt(f);b.opacity=1,t._trails.run(["opacityHandler"],b)}})}else this._axisProjections(),this._trails.run(["opacityHandler"]),t._updateSTitle(),this._setTooltip(),this._setBubbleCrown(),this.labels.highlight(null,!1)},updateBubbleOpacity:function(t){var e=this,i=1,a=this.model.entities.opacityHighlightDim,n=this.model.entities.opacityRegular,s=this.model.entities.opacityRegular,l=this.model.entities.opacitySelectDim;this.entityBubbles.style("opacity",function(t){return e.someHighlighted&&e.model.entities.isHighlighted(t)?i:e.someSelected?e.model.entities.isSelected(t)?n:l:e.someHighlighted?a:s});var r=e.someSelected&&e.model.entities.opacitySelectDim<.01;r!=this.someSelectedAndOpacityZero_1&&this.entityBubbles.style("pointer-events",function(t){return!r||e.model.entities.isSelected(t)?"visible":"none"}),this.someSelectedAndOpacityZero_1=e.someSelected&&e.model.entities.opacitySelectDim<.01}}),Gn=Hi.extend("BubbleChart",{init:function(t,e){this.name="bubblechart",this.components=[{component:Un,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","language","ui"]},{component:La,placeholder:".vzb-tool-labels",model:["state.entities","state.marker","ui"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"]},{component:ln,placeholder:".vzb-tool-dialogs",model:["state","ui","language"]},{component:Ua,placeholder:".vzb-tool-buttonlist",model:["state","ui","language"]},{component:ra,placeholder:".vzb-tool-treemenu",model:["state.marker","language"]},{component:on,placeholder:".vzb-tool-datawarning",model:["language"]},{component:fn,placeholder:".vzb-tool-datanotes",model:["state.marker","language"]}],this._super(t,e)},validate:function(t){if(t=this.model||t,this._super(t),t.ui.chart.lockNonSelected){var e=t.state.time.timeFormat.parse(""+t.ui.chart.lockNonSelected);e<t.state.time.start&&(t.ui.chart.lockNonSelected=t.state.time.timeFormat(t.state.time.start)),e>t.state.time.end&&(t.ui.chart.lockNonSelected=t.state.time.timeFormat(t.state.time.end))}},default_model:{state:{time:{round:"ceil"},entities:{dim:"geo",show:{_defs_:{geo:["*"],"geo.cat":["country"]}},opacitySelectDim:.3,opacityRegular:1},marker:{space:["entities","time"],type:"geometry",label:{use:"property",which:"geo.name"},size_label:{use:"constant"},axis_y:{use:"indicator",which:"lex"},axis_x:{use:"indicator",which:"gdp_pc"},color:{use:"property",which:"geo.world_4region"},size:{use:"indicator",which:"pop"}}},ui:{chart:{whenHovering:{showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0},labels:{dragging:!0,removeLabelBox:!1},trails:!0,lockNonSelected:0},presentation:!0,adaptMinMaxZoom:!1}}}),Qn=ni.extend({init:function(t,e){this.name="popbyage",this.template="popbyage.html",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"age",type:"entities"},{name:"marker",type:"model"},{name:"language",type:"language"}];var i=this;this.model_binds={"change:time.value":function(t){i._updateEntities()},"change:entities.show":function(t){console.log("Trying to change show")},"change:age.select":function(t){i._selectBars()},"change:marker.color.palette":function(t){i._readyOnce&&i._updateEntities()},"change:marker.color.scaleType":function(t){i._readyOnce&&i._updateEntities()}},this._super(t,e),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=L(),this.yAxis=L()},readyOnce:function(){this.el=this.el?this.el:d3.select(this.element),this.element=this.el,this.graph=this.element.select(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.bars=this.graph.select(".vzb-bc-bars"),this.labels=this.graph.select(".vzb-bc-labels"),this.title=this.element.select(".vzb-bc-title"),this.year=this.element.select(".vzb-bc-year"),this.model.age.selectMultiple(!0);var t=this;this.on("resize",function(){t._updateEntities()})},ready:function(){this.AGEDIM=this.model.age.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.updateUIStrings(),this._updateIndicators(),this.resize(),this._updateEntities(),this._updateEntities()},updateUIStrings:function(){this.translator=this.model.language.getTFunction();var t=this.translator("indicator/"+this.model.marker.axis_y.which),e=this.yTitleEl.selectAll("text").data([0]);e.enter().append("text"),e.attr("y","-6px").attr("x","-9px").attr("dx","-0.72em").text(t)},_updateIndicators:function(){var t=this;this.duration=this.model.time.delayAnimations,this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(!1),this.yAxis.tickFormat(t.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(t.model.marker.axis_x.getTickFormatter())},_updateEntities:function(){var t=this,e=this.model.time,i=this.AGEDIM,a=this.TIMEDIM,n=e.playing?e.delayAnimations:0,s=this.model.age.grouping||1,l={};l[a]=e.value;var r=this.model.marker.getKeys(i),o=this.model.marker.getValues(l,[i]),c=this.yScale.domain();this.cScale=this.model.marker.color.getScale(),this.model.age.setVisible(r),this.entityBars=this.bars.selectAll(".vzb-bc-bar").data(r),this.entityLabels=this.labels.selectAll(".vzb-bc-label").data(r),this.entityBars.exit().remove(),this.entityLabels.exit().remove();var h=this._highlightBar.bind(this),d=this._unhighlightBars.bind(this);this.entityBars.enter().append("g").attr("class","vzb-bc-bar").attr("id",function(t){return"vzb-bc-bar-"+t[i]}).on("mouseover",h).on("mouseout",d).on("click",function(e,i){ve()||t.model.age.selectEntity(e)}).onTap(function(e){d3.event.stopPropagation(),t.model.age.selectEntity(e)}).append("rect"),this.entityLabels.enter().append("g").attr("class","vzb-bc-label").attr("id",function(t){return"vzb-bc-label-"+t[i]}).append("text").attr("class","vzb-bc-age");var u=this.height/(c[1]-c[0]),m=u*s,g=this.height-m;this.bars.selectAll(".vzb-bc-bar > rect").attr("fill",function(e){return t._temporaryBarsColorAdapter(o,e,i)}).attr("shape-rendering","crispEdges").attr("x",0).transition().duration(n).ease("linear").attr("y",function(t,e){return g-(t[i]-c[0])*u}).attr("height",m).attr("width",function(e){return t.xScale(o.axis_x[e[i]])}),this.labels.selectAll(".vzb-bc-label > .vzb-bc-age").text(function(a,n){var l=t.model.marker.axis_x.getTickFormatter(),r=t.translator("popbyage/yearOldsIn"),c=parseInt(a[i],10);return s>1&&(c=c+"-to-"+(c+s-1)),c+r+" "+t.model.time.timeFormat(e.value)+": "+l(o.axis_x[a[i]])}).attr("x",7).attr("y",function(t,e){return g-(t[i]-c[0])*u-10}).style("fill",function(e){var a=t.cScale(o.color[e[i]]);return d3.rgb(a).darker(2)});var p=Gt(o.label_name).reverse()[0];p="usa"===p?"United States":"Sweden",this.title.text(p),this.year.text(this.model.time.timeFormat(this.model.time.value));var f=this.model.marker.axis_x.getLimits(this.model.marker.axis_x.which);if(1==s)this.xScale=this.xScale.domain([f.min,f.max]);else{var o=Gt(o.axis_x);o.push(f.max),this.xScale=this.xScale.domain([f.min,Math.max.apply(Math,o)])}this.resize()},_temporaryBarsColorAdapter:function(t,e,i){return this.cScale(t.color[e[i]])},_unhighlightBars:function(){ve()||(this.bars.classed("vzb-dimmed",!1),this.bars.selectAll(".vzb-bc-bar.vzb-hovered").classed("vzb-hovered",!1),
this.labels.selectAll(".vzb-hovered").classed("vzb-hovered",!1))},_highlightBar:function(t){if(!ve()){this.bars.classed("vzb-dimmed",!0);var e=this.bars.select("#vzb-bc-bar-"+t[this.AGEDIM]);e.classed("vzb-hovered",!0);var i=this.labels.select("#vzb-bc-label-"+t[this.AGEDIM]);i.classed("vzb-hovered",!0)}},_selectBars:function(){var t=this,e=this.AGEDIM,i=this.model.age.select;this._unselectBars(),i.length&&(this.bars.classed("vzb-dimmed-selected",!0),xt(i,function(i){t.bars.select("#vzb-bc-bar-"+i[e]).classed("vzb-selected",!0),t.labels.select("#vzb-bc-label-"+i[e]).classed("vzb-selected",!0)}))},_unselectBars:function(){this.bars.classed("vzb-dimmed-selected",!1),this.bars.selectAll(".vzb-bc-bar.vzb-selected").classed("vzb-selected",!1),this.labels.selectAll(".vzb-selected").classed("vzb-selected",!1)},resize:function(){this.profiles={small:{margin:{top:70,right:20,left:40,bottom:40},minRadius:2,maxRadius:40},medium:{margin:{top:80,right:60,left:60,bottom:40},minRadius:3,maxRadius:60},large:{margin:{top:100,right:60,left:60,bottom:40},minRadius:4,maxRadius:80}},this.activeProfile=this.profiles[this.getLayoutProfile()];var t=this.activeProfile.margin;return this.height=parseInt(this.element.style("height"),10)-t.top-t.bottom||0,this.width=parseInt(this.element.style("width"),10)-t.left-t.right||0,this.height<=0||this.width<=0?Ft("Pop by age resize() abort: vizabi container is too little or has display:none"):(this.graph.attr("transform","translate("+t.left+","+t.top+")"),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range([this.height,0]):this.yScale.rangePoints([this.height,0]).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range([0,this.width]):this.xScale.rangePoints([0,this.width]).range(),this.yAxis.scale(this.yScale).orient("left").tickSize(6,6).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:t,limitMaxTickNumber:6}),this.xAxis.scale(this.xScale).orient("bottom").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:t,limitMaxTickNumber:6}),this.xAxisEl.attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.yAxisEl.call(this.yAxis),this.title.attr("x",t.right).attr("y",t.top/2),void this.year.attr("x",this.width+t.left).attr("y",t.top/2))}}),Zn=Hi.extend("PopByAge",{init:function(t,e){this.name="popbyage",this.components=[{component:Qn,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.entities_age","state.marker","language"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"]},{component:ln,placeholder:".vzb-tool-dialogs",model:["state","ui","language"]},{component:Ua,placeholder:".vzb-tool-buttonlist",model:["state","ui","language"]},{component:ra,placeholder:".vzb-tool-treemenu",model:["state.marker","language"]}],this._super(t,e)}}),Jn=ni.extend({init:function(t,e){this.name="agepyramid",this.template="agepyramid.html",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"side",type:"entities"},{name:"stack",type:"entities"},{name:"age",type:"entities"},{name:"marker",type:"model"},{name:"marker_side",type:"model"},{name:"language",type:"language"},{name:"ui",type:"model"}];var i=this;this.model_binds={"change:time.value":function(t){if(i._readyOnce){if(1!=i.model.time.step&&!i.snapped&&!i.model.time.playing&&!i.model.time.dragging){var e=d3.bisectLeft(i.timeSteps,i.model.time.value);if(0!=e&&i.timeSteps[e]-i.model.time.value){i.snapped=!0;var a=i.model.time.value,n=i.timeSteps[e-1],e=i.timeSteps[e],s=e-a>a-n?n:e;i.model.time.value=new Date(s)}}i.snapped||i._updateEntities(),i.snapped=!1}},"change:entities.show":function(t){console.log("Trying to change show")},"change:stack.select":function(t){i._selectBars()},"change:marker.color.palette":function(t){i._readyOnce&&i._updateEntities()},"change:marker.color.scaleType":function(t){i._readyOnce&&i._updateEntities()},"change:ui.chart.inpercent":function(t){i._readyOnce&&(i._updateLimits(),i.resize(),i._updateEntities())}},this._super(t,e),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=L(),this.xAxisLeft=L(),this.yAxis=L(),this.xScales=[],this.totalFieldName="Total"},readyOnce:function(){this.el=this.el?this.el:d3.select(this.element),this.element=this.el,this.interaction=this._interaction(),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.xAxisLeftEl=this.graph.select(".vzb-bc-axis-x-left"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.barsCrop=this.graph.select(".vzb-bc-bars-crop"),this.bars=this.graph.select(".vzb-bc-bars"),this.labels=this.graph.select(".vzb-bc-labels"),this.title=this.element.select(".vzb-bc-title"),this.titleRight=this.element.select(".vzb-bc-title-right"),this.year=this.element.select(".vzb-bc-year"),this.model.age.selectMultiple(!0);var t=this;this.on("resize",function(){t._updateEntities()})},ready:function(){this.timeSteps=this.model.time.getAllSteps(),this.shiftScale=d3.scale.linear().domain([this.timeSteps[0],this.timeSteps[this.timeSteps.length-1]]).range([0,this.timeSteps.length-1]),this.SIDEDIM=this.model.marker.side.which,this.STACKDIM=this.model.stack.getDimension()||this.model.marker.color.which,this.AGEDIM=this.model.age.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.updateUIStrings(),this._updateIndicators(),this._updateLimits(),this._createStepData(this.model.marker.axis_x),this.resize(),this._updateEntities(),this._selectBars()},updateUIStrings:function(){this.translator=this.model.language.getTFunction();var t=this.translator("indicator/"+this.model.marker.axis_y.which),e=this.yTitleEl.selectAll("text").data([0]);e.enter().append("text"),e.attr("y","-6px").attr("x","-9px").attr("dx","-0.72em").text(t)},_updateIndicators:function(){var t=this;this.duration=this.model.time.delayAnimations,this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(!1),this.yAxis.tickFormat(t.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(t.model.marker.axis_x.getTickFormatter()),this.xAxisLeft.tickFormat(t.model.marker.axis_x.getTickFormatter());var e=this.SIDEDIM,i=this.STACKDIM,a=this.AGEDIM,n=this.model.age.grouping||1,s=this.model.marker.getKeys(a),l=[];l=s.map(function(t){return t[a]}),this.ageKeys=l,this.shiftedAgeKeys=this.timeSteps.map(function(t,e){return-e*n}).slice(1).reverse().concat(l);var r=this.model.marker.getKeys(e),o=[];o=r.map(function(t){return t[e]});var c=this.model.side.getFilter;if(c[e]&&"*"!=c[e][0]&&(o=o.filter(function(i){var a={};return a[e]=i,t.model.side.isShown(a)})),o.length>1){var h=this.ui.chart.flipSides?d3.ascending:d3.descending;o.sort(h)}o.length>2&&(o.length=2),this.sideKeys=o;var d=this.model.marker.getKeys(i),u=[],u=kt(d.map(function(e){return e[i]==t.totalFieldName&&(t.dataWithTotal=!0),e[i]}),this.totalFieldName),m=Ut(this.model.marker.color.getPalette()).reduce(function(t,e){return-1!=u.indexOf(e)&&t.push(e),t},[]);if(m.length!=u.length&&(m=u.reduce(function(t,e){return-1==t.indexOf(e)&&t.push(e),t},m)),this.stackKeys=m,this.stacked=this.ui.chart.stacked&&"constant"!=this.model.marker.color.use&&this.model.stack.getDimension(),this.twoSided=this.sideKeys.length>1,this.twoSided)this.xScaleLeft=this.xScale.copy(),this.title.text(this.sideKeys[1]),this.titleRight.text(this.sideKeys[0]);else{var g=this.translator("indicator/"+this.model.marker.axis_x.which);this.title.text(g)}this.cScale=this.model.marker.color.getScale()},_updateLimits:function(){var t,e,i=this,a=this.model.marker.axis_x;if(this.ui.chart.inpercent){t=a.getLimitsByDimensions([this.SIDEDIM,this.TIMEDIM,this.AGEDIM,this.STACKDIM]);var n=this.model.marker_side.hook_total.getLimitsByDimensions([this.SIDEDIM,this.TIMEDIM]),s=this.dataWithTotal?.5:1,l=a.getUnique(),r=[];xt(i.sideKeys,function(e){xt(l,function(a){xt(i.ageKeys,function(l){var o=0;xt(i.stackKeys,function(i){t[e][a][l][i]&&(o+=t[e][a][l][i].max)}),r.push(o/(n[e][a].max*s))})})}),e=[0,Math.max.apply(Math,r)]}else{t=a.getLimitsByDimensions([this.SIDEDIM,this.TIMEDIM,this.AGEDIM,this.STACKDIM]);var l=a.getUnique(),r=[];xt(i.sideKeys,function(e){xt(l,function(a){xt(i.ageKeys,function(n){var s=0;xt(i.stackKeys,function(i){t[e][a][n][i]&&(s+=t[e][a][n][i].max)}),r.push(s)})})}),e=null!=a.domainMin&&null!=a.domainMax?[+a.domainMin,+a.domainMax]:[0,Math.max.apply(Math,r)]}this.xScale.domain(e),this.xScaleLeft&&this.xScaleLeft.domain(this.xScale.domain())},getShiftedValues:function(t,e){var i=function(t,e,a,n){e--,xt(t,function(t,s){e?(a[s]={},i(t,e,a[s],n)):n(t,a,s)})},a=t.which,n=t.use,s=this.TIMEDIM,l={},r=t.getConceptprops?t.getConceptprops().interpolation:null;return i(this.stepData,this.stepDataDeep,l,function(i,l,o){var c=d3.bisectLeft(i.map(function(t){return t[s]}),e),h=de(i,n,a,c,s,e,r);l[o]=t.mapValue(h)}),l},_createStepData:function(t){var e=this,i=this.TIMEDIM,a=this.SIDEDIM,n=this.STACKDIM,s=this.AGEDIM;this.stepData={};var l=0,r=this.model.age.grouping||1,o=[s,a,n];this.stepDataDeep=o.length,xt(this.timeSteps,function(t,a){var n={};n[i]=t;var s=e.model.marker.getValues(n,o).axis_x,c=e.stepData[t]={};xt(e.shiftedAgeKeys,function(t){var e=+t+l,i=s[e];i||(0>e?i=s[0]:c["null"]=s[0]),c[t]=i}),l+=r});var c=this.stepData,h={},d=t.which;t.use;xt(c,function(t,e){xt(t,function(t,a){var n=!1;"null"!=a&&(t||0==t||(t=c[e]["null"],n=!0),xt(t,function(t,s){xt(t,function(t,l){var r=h[a]||{},o=r[s]||{},c=o[l]||[],u={};u[i]=new Date(e),u[d]=n?0:t,c.push(u),o[l]=c,r[s]=o,h[a]=r})}))})}),this.stepData=h},_updateEntities:function(){var t=this,e=this.model.time,i=this.SIDEDIM,a=this.AGEDIM,n=this.STACKDIM,s=this.TIMEDIM,l=e.playing?e.delayAnimations:0,r=this.getShiftedValues(this.model.marker.axis_x,e.value),o=this.model.age.grouping||1;if(this.ui.chart.inpercent){var c={};c[s]=e.value,this.totalValues=this.model.marker_side.getValues(c,[this.SIDEDIM]).hook_total,this.dataWithTotal&&xt(this.sideKeys,function(e){t.totalValues[e]*=.5})}var h=this.model.marker.getKeys(a),d=this.yScale.domain();this.model.age.setVisible(h);var u=d3.bisectLeft(this.timeSteps,e.value),m="s_age",g=h.map(function(t){return t[m]=+t[a],t[a]=t[m]-u*o,t}),p={};p[m]=h.length*o,p[a]=p[m]-u*o,u&&g.push(p),this.entityBars=this.bars.selectAll(".vzb-bc-bar").data(g,function(t){return t[a]}),this.entityLabels=this.labels.selectAll(".vzb-bc-label").data(h),this.entityBars.exit().remove(),this.entityLabels.exit().remove();var f=this.height/(d[1]-d[0]),v=f*o,b=this.height-v;this.entityBars.enter().append("g").attr("class",function(t){return"vzb-bc-bar vzb-bc-bar-"+t[a]}),this.entityBars.attr("class",function(t){return"vzb-bc-bar vzb-bc-bar-"+t[a]}),this.sideBars=this.entityBars.selectAll(".vzb-bc-side").data(function(e){return t.sideKeys.map(function(t){var n={};return n[a]=e[a],n[m]=e[m],n[i]=t,n})}),this.sideBars.exit().remove(),this.sideBars.enter().append("g").attr("class",function(e,i){return"vzb-bc-side vzb-bc-side-"+(!i!=!t.twoSided?"right":"left")});var y=this.sideBars.selectAll(".vzb-bc-stack").data(function(e,s){var l=t.stacked?t.stackKeys:[t.totalFieldName];return l.map(function(t){var s={};return s[a]=e[a],s[m]=e[m],s[i]=e[i],s[n]=t,s})});y.exit().remove(),y.enter().append("rect").attr("class",function(e,i){return"vzb-bc-stack vzb-bc-stack-"+i+(t.highlighted?" vzb-dimmed":"")}).attr("y",0).on("mouseover",t.interaction.highlightBar).on("mouseout",t.interaction.unhighlightBars).on("click",function(e,i){ve()||t.model.stack.selectEntityMD(e)}).onTap(function(e){d3.event.stopPropagation(),t.model.stack.selectEntityMD(e)}),this.stackBars=this.bars.selectAll(".vzb-bc-bar").selectAll(".vzb-bc-side").attr("transform",function(e,i){return i?"scale(-1,1) translate("+t.activeProfile.centerWidth+",0)":""}).selectAll(".vzb-bc-stack").attr("height",v).attr("fill",function(e){return t.cScale(e[n])}).each(function(e,s){var l=t.ui.chart.inpercent?t.totalValues[e[i]]:1,o=0;if(t.stacked)o=r[e[a]][e[i]][e[n]];else{var c=r[e[a]][e[i]];xt(c,function(t){o+=t})}e.width_=t.xScale(o/l);var h=this.previousSibling;if(h){var d=d3.select(h).datum();e.x_=d.x_+d.width_}else e.x_=0});var x=g[0][m]-g[0][a]-this.shiftScale(e.value)*o;this.bars.selectAll(".vzb-bc-bar").attr("transform",function(t,e){t[m]<0?0:t[a]-o;return"translate(0,"+(b-(t[m]-o-d[0])*f)+")"}).transition("age").duration(l).ease("linear").attr("transform",function(t,e){return"translate(0,"+(b-(t[m]-d[0]-x)*f)+")"}),this.stackBars.interrupt().transition().duration(.95*l).ease("linear").attr("width",function(t,e){return t.width_}).attr("x",function(t,e){return t.x_}),this.entityLabels.enter().append("g").attr("class","vzb-bc-label").attr("id",function(t){return"vzb-bc-label-"+t[m]}).append("text").attr("class","vzb-bc-age"),this.labels.selectAll(".vzb-bc-label > .vzb-bc-age").each(function(e,i){var n=t.translator("agepyramid/yearOlds"),s=parseInt(e[a],10);o>1&&(s=s+"-to-"+(s+o-1)),e.text=s+n}).attr("y",function(t,e){return b-(t[m]-d[0])*f-10}),l?this.year.transition().duration(l).ease("linear").each("end",this._setYear(e.value)):this.year.interrupt().text(e.timeFormat(e.value)),this._selectBars()},_setYear:function(t){var e=this.model.time.timeFormat(t);return function(){d3.select(this).text(e)}},_interaction:function(){var t=this;return{unhighlightBars:function(){ve()||(t.highlighted=!1,t.stackBars.classed("vzb-dimmed",!1).classed("vzb-hovered",!1),t.labels.selectAll(".vzb-hovered").classed("vzb-hovered",!1))},highlightBar:function(e){if(!ve()){t.highlighted=!0;var i=t.ui.chart.inpercent?d3.format(".1%"):t.model.marker.axis_x.getTickFormatter(),a=t.SIDEDIM,n=(t.AGEDIM,t.STACKDIM),s="s_age";t.stackBars.classed("vzb-dimmed",!0);var l=d3.select(this);l.classed("vzb-hovered",!0);var r=t.sideKeys.indexOf(e[a]),o=t.labels.select("#vzb-bc-label-"+e[s]);o.selectAll(".vzb-bc-age").text(function(a){var s=t.stackKeys.length>1?e[n]:a.text;s=t.twoSided?s:a.text+" "+e[n];var l=t.xScale.invert(e.width_);return s+": "+i(l)}).attr("x",(r?-1:1)*(.5*t.activeProfile.centerWidth+7)).classed("vzb-text-left",r),o.classed("vzb-hovered",!0)}}}},_selectBars:function(){var t=this,e=this.STACKDIM,i=this.AGEDIM,a=this.SIDEDIM,n=this.model.stack.select;this._unselectBars(),n.length&&(this.stackBars.classed("vzb-dimmed-selected",!0),xt(n,function(n){var s=t.stacked?t.sideKeys.indexOf(n[a]):0,l=t.stacked?t.stackKeys.indexOf(n[e]):0,r=t.twoSided!=!s?"left":"right";t.bars.selectAll(".vzb-bc-bar-"+n[i]).selectAll(".vzb-bc-side-"+r).selectAll(".vzb-bc-stack-"+l).classed("vzb-selected",!0)}))},_unselectBars:function(){this.stackBars.classed("vzb-dimmed-selected",!1),this.stackBars.classed("vzb-selected",!1)},presentationProfileChanges:{medium:{margin:{right:80,bottom:80},infoElHeight:32},large:{margin:{top:100,right:100,left:100,bottom:80},infoElHeight:32}},profiles:{small:{margin:{top:70,right:20,left:40,bottom:40},minRadius:2,maxRadius:40,centerWidth:2},medium:{margin:{top:80,right:60,left:60,bottom:40},minRadius:3,maxRadius:60,centerWidth:2},large:{margin:{top:100,right:60,left:60,bottom:40},minRadius:4,maxRadius:80,centerWidth:2}},resize:function(){var t=this;this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var e=this.activeProfile.margin;if(this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.height<=0||this.width<=0)return Ft("Pop by age resize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")"),this.barsCrop.attr("width",this.width).attr("height",this.height),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range([this.height,0]):this.yScale.rangePoints([this.height,0]).range();var i=this.twoSided?.5*(this.width-this.activeProfile.centerWidth):this.width;"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range([0,i]):this.xScale.rangePoints([0,i]).range(),this.yAxis.scale(this.yScale).orient("left").tickSize(6,6).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:e,limitMaxTickNumber:19});var a=this.model.age.grouping||1,n=this.ui.chart.inpercent?d3.format((a>3?"":".1")+"%"):this.model.marker.axis_x.getTickFormatter();this.xAxis.scale(this.xScale).orient("bottom").tickFormat(n).tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:e,limitMaxTickNumber:6});var s=this.twoSided?.5*(this.width+t.activeProfile.centerWidth):0;this.xAxisEl.attr("transform","translate("+s+","+this.height+")").call(this.xAxis),this.yAxisEl.attr("transform","translate(0,0)").call(this.yAxis),this.xScaleLeft&&("ordinal"!==this.model.marker.axis_x.scaleType?this.xScaleLeft.range([.5*(this.width-this.activeProfile.centerWidth),0]):this.xScaleLeft.rangePoints([.5*(this.width-this.activeProfile.centerWidth),0]).range(),this.xAxisLeft.scale(this.xScaleLeft).orient("bottom").tickFormat(n).tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:e,limitMaxTickNumber:6}),this.xAxisLeftEl.attr("transform","translate(0,"+this.height+")").call(this.xAxisLeft)),this.bars.attr("transform","translate("+s+",0)"),this.labels.attr("transform","translate("+s+",0)"),this.title.attr("x",e.left+(this.twoSided?s-5:0)).style("text-anchor",this.twoSided?"end":"null").attr("y",e.top/2),this.titleRight.attr("x",e.left+s+5).attr("y",e.top/2),this.year.attr("x",this.width+e.left).attr("y",e.top/2)}}),$n=Hi.extend("AgePyramid",{init:function(t,e){this.name="agepyramid",this.components=[{component:Jn,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.entities_side","state.entities_stack","state.entities_age","state.marker","state.marker_side","language","ui"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"]},{component:ln,placeholder:".vzb-tool-dialogs",model:["state","ui","language"]},{component:Ua,placeholder:".vzb-tool-buttonlist",model:["state","ui","language"]},{component:ra,placeholder:".vzb-tool-treemenu",model:["state.marker","language"]}],this._super(t,e)},default_model:{ui:{chart:{inpercent:!1,stacked:!0}}}}),ts=Hi.extend("JOINTPyramidLine",{init:function(t,e){this.name="joint_pyramidline",this.template='<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-stage vzb-tool-stage-left" style="position:absolute; left: 0; width: 50%; height: 100%;"><div class="vzb-tool-viz vzb-tool-viz-pyramid"></div></div><div class="vzb-tool-stage vzb-tool-stage-right" style="position:absolute; right: 0; width: 50%; height: 100%;"><div class="vzb-tool-viz vzb-tool-viz-line"></div><div class="vzb-tool-timeslider"></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-datanotes vzb-hidden"></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-datawarning vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>',this.components=[{component:Jn,placeholder:".vzb-tool-viz-pyramid",model:["state.time","state.entities","state.entities_side","state.entities_stack","state.entities_age","state.marker_pyramid","state.marker_side","language","ui"]},{component:Vn,placeholder:".vzb-tool-viz-line",model:["state.time","state.entities","state.marker_line","language"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker_pyramid"]}],this._super(t,e)}}),es=ni.extend({init:function(t,e){this.name="cartogram",this.template="cartogram.html";var i=function(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t};this.isMobile=i(),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"language",type:"language"},{name:"ui",type:"model"}];var a=this;this.model_binds={"change:time.value":function(t){a._readyOnce&&(a.year.setText(a.model.time.timeFormat(a.model.time.value)),a.calculationQueue?a.calculationQueue.push(a.model.time.value.toString()):a.calculationQueue=[a.model.time.value.toString()],function(t){a.model.marker.getFrame(t,function(t,e){var i=a.calculationQueue.indexOf(e.toString());-1!=i&&(a.calculationQueue.splice(0,i+1),a.frameChanged(t,e))})}(a.model.time.value))},"change:marker.size.extent":function(t,e){a._readyOnce&&(a.updateMarkerSizeLimits(),a.updateEntities())},"change:marker.color.scaleType":function(t,e){a.updateIndicators(),a.updateEntitityColor()},"change:marker.size.use":function(t,e){a.model.ui.chart.lockActive="constant"!=a.model.marker.size.use},"change:marker.color.palette":function(t,e){a.updateEntitityColor()},"change:ui.chart.lockNonSelected":function(t){a.updateEntities(900)},"change:entities.select":function(){a._readyOnce&&a.updateLandOpacity()},"change:entities.highlight":function(){a._readyOnce&&a.updateLandOpacity()},"change:entities.opacitySelectDim":function(){a.updateLandOpacity()},"change:entities.opacityRegular":function(){a.updateLandOpacity()}},this._super(t,e),a.COLOR_LAND_DEFAULT="#fdfdfd",this.lands=null,this.features=null,this.topo_features=null,this.borderArcs=null,this.defaultWidth=700,this.defaultHeight=550,this.updateEntitiesQueue=[],this.boundBox=[[.05,0],[.95,1]],q(),this.cached=[],this.projection=d3.geo.mercator().center([25,-29]).scale(1900).translate([this.defaultWidth/2,this.defaultHeight/2]).precision(.1),this.cartogram=d3.cartogram().projection(this.projection).properties(function(t){return t.properties})},afterPreload:function(){var t=this;this.world||Ft("cartogram afterPreload: missing country shapes "+this.world),this.geometries||Ft("cartogram afterPreload: missing country shapes "+this.geometries),this.borderArcs=t.cartogram.meshArcs(this.world,this.world.objects.topo,function(t,e){return t.properties.MN_NAME&&t.properties.PR_NAME!==e.properties.PR_NAME}),this.labels=this.parent.findChildByName("gapminder-labels"),this.labels&&this.labels.config({CSS_PREFIX:"vzb-ct",TOOL_CONTEXT:this,LABELS_CONTAINER_CLASS:"vzb-ct-labels",LINES_CONTAINER_CLASS:"vzb-ct-lines"})},_getKey:function(t){return t.properties[this.id_lookup]?t.properties[this.id_lookup].toString():t.id.toString()},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-ct-graph"),this.mapSvg=this.element.select(".vzb-ct-map-background"),this.labelsContainerCrop=this.graph.select(".vzb-ct-labels-crop"),this.labelsContainer=this.graph.select(".vzb-ct-labels"),this.yTitleEl=this.graph.select(".vzb-ct-axis-y-title"),this.sTitleEl=this.graph.select(".vzb-ct-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-ct-axis-y-info"),this.sInfoEl=this.graph.select(".vzb-ct-axis-c-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.entityBubbles=null,this.tooltip=this.element.select(".vzb-ct-tooltip"),this.yearEl=this.graph.select(".vzb-ct-year"),this.year=new Tn(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom",bottomOffset:5}),this.mapGraph=this.element.select(".vzb-ct-map-graph").attr("width",this.defaultWidth).attr("height",this.defaultHeight),this.mapGraph.html(""),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension();var t=this;this.updateUIStrings(),this.on("resize",function(){t.updateSize()}),this.wScale=d3.scale.linear().domain(this.parent.datawarning_content.doubtDomain).range(this.parent.datawarning_content.doubtRange),this.cartogram.iterations(0),this.redrawInProgress=!0,this.cartogram(this.world,this.geometries).then(function(e){if(t.redrawInProgress=!1,t.features=t.topo_features=e.features,t.lands=t.mapGraph.selectAll(".land").data(t.topo_features).enter().append("path").attr("class",function(e){return"land "+(e.properties[t.id_lookup]?e.properties[t.id_lookup]:e.id)}).attr("d",t.cartogram.path).on("mouseover",function(e,i){ve()||t._interact()._mouseover(e,i)}).on("mouseout",function(e,i){ve()||t._interact()._mouseout(e,i)}).on("click",function(e,i){ve()||t._interact()._click(e,i)}).each(function(e){e[t.KEY]=t._getKey(e)}),t.borderArcs){var i=t.cartogram.stitchArcs(e,t.borderArcs);t.borders=t.mapGraph.append("path").datum(i).attr("class","boundary").attr("d",t.cartogram.path)}})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateTitleNumbers(),this.updateEntities(this.duration))},ready:function(){var t=this;this.cached=[],this.updateIndicators(),this.updateUIStrings(),this.updateMarkerSizeLimits(),this.updateSize(),this.model.marker.getFrame(t.model.time.value,t.frameChanged.bind(t)),this.year.setText(t.model.time.timeFormat(t.model.time.value))},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale()},updateMarkerSizeLimits:function(){var t=this.model.marker.size.extent||[0,1];this.minRadius=Math.max(100*t[0],0),this.maxRadius=Math.max(100*t[1],0),this.sScale.domain([0,this.sScale.domain()[1]]),"ordinal"!==this.model.marker.size.scaleType?this.sScale.range([this.minRadius,this.maxRadius]):this.sScale.rangePoints([this.minRadius,this.maxRadius],0).range()},_calculateTotalSize:function(t,e){if(this.cached[t])return this.cached[t];var i=this;return this.cached[t]=0,xt(e,function(e){i.cached[t]+=i.sScale(e)}),this.cached[t]},_redrawEntities:function(){var t=this;if(0!=this.updateEntitiesQueue.length){if(this.redrawInProgress)return void setTimeout(function(){t._redrawEntities()},100);this.redrawInProgress=!0;var e=this.updateEntitiesQueue[this.updateEntitiesQueue.length-1].time,i=this.updateEntitiesQueue[this.updateEntitiesQueue.length-1].duration;this.updateEntitiesQueue=[],this.model.ui.chart.lockNonSelected&&(e=this.model.time.timeFormat.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(e,function(e){var a=null;"constant"==t.model.marker.size.use?t.cartogram.iterations(0):(t.cartogram.iterations(8),t.cartogram.value(function(i){if(t.model.ui.chart.lockNonSelected){var a=t.sScale(e.size[t._getKey(i)]),n=t.sScale(t.values.size[t._getKey(i)]);return d3.geo.path().projection(null).area(i)*Math.pow(n/a,2)}return t.sScale(t.values.size[t._getKey(i)])}));var n=(new Date).getTime();t.cartogram(t.world,t.geometries,a).then(function(e){var a=(new Date).getTime();if(i&&(i=Math.max(i,a-n)),t.features=e.features,t.borderArcs){var s=t.cartogram.stitchArcs(e,t.borderArcs);t.borders.datum(s).transition().duration(i).ease("linear").attr("d",t.cartogram.path)}t.lands.data(t.features).each(function(e){e[t.KEY]=t._getKey(e)}),i?(t.lands.interrupt().transition().duration(i).ease("linear").style("fill",function(e){return null!=t.values.color[t._getKey(e)]?t.cScale(t.values.color[t._getKey(e)]):t.COLOR_LAND_DEFAULT}).attr("d",t.cartogram.path),t.borderArcs&&t.borders.interrupt().transition().duration(i).ease("linear").attr("d",t.cartogram.path)):(t.borders.attr("d",t.cartogram.path),t.lands.style("fill",function(e){return null!=t.values.color[t._getKey(e)]?t.cScale(t.values.color[t._getKey(e)]):t.COLOR_LAND_DEFAULT}).attr("d",t.cartogram.path)),t.updateLandOpacity(),t.redrawInProgress=!1,t._redrawEntities()})})}},updateEntities:function(t){var e=this.model.time.value;this.updateEntitiesQueue.push({time:e,duration:t}),this._redrawEntities()},updateEntitityColor:function(){var t=this;this.lands.transition().duration(t.duration).ease("linear").style("fill",function(e){return null!=t.values.color[t._getKey(e)]?t.cScale(t.values.color[t._getKey(e)]):t.COLOR_LAND_DEFAULT})},updateUIStrings:function(){var t=this;this.translator=this.model.language.getTFunction();this.model.marker.size.getConceptprops();this.strings={title:{C:("constant"!==t.model.marker.size.use?this.translator("buttons/color")+": ":"")+this.translator("indicator/"+t.model.marker.color.which),S:this.translator("buttons/size")+": "+this.translator("indicator/"+t.model.marker.size.which)}},this.yTitleEl.select("text").text(this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX("left").alignY("top").updateView().toggle()}),this.sTitleEl.select("text").text(this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX("left").alignY("top").updateView().toggle()}),ye(this.dataWarningEl,Mi).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(Si).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=a(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(i.x,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.sInfoEl.html(Si).select("svg").attr("width","0px").attr("height","0px"),this.sInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.sInfoEl.on("mouseover",function(){var e=this.getBBox(),i=a(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(i.x,i.y)}),this.sInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0;
},updateSize:function(){var t,e,i={small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22}},a={medium:{infoElHeight:26},large:{infoElHeight:32}};this.activeProfile=this.getActiveProfile(i,a),t=this.activeProfile.margin,e=this.activeProfile.infoElHeight;var n=this.height=parseInt(this.element.style("height"),10)-t.top-t.bottom||0,s=this.width=parseInt(this.element.style("width"),10)-t.left-t.right||0;if(this.height<=0||this.width<=0)return Ft("Bubble map updateSize() abort: vizabi container is too little or has display:none");var l=this.boundBox,r=[l[0][0]*this.defaultWidth,l[0][1]*this.defaultHeight,Math.abs(l[1][0]-l[0][0])*this.defaultWidth,Math.abs(l[1][1]-l[0][1])*this.defaultHeight];this.graph.attr("transform","translate("+t.left+","+t.top+")"),this.year.resize(this.width,this.height,Math.min(this.width/2.5,Math.max(this.height/4,this.width/4))/2.5),this.mapSvg.attr("width",s).attr("height",n).attr("viewBox",r.join(" ")).attr("preserveAspectRatio","xMidYMid").attr("x",t.left).attr("y",t.top).style("transform","translate3d("+t.left+"px,"+t.top+"px,0)"),this.yTitleEl.style("font-size",e).attr("transform","translate(0,"+t.top+")");var o=this.yTitleEl.select("text").node().getBBox();this.sTitleEl.attr("transform","translate(0,"+(t.top+o.height)+")").classed("vzb-hidden","constant"==this.model.marker.size.use);var c=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*c.height).attr("height",.75*c.height).attr("x",-c.width-1.2*c.height).attr("y",.65*-c.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*c.height)+")").select("text"),this.yInfoEl.select("svg").node()){var h=this.yTitleEl.node().getBBox(),d=d3.transform(this.yTitleEl.attr("transform")).translate;this.yInfoEl.select("svg").attr("width",e).attr("height",e),this.yInfoEl.attr("transform","translate("+(h.x+d[0]+h.width+.4*e)+","+(d[1]-.8*e)+")")}if(this.sInfoEl.classed("vzb-hidden",this.sTitleEl.classed("vzb-hidden")),!this.sInfoEl.classed("vzb-hidden")&&this.sInfoEl.select("svg").node()){var h=this.sTitleEl.node().getBBox(),d=d3.transform(this.sTitleEl.attr("transform")).translate;this.sInfoEl.select("svg").attr("width",e).attr("height",e),this.sInfoEl.attr("transform","translate("+(h.x+d[0]+h.width+.4*e)+","+(d[1]-.8*e)+")")}},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text").style("font-size",null),e=this.sTitleEl.select("text").style("font-size",null),i=t.node().getBBox(),a=this.sTitleEl.classed("vzb-hidden")?i:e.node().getBBox(),n=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(i.width,a.width);Math.max(i.width,a.width)>this.width?(t.style("font-size",n+"px"),e.style("font-size",n+"px")):(t.style("font-size",null),e.style("font-size",null))},_interact:function(){var t=this;return{_mouseover:function(e,i){t.model.time.dragging||(t.model.entities.highlightEntity(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.entities.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,i){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.entities.clearHighlighted())},_click:function(e,i){t.model.entities.selectEntity(e)}}},updateTitleNumbers:function(){var t,e=this;if(e.isMobile&&e.model.entities.select&&1===e.model.entities.select.length&&(t=e.model.entities.select[0]),e.hovered||t){var i=e.hovered||t,a=e.model.marker.color.getTickFormatter(),n=e.translator("unit/"+e.model.marker.color.which);n==="unit/"+e.model.marker.color.which&&(n="");var s=e.values.color[e._getKey(i)];if(e.yTitleEl.select("text").text(this.strings.title.C+": "+(s||0===s?a(s)+" "+n:e.translator("hints/nodata"))),"constant"!==this.model.marker.size.use){var l=e.model.marker.size.getTickFormatter(),r=e.translator("unit/"+e.model.marker.size.which);r==="unit/"+e.model.marker.size.which&&(r="");var o=e.values.size[e._getKey(i)];e.sTitleEl.select("text").text(this.strings.title.S+": "+l(o)+" "+r)}this.yInfoEl.classed("vzb-hidden",!0),this.sInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.strings.title.C),this.sTitleEl.select("text").text(this.strings.title.S),this.yInfoEl.classed("vzb-hidden",!1),this.sInfoEl.classed("vzb-hidden",!1)},_setTooltip:function(t){if(t){var e,i,a=this.values.label[this._getKey(t)]?this.values.label[this._getKey(t)]:t.properties.MN_NAME,n=10,s=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),l=s[0],r=s[1],o=-1,c=-1,h=0,d=0;n&&(h=.71*n,d=.71*n),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(a);var u=this.tooltip.select("text")[0][0].getBBox();l-h-u.width<0?(o=1,l+=u.width+5):l-=5,r-d-u.height<0?(c=1,r+=u.height):r-=11,n?(e=l+h*o,i=r+d*c):(e=l+h*o,i=r+d*c),this.tooltip.attr("transform","translate("+(e?e:s[0])+","+(i?i:s[1])+")"),this.tooltip.select("rect").attr("width",u.width+8).attr("height",1.2*u.height).attr("x",-u.width-4).attr("y",.85*-u.height).attr("rx",.2*u.height).attr("ry",.2*u.height)}else this.tooltip.classed("vzb-hidden",!0)},updateLandOpacity:function(){var t=this,e=.8,i=.3,a=this.model.entities.opacityRegular,n=this.model.entities.opacityRegular,s=this.model.entities.opacitySelectDim;this.someHighlighted=this.model.entities.highlight.length>0,this.someSelected=this.model.entities.select.length>0,this.lands.style("opacity",function(l){return t.someHighlighted&&t.model.entities.isHighlighted(l)?e:t.someSelected?t.model.entities.isSelected(l)?a:s:t.someHighlighted?i:n});var l=t.someSelected&&t.model.entities.opacitySelectDim<.01;l!=this.someSelectedAndOpacityZero_1&&this.lands.style("pointer-events",function(e){return!l||t.model.entities.isSelected(e)?"visible":"none"}),this.someSelectedAndOpacityZero_1=t.someSelected&&t.model.entities.opacitySelectDim<.01}}),is=Hi.extend("JOINTCartogramLine",{init:function(t,e){this.name="joint_cartogramline",this.template='<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-stage vzb-tool-stage-left" style="position:absolute; left: 0; width: 65%; height: 100%;"><div class="vzb-tool-viz vzb-tool-viz-cartogram"></div></div><div class="vzb-tool-stage vzb-tool-stage-right" style="position:absolute; right: 0; top: 0; width: 40%; height: 100%;"><div class="vzb-tool-viz vzb-tool-viz-line"></div><div class="vzb-tool-timeslider"></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-datanotes vzb-hidden"></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-datawarning vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>',this.components=[{component:es,placeholder:".vzb-tool-viz-cartogram",model:["state.time","state.entities","state.marker","language","ui"]},{component:Vn,placeholder:".vzb-tool-viz-line",model:["state.time","state.entities_line","state.marker_line","language"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"]},{component:ln,placeholder:".vzb-tool-dialogs",model:["state","ui","language"]},{component:Ua,placeholder:".vzb-tool-buttonlist",model:["state","ui","language"]},{component:ra,placeholder:".vzb-tool-treemenu",model:["state.marker","language"]},{component:on,placeholder:".vzb-tool-datawarning",model:["language"]},{component:fn,placeholder:".vzb-tool-datanotes",model:["state.marker","language"]}],this._super(t,e)},readyOnce:function(){this.element=d3.select(this.element),this.element.select(".vzb-lc-axis-y-title").classed("vzb-hidden",!0),this.element.select(".vzb-lc-axis-x-title").classed("vzb-hidden",!0),this.element.select(".vzb-lc-axis-y-info").classed("vzb-hidden",!0),this.element.select(".vzb-data-warning").classed("vzb-hidden",!0)}}),as=(ni.extend("donut",{init:function(t,e){var i=this;this.name="donutchart",this.template='<div class="vzb-donutchart"><svg class="vzb-donutchart-svg"></svg></div>',this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"model"}],this.model_binds={"change:time:value":function(t){i._readyOnce&&(i.time=i.model.time.value,i.yearEl.text(i.timeFormatter(i.time)),i.redraw())}},this._super(t,e),this.colorScale=null,this.arc=d3.svg.arc(),this.pie=d3.layout.pie().sort(null).value(function(t){return t.pop})},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.svgEl=this.element.select("svg").append("g"),this.yearEl=this.svgEl.append("text").attr("class","year").style({"font-size":"4em"}),this.titleEl=this.svgEl.append("text").attr("class","title").style({"font-size":"2em"}),this.on("resize",function(){t.resize(),t.redraw()}),this.resize(),this.update(),this.redraw()},update:function(){this.timeFormatter=d3.time.format("%Y"),this.colorScale=this.model.marker.color.getScale(),this.titleEl.text("Population"),this.keys=this.model.marker.getKeys(),this.entities=this.svgEl.selectAll(".vzb-dc-entity").data(this.keys),this.entities.exit().remove(),this.entities.enter().append("g").attr("class","vzb-dc-entity").each(function(){d3.select(this).append("path"),d3.select(this).append("text").attr("class","label").style({"font-size":"1.2em"})})},redraw:function(){var t=this;this.values=this.model.marker.getValues({time:t.time},["geo"]);var e=this.keys.map(function(e){return{geo:e.geo,pop:t.values.axis[e.geo],color:t.values.color[e.geo],label:t.values.label[e.geo]}});e=this.pie(e),this.entities.data(e).select("path").attr("d",this.arc).style("fill",function(e){return t.colorScale(e.data.color)}).style("stroke","white"),this.entities.select("text").style({"text-transform":"capitalize"}).attr("transform",function(e){return"translate("+t.arc.centroid(e)+")"}).text(function(t){return t.data.geo})},resize:function(){var t=parseInt(this.element.style("height"),10)||0,e=parseInt(this.element.style("width"),10)||0,i=Math.min(t,e);return 0>=t||0>=e?Ft("Donut chart resize() abort: vizabi container is too little or has display:none"):(this.svgEl.attr("transform","translate("+e/2+","+t/2+")"),this.titleEl.attr("y","-0.1em"),this.yearEl.attr("y","0.1em"),void this.arc.outerRadius(i/2*.9).innerRadius(i/2-.1*i))}}),Hi.extend("DonutChart",{init:function(t,e){this.name="donutchart",this.components=[{component:"donut",placeholder:".vzb-tool-viz",model:["state.time","state.marker"]},{component:"timeslider",placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"]}],this._super(t,e)},default_model:{state:{}}})),ns=Hi.extend("Cartogram",{init:function(t,e){this.name="cartogram",this.components=[{component:es,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","language","ui"]},{component:ba,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker"]},{component:La,placeholder:".vzb-tool-labels",model:["state.entities","state.marker","ui"]},{component:ln,placeholder:".vzb-tool-dialogs",model:["state","ui","language"]},{component:Ua,placeholder:".vzb-tool-buttonlist",model:["state","ui","language"]},{component:ra,placeholder:".vzb-tool-treemenu",model:["state.marker","language"]},{component:on,placeholder:".vzb-tool-datawarning",model:["language"]},{component:fn,placeholder:".vzb-tool-datanotes",model:["state.marker","language"]}],this._super(t,e)},default_model:{state:{time:{},marker:{space:["entities","time"],color:{use:"property",which:"population"}}},ui:{chart:{labels:{dragging:!0},lockNonSelected:0},presentation:!0}}}),ss={},ls={},rs=we.extend({ERROR_NETWORK:"Connection Problem",ERROR_RESPONSE:"Bad Response",ERROR_ORDERING:"Cannot sort response. Column does not exist in result.",ERROR_PARAM_PATH:"Missing base path for waffle reader",init:function(t){this._name="waffle",this._data=[],this._basepath=t.path,this._parsers=t.parsers,this._basepath||Ht(this.ERROR_PARAM_PATH)},read:function(t,e){var i=new l,a=this._basepath;return a+="?"+this._encodeQuery(t),this._data=[],ss.hasOwnProperty(a)?(this._parse(i,t,ss[a]),i):ls.hasOwnProperty(a)?ls[a]:(ls[a]=i,me(a,[],this._readCallbackSuccess.bind(this,i,a,t),this._readCallbackError.bind(this,i,a,t),!0),i)},_encodeQuery:function(t){var e=zt({},t.where);e.select=t.select,e.gapfilling=t.gapfilling,e.geo&&1===e.geo.length&&"*"===e.geo[0]&&delete e.geo;var i=[];return Object.keys(e).map(function(t){var a=os.encodeQuery(e[t]);a&&i.push(t+"="+a)}),i.join("&")},getData:function(){return this._data},_readCallbackSuccess:function(t,e,i,a){return a?(e.indexOf("?geo.cat=world_4region&select=geo,geo.name,shape_lores_svg")>-1&&(Ft("WAFFLE READER: APPLYING STUB FUNCTIONALITY TO GET DATA world_4region, WHICH IS NOT YET IN WS"),a.rows=[["africa","Africa","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 584.5 364.5'><path id='africa' d='M322.7,114.7l-1-1.8l-6.5,2.3l-16-4.8l-2.3,1.7l-1.8,4.5l-16.9-8.6l-0.2-0.6l-0.3-5.5l-2-2.8l-29,4.4l-0.2-0.4 l-1.7,0.2l-0.1,1.1l-6.7,7l-0.5,1.9l-0.6,0.7l-0.3,3.3l-15.3,23.7l0.6,13.2l-1.4,3l1.1,7.6l12.1,17.9l6,2.8l7.1-1.9l4.5,0.8 l13.7-3.3l3.9,4.5h3.5l1.6,1.4l1.8,3.6l-1.1,10.7l9.2,27.4l-4,14.6l8.5,30.7l1.1,1.1v0.7h0.5l3.5,12.5l2,1.7l11.9-0.6l15-18.2v-3.9 l5.1-4.5l1.1-4.2l-1.1-5.9l10.5-12.2l0.6-0.3l1.6-3.7l-3.4-24l25-43.3l-13.1,1.1l-1.8-1.1l-24.7-48.6l0.9-0.4l0.6-1L322.7,114.7  M360.1,233.2l2.3,1.7l-8.6,30.5l-4.3-0.6l-2-7.6l2.8-14.6l6.4-4.4l2.8-4.9L360.1,233.2z'/></svg>"],["americas","Americas","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 584.5 364.5'><path id='americas' d='M134.8,152l-11.4,1.8l-3.1-1.7l5.3-1.3l-0.7-1.1l-3.3-1.4h-0.1l-8.1-0.9l-0.3-0.3l-0.3-1.5l-6.2-3.6l-3.4,0.8 l-1.6,1.3l-1.2-0.5l-0.7-1.7l3.8-1.6l9.1,0.7l9.5,5.3l0,0l3.3,1.8l1.7-0.5l6.6,2.8L134.8,152 M183.7,25.4l-0.5-1.5l-2.6-2.2 l-2.1-0.6l-2.9-2.2l-18.2-2.2l-5.1,3.7l2,4.3l-6,2.2l1-1.7l-4.6-1.9l-0.5-1.7l-1.1-1.2l-2.9,0.5l-2.1,4.2l-5.8,2.5l-15.5-2.2 l10.5-1.7l-1.3-4l-11.6-0.4l-3.2-1.5L96,20.7h5.8l4,1.9l-1.7,1l0.8,1l7.2,2.3l-78.9-5.3l-10,3.6l-0.4,4.4L18,31.1l1,1.8l1.7,1.2 l-5.5,4.5l-0.4,5.6L13.8,46l1.8,1.8l-4.4,6.2L22,43.7l1.8-0.5l1.3-1.2l13.4,4l4,4.2l-1.3,14l1.6,2.6l-3.3,1.3L39.4,70l2.7,2.6 L28.6,96.9l1.6,11.2l4.8,5.6l-0.2,3.4l2.5,6.1l-0.5,5l6.6,11.9L38,121.5l1.7-4l3.4,6.1l0.3,2.2l7.1,13.1l1.1,9.2l11.1,8.7l1.6,0.3 l1.3,0.9l5.5,1.2l3.4-0.9l5.5,4.2l0.3,0.5l0.8,0.3l2.1,1.9l5.5,0.5l0.2,0.6l0.8,0.3l4.8,8.9l2.3,1.5l0.2,0.5l7.1,3.4l1.6-1.7 l-5.1-2.2l-1.3-15.6l-6.3-2.2l-3.7,0.3v-4.6l3.7-8.9l-5.2-0.9l-0.5,0.3L83,151l-6.3,2.2l-4-2.8l-3.2-8.9l3.2-11.8l0.5-0.3l0.2-1.2 l2.6-3.1l8.5-3.6l6.3,1.8l4.5-3.1l9.2,1.1l2.5,3.1l1.5,7.8l1.3,1.8l2.1-4.5l-1.1-5l1.6-7l13.7-12.3l0.2-3.7l0.8-1.7l0.9-0.2l0.7,0.5 l0.6-1.9l15-8.8l2.2-3.9l11.9-5.1l-2.2,3.6l11.4-3.8l-5.2-1.7l-1.8-2.8l1.6-4.2l-0.8-0.9h-4.2l0.8-1.5l19.5-3.2l1.6,2.8l-4.5,4.2 l6,1.7l5.3-2.2l-6.3-7.6l4.5-6.1l-1.1-0.6l-0.2-0.5h-3.2l-3.7-13.4l-7.7,3.1l-1.8-1.9l0.2-3.9l-2.3-2.5l-3.4-1.5l-6.6,1.9l-2.1,4.2 l-1.1,0.6l-1.3,2.2l-0.3,3.4l-10,9.5l-0.8,2.8l-1.8,1.9l-2.1,0.3l-1.8-2.5l1.1-4.8l-11.9-6.1l-3.1-5.1l15-12l1.3,0.3l5.1-1.2 l1.1-1.2l0.4-1.2l3.4-0.3l-1.7,4.8L147,34l4.6,0.7l-2.2-2.9l-2.1-1.2l8.2-2.8l0.3-0.6l2-1.7l0.7,0.1l8.1-4.2l7.4,5.3l0.2,1.5l-6,1.5 l-1.8,2.2l3.7,5.3l3.4,1.2l2.3-2.2l2.9-1.2L179,33l-0.2-1.9l7.7-1.7L183.7,25.4 M119.7,74.5l0.8,3.1l1.7,1.8l3.3-0.2l5.4,4.7 l2.7,0.2l-0.5,1.7l-4.7-0.4l0.2-1.2l-2.6-0.9l-2,0.6l-2.6,3.4l3.1,1.7l-3.2,2.3l-2.6-1.2l0.1-9.3l-9.6,9.9L108,88l4.5-7l4.3-2 l-5.1-2.1l-4.8,0.5l0.2-1.7l1.3-1.2l8.7-2.2L119.7,74.5 M205.9,223.1l-1.3,3.1H204l-7.1,11.2l-1.9,18.2l-3.1,6.1h-0.5v0.6l-0.8,0.3 l-1.1,1.2l-2.7-0.3l-9.4,6.7l-7.7,21.6l-3.9,3.3l-5.1-1.1l2.1,3.3l0.5,5.3l-7.9,3.3l-1.4,1.5l-0.5,3.6l-1.1,0.6l-1.1-0.3l-1.8,0.9 l1.8,6.1l-1.8,5.6l3.4,6.1l-2,5.9l0.5,3.1l11.1,8.2l-0.2,0.5l-9.3-0.6l-4.3-5.1l-4.7-1.7l-8.6-17.1l0.5-1.7l-6-12.3l-4.5-56.7 l-12.4-10.2l-4.2-8.1l-0.8-0.6l-9.8-21.5l1.1-2.2l-0.3-2.6l-0.5-0.8l7.9-15.3l0.3-5.6l-1-2.8l1-3.9l1.8-0.3l9.7-8.2l2.1,0.3l0.8,5.1 l2.7-5.1l1.3-0.3l4.2,2.8h0.9l0.2,0.6l14.8,3.9l1.6,1.4l0.3,0.6l7.9,6.7l7.7,0.9l4.3,4l2,6.3l-1,4.6l4.4,1.4l1.1,2.2l5.2-1.1 l2.1,1.1l2.6,4l2.9-0.9l9,1.9l8.6,5.8L205.9,223.1'/></svg>"],["asia","Asia","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 584.5 364.5'><path id='asia' d='M322.9,118.9l22.8,42.5l13.5-5.9l16.8-19l-7.3-6.5l-0.7-3.4h-0.1l-5.7,5.2l-0.9,0.1l-3.2-4.4l-0.4-0.2l-0.7,1.7 l-1.2-0.4l-4.1-11.4l0.2-0.5l1.9-1.2l5.1,6.8l6.2,2.7l0.8-0.2l1.1-1.1l1.6,0.4l2.9,2.6l0.4,0.8l16.4,0.8l6.9,6.5l0.4,0.1l1.4-0.3 l0.3,0.1l-1.7,2.5l2.9,2.8h0.7l3.3-3.3l0.5,0.3l9.2,32.1l4,3.7l1.3-1.3h0.2l1.7,1.3l1.4,6.6l1.6,0.9l1.7-2.9l-2.3-7.3l-0.1,0.3v-0.2 l-1.7,0.6l-1.3-1.1l1.2-14.3l14.3-17.6l5.9-1.7l0.3,0.1l3.1,4.5l0.8,0.2l0.9,1.5l0.8,0.3l4.7,10.3l0.2,0.1l2-0.6l5.4,10.1l-0.3,10.5 l2.8,3.7l0,0l4.2,10.8l1.8,1.7l-1.1,2.4l-0.8-0.6l-1.9-4l-1.7-1.4l-0.3-0.9l-5.5-3.5l-2.4-0.3l-0.2,1.2l19.8,28.5l2.6-3.6l-5.7-11.2 l0.9-4l0.7-0.2l0.2-2.3l-9.3-18.6l-0.3-8.9l1.4-1.5l6.7,7.8l1.4,0.3l1.1-0.6l0.1,0.1l-0.2,3.4l0.6,0.5l0.5,0.2l7.4-7.9l-2-10.4 l-6.9-9.5l4.9-6l0.8,0.2l0.8,0.5l1.7,3.9l2.9-4.7l10.1-3.6l5.1-8.1l1.6-9.9l-2.5-2l1.1-1.7l-7.5-11.5l3.5-4.7l-6.1-0.9l-3.5-3.7 l4.1-4.3l0.8-0.1l1.4,0.9l0.6,2.9l2.8-1.3l3.9,1.4l0.9,3.2l2.3,0.5l5,9h0.4l2.3-2.4h0.3l1-1.5l-1.7-3.8l-5.8-5.9l2.1-4v-3.6l2.6-2.4 l0.5,0.1l0.2-0.1l-3.5-15.2l-0.2,0.1v-0.1l-9.3,1.2l-7.3-9.3L464,58.8l-0.8,1.9L441.2,60l-1.5-1.8l-0.2,0.1l0,0l-7.3,4.1l-7.5-3 l-0.5,0.3l-1.8-0.8l-0.9-1.2l-0.3,0.1l-0.1-0.1l-5.7-0.4l-0.3-0.2l0,0l0,0l-1,0.5l-1.5,4.5l-4.2,2.7l-16.8-4.4L377.5,50l0,0l-0.2,1 l1.8,6.7l-13.3,3l-9.2-3.8l-1.1,3.1l-6.7-1.6l-0.1,0.1h-0.2l-4.4,6.8l3.8,3.8l0.6,2.7l0,0l0,0L352,71l2.6,2.2V74l-2.3,1.9l-0.8,1.6 l1.6,3.9l0.9,0.3l1,1.1l2.6,0.9l1.7,1.7l-0.2,1.1l-1.5,2.8l2.1,3.7v4.5l-1.3,1.4l-3.8-0.9l-4.7-5.1v-0.6l-1.4-1.4l-3.9,2.1l-2.4-2.1 l-1.6,0.9l-0.3,5.1l-15.2,4.7l-1.7,9.8l-2.5,1.7L322.9,118.9 M531.1,99.3l-1,2l-4,1.7l-2.4,3l-3.3-2.5l-6.4,0.2l-0.2-0.7l8.9-4.2 l3.7-4.9l-0.6-3.3l-3.2-5.1l-0.7-0.4v-5.1l1.4-2.6l1.7,0.3l0.6,0.7h0.8l1.1,0.8l1.3,0.3l0.6,1.9l-1.7,2l-2.6-1.2L531.1,99.3  M500.5,130.3l1.9-0.9l-0.8,6.3l-1.6-0.3L500.5,130.3 M515.9,180.5l-1.7,0.4l-2.2-3.3l-3.6-2.2l4.3-2.5l0.9-3.1l-0.3-4.1l-4.6-2.1 l-2,0.5l-5.1,8.5l-2.4,0.3l-0.2-3.4l0.8-0.7l4.2-9.3l-1.8-3.7l1.4-9.3l2.4,1.8l1.6,3.6l-0.5,4.8l8,6.4l0.1-0.1l3.1,11.2L515.9,180.5 L515.9,180.5L515.9,180.5 M497.7,179.5l2.6,0.9l1.1,1.9l-1.8,5.1l0.8,7l-6,10.9l-9.2-1.7l-2.9-10.9L497.7,179.5L497.7,179.5  M509,194.8l-1.8,0.1L509,194.8 M515,193.9l-1.7,2.2l-2.4-0.2l-1.9-1.1l-3.3,1.3l-0.3,1.9l1.2,1.4l2.1-0.3l0.9-0.7l1.1,0.1l0.3,1.2 l-1.9,2.6l0.7,5.6l-2.3-2l-1-2l-1.5,1l0.9,5.2l-3.1-0.4l0.2-2.8l-1.4-2.5l2.9-10.5l3.2-1.6l3.8,1.2l3.4-1.1L515,193.9 M530.7,198.1 l2.5,0.5l0.4,0.4l2,5.3l2.1-2.2l4.2-1.7l14.5,11.5l2.4,0.5l4-2.6l-1.2,4.7l-3.5,1.4l-0.5,1.4l0.1,1.3l4.4,6.5l-4.4-1.5l-5.2-7.5 l-5.6,4.4l-5.6-2l-1.2-1.5l1.3-1.5l-1.9-2.4l-0.3-0.8l-8.5-5l-0.9-4.7l-3.4-3.1l2.4-1.4H530.7 M476.6,212.1l19.1,5l3.1-0.8l4.4,1.4 l3.3-0.9l12.4,2.1l-0.1,0.6l-8.2,4v-1.9l-35.4-5.6l-1.5-1.8l2.5-1.9H476.6 M569.4,280.1l-19,14.6l-0.7-1.1l2.2-4.6l5.1-3l7.4-9.7 l0.9-4.3l4.8,5.1L569.4,280.1 M554.3,267.3l-11.1,18.2l-5.7,3.1l-4.8,7.7l-2.5,0.5l-0.6-1.9l0.5-3.4l2.8-2.9l-6.6-0.8l-1.6-1.4 l-1.7-8.4l-0.9-0.9l-3.1,1.1l-5.2-3.9l-32.3,7.3l-2.3-1.9l2.3-4.5l0.6-21.9l1.8-2.5l13.9-6.4l4.3-4.8l0.3-0.9l10-9.2l4.2,1.9l5.5-7 l4.2-1.4l4.9,2l-1.1,5l2.8,4.8l4.5,2.8l3.2-4.5l2.5-11.7l4.6,10.8v7.6l7.7,18.5L554.3,267.3L554.3,267.3L554.3,267.3L554.3,267.3 L554.3,267.3L554.3,267.3'/></svg>"],["europe","Europe","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 584.5 364.5'><path id='europe' d='M556.7,26.9l-35.5-7.3l-3.5,1.4l-49.9-5.2l-2.7,2l-45.8-4.1l-1.3-1.9l-15.3-2.2l-0.2,0.1h-0.1l-0.2,0.2l-6,0.6 l-0.5,0.5L372.4,17l-1.7,1.7l-5.8-3.1h-1.7l-1.5,3.7l1.8,2.5l-0.4,0.2l-10.1-1.5l-6.8,1.9l-5.3-0.6l-7.2,2.6l-4.2-1h-0.1l-3.1,3.2 l-0.9,0.2l-2.6,2.2l-2.3,0.8l-1.6,2h-1.7l-5.1-5.1l-1-0.2l-0.1-0.5l1.3-0.9l8.4,1.6l0.5-0.1l2.4-1.8l-0.8-0.9l-20.2-5.5l-16.9,3.4 L268,37l0.8,6.1l3.2,1.7l4-1l1.5,0.9l2.6,5.5h0.8l0.7,1.2l0.8,0.2l7.9-9.7l-2.9-5.4l8.5-8.9h0.5l1.3,1.7l-2.7,6.6l0.8,2.8l11.9,2.4 l-4,1.8l-3.5-0.3l-1.5,1.2l1,1.6l-0.1,2.2l-0.9-0.6H297l-1.8,1.2l-0.5,3.9l-2.3,2.2h-4.3l-4.2,1.9l-6.8-0.7l-0.6-0.4l2.5-1.7 l0.5-1.2l-0.9-1.7l-0.2-0.1l-2.3,0.5l-0.2-0.1l-0.2-3.4l-0.4-0.1l-2.6,3.9l1.3,3.7l-1.4,1.7L269,57l-18.9,13.1l0.1,1l1.7,1.6 l0.8,0.3l1.3,2.2l0.3,3.6l-3.1,4.5l-9.7-0.9l-1.3,1.5L239,97.9l0.4,1.1l5.1,3.1l0.2,0.8l1.6-0.2l0.1-0.2h0.1v-0.1l7.9-4.5l10-14.3 l10-2.8l1.2,0.5l11,11.5l0.2,2.3l-2,1.8l-1.9-0.4l-1.8,0.5l3.8,3.9l1.1-0.7l3.7-5.6l0.2-0.5l-0.9-1.9l0.2-0.4l2.3,0.3l0.8-1 l-1.7-0.9l-8.7-7.6l-0.5-4.5l1.4,0.2l10.4,8l3.4,9l1,0.5l0.5,0.6v1.5l4.5,6.1v0.4l0.7,1.1l3.7,1.3l1.4-1.6l-3.8-2.3l-0.1-1.7 l2.2-2.6l-6.3-6.3l5.6-2.2L306,90l5.8,8l4.2-0.6l2.7,0.9l1,4.7l0.7-0.1l1.8-2l-1.3-1.7l0.2-0.9h4.3l0.3,2.7l15.2-4.7l0.4-5.1 l1.5-0.9l2.5,2l3.9-2.1l1.4,1.5l0.3-3.9l-3.1-5.3l-1.3-8.6l2.9-2.5l-0.6-2.7l-3.8-3.8l4.5-6.9l6.8,1.6l1.1-3.1l9.2,3.8l13.3-3.1 l-1.8-6.7l0.2-1l8.7,7.4l22.2,7.4l4.3-2.7l1.5-4.5l1-0.5l0.2,0.2l6,0.4l1,1.2l1.7,0.8l0.5-0.3l7.5,2.9l7.5-4.2l1.5,1.8l22.1,0.8 l0.7-1.8l23.5-1.4l7,9.2l9.6-1.2l3.4,15.2l1,1.1l-0.2,0.2l1.7,1.7l0.5,0.1l1.8-2.2l1.6-5.3L508,56.7l-2.9-2.2l-5.5,0.3l-2.6-2.5 l1.8-7.8l0.5-0.3l0.2-0.9l3.4-1.7l14.2,0.6l1.3-4.8l1.6-1.2l0.4-0.1l4.3,1.2l0.1-0.1l0.2,0.1l3.1-2.5l1.7,0.9l-1,12l6.9,15.9l3.1-3 l0.1-0.3l2.3,1.1l0.8-2.2l-1.1-8.7l-4.8-5.8l0.1-2.6l0.8-1.5l4.5-2.2l2.2,0.2l4-3.7l2.1-0.3l1.1-1.7l-5.2-2.5l-0.5-1.7l2.9-1.7 l8.2,2.2l0.9-0.2l0.8-1.2L556.7,26.9 M331,87l-11.6-3.1l-8.9,2.9l-0.2-0.1l-0.5-1.9l2.9-7l2.9-2.5h1.7l2.1,1.1l2.3-1.7l1.8-3.4 l1.8-0.6l2.1,0.6l-0.8,3.9l7.7,7.3L331,87 M252.8,18.2l-5.8,5.6l-3.7,1.1l-1.1,4.3l-2.2,1.7l-0.2,1.2l0.9,1.7l7.8,1.2l-2.4,2.9 l-4.6,1.7l-5.9-2.9l2-1.8l1.9-0.8l-2.5-2.1l-11.4,1.7l-4.7,3.1l-8,1.7L203,49l-3.4,0.3l-3.7-2.8l-1.3-10.6l5.2-4.5l1.1-2l-1.9-3.3 l-0.5-0.3v-0.6l-0.5-0.3v-0.6l-0.6-0.3l-1.1-1.4l-3.1-1.4h-5.5l-4-1.7l71.2-3.4L252.8,18.2 M258.9,60.7l0.7,1.2l-10.5,1.5l3.4-1.5 l-0.1-1.5l-2.7-0.9l4.2-4.9l-2.7-2.7l-5.9,7.4l-4.4,0.8l1.1-2.7l-0.2-2.7l8.5-4.8l0.3-3.8l1-1.3l1.3,0.4l0.2,1.1l1.3,0.3l-0.8,3.2 l3.3,2.4l1.7,5.1l2.6,0.9L258.9,60.7'/></svg>"]]),e.indexOf("?geo.cat=geographic_regions&select=geo,geo.name,shape_lores_svg")>-1&&(Ft("WAFFLE READER: APPLYING STUB FUNCTIONALITY TO GET DATA geographic_regions, WHICH IS NOT YET IN WS"),a.rows=[["america","America","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='america' d='M189.96,40.495c1.3,0.72,2.56,1.51,3.82,2.32l1.04,0.23c0.57,0.13,1.7,0.39,2.27,0.52c0.55,0.18,1.64,0.55,2.18,0.73c-0.13,1.2-0.26,2.41-0.36,3.61c-4.66,0.37-9.34,0.55-14,0.8c0.06,1.15,0.11,2.3,0.16,3.45c0.58-0.04,1.74-0.11,2.32-0.14c1.6-0.47,2.8,0.77,3.51,2.04l0.63,0.8c0.88,0.68,1.23,1.54,1.06,2.59l-0.11,1.04c1.27-0.13,1.89,0.44,1.87,1.71c2.21,0.13,4.42,0.26,6.65,0.27c1.38-0.07,2.75,0.11,4.1,0.43c1.94,0.35,3.91,0.45,5.88,0.44c0.57,0.09,1.72,0.27,2.29,0.35l1.24,0.46c0.12-1.63,0.31-3.27,0.3-4.91c-0.29-1.27,0.12-2.87,1.7-2.85c1.17-0.31,2.33-0.63,3.5-0.96c-0.16-0.53-0.46-1.58-0.61-2.1c-0.42-1.05-0.16-1.91,0.76-2.6c1.85-1.74,3.41-3.76,5.09-5.66c2.13-2.35,5.27-3.21,8.07-4.51l0.62-0.31c1.1-0.64,2.26-1.21,3.49-1.58c1.25-0.46,2.52-0.97,3.57-1.83c0.51-0.9,1.27-1.43,2.28-1.59c2.35-0.65,4.6-1.6,6.83-2.58l-0.65-1.11c-0.6-0.83-0.87-1.75-0.81-2.76c-2.47-0.83-4.94-1.79-7.54-2.09c-1.18-0.02-2.34-0.27-3.43-0.68c-0.87-0.11-2.59-0.34-3.45-0.46c-1.18,0.08-2.35-0.12-3.47-0.479c-2.02-0.15-6.06-0.46-8.09-0.62c-1.35,0.04-4.07,0.11-5.43,0.14c-0.54,0.18-1.64,0.54-2.18,0.71c-0.62,0.89-1.44,1.311-2.48,1.271l-0.72,0.03c-4.64,0.31-9.27,0.63-13.89,1.02l-0.78,0.38c-2.28,1.27-4.54,2.55-6.82,3.82l-0.7,0.42c-0.93,0.689-1.95,1.24-3.04,1.6l-0.93,0.521c-0.83,0.83-1.72,1.02-2.7,0.56C184.92,35.785,186.99,38.645,189.96,40.495z M203.85,33.395l-1.02,0.57c2.36,1.12-1.66,3.47-1.3,0.83c-0.15-1.15-0.3-2.311-0.43-3.46C201.77,28.755,206.22,32.025,203.85,33.395z M204.82,54.435c-2.256-0.119-4.503-0.26-6.75-0.442c-0.075-1.56,0.615-2.036,2.07-1.438C201.7,53.195,203.26,53.815,204.82,54.435 M162.94,36.825c0.44,0.12,1.3,0.36,1.74,0.48c1.02-0.1,1.92,0.2,2.7,0.88c1.21,0.82,2.51,1.5,3.83,2.14c1.16,0.36,1.59,1.11,1.31,2.23c0.15-0.36,0.43-1.09,0.58-1.46c0.31-1.14,1.05-1.58,2.22-1.31c1.21,0.15,2.43,0.26,3.66,0.33c0.56,0.1,1.69,0.29,2.25,0.39c0.49,0.17,1.46,0.5,1.95,0.66c0.19-1.6,0.38-3.21,0.57-4.81l-0.66-0.3c-2.57-1.13-5.11-2.33-7.64-3.53l0.2,1.09c0.74,1.38-1.02,2.32-2.03,1.35c-1.1-0.49-2.23-0.92-3.38-1.28c-1.12-0.23-2.15-0.77-2.95-1.6c-0.99-0.82-1.99-1.62-3-2.4c-1.93,0.89-3.85,1.8-5.74,2.74c0.42,0.4,1.28,1.2,1.71,1.6C161.26,34.855,162.13,35.815,162.94,36.825 M146.08,43.795c0.74-1.05,1.6-2.01,2.57-2.86c0.47-0.47,1.42-1.42,1.89-1.89c-3.31-0.11-6.59-0.23-9.88-0.37c0.93,2.65,1.99,5.26,3.18,7.8C144.61,45.605,145.35,44.705,146.08,43.795 M126.03,51.835c2.62-0.65,5.14-1.52,7.75-2.24c-0.52,1.48-1.03,2.97-1.56,4.45c-0.15,0.4-0.43,1.2-0.57,1.6c1.2,0,2.12,1.06,2.04,2.24c0.42,0.14,1.27,0.42,1.7,0.56c2.78,0.89,5.5,1.98,8.13,3.25c0.76-0.15,2.27-0.46,3.03-0.62c0.85-0.58,1.77-0.78,2.78-0.58c3.31,0.26,6.48-1.06,9.3-2.65c0.95-0.74,1.82-0.69,2.61,0.13c0.27-1.58,0.55-3.16,0.84-4.74c-2.61-1.72-5.18-3.49-7.79-5.21l-0.6-0.39c-1.13-0.69-2.22-1.45-3.19-2.35c-0.19,0.48-0.57,1.45-0.76,1.93c-0.33,1.19-1.07,1.63-2.23,1.33l0.36,1.28c0.87,1.17-0.63,2.79-1.7,1.55c-2.62-1.55-5.39-2.82-7.95-4.47c-2.48-1.64-4.97-3.27-7.46-4.89c-2.52,0.64-4.88,1.82-6.94,3.4c-0.82,0.75-1.98,1.45-3.11,0.91c-0.15,1.61-0.31,3.23-0.47,4.84C122.14,51.535,124.08,52.215,126.03,51.835 M176.44,48.955l-0.4-1.49c-3.84,0.58-7.59,1.65-11.2,3.1c0.39,0.4,1.18,1.19,1.58,1.59c1.19,1.11,2.27,2.34,3.31,3.6c1.17,2.14,3.56,2.08,5.56,1.21c0.73-1.21,1.51-2.4,2.29-3.58c0.25-0.73,0.75-2.2,1-2.94C177.36,50.695,176.65,50.195,176.44,48.955 M320.03,350.335c-0.43-1.08-0.7-2.22-0.76-3.37c-0.96-1.18-2.23-2.02-3.43-2.9c-2.29-1.58-4.56-3.18-6.87-4.71c-6.17-1.83-12.18-4.11-18.19-6.42c-1.25-0.35-2.65-0.8-3.27-2.05c-1.73-2.42-2.9-5.17-3.72-8.02c-0.54-1.74-0.94-3.49-1.21-5.25l-0.97,0.03c-1.07,0.09-1.87-0.35-2.4-1.34c-0.73-0.86-1.54-1.63-2.44-2.3c-1.07-0.54-1.41-1.33-1.01-2.36c-2.81-0.28-5.71-0.37-8.45-0.97c-1.79-1.51-3.28-3.33-4.68-5.18l-0.42-0.53c-3.22-4.75-8.95-8.5-14.85-7.28c-1.59,0.11-3.24,0.24-4.77-0.29c-3.42-1.09-6.75-2.48-10.11-3.67c-0.86,0.83-1.69,1.68-2.5,2.55c-0.83,0.98-1.75,1.87-2.72,2.7c-0.92,1.06-1.58,2.3-2.16,3.57c-0.15,1.4-1.72,1.69-2.63,0.76c-0.61-0.01-1.82-0.05-2.43-0.07c-2.08,0.09-4.21-0.19-6.23-0.36l-1.3-0.14c-1.27-0.02-1.85-0.64-1.74-1.87c0.11-4.16,0.39-8.36-0.12-12.5c0.09-1.47-0.99-2.41-2.32-2.7c-1.12-0.2-2.19-0.59-3.16-1.18c-0.72-0.35-2.16-1.04-2.89-1.39c-0.38-0.2-1.15-0.59-1.53-0.78c0.19-2.24,0.58-6.7,0.77-8.94c0.17-1.35,0.45-2.68,0.71-4.01c-0.73-1.02-1.3-2.16-1.69-3.35c-1.41-0.13-2.82-0.25-4.22-0.37c-0.07,1.19-1.18,2.11-2.36,1.93c-0.49,1.16-0.96,2.32-1.44,3.49c-0.45,1.52-1.59,2.7-2.99,3.41l-1.12,0.7c-1.02,0.89-2.69,1.36-3.71,0.2l-0.8-0.63c-2.7-1.79-4.49-4.5-5.88-7.35l-0.46-0.82c-0.61-0.88-0.7-1.81-0.29-2.8c0.95-4.01,1.78-8.05,2.24-12.15c0.18-1.43,0.56-4.28,0.74-5.71c0.51-0.12,1.53-0.38,2.05-0.5c4.34-0.98,8.8-0.27,13.19,0.1c0.4-0.88,0.98-1.61,1.74-2.2l0.86-0.78c1.29-1.25,2.9-1.47,4.81-0.66c7.01,0.89,5.82,9.64,10.35,13.31c0.98,0.58,1.98,1.14,2.94,1.78c0.85-1.45,1.68-2.91,2.54-4.35c1.59,0.13,3.18,0.29,4.78,0.45c0.05-0.72,0.15-2.16,0.2-2.88c-0.68-0.6-1.31-1.25-1.89-1.93c-0.83,0.05-2.48,0.14-3.3,0.18c-1.15,0.15-1.85-0.36-2.12-1.52c-0.48-1.21-1.02-2.38-1.64-3.51c-0.69-0.84-0.86-1.76-0.52-2.75c0.45-1.72,0.81-3.47,1.39-5.14c1.92-3.29,5.11-5.51,7.9-8c3.73-2.83,5-7.82,4.94-12.3c-0.17-1.02,0.05-1.95,0.65-2.79l0.3-0.99c0.05-1.04,0.45-1.92,1.21-2.63l0.61-0.85c0.94-1.39,1.91-3.09,3.76-3.31c1.39-0.36,2.78-0.7,4.18-1.04c-0.01-1.86,0.26-3.64,0.82-5.35c1.01-1.68,1.96-3.64,3.86-4.47c3.43-1.92,5.49,2.56,7.97,4.13c0.34-0.5,1.02-1.48,1.37-1.97c0.63-1.18,1.73-1.96,2.9-2.55c3.53-1.93,5.72-5.48,8.29-8.44c-1.73-0.08-3.47-0.14-5.2-0.13l-0.69,0.42c-1.16,0.68-3.49,2.03-4.65,2.7c-0.18-2.73-0.37-5.46-0.56-8.19c-0.16-1.88-0.4-3.76-0.64-5.63c3.98-1.15,9.02,0.07,12.39-2.86c0.65-0.67,2.51-2.1,2.9-0.45c-0.49,1.17-1.38,1.52-2.67,1.07c-0.13,2.38-0.34,4.76-0.33,7.14c0.02,1.15,0.03,2.32-0.15,3.46c3.36,0.98,6.79,2.07,10.34,1.83c1.45-0.11,2.9-0.21,4.36-0.17c-0.22-1.62-0.53-3.23-0.93-4.81c-0.55-0.93-0.62-1.87-0.2-2.83l0.42-1.16c-0.98,0.56-1.86,0.39-2.64-0.5c-0.99-0.79-1.99-1.55-3.01-2.29c-0.17-1.03-0.34-2.06-0.5-3.09c-0.39-1.14,0.12-2.29,0.81-3.19c0.26-0.41,0.77-1.23,1.02-1.65c-1.23,0.19-1.89-0.34-1.99-1.58c-0.26-1.61-0.52-3.22-0.75-4.83c-2.32-1.69-4.63-3.4-6.9-5.15l-0.61-0.49c-3.13-2.6-3.67-6.84-5.2-10.39l-0.33-0.76c-0.79-1.49-1.58-2.99-2.33-4.5l-0.5-0.78c-0.93-0.52-1.46-1.3-1.59-2.33c-0.16-0.71-0.49-2.13-0.66-2.84c-1.89,1.68-3.82,3.34-5.9,4.78c-1.01,0.73-2.21,1.13-3.38,1.52c-1.21,0.35-1.87-0.14-1.99-1.5l-0.29-1.46c-0.38-1.91-0.65-3.83-0.82-5.76c-0.37-0.28-1.13-0.83-1.51-1.11c-1.97-1.44-3.84-2.99-5.77-4.47c-2.81-1.52-6.83-4.98-9.96-2.68c-0.82,0.99-1.68,1.98-2.81,2.63l-0.48,0.32c1.23,0.07,1.76,0.73,1.62,1.98c-0.02,0.59-0.05,1.77-0.06,2.36c0.13,1.22-0.43,2.32-1,3.34l-0.35,1.23c-0.16,1.45-0.48,4.34-0.64,5.78l1,1c1.06,0.86,1.74,2.08,2.08,3.4c0.2,0.55,0.61,1.65,0.82,2.19c1.07,0.76,1,2.28-0.25,2.81c-0.13,0.52-0.39,1.55-0.51,2.06c-0.09,1.05-0.61,1.82-1.56,2.3c-0.52,0.46-1.55,1.38-2.07,1.84c-0.63,0.99-1.46,1.32-2.5,0.98l0.86,0.89c0.84,0.72,1.08,1.61,0.72,2.68c-0.09,0.51-0.28,1.52-0.37,2.03c-0.33,1.91-0.66,3.83-0.99,5.75c-2.6-2.17-4.47-5.01-5.64-8.17c-0.67-1.56-1.46-3.12-2.87-4.13c-1.31-1.02-2.56-2.12-3.75-3.27c-0.49-0.36-1.47-1.1-1.96-1.46c-0.97-0.34-1.67-0.96-2.09-1.88l-0.54-0.47c-2.16-1.24-4.37-2.39-6.62-3.44c-0.56-0.03-1.68-0.09-2.24-0.11c-1.42,0.43-2.59-0.58-2.73-1.97c-0.45-1.25-1.33-2.26-2.19-3.23c-0.88-0.76-1.5-1.84-1.29-3.03c-0.02-1.82-0.05-5.44-0.07-7.25c-0.15-1.06,0.23-1.89,1.14-2.49l0.56-0.51c2.08-2.03,4.12-4.09,6.26-6.06l0.59-0.53c1.88-1.6,3.89-3.03,5.88-4.48c1.43,1.48,2.86,2.97,4.31,4.44l0.7,0.71c1.06-0.53,2.21-0.87,3.38-1.01l1.1-0.19c1.52-0.33,3.08-0.32,4.62-0.14c0.74,0.05,2.22,0.15,2.95,0.2l-0.47-0.85c-0.49-0.82-0.88-1.68-1.18-2.58c-0.52-1.42-1.36-2.96-2.95-3.34c-1-0.16-1.8-0.65-2.39-1.47c-0.5-0.38-1.5-1.13-2-1.5c-1.4-0.39-2.09-2.31-0.38-2.85l0.61-0.39c2.4-1.55,4.78-3.12,7.19-4.66c-0.09-4.37,0.03-8.75,0.43-13.1c2.47-0.39,4.87-0.71,7.4-0.95c0.1,0.38,0.31,1.15,0.41,1.53c1.18,3.42,0.01,6.92-1.29,10.1c1.73,0.26,3.47,0.5,5.22,0.74c0.88-1.42,1.76-2.84,2.67-4.25l0.23,0.87c0.51,1.48,1.12,2.93,1.68,4.4c0.69,1.19,0.26,2.77-0.95,3.44c-3.19,2.63-7,4.34-10.61,6.29c-0.06,1.3-0.11,2.59-0.15,3.89c0.44,0.16,1.32,0.48,1.77,0.64c1.19,0.31,1.61,1.06,1.26,2.23c0.65-0.32,1.95-0.96,2.6-1.28c0.96-0.65,2.12-0.99,3.28-0.73c0.8,0.05,2.39,0.16,3.19,0.22c1.14-0.03,1.85,0.52,2.14,1.66l0.45,1.03c0.65,1.35,1.3,2.72,1.68,4.19c1.31,0.26,2.63,0.5,3.96,0.72c1.19,0.04,2.25,0.59,3.16,1.33l0.74,0.45c0.98,0.37,1.64,1.04,1.98,2.03c0.37,0.03,1.09,0.08,1.45,0.1c0.5-0.24,1.49-0.72,1.98-0.96c2.45-2.4,3.93-6.04,3.27-9.47c-1.39-2.09-2.91-4.1-4.47-6.07c-0.79-0.84-1.51-1.74-2.15-2.69c-2.13-1.1-0.01-3.44,1.2-1.3c0.34,0.14,1.01,0.42,1.35,0.56c1.54,0.69,1.79,1.7,0.75,3.04l-0.41,0.53c0.32,0.09,0.97,0.28,1.29,0.38c1.87,0.56,3.75,1.08,5.64,1.59c0.72-2.99,2.35-6.14,1.49-9.25c-0.72-0.89-1.31-1.87-1.66-2.95c-0.62-1.77-2.39-2.69-4.08-3.14c-1.02-0.13-1.83-0.61-2.44-1.42l-0.71-0.38c-1.87-0.3-2.59-2.03-1.34-3.48c1.17-1.91-0.47-3.89-1.54-5.42c-1.67-1.75-3.41-3.44-5.21-5.05c-2.09-1.45-4.52-2.33-6.93-3.09c-1.18-0.17-2.16-0.89-2.66-1.97c-1.34-1.99-2.99-4.55-5.76-4.2c-2.88,0.07-5.78,0.27-8.64,0.4c-0.28-0.95-0.55-1.89-0.83-2.83c-0.39-1.31-0.78-2.61-1.16-3.91l-0.91-0.04c-2.99-0.08-6-0.26-8.97-0.41c-2-0.11-3.99-0.22-5.98-0.35c0.34,1.1-0.08,1.84-1.24,2.24c-1.83,0.94-4.07,2.22-3.44,4.67c0.01,1.39,0.02,4.16,0.02,5.55v1.65c1.32,0.73,2.41,1.8,3.37,2.95l0.52,0.57c1.78,1.89,3.5,3.83,5.19,5.8l0.59,0.65c1.18,0.65,1.15,2.14,0.08,2.89c-1.08,1.62-1.93,3.38-2.82,5.12c-0.47-1.42-0.98-2.82-1.55-4.2c-0.84-1.05-1.68-2.1-2.52-3.14c-0.92-0.63-1.84-1.25-2.78-1.84c-2.03-1.28-3.91-2.82-5.42-4.69c-2.34-3.72-1.01-8.14,0.93-11.74c0.48-1.26,1.53-2.16,2.48-3.08l0.52-0.86c0.54-1.3,1.06-2.61,1.71-3.87c-4.5-0.35-9.01-0.53-13.5-0.77c0.33,3.29,0.67,6.56,1.03,9.86c0.79,1.74,0.37,5.85-1.53,3.4c-0.52-1.8-0.85-3.64-1.27-5.46c-0.37-1.33-0.54-2.75-0.08-4.08l0.2-0.83c-0.66-0.63-1.99-1.91-2.66-2.55c-2.68,0.97-5.37,1.91-8.09,2.8l0.73,1.25c1.63,1.58-0.23,3.44-2.02,2.41l-1.4-0.29c0.14,0.55,0.43,1.66,0.58,2.21c-0.07,1.32,0.38,2.41,1.35,3.26c1.23,1.06,2.44,2.13,3.64,3.23c1.93,1.33,3.99,2.45,6.18,3.36c-0.18,1.2-0.54,3.58-0.71,4.77c-0.09,1.33-0.77,2.49-1.37,3.64l-0.21,0.75c-0.55,1.73,0.23,4.73-1.9,5.06c-1.77,0.26-3.56,0.39-5.34,0.51c-2.41,0.82-1.84-2.77,0.25-1.51c0.16-1.29,0.27-2.59,0.33-3.89c-0.13-1.01,0.12-1.93,0.74-2.73c0.44-0.86,1.32-2.56,1.76-3.41c-2.41-0.77-4.82-1.56-7.21-2.35c-1.07-2.78-2.1-5.6-3.54-8.21c-0.71-1.14-1.31-2.34-1.83-3.57l-0.57-0.93c-0.87-0.81-1.06-1.7-0.57-2.67c-0.56,0.26-1.67,0.78-2.23,1.04c-1.16,0.64-2.42,1.07-3.73,1.25c-1.56,0.32-3.11,0.71-4.59,1.3c-0.51,1.26-2.01,1.35-2.8,0.31c-2.05-1.15-4.24-2-6.39-2.95c-1.49-0.42-2.39-1.76-2.83-3.17c-0.23-0.56-0.7-1.7-0.93-2.26c-0.7,0.85-1.58,1.02-2.64,0.51c-1.57-0.41-3.16-0.66-4.78-0.73c-1.38,0-2.76-0.17-4.06-0.67c-0.98-0.31-2.96-0.92-3.95-1.23c-1.11,1.67-2.21,3.34-3.19,5.09c-0.72,1.52-1.22,3.19-1.16,4.88c0.21,1,0.05,1.94-0.47,2.82c-0.17,0.48-0.51,1.43-0.68,1.91c-0.27,0.49-0.81,1.46-1.08,1.94l1.45,0.17c1.57,0.01,2.94,0.84,4.11,1.83c0.55,0.42,1.66,1.25,2.22,1.67c1.45-0.74,2.97-1.35,4.45-2.03c0.44-0.29,1.34-0.87,1.78-1.16c1.21-1.49,3.39-1.11,3.28,1.04c0.46,1.97,0.93,3.95,1.64,5.86c0.63,1.68,1.31,3.35,1.98,5.02c-1.55-0.32-4.65-0.96-6.21-1.28l-0.78-0.17c-1.49-0.22-2.7-1.15-3.94-1.92c-0.65,0-1.94-0.01-2.59-0.02c-0.58,0.91-1.39,1.39-2.44,1.44l-1.09,0.13c-1.8,0.49-3.98,0.2-4.71-1.77c-0.67-1.09-1.33-2.17-1.98-3.26c-0.3,0.47-0.89,1.41-1.19,1.88c-0.39,0.38-1.19,1.15-1.59,1.53c-0.33-0.03-0.99-0.09-1.33-0.13c-2.13-0.22-4.28-0.26-6.43-0.32l-0.64,0.86c-0.67,1.22-1.97,1.87-3.33,1.92c-2.62,0.42-5.23,0.9-7.86,1.3c-1.76,0.58-3.34,0.42-4.74-0.49c-1.27-0.72-2.54-1.44-3.9-1.98c-2.91-0.98-5.88-1.77-8.84-2.56c-2.48-0.6-5.07-0.64-7.6-0.74c-1.11,0-3.32-0.01-4.43-0.01l-0.43-0.39c-1.47-1.27-3.03-2.67-4.99-3.07c-1.03,0-1.91-0.36-2.62-1.09l-0.8-0.55c-3.01-0.08-6.03-0.02-9.03,0.07c-1.48,0.5-2.85,1.26-4.15,2.11c-0.91,0.67-1.96,1.38-3.16,1.15l-1.17-0.04c0.47,1.06,0.17,1.87-0.9,2.45c-0.85,0.64-1.68,1.31-2.48,2.01c-2.47,2.23-4.9,4.51-7.38,6.72c-0.05,0.71-0.14,2.15-0.18,2.86c2.14,0.98,4.26,1.98,6.39,2.98c-0.13,0.68-0.38,2.04-0.5,2.72c-1.64,0.98-3.28,1.96-4.88,3l-0.68,0.47c-1.25,0.94-2.49,1.89-3.82,2.72c0.56,1.04,1.16,2.05,1.8,3.04c2.23,1.52,4.57,2.87,6.96,4.1c1.76-0.04,3.51-0.32,5.25-0.53c2.18-1.18,4.07,2.1,1.22,2.51c-1.65,0.48-3.32,0.83-4.99,1.19c-1.98,3.8-4.07,7.55-5.56,11.57c3.6,4.66,8.7,9.03,14.52,10.34c0.56,0.06,1.68,0.18,2.24,0.24c0.73,0.05,2.18,0.16,2.91,0.21l1.31,0.03c-1.57,2.04-3.23,4.03-4.96,5.95l-0.46,0.55c-0.79,1.03-1.75,1.94-2.9,2.57l-0.8,0.52c0.99-0.38,1.87-0.13,2.62,0.75l0.97,0.5c0.53,0.21,1.59,0.64,2.13,0.85l0.61,0.36c1.54-2.01,3.15-3.95,4.83-5.82l0.46-0.53c0.8-1.02,1.75-1.9,2.75-2.73l0.42-0.57c0.27-0.98,0.84-1.73,1.72-2.23c0.61-0.99,1.1-2.03,1.48-3.12c0.36-0.95,0.71-1.9,1.07-2.85c2.33,0.83,4.68,1.61,7.05,2.33c0.81-0.38,2.42-1.14,3.23-1.52c-0.14-0.51-0.41-1.52-0.55-2.03c-0.81-1.22,0.19-3.21,1.7-2.16c1.89,0.66,3.8,1.37,5.81,1.51c1.01-0.12,1.93,0.11,2.77,0.69c0.73,0.14,2.2,0.43,2.93,0.57c1.02-0.03,1.88,0.34,2.56,1.12c1.74,0.99,3.71,1.48,5.62,2.04c1.35,0.17,2.33,1.14,3.14,2.16c0.72,0.89,1.59,1.59,2.6,2.11c1.67,0.69,3.31,1.46,4.91,2.32l0.78,0.43c0.98,0.43,1.54,1.18,1.69,2.27l0.34,0.91c0.85,0.58,1.37,1.36,1.57,2.37l0.29,0.73c0.92,0.44,1.53,1.15,1.83,2.13l0.33,0.64c2.2,3.86,5.06,7.42,6.47,11.69c0.37,2.61,0.62,5.25,0.75,7.9c1.43,0.72,2.69,1.74,3.72,2.98c0.45,0.51,1.34,1.54,1.79,2.06c1.46,3.03,1.53,6.45,1.91,9.74l0.06,0.87c0.08,3.9-0.08,7.8-0.12,11.7c0.09,4.67-0.44,9.82,2.34,13.86c0.78,1.11,1.41,2.32,1.83,3.63l0.4,0.96c0.6,1.22,1.06,2.52,1.24,3.88c0.04,4.18,2.96,7.21,7.13,7.43c1.13,0.12,1.74,0.75,1.84,1.9c0.43,2.14,1.01,4.33,2.3,6.13c0.7,0.73,1.06,1.61,1.06,2.63c0.87,1.88,2.33,3.39,3.62,4.99c1.05,0.95,1.24,2.41,1.2,3.76c0,2.61,0.3,5.51,2.48,7.27c0.98,0.86,1.85,1.85,2.56,2.95c0.43,0.5,1.28,1.51,1.7,2.01c1.21,1.09,2.4,2.19,3.54,3.35c0.48,0.44,1.44,1.33,1.92,1.77c-0.01-1.13-0.07-2.25-0.19-3.37c-0.89-0.56-1.35-1.35-1.4-2.36c-0.25-1.72-0.61-3.42-0.93-5.11c-0.27-1.41-0.52-2.82-0.77-4.23c0.95,1.41,1.9,2.82,2.84,4.24c0.57,0.9,1.21,1.76,1.91,2.57c0.82,0.6,1.29,1.42,1.42,2.43l0.23,0.76c0.96,0.37,1.64,1.03,2.05,1.98l0.51,0.72c0.78,1.01,1.8,2.07,1.67,3.46c0.07,1.77,0.19,5.29,0.25,7.05c1.55,1.72,3.06,3.47,4.5,5.29l0.77-0.12c1.19-0.4,2.27,0.37,3.06,1.18c1.23,1.09,2.66,1.95,4.21,2.52c1.14,0.2,1.75,0.85,1.83,1.95c0.03,0.23,0.09,0.7,0.11,0.93c3.98,0.29,7.94,0.73,11.89,1.31c2.31,1.2,4.04,3.26,6.36,4.46c1.13,0.17,2.28,0.46,3.2,1.2c2.2,1.37,4.42,2.7,6.52,4.23c1.07,0.54,1.59,1.65,1.94,2.75l0.35,0.77c0.82,0.6,1.31,1.4,1.48,2.41c0.47,1.4,1.42,2.63,2.56,3.56c3.62,1.77,7.67,2.93,11.7,2.06c0.65,0.53,1.31,1.07,1.97,1.61c0.89,0.61,1.22,1.47,1,2.58c0.02,0.95,0.05,2.85,0.07,3.8c0.07,0.97,0.2,2.91,0.27,3.88l-0.47,0.43l-0.81,0.82c-1.12,1.29-2.29,2.53-3.47,3.76c-0.92,1.14-1.57,2.54-1.78,4c0.07,1.02-0.21,1.93-0.86,2.72c0.07,0.51,0.21,1.54,0.29,2.05c0.58,0.86,0.76,1.8,0.53,2.81c-0.06,0.58-0.19,1.75-0.25,2.33c0,1.35-0.42,2.65-0.99,3.87c-3.28,4.89,0.22,10.28,4.09,13.3c0.87,0.59,1.3,1.43,1.29,2.51l0.21,0.99c0.55,0.86,0.74,1.8,0.57,2.82c-0.08,1.57,0.61,3.05,1.41,4.37c0.74,1.11,1.33,2.32,1.76,3.59c0.22,0.46,0.66,1.37,0.88,1.83c1,1.31,1.99,2.63,2.89,4.02c0.6,0.88,1.28,1.69,2.05,2.43c2.23,1.97,4.52,3.84,6.84,5.71l0.82,0.58c0.26,0.18,0.79,0.54,1.05,0.72c-0.06,0.89-0.16,2.66-0.22,3.55c-0.12,2.02-0.36,6.06-0.48,8.08c-0.12,1.19-0.36,3.56-0.48,4.74c-0.21,1.66-0.35,3.34-0.42,5.02c0.07,1.17-0.16,2.33-0.58,3.43c-0.36,1.29-0.57,2.61-0.65,3.95c-0.52,7.56-0.05,15.36-2.29,22.68c-0.4,1.31-0.83,2.61-1.12,3.96c-0.08,1.01-0.49,1.86-1.25,2.54l-0.54,0.76c-0.29,6.19-0.28,12.4-0.39,18.62c0.01,2.93,0.4,5.85,0.73,8.77c0.19,1.04-0.13,1.9-0.98,2.61l-0.66,0.85c-0.53,1.09-1.32,1.45-2.38,1.07c0.65,2.08,1.4,4.14,1.89,6.28c0.64,3.28,0.71,6.58,0.98,9.93c0.15,2.62,0.29,5.26,0.4,7.91c0.89,0.75,1.78,1.51,2.67,2.28c2.52,2.16,4.89,4.47,7.35,6.71c3.25,2.62,7.76,0.42,11.53,0.34c-0.84-0.93-1.7-1.83-2.57-2.7c-0.99-0.88-1.81-1.92-2.51-3.02l-0.5-0.65c-0.87-0.56-1.4-1.34-1.58-2.34c-0.35-1.06-0.73-2.11-1.16-3.13c-0.54-1.31-1.08-2.61-1.61-3.91c0.82-0.91,1.65-1.8,2.46-2.71c2.79-3.28,5.16-7.31,5.64-11.61c-0.45-0.81-0.87-1.63-1.25-2.45c-0.59-1.18-1.23-2.32-1.84-3.47c1.52-1.89,3.13-3.7,4.71-5.54c1.06-1.29,1.89-2.75,2.6-4.25c1.08-2.38,2.16-4.75,3.27-7.11l0.33-0.74c0.52-1.36,1.29-2.76,2.75-3.27c0.51-0.26,1.53-0.79,2.04-1.05c2.54-1.33,5.07-2.68,7.52-4.15c0.69-2.65,0.41-5.4,0.36-8.09c2.11-1.02,4.38-1.89,6.13-3.5c0.87-0.96,1.81-1.84,2.83-2.64c1.96-1.62,2.4-4.29,2.74-6.66c0.04-1.07,0.56-1.83,1.56-2.27l0.61-0.45c0.57-0.84,1.34-1.37,2.34-1.57c1.67-1.77,2-4.3,2.48-6.58c0.51-2.74,0.96-5.53,1.55-8.23l0.14-0.59c0.38-1.78,2.18-2.65,3.49-3.67l0.84-0.63c1-0.87,2.12-1.64,3.42-1.98c1.65-0.61,3.34-1.18,4.9-2.02c0.92-1.1,1.88-2.18,2.89-3.2c1.86-1.98,3.01-4.53,3.57-7.16c0.23-1.3,0.65-2.56,1.14-3.78c1.35-4.8,0.75-9.98,2.15-14.75c0.97-1.95,2.17-3.77,3.39-5.58C318.94,360.125,320.97,355.295,320.03,350.335z M201.62,108.035c1.3-1.03,2.87,1.21,1.56,2.15C201.86,111.255,200.3,108.975,201.62,108.035z M160.23,91.855l-1.2,0.51c-2.9,2.15-6.3,3.57-9.96,3.77l0.76-0.25c-2.64,0.37-5.3,0.58-7.97,0.64c-2.68-0.07-1.45-5.11,1.01-3.92c2.06-0.02,4.12-0.03,6.19-0.08c3.98-1.16,8.33-2.5,12.34-0.78L160.23,91.855 M220.38,271.435c1.05-0.17,1.87,0.23,2.46,1.2l0.57,0.55c3.09,2.48,6.34,4.75,9.63,6.97c3.54,0.04,7-0.77,10.46-1.43c0-1.01,0.01-3.04,0.01-4.06c-0.29,0.02-0.89,0.05-1.18,0.07c-1.05,0.11-1.86-0.32-2.43-1.27c-0.5-0.45-1.51-1.37-2.02-1.82c-1.31-0.98-2.58-2.01-3.76-3.12c-0.88-0.78-1.76-1.53-2.66-2.26l-0.34,1.07c-0.08,2.57-2.4,2.54-3.98,1.18l-0.85-0.41c-0.98-0.33-1.68-0.96-2.1-1.91c-0.72-0.78-1.55-1.41-2.49-1.9c-2.11-1-4.26-1.93-6.44-2.74c-1.16-0.25-2.31-0.19-3.43,0.16c-2.3,0.78-4.55,1.68-6.82,2.49c0.46,1.39,0.93,2.79,1.4,4.18c3.95-0.84,8.1-1.22,11.75,0.89c1.19,0.34,1.6,1.09,1.23,2.26L220.38,271.435z'/></svg>"],["sub_saharan_africa","Sub-Saharan Africa","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='sub_saharan_africa' d='M488.08,345.035c5.11-10.88,14.33-19.02,20.83-28.98c3.28-6.75,5.42-14.26,5.12-21.82c-4.56,1.59-9.14,3.19-13.67,4.84c-1.21,0.87-2.79,0.27-3.09-1.19l-0.48-0.92c-1.47-2.71-2.98-5.4-4.4-8.13c-4.72-7.55-8.46-15.7-11.36-24.12c-6.5-0.32-12.99-1.01-19.5-0.67c-3.83,1.29-6.55,4.65-10.11,6.5c-5.98-1.5-10.87-5.94-16.83-7.39c-11.42-0.79-19.79,8.42-28.23,14.57c-6.29-6.06-12.33-12.36-18.54-18.5c-1.77-1.59-3.57-3.15-5.43-4.62c-4.34-2.86-9.65-3.57-14.65-4.58c-5.4,4.16-7.36,11.61-9.44,17.91c0.35,8.3,0.43,16.66-1.15,24.89c1.67,0.73,3.35,1.49,5.09,2.06c1.04,0.24,2.42,0.78,2.33,2.1c0.89,6.5,1.7,13.87,7.64,17.84c2.9,4.07,9.61,6.35,13.61,2.58c0.89-1.13,2.41-1.25,3.58-0.46c5.3,2.98,10.55-1.13,15.91-1.18c4.74,1.87,8.9,4.86,13.16,7.6c-0.62,4.54-1.44,9.09-1.16,13.7c2.11,5.98,8.03,10.05,9.24,16.42c2.56,8.84-1.93,17.43-2.92,26.09c-0.65,8.14,3.8,15.16,6.28,22.58c0.52,1.8,0.77,3.67,0.76,5.63c-0.33,7.45,3.61,13.84,5.72,20.7c0.43,4.23,3.12,7.44,5.54,10.67c5.88-2.56,13.43-1.47,18.23-6c0.35-0.95,0.99-1.63,1.92-2.04c5.03-4.33,8.65-10.45,10.18-16.92c0.91-3.6,3.23-6.52,5.33-9.49c3.47-5.2-0.62-11.99,2.91-17.22c2.82-4.1,7.5-6.21,11.65-8.73C490.87,367.495,486.8,356.435,488.08,345.035 M511.44,359.355c-1.12,0.4-2.23,0.81-3.34,1.22c2,8.17-7.02,12.62-10.6,18.7c-1.28,6.86-2.24,13.9-2.13,20.91c0.09,1.22,0.14,2.44,0.17,3.67c-0.27,1.6,0.69,3.59,2.54,3.48c0.97-0.01,1.95,0.05,2.93,0.16c1.47,0.12,2.95,0.22,4.44,0.31c2.46-9.41,4.82-18.85,7.04-28.32c1.41-5.41-1.91-11.14,0.56-16.4C512.51,361.835,511.97,360.595,511.44,359.355z'/></svg>"],["east_asia_pacific","East Asia & Pacific","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='east_asia_pacific' d='M673.78,359.585c1.46,1.17,2.93,2.37,4.62,3.23c2.09-2.16,4.08-4.44,5.93-6.82c-8.72,2.34-16.34-5.53-25.18-1.45c-1.03,0.4-1.94,0.24-2.73-0.46c-4.84-4.17-10.66-6.75-17.2-6.55c-1.27-0.05-1.79-0.68-1.57-1.9c0.17-1.64,0.37-3.28,0.48-4.91c0.03-1.18,0.1-2.34,0.2-3.5c-1.12-1.44-2.53-2.6-3.85-3.81c-1.09-6.14-1.85-12.37-3.76-18.33c-1.72-3.65-5.16-6.21-6.8-9.9c-0.54-3.21,0.4-6.45,0.62-9.65c4.63,2.68,7.54,7.26,10.73,11.39c3.93-2.52,7.66-5.55,10.13-9.58c0.92-6.9-2.27-13.36-5.55-19.17c-1.79-2.71-0.06-5.83,0.57-8.6c1.45,0,2.91,0,4.37,0.01c-1.13,2.28-2.32,4.52-3.45,6.79c1.75,1.14,3.52,2.28,5.3,3.41c2.72-4.47,3.4-10.99,8.99-12.92c5.66-1.83,11.2-5.22,12.78-11.45c0.19-1.01,0.74-1.76,1.65-2.26c2.63-2.21,3.59-5.83,3.45-9.15c-0.05-1-0.05-1.99,0.01-2.97c0.36-5.74-2.52-10.9-4.7-16.01c2.42-2.33,4.68-4.82,6.89-7.34c-1.89-0.71-3.8-1.39-5.69-2.07c2.26-1.55,4.64-2.92,6.99-4.34c2.78,5.42,4.8,11.15,6.72,16.92c2.27-1.04,4.51-2.18,6.7-3.41c-1.55-7.61,0.35-15.09,1.16-22.61c0.2-3.31,0.58-6.58,1.13-9.83c1.93-2.68,4.22-5.09,6.48-7.51c-5.43-1.11-9.5-5.07-13.27-8.84c-3.16-3.51-3.2-8.54-4.13-12.93c-2.61-0.44-5.08-0.84-7.64-1.26c-2.02,4.14-2.97,9.41-6.5,12.45c-7.78,0.26-15.41,1.65-23.11,2.61c-7.94-2.57-15.44-6.53-23.21-9.66c-0.96,2.69-1.6,5.48-2.53,8.19c-5.15-1.23-10.96-3.49-16.05-0.7c-6.92,3.8-12.21,9.89-17.81,15.33c-4.57,3.74-2.78,10.8-7.27,14.61c-2.84,3.03-7.1,4.04-10.66,5.8c0.78,2.66,1.56,5.35,2.66,7.9c3.58,6.07,10.11,11.34,9.06,19.04c1.46,0.12,2.04,0.91,1.74,2.36c1.68,0.49,3.34,1.04,5,1.62c1.47,0.32,2.05,1.18,1.75,2.57c3.69,1.22,7.36,2.51,11.14,3.41c0.09-1.88,2.77-2.14,3.26-0.34c5.16-1.63,10.4-3.01,15.74-3.96c-0.39,10.36-6.57,18.96-10.55,28.14c-0.57,3.1,1.76,5.75,3.84,7.74c1.24,0.74,1.48,2.33,0.57,3.44c-0.34,0.73-1.04,2.2-1.38,2.93c2.27-0.22,4.55-0.47,6.83-0.72c1.46,4.8,3.78,9.65,2.78,14.77c-1.06,6.75,2.27,12.96,4.23,19.18c-3.76-1.78-7.58-3.45-11.61-4.52c0.85,3.8,1.4,7.78,3.87,10.94c6.44,9.51,11.34,20.71,21.1,27.36c1.07,0.44,1.51,1.21,1.33,2.3c-0.06,0.47-0.17,1.4-0.23,1.87c1.86-0.17,3.72-0.34,5.6-0.5c1.8-0.41,3.47,0.45,5.02,1.27c6.09,1.79,12.33,3.25,18.58,4.49C669.74,362.315,671.77,360.595,673.78,359.585 M691.93,240.635c1.09-0.46,2.19-0.91,3.31-1.35c0.229-1.49,0.479-2.96,0.74-4.44c0.14-1.11,0.81-1.68,2.01-1.69c6.03-1.36,11.64-4.12,17.6-5.75c1.32-5.8,3.39-11.49,3.68-17.47c-0.03-1,0.07-1.98,0.3-2.95c0.21-1.17,0.43-2.33,0.66-3.49c3.38-2.03,5.46-5.39,6.98-8.93c-2.29-1.45-4.49-3.07-6.96-4.2c-0.58-0.22-1.74-0.65-2.32-0.87c-2.2,5.1-7.26,10.67-3.86,16.32c0.82,1.06,1.22,2.59,0.17,3.67c-2.01,4.77-6.88,6.98-10.1,10.75c-4.21,4.14-9.85,6.39-14.81,9.44C690.25,233.325,691.12,236.955,691.93,240.635 M672.63,254.455c-4.63,3.53-5.19,9.39-3.15,14.67c2.53-0.86,3.6-3.21,3.04-5.76c-0.23-1-0.06-1.93,0.5-2.79C673.27,258.525,672.84,256.475,672.63,254.455 M684.31,305.865c-1.21-2.6-4.32-3.46-6.51-4.89c-0.41-1.04-0.82-2.07-1.22-3.1c0.61,0.07,1.84,0.22,2.45,0.29c1.17,0.01,1.81,0.6,1.91,1.77l0.11,0.62c-0.18-6.63-5.98-11.05-6.71-17.51c-0.29-0.97-0.33-1.95-0.1-2.94c0.12-1.02,0.37-3.08,0.49-4.11c-2.31,0.86-4.56,1.83-6.77,2.89c1.53-0.78,1.98,1.32,1.05,2.18c-2.58,4.38,0.16,9.5,1.25,13.88c1.79,5.69,2.71,11.61,3.67,17.47c2.35,1.86,5.14,3.06,7.74,4.54C683.42,313.545,685.43,309.925,684.31,305.865 M667.62,296.795c-3.66,2.94-7.17,6.78-7.05,11.79c1.01-0.04,3.03-0.11,4.04-0.14C665.91,304.645,667.07,300.785,667.62,296.795 M770.41,322.895c-0.63,0.21-1.9,0.62-2.53,0.82c2.58,3.25,5.3,6.39,7.44,9.97c1.87-3,5.92-6.7,2.96-10.29c-0.68-0.78-0.98-1.67-0.89-2.69c-0.27-2.58-1.59-4.87-2.62-7.19c-2.53,0.54-5.05,1.13-7.6,1.51c0.02-1.65,0.04-3.31,0.02-4.95c0.14-0.55,0.42-1.65,0.56-2.2c-0.81-0.11-2.43-0.32-3.24-0.43c-0.05,4.21-0.07,8.42-0.08,12.64c2.34,0.16,4.68,0.02,7.03,0.17C773.84,320.375,771.94,323.065,770.41,322.895 M651.81,319.775c-2.78,3-6.91,4.45-9.38,7.72c-1.84,2.22,0.1,4.87,0.92,7.09c2.32,4.22,4.22,11.11,10.73,9.48c4.49,1.37,7.38-2.16,10.35-4.63c0.79,3.51,1.47,7.03,2.24,10.56c2.42-1.41,5.85-2.03,7.44-4.36c-0.31-8.07,5.5-14.08,7.37-21.54c-3.15,0.98-6.43,1.8-9.61,2.57c-1.14-0.18-3.43-0.54-4.58-0.72c-0.46-0.16-1.37-0.48-1.83-0.65c0.87-3.49,1.63-7.03,1.88-10.63c-1.52-1.11-4.58-3.35-6.1-4.47C657.38,312.615,655.24,316.865,651.81,319.775 M716.22,314.735c-0.7,2.41-1.53,4.75-2.14,7.19c2.21-0.34,4.45-0.56,6.7-0.62c2.33-0.21,4.66-0.43,6.99-0.69c0.86-0.11,1.75-0.23,2.64-0.35c2.13,3.19,4.69,6.06,7.35,8.83c0.61-5.42-2.51-10.07-5.11-14.5C727.25,315.965,721.66,315.605,716.22,314.735 M745.38,325.445c0.99-0.68,1.98-1.36,2.99-2.03c0.01-0.85,0.05-2.55,0.07-3.39c-1.24,0.36-2.47,0.74-3.68,1.14c-0.55,0.02-1.66,0.04-2.21,0.06c0.06,0.83,0.18,2.51,0.24,3.34C743.76,324.505,744.63,324.795,745.38,325.445 M754.89,329.085c1.41-1.37,2.81-2.76,4.18-4.18c-1.57-0.18-3.14-0.35-4.69-0.51C754.54,325.955,754.71,327.515,754.89,329.085 M784,335.575c0.54,0.85,0.73,1.78,0.55,2.79c0.04,4.68,0.6,11.77,6.25,13.2c1.24,0.42,2.42,1.11,3.15,2.25l0.54,0.66c-0.1-4.59-3.38-7.58-5.36-11.28c-1.65-5.98,0.69-13.84-5.5-17.62C783.7,328.915,783.47,332.245,784,335.575 M738.22,351.265c2.28-1.87,2.94-4.92,3.98-7.54c-3.94,1.24-7.93,2.31-12,3c-2.32-3.02-4.71-6.29-8.55-7.44c-4.96-2.08-10.62-5.53-16.02-2.74c-3.32-3.38-7.52-5.99-12.54-5.71c0.63,4.98,1.42,10.02,3.73,14.54l1.31-0.02c1.86-0.06,3.72,0.2,5.58,0.77c1.35,0.38,2.71,0.78,4.08,1.2c0.16,3.48,0.17,6.98-0.01,10.46c5.79,1.61,12.23,3.66,17.67-0.04c3.17,3.67,7.41,5.98,12.14,7.12c0.23-1.55,0.71-4.65,0.94-6.19c-2.38-1.46-4.77-2.91-7.15-4.37c0.24-0.97,0.5-1.92,0.77-2.88C734.16,351.565,736.26,351.985,738.22,351.265 M747.51,336.595c1.25-0.08,2.51-0.15,3.77-0.21c0.43-1.03,0.86-2.05,1.31-3.06c-1.69-0.35-3.38-0.7-5.05-1.06C747.53,333.705,747.52,335.145,747.51,336.595 M740.72,357.255c3.73,5.23,7.87,12.81,15.28,12.14c-0.18-0.56-0.54-1.67-0.72-2.22C755.01,360.005,746.17,358.795,740.72,357.255 M732.82,389.945c-3.18-4.36-3.65-9.92-6.24-14.55c-2.65-4.47-3.5-10.4-8.64-12.82c-1.37,5.26-2.32,10.61-3.11,16c0.24,1.43-1.62,2.05-2.38,0.88c-3.72-2.13-5.71-5.84-5.91-10.22c-0.44-1.1-0.59-2.38,0.05-3.43l0.46-1.11c-3.66-0.73-7.43-1.31-11.17-0.83c-4.22,1.41-5.51,6.3-7.89,9.56c-1.01-1.29-2-2.6-2.96-3.91c-4.9,4.1-13.1,6.94-12.4,14.59c-0.05,1.28-0.33,2.89-1.77,3.29c-5.3,2.55-10.89,4.52-15.89,7.66c-1.5,0.99-2.58,2.57-2.64,4.42c-1.65,13.09,5.13,25.3,5.65,38.3c1.33-0.09,2.68-0.18,4.03-0.28c0.97-0.11,1.96-0.14,2.96-0.08c9.6-0.06,17.45-6.79,26.521-8.85c4.88-1.58,8,2.36,10.39,5.67c2.44,3.52,6.3,5.52,9.75,7.89c1.16,3,1.44,6.91,4.12,9.14c3.58,0.61,7.22-0.03,10.8-0.46c3.5-0.72,8.19-0.65,10.47-4.02c0.55-1.06,1.34-1.39,2.38-0.98c-0.11-7.39,2.05-14.43,5.78-20.78c0.08-0.56,0.23-1.68,0.31-2.24c0.56-5.14-0.03-10.4-0.92-15.45C742.11,400.645,735.92,396.295,732.82,389.945 M774.13,387.045c-2.23-1.19-4.52-2.24-6.85-3.19c0.84,6.64,1.34,13.59,4.35,19.7C777.2,399.325,771.4,392.495,774.13,387.045 M794.97,401.925c-2.66,2.09,1.33,2.19,2.9,2.5c0.57,0.02,1.71,0.05,2.27,0.07c2.72-0.38,3.11-4.32,4.28-6.4c-2.6,0.35-5.12,0.95-7.56,1.79C796.5,400.815,795.87,401.495,794.97,401.925 M813.64,398.695c-2.08,2.31-3.9,4.88-5.24,7.7c-1.62,2.94,1.29,5.67,2.64,8.08c1.5-3.68,3.25-7.48,3.15-11.53C813.98,401.525,813.75,400.115,813.64,398.695 M788.49,435.135c1.1,4.84,3.229,9.63,2.34,14.71c-1.56,4.38-5.11,7.65-7.52,11.56c-2.55,4.47-7.13,7.01-11.11,9.98c0.12,4.16,2.72,9.01,7.91,6.7c3.73,0.13,5.64-3.56,5.23-6.87c-0.18-1.11,0.19-1.94,1.1-2.52c7.36-4.71,12.74-12.19,14.63-20.71c0.09-0.96,0.33-1.89,0.71-2.76C795.11,445.265,792.08,439.535,788.49,435.135 M723.63,455.055c1,4.84,2.04,9.71,3.71,14.37c5.46-2.19,8.23-7.54,7.8-13.37C731.27,456.055,727.42,455.755,723.63,455.055z'/></svg>"],["south_asia","South Asia","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='south_asia' d='M601.63,246.995c-1.07,0.51-2.16,0.62-3.26,0.34c-3.78-0.9-7.45-2.19-11.14-3.41c-1.28-0.34-1.86-1.2-1.75-2.57c-1.66-0.58-3.32-1.13-5-1.62c-1.29-0.26-1.88-1.04-1.74-2.36c1.05-7.7-5.48-12.97-9.06-19.04c-3.8,0.06-7.53,0.15-11.31,0.2c-0.73-0.14-2.2-0.42-2.94-0.56c-6.29,1.78-12.33,4.28-18.51,6.36c-3.12,8.02,0.28,16.11,2.42,23.86c2.17,4.11-1.04,7.46-2.88,10.72c3.76,0.44,7.52,0.82,11.31,1.26c3.44,5.13,8.18,9.16,12.36,13.65c2.5,5.67,2.57,12.13,5.07,17.83c2.35,5.49,3.82,11.29,5.51,17.01c1.95-0.71,3.89-1.43,5.83-2.16c0.76,2.94,1.48,5.9,2.28,8.86c1.94-0.91,3.93-1.79,5.63-3.12c0.2-5.39-4.38-9.48-4.46-14.8c-0.021-4.48-1.46-9.7,2.32-13.11c4.66-5.32,9.59-10.53,15.38-14.64c3.07,0.03,6.11,0.85,9.13,1.48c3.98-9.18,10.16-17.78,10.55-28.14C612.03,243.985,606.79,245.365,601.63,246.99 M591.761,303.9c0,6.72,0.83,13.56-0.69,20.19c1.29,0.4,2.56,0.81,3.87,1.2c3.3-6.65,2.56-14.28,0.82-21.29C594.421,303.96,593.091,303.93,591.761,303.9z'/></svg>"],["middle_east_north_africa","Middle East & North Africa","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='middle_east_north_africa' d='M539.34,248.195c-2.14-7.75-5.54-15.84-2.42-23.86c-2.55-2.9-4.72-6.23-7.82-8.55c-3.76,0.07-7.32,1.15-10.88,2.17c-3.09-0.28-5.96-1.47-8.81-2.57c-3.41-1.2-6.9-2.16-10.37-3.16c-0.29,1.63-0.88,4.87-1.17,6.5c-5.93,0.71-11.98,0.86-17.75,2.52c-2.52,0.6-2.94,3.38-3.46,5.49c-0.93,3.22-1.05,7.96-4.96,9.05c-8.68,2.12-17.59-0.32-25.24-4.46c-2.21,2.25-4.4,4.52-6.57,6.8c-4.71-2.71-9.39-5.47-14.02-8.3c-1.19-3.9-1.29-8.46-3.94-11.78c-3.08-2.15-7.27-0.19-10.57-0.3c-8.18,0.62-16.06,2.8-24.04,4.54c-1.61,0.37-3.24,0.7-4.85,1.04c-3.75,5.03-8.11,9.99-8.7,16.54c-0.25,3.94-4.05,5.46-7.03,7.06c-0.11,0.71-0.32,2.14-0.42,2.85c0.35,0.06,1.06,0.18,1.42,0.25c5,1.01,10.31,1.72,14.65,4.58c1.96,1.35,3.73,2.96,5.43,4.62c6.21,6.14,12.25,12.44,18.54,18.5c8.44-6.15,16.81-15.36,28.23-14.57c5.96,1.45,10.85,5.89,16.83,7.39c3.56-1.85,6.28-5.21,10.11-6.5c6.51-0.34,13,0.35,19.5,0.67c-1.49-4.16-3.04-8.29-4.39-12.49c7.47,11.08,12.24,23.78,15.75,36.61c1.42,2.73,2.93,5.42,4.4,8.13c9.35-5.37,19.76-9.02,27.99-16.19c3.55-4.15,6.63-8.67,9.82-13.09c-2.02-3.28-3.91-6.63-5.5-10.14c2.46,0.42,4.91,0.88,7.36,1.37C538.3,255.655,541.51,252.305,539.34,248.195z M514.19,255.825c-2.91-3.79-4.66-8.33-5.75-12.95c4.8,4.17,9.01,9.01,12.95,14C519.02,256.865,515.88,258.145,514.19,255.825z'/></svg>"],["europe_central_asia","Europe & Central Asia","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 833 532'><path id='europe_central_asia' d='M527.62,81.815c-1.81-4.6-3.69-9.97-0.39-14.54c5.21-8.59,15.11-11.99,24.07-15.18c3.03-0.96,3.76-4.4,5-6.91c-7.53-0.09-14.66,2.35-21.78,4.44c-3.29,1.39-7.55,2.13-9.06,5.83c-4.25,6.76-8.13,13.75-12.72,20.29C515.48,81.435,521.66,83.515,527.62,81.815 M341.44,55.475c2.64-5.77,2.33-12.32,3.2-18.47c2.12-5.6,7.66-8.51,12.64-11.14c-2.48-4.16-7.41-4.5-11.73-5.39c-1.93-4.7-5.32-9.04-10.31-10.7c-6.87-3.27-14.33,0.62-21.45-1.67c-0.25,1.23-0.74,3.68-0.99,4.91c-9.18-5.71-20.98-4.25-30.18,0.55c-2.57,2.44-4.15,5.811-7.13,7.86c-0.84,0.83-1.73,0.88-2.67,0.14l-1-0.64c0.11,2.5,0.33,7.51,0.44,10.01c2.76,5.82,9.96,5.83,15.44,6.91c1.62,8.65,2.63,17.41,3.47,26.16c-0.36,4.92-3.41,9.54-2.26,14.57c0.59,0.83,0.8,1.76,0.63,2.77c-1.49,7.83,3.9,13.85,10.46,16.91c2.5-5.38,5.09-10.73,7.75-16.03c6.5-1.83,12.02-5.88,18.47-7.86c3.54-1.57,8.57-2.06,9.74-6.47c1.76-4-1.85-7.38-4.19-10.16C334.89,56.945,339.65,58.825,341.44,55.475 M782.56,84.155c-0.47,1.66-0.93,3.31-1.37,4.97c-7.42-4.41-16.63-3.57-24.01-8.03c-3.6-1.87-8.34-4.57-11.86-1.13c-0.67,1.11-2.27,1.19-2.73-0.14c-1.93-2.52-4.26-4.72-6.5-6.93c-2.9-1.18-6.16-0.08-9.1-1.11c-2.08-0.67-4.09-1.6-6.23-2.06c-1.22-0.07-2.43-0.15-3.63-0.26c-3.82-0.47-6.46,2.71-8.73,5.25c-0.65,0.86-1.51,1.19-2.58,0.99c-5.28-0.07-10.45,1.31-15.52,2.62c-1.25-3.96-2.14-8.02-3.06-12.05c-3.4-0.93-6.9-1.53-10.4-1.78c-1.15,1.67-2.18,3.45-3.67,4.83c-7.39-2.12-14.71-4.59-22.08-6.8c4.31-4.31,3.24-10.23,1.69-15.56c-4.26-1.08-9.13-0.43-12.88-3.02c-2.73-1.15-5.55-4.33-8.78-2.89c-4.63,1.89-7.72,6.08-11.67,8.99c-0.94,1.22-2.53,0.86-3.63,0.13c-3.57-2.12-7.39,0.33-10.92,1.18c-3.15,1.06-6.58,1.43-9.43,3.17c-1.81,2.24-2.25,5.26-3.29,7.9c-3.35,0.92-6.69,1.79-9.97,2.88c-1.07,0.46-2.38,0.73-3.38-0.02c0.26,1.85,0.56,3.69,0.9,5.52c-1.38,0.87-2.76,1.75-4.07,2.7c-1.01,1.03-2.92,1.68-3.77,0.1c-1.22-1.48-2.42-2.97-3.62-4.46c-1.52,1.45-3,2.93-4.49,4.39c-0.29-1.5-0.56-3-0.83-4.5l-0.86,0.32c-0.58,0.08-1.73,0.23-2.3,0.31c-0.68-0.02-2.04-0.06-2.72-0.08c-1,0.05-1.99,0.06-2.97,0.03c-6.52,2.06-5,11.43-6.64,16.52c-2.74,0.12-8.21,0.37-10.95,0.49c-0.51,0.22-1.51,0.66-2.02,0.88c-6.07,4.03-13.7,2.67-20.54,3.83c-3.68,0.95-6.63,3.67-8.44,6.92c-0.37,1.29-2.96,3.74-3.3,1.27c-0.13-2.59,0.18-5.17,0.1-7.75c-1.56,0.02-3.09,0.22-4.62,0.42c-0.48,3.08-0.89,6.17-1.35,9.26c-0.96-0.03-1.91-0.06-2.85-0.08l-0.69-0.01c-0.12-0.56-0.35-1.69-0.47-2.25c0.55-4.48-4.63-5.86-7.42-8.12c-4.37-3.11-10.29-2.92-14.51-6.16c-1.89-3-4.35-6.24-8.3-5.63c-1.74,0.02-3.44,0.04-5.11,0.04c-3.89,0.05-7.2,2.34-10.38,4.3c-6.12,4.05-13.19,7.44-17,14.05c-3.09,3.72-4.11,8.54-6.6,12.59c-3.87,4.99-9.23,8.49-14.39,11.98c0.13,0.45,0.39,1.33,0.52,1.77c0.49,1.64,0.45,3.33-0.13,5.08c-0.65,4.67,0.22,9.36,1.08,13.95c3.49-1.03,7.01-2.11,10.44-3.38c-5.19,4.58-4.51,11.72-4.79,18.07c-5.61,0.48-9.03,4.69-12.28,8.67c-2.82-4.04-4.19-8.88-6.79-13.04c-3.39-4.97-2.78-11.3-4.86-16.78c-3.85,0.59-7.93,2.12-9.09,6.15c-1.5,5.26-5.89,8.7-8.52,13.26c-0.29,3.7-1.17,7.83,0.59,11.34c2.66,2.02,5.88,0.05,8.62-0.7c-1.86-2.64,2.4-3.49,1.38-0.3c-0.23,2.29-0.66,4.54-1.09,6.8c1.13,0.05,2.27,0.09,3.41,0.12c0.99-0.04,1.96,0.08,2.92,0.36c0.53,0.12,1.58,0.37,2.1,0.5c0.13,0.61,0.38,1.83,0.51,2.44c-1.7,0.42-5.09,1.26-6.79,1.68c2.46,4.73,5.97,8.77,9.08,13.07c-1.47,1.59-2.98,3.15-4.37,4.82c-0.56,1.31-2.18,1.05-2.73-0.11c-3.2-4.36-8.71-1.13-12.91-0.28l0.48,1.12c0.09,0.57,0.27,1.71,0.36,2.28c-0.18,3.27-0.21,6.55-0.1,9.82c-0.01,0.57-0.02,1.72-0.03,2.29c-1.01,5.3,2.93,9.34,6.84,12.16c1.61-0.34,3.24-0.67,4.85-1.04c3.93-1.6,8.15-3.58,10.14-7.58c3.83-9.05,11.45-15.77,20.29-19.76c4.51,6.36,11.12,11,14.27,18.37c-2.63,1.19-5.01,2.52-7.52,3.83c1.89,1.64,3.78,3.28,5.67,4.93c3.3-4.19,6.63-8.35,9.97-12.5c3.01,4.11,6.6,7.86,10.98,10.53c0.91-4.43,1.8-8.87,2.67-13.31c1.78,4.45,2.93,9.16,5.18,13.4c2.92,2.5,7.44,1.3,10.68,3.28c1.37,1.03,2.51,2.34,3.73,3.57c1.09-0.1,2.18-0.21,3.28-0.31c0.52-2.11,0.94-4.89,3.46-5.49c5.77-1.66,11.82-1.81,17.75-2.52c0.29-1.63,0.88-4.87,1.17-6.5c3.47,1,6.96,1.96,10.37,3.16c0.64-2.84,2.22-5.83,1.09-8.77c-1.88-5.67-4.27-11.17-5.61-17.01c3.46-1.03,6.89-2.32,10.5-2.77c2.05-0.38,0.94,2.57-0.5,2.53c-1.54,0.77-3.07,1.55-4.6,2.33c3.51,8.47,6.25,17.23,7.93,26.26c3.56-1.02,7.12-2.1,10.88-2.17c3.1,2.32,5.27,5.65,7.82,8.55c6.18-2.08,12.22-4.58,18.51-6.36c0.76-1.34,2.85-1.13,2.94,0.56c3.78-0.05,7.51-0.14,11.31-0.2c-1.1-2.55-1.88-5.24-2.66-7.9c3.56-1.76,7.82-2.77,10.66-5.8c4.49-3.81,2.7-10.87,7.27-14.61c5.6-5.44,10.89-11.53,17.81-15.33c5.09-2.79,10.9-0.53,16.05,0.7c0.93-2.71,1.57-5.5,2.53-8.19c7.77,3.13,15.27,7.09,23.21,9.66c7.7-0.96,15.33-2.35,23.11-2.61c3.53-3.04,4.48-8.31,6.5-12.45c2.56,0.42,5.03,0.82,7.64,1.26c0.93,4.39,0.97,9.42,4.13,12.93c3.77,3.77,7.84,7.73,13.27,8.84c-2.26,2.42-4.55,4.83-6.48,7.51c-0.55,3.25-0.93,6.52-1.13,9.83c3.57-2.16,7.68-3,11.79-3.44c2.33-3.44,4.73-6.82,7.14-10.21c3.52-4.73,3.61-10.92,5-16.44c0.34-0.46,1.02-1.38,1.36-1.84c0.11,0.38,0.34,1.14,0.46,1.52c0.39,5.9,0.36,11.82,0.59,17.73c0.58,0.22,1.74,0.65,2.32,0.87c2.51-2.36,2.13-6.16,2.76-9.21c1.33-7.43-0.54-15.01-1.69-22.31c-5.5-1.67-11.51-1.6-16.57-4.55c5.84-5.93,10.54-13.37,17.71-17.81c0.88-0.58,1.81-0.55,2.77,0.07c7.14,1.65,14.66,1.2,21.97,1.84c1.84-4.42,4.28-8.54,7.23-12.31c0.42-1.44,2.35-1.05,2.44,0.37c0.84,2.23,2.18,4.23,3.7,6.07c-4.17,5.31-8.48,10.49-13.43,15.09c0.47,7.37,1.65,14.67,3.36,21.85c0.76,0.01,2.28,0.04,3.04,0.05c5.11-6.79,9.88-13.92,13.45-21.65c1.55-3.07-0.6-6.21-1.42-9.16c3.15-1.99,6.47-3.78,9.42-6.09l0.49-0.41c0.91,0.25,2.74,0.73,3.65,0.98c0.94,0.28,1.89,0.56,2.85,0.84c5.1-6.6,13-10.06,21.08-11.21c-0.07-3.26-0.09-6.53,0.34-9.77c1.03-4.41,5.51-6.65,7.16-10.73c1.1-2.65,2.43-5.21,4.03-7.59C807.19,85.225,793.68,84.225,782.56,84.155z M385.7,162.815c-0.05-1.84-0.16-5.51-0.22-7.34c1.02,0.46,2.04,0.91,3.07,1.37C387.59,158.835,386.64,160.815,385.7,162.815z M394.6,173.925c-0.14-0.32-0.43-0.97-0.57-1.29C395.45,170.455,397.2,174.535,394.6,173.925z M438.12,204.965c-4.42-3.76-8.85-7.77-11.23-13.19c4.05,3.22,8.12,6.42,12.41,9.32C438.91,202.385,438.5,203.665,438.12,204.965z M444.704,121.556c0.179,3.023,0.504,6.094,0.636,9.14c1.19,2.4,2.7,4.63,4.09,6.94c-2.52,5.01-4.77,10.14-7.13,15.22c-5.5,0.7-10.72,2.77-16.23,3.35c1.14,1.52-2.28,2.63-2.17,0.7c-0.88-1.14-1.76-2.27-2.64-3.41c3.78,0.49,7.87,0.2,10.98-2.27c4.32-4.67,5.93-11.02,7.99-16.85c1.12-4.25-3.12-9.2,0.27-12.85c3.62-4.56,6.96-9.32,10.1-14.22c0.16,1.45,0.49,4.35,0.65,5.8C448.83,115.624,444.943,117.717,444.704,121.556z M454.54,132.865c0.94-1.11,2.72-1.21,4.05-0.85C460.19,133.855,454.77,134.815,454.54,132.865z M483.39,105.225c0.79,1.46,1.61,2.91,2.41,4.37c-3.5-0.36-7.11-0.62-10.28-2.27C478.12,106.565,480.75,105.865,483.39,105.225z M479.47,188.485c-1.11,1.45-3.02-0.54-1.66-1.66C478.93,185.465,480.92,187.385,479.47,188.485z M476.26,200.025c-1.23,1.23-2.44,1.22-3.64-0.01c-3.07,1.83-6.33,3.33-9.57,4.82c-0.51-2.02-1.2-4.04-1.19-6.15c1.32-3.52,3.58-6.61,5.46-9.86c4.19,5.28,11.54,2.83,16.76,6.08c2.16,2.88,4.09,5.95,5.91,9.07C485.23,203.475,480.48,202.345,476.26,200.025z M563.81,93.445c-1.04-1.29-1.04-3.57,0-4.86C565.41,89.035,565.41,92.995,563.81,93.445 M444.69,121.695c0.002-0.048,0.011-0.092,0.014-0.14c-0.011-0.173-0.025-0.348-0.034-0.521L444.69,121.695 M340.98,105.145c2.18,5.34,3.83,15.85,11.97,12.85c1.13-0.39,2.32-0.61,3.53-0.52c0.59,0.01,1.77,0.03,2.36,0.04c7,1.57,9.34-6.93,9.48-12.13C359.71,101.875,349.59,101.475,340.98,105.145 M413.6,206.395c0.53,2.06,1.9,4.81,4.19,5.07c0.56-0.03,1.68-0.08,2.25-0.11c0.35-0.23,1.05-0.68,1.4-0.9c-0.04-4.44-1.94-8.54-3.5-12.6C416.23,200.505,413.58,203.055,413.6,206.395 M450.56,221.285c-1.37,2.07-0.08,4.49,0.33,6.65c1.83-0.41,5.49-1.24,7.32-1.65C456.09,224.075,453.87,221.435,450.56,221.285z'/></svg>"]],
console.log(a)),e.indexOf("?geo.cat=income_groups&select=geo,geo.name,shape_lores_svg")>-1&&(Ft("WAFFLE READER: APPLYING STUB FUNCTIONALITY TO GET DATA income_groups, WHICH IS NOT YET IN WS"),a.rows=[["lower_middle_income","Lower middle income",null],["low_income","Low income",null],["upper_middle_income","Upper middle income",null],["high_income","High income",null]],console.log(a)),e.indexOf("?geo.cat=landlocked&select=geo,geo.name,shape_lores_svg")>-1&&(Ft("WAFFLE READER: APPLYING STUB FUNCTIONALITY TO GET DATA landlocked, WHICH IS NOT YET IN WS"),a.rows=[["landlocked","Landlocked",null],["coastline","Coastline",null]],console.log(a)),e.indexOf("?geo.cat=g77_and_oecd_countries&select=geo,geo.name,shape_lores_svg")>-1&&(Ft("WAFFLE READER: APPLYING STUB FUNCTIONALITY TO GET DATA g77_and_oecd_countries, WHICH IS NOT YET IN WS"),a.rows=[["others","Others",null],["oecd","OECD",null],["g77","G77",null]],console.log(a)),e.indexOf("?geo.cat=main_religion_2008&select=geo,geo.name,shape_lores_svg")>-1&&(Ft("WAFFLE READER: APPLYING STUB FUNCTIONALITY TO GET DATA main_religion_2008, WHICH IS NOT YET IN WS"),a.rows=[["eastern_religions","Eastern religions",null],["muslim","Muslim",null],["christian","Christian",null]],console.log(a)),a=Pt(this._uzip(a.data||a),this._parsers),ss[e]=a,this._parse(t,i,a),void(ls[e]=void 0)):(Ht("Empty json: "+e),void t.reject({message:this.ERROR_RESPONSE,data:e}))},_readCallbackError:function(t,e,i,a){t.reject({message:this.ERROR_NETWORK,data:e})},_uzip:function(t){for(var e,i=t.rows,a=t.headers,n=new Array(i.length),s=0;s<i.length;s++){n[s]={};for(var l=0;l<a.length;l++)e=a[l],n[s][e]="","undefined"!=typeof i[s][l]&&null!==i[s][l]&&(n[s][e]=i[s][l].toString()),"geo.cat"===e&&(n[s][e]=[n[s][e]])}return n},_parse:function(t,e,i){var a=i;if(e.orderBy&&a[0]){if(!a[0][e.orderBy])return t.reject({message:this.ERROR_ORDERING,data:e.orderBy});a.sort(function(t,i){return t[e.orderBy]-i[e.orderBy]})}this._data=a,t.resolve()}}),os=function(){function t(t){return e()(t)}function e(t){return t?a:i}function i(t,i){return t?t.toString()===t||n(t)?t:Array.isArray(t)?t.map(e(1)).join():"object"==typeof t?s(t).map(e(1)).join():t:t}function a(t){return encodeURI(t).replace(/,/g,":")}function n(t){return parseInt(t,10)==t}function s(t){return Object.keys(t).map(function(e){return t[e]===!0?[e]:[e,t[e]]})}return{encodeQuery:t}}(),cs={},hs={},ds=we.extend({init:function(t){this._name="json",this._data=[],this._basepath=t.path,this._parsers=t.parsers,this._basepath||Ht("Missing base path for json reader")},read:function(t,e){var i=this,a=new l,n=this._basepath.replace("{{LANGUAGE}}",e);return i._data=[],function(t,e){function a(t){t=t[0].map(function(t){return t["geo.cat"]=[t["geo.cat"]],t["geo.world_4region"]=t["geo.world_4region"]||t.geo,t}),t=Pt(t,i._parsers);var e=Object.keys(i._parsers),a=e[0];return t.sort(function(t,e){return t[a]-e[a]}),t}function s(a){var n=a,s=t.where;s["geo.category"]&&(s["geo.cat"]=wt(s["geo.category"]),s["geo.category"]=void 0),s=Pt([s],i._parsers)[0];var l=[];return xt(s,function(t,e){for(var i=0,a=n.length;a>i;i++)if(n[i].hasOwnProperty(e))return l.push(e),!0}),s=wt(s,l),n=Lt(n,s),0==n.length?void e.reject("data reader returns empty array, that's bad"):(n=n.map(function(e){return wt(e,t.select)}),i._data=n,void e.resolve())}cs.hasOwnProperty(n)?s(cs[n]):hs.hasOwnProperty(n)?hs[n].then(function(){s(cs[n])}):(d3.json(n,function(t,e){return e?t?void Ht("Error Happened While Loading JSON File: "+n,t):(e=a(e),cs[n]=e,hs[n].resolve(),hs[n]=void 0,void s(e)):void Ht("No permissions or empty file: "+n,t)}),hs[n]=new l)}(t,a),a},getData:function(){return this._data}}),us=we.extend({init:function(t){this.name="inline",this._super(t)}}),ms={},gs={},ps=we.extend({init:function(t){this._name="graph",this._data=[],this._basepath=t.path,this._parsers=t.parsers,this._basepath||Ht("Missing base path for graph reader")},read:function(t,e){function i(t){return"string"==typeof t?t:t.getUTCFullYear()}var a=this,n=new l,s=this._basepath;if(t.where.time){var r=t.where.time[0],o="undefined"!=typeof r.join&&2===r.length?JSON.stringify({from:i(r[0]),to:i(r[1])}):i(r[0]);s+="?time="+o}return a._data=[],function(t,e){function i(t){return t?(t=r(n(t.data)),ms[s]=t,gs[s].resolve(),gs[s]=void 0,void o(t)):void Ht("Empty json: "+s,error)}function n(t){for(var e=t.rows,i=t.headers,a=new Array(e.length),n=0;n<e.length;n++){a[n]={};for(var s=0;s<i.length;s++)a[n][i[s]]=(e[n][s]||"").toString(),"geo.cat"===i[s]&&(a[n][i[s]]=[a[n][i[s]]])}return a}function r(t){t=Pt(t,a._parsers);var e=Object.keys(a._parsers),i=e[0];return t.sort(function(t,e){return t[i]-e[i]}),t}function o(i){var n=i,s=t.where;s["geo.category"]&&(s["geo.cat"]=wt(s["geo.category"]),delete s["geo.category"]),s=Pt([s],a._parsers)[0];var l=[];xt(s,function(t,e){for(var i=0,a=n.length;a>i;i++)if(n[i].hasOwnProperty(e))return l.push(e),!0}),s=wt(s,l),n=Lt(n,s),0===n.length&&Ft("data reader returns empty array, that's bad"),n=n.map(function(e){return wt(e,t.select)}),a._data=n,e.resolve()}return ms.hasOwnProperty(s)?(o(ms[s]),e):gs.hasOwnProperty(s)?(gs[s].then(function(){o(ms[s])}),e):(gs[s]=new l,me(s,[],i,console.error.bind(console),!0),e)}(t,n),n},getData:function(){return this._data}}),fs=null,vs=null,bs={},ys=[];Y.prototype.reset=function(){fs=null,vs=[],bs={},ys=[],_s.FILE_CACHED={},_s.FILE_REQUESTED={}},Y.prototype.getIndex=function(t){var e=this.ddfPath+"ddf--index.csv",i=W(e);i.then(function(){fs=_s.FILE_CACHED[e],t(null,fs)},function(e){t(e)})},Y.prototype.getConceptFileNames=function(){var t=this,e=[];return fs&&fs.forEach(function(i){"concept"===i.key&&e.push(t.ddfPath+i.file)}),Et(e)},Y.prototype.getEntitySetsByQuery=function(t){if(!t||!t.select||!t.where)return'Wrong entities query; it should contain "select" and "where" fields';var e=j(t).filter(function(t){return"entity_set"===bs[t]}),i=V(t).filter(function(t){return"entity_set"===bs[t]});return i.length>0?i:e},Y.prototype.getEntityFileNames=function(t){var e=this,i=[],a=this.getEntitySetsByQuery(t);return"string"==typeof a?a:(fs&&fs.forEach(function(t){a.indexOf(t.key)>=0&&i.push(e.ddfPath+t.file)}),Et(i))},Y.prototype.getHeaderDescriptor=function(t,e){var i=0,a={};return e&&t.map(function(t){var n=t.indexOf("."),s=n>=0?t.substr(n+1):t;e[s]&&(a[s]=t,i++)}),a.latitude="geo.latitude",a.longitude="geo.longitude",{needed:i>0,convert:a}},Y.prototype.applyFilter=function(t,e){var i=0;for(var a in e)if(e.hasOwnProperty(a)){var n=a.indexOf("."),s=n>=0?a.substr(n+1):a;if(!t[s])continue;t[s].toUpperCase()===e[a].toString().toUpperCase()&&i++}return Object.keys(e).length===i},Y.prototype.getFilterConvertPairs=function(t){var e={};for(var i in t)if(t.hasOwnProperty(i)){var a=i.indexOf(".");a>=0&&(e[i.substr(0,a)]=i.substr(a).replace(/^.is--/,""))}return e},Y.prototype.normalizeAndFilter=function(t,e,i){var a=this,n=[],s=a.getFilterConvertPairs(i);return e.forEach(function(e){if(a.applyFilter(e,i)){var l={};for(var r in e)if(e.hasOwnProperty(r)){var o=t.convert[r];for(var c in s)s.hasOwnProperty(c)&&e[s[c]]&&(l[c]=e[s[c]]);o&&(l[o]=e[r])}n.push(l)}}),n},Y.prototype.getEntities=function(t,e){var i=this,a=[],n=i.getEntityFileNames(t);return"string"==typeof n?e(n):(n.forEach(function(t){a.push(W(t))}),a.length||e([]),void l.all(a).then(function(){var a=[];Object.keys(_s.FILE_CACHED).forEach(function(e){if(n.indexOf(e)>=0&&_s.FILE_CACHED[e]&&_s.FILE_CACHED[e][0]){var s=i.getHeaderDescriptor(t.select,_s.FILE_CACHED[e][0]);s.needed===!0&&(a=a.concat(i.normalizeAndFilter(s,_s.FILE_CACHED[e],t.where)))}}),a.length>0&&(ys=a),e(null,ys)},function(t){e(t)}))},Y.prototype.getConcepts=function(t,e){var i=this,a=[],n=i.getConceptFileNames();n.length||e(a),n.forEach(function(t){a.push(W(t))}),l.all(a).then(function(){var t=[];Object.keys(_s.FILE_CACHED).forEach(function(e){n.indexOf(e)>=0&&(t=t.concat(_s.FILE_CACHED[e]))}),t.length>0&&(vs=t,vs.forEach(function(t){var e=t.concept.split(/,/);e.forEach(function(e){bs[e]=t.concept_type})})),e(null,vs)},function(t){e(t)})},Y.prototype.getConceptsAndEntities=function(t,e){var i=this;i.getConcepts(t,function(a,n){return a?e(a):void i.getEntities(t,function(t,i){e(t,n,i)})})},Y.prototype.divideByQuery=function(t){var e=[],i=[];return t.select.forEach(function(t){"measure"===bs[t]&&e.push(t),"measure"!==bs[t]&&i.push(t)}),{measures:e,other:i}},Y.prototype.getDataPointDescriptorsByIndex=function(t){var e=this,i=[],a=[];return fs&&fs.forEach(function(n){if("measure"===bs[n.value]){var s=n.key.split(/,/),l=s.concat(n.value),r=0;l.forEach(function(e){t.select.indexOf(e)>=0&&r++}),r===l.length&&(a.push(e.ddfPath+n.file),i.push({fileName:e.ddfPath+n.file,measures:[n.value],measure:n.value,other:s}))}}),{descriptors:i,fileNames:a}},Y.prototype.getDataPointDescriptors=function(t){this.categorizedQuery=this.divideByQuery(t);var e=this.getDataPointDescriptorsByIndex(t),i=e.descriptors;return i},Y.prototype.getDataPointsContent=function(t,e){var i=this,a=[];return this.dataPointDescriptors=this.getDataPointDescriptors(t),this.dataPointDescriptors.forEach(function(t){a.push(W(t.fileName))}),a.length?void l.all(a).then(function(){i.dataPointDescriptors.forEach(function(t){t.content=_s.FILE_CACHED[t.fileName]}),e()},function(t){e(t)}):e()},Y.prototype.getExpectedConcept=function(t){for(var e=0;e<vs.length;e++)if(this.categorizedQuery.other.indexOf(vs[e].concept)>=0&&vs[e].concept_type===t)return vs[e].concept;return null},Y.prototype.getTimeConcept=function(){return this.getExpectedConcept("time")},Y.prototype.getEntityDomainConcept=function(){return this.getExpectedConcept("entity_domain")},Y.prototype.getDataPoints=function(t,e){var i=this;i.getDataPointsContent(t,function(a){if(a)return e(a);var n=i.getEntityDomainConcept(),s=i.getTimeConcept();i.dataPointDescriptors.forEach(function(t){t.contentHash={},t.content.forEach(function(e){t.contentHash[e[n]]||(t.contentHash[e[n]]={}),t.contentHash[e[n]][e[s]]=e[t.measure]})});var l=[],r=$(i.getEntityDomainConcept()),o=J(t.where[i.getTimeConcept()]);r.forEach(function(t){o.forEach(function(e){var a={};a[n]=t,a[s]=new Date(e);var r=0;i.dataPointDescriptors.forEach(function(i){i.contentHash[t]&&i.contentHash[t][e]&&(a[i.measure]=Number(i.contentHash[t][e]),r++)}),r===i.dataPointDescriptors.length&&l.push(a)})}),e(a,l)})},Y.prototype.cachedFileExists=function(t){return"undefined"!=typeof _s.FILE_CACHED[t]};var xs=null,_s={FILE_CACHED:{},FILE_REQUESTED:{}},zs=[/^(\d{4})$/,/^(\d{4})q(\d{1})$/,/^(\d{4})(\d{2})$/,/^(\d{4})w(\d{1,2})$/,/^(\d{4})(\d{2})(\d{2})$/],Ms=we.extend({init:function(t){this._name="ddf1-csv",this._data=[],this._ddfPath=t.path,this.ddf=new Y(this._ddfPath)},read:function(t,e){function i(){return t.select.indexOf("shape_lores_svg")>=0&&t.where["geo.cat"].length>0}var a=this,n=zt({},t),s=new l;return i()&&(a._data=tt(t.where["geo.cat"]),s.resolve()),i()||a.ddf.getIndex(function(){a.ddf.getConceptsAndEntities(n,function(t,e,i){t&&s.reject(t),!t&&a.ddf.divideByQuery(n).measures.length<=0&&(a._data=i,s.resolve()),a.ddf.divideByQuery(n).measures.length>0&&a.ddf.getDataPoints(n,function(t,e){t&&s.reject(t),t||(a._data=e,s.resolve())})})}),s},getData:function(){return this._data}}),ws={},Ss={},ks=we.extend({init:function(t){this._name="csv",this._data=[],this._basepath=t.path,this._parsers=t.parsers,this._basepath||Ht("Missing base path for csv reader")},read:function(t,e){var i=this,a=new l;this.path=this._basepath.replace("{{LANGUAGE}}",e),this.path=this.path.replace(/{{(.*?)}}/g,function(e,i){return i=i.toLowerCase(),rt(t.where[i])?t.where[i].sort().join("-"):t.where[i]});var n=this.path;return t.where.time&&1===t.where.time[0].length&&(n=n.replace(".csv","-"+t.where.time[0][0]+".csv")),i._data=[],function(t,e){function a(a){var n=a,s=t.where;s["geo.category"]&&(s["geo.cat"]=wt(s["geo.category"]),s["geo.category"]=void 0);var l=i.loadProperties(n,t);l.then(function(){var a=[];if(xt(s,function(t,e){for(var i=0,s=n.length;s>i;i++)if(n[i].hasOwnProperty(e))return a.push(e),!0}),s=wt(St(s),a),s=Pt([s],i._parsers)[0],n=Lt(n,s),0==n.length)return void e.reject("data reader returns empty array, that's bad");if(n=n.map(function(e){return wt(e,t.select)}),n=i.groupData(n,t),"undefined"==typeof n[0].year&&"undefined"==typeof n[0].time){var l=!0;xt(t.select,function(t){-1!==t.indexOf(".")&&(l=!1)}),l&&xt(n,function(t){t.year=new Date("2011")})}if("undefined"==typeof n[0].geo&&("undefined"!=typeof n[0].age||"undefined"!=typeof n[0].age_by_1_year)){var l=!0;xt(t.select,function(t){-1!==t.indexOf(".")&&(l=!1)}),l&&xt(n,function(t){t.geo="zaf"})}t.orderBy&&n[0]&&(n[0][t.orderBy]?n.sort(function(e,i){return e[t.orderBy]-i[t.orderBy]}):e.reject("Cannot sort by "+t.orderBy+". Column does not exist in result.")),i._data=n,e.resolve()})}var s=i.load(n,a);s.then(function(){a(ws[n])})}(t,a),a},getData:function(){return this._data},format:function(t){return t=t.map(function(t){return t["geo.cat"]&&(t["geo.cat"]=[t["geo.cat"]]),t}),t=Pt(t,this._parsers)},load:function(t){var e=this;return ws.hasOwnProperty(t)||Ss.hasOwnProperty(t)||(d3.csv(t,function(i,a){return a?i?void Ht("Error Happened While Loading CSV File: "+t,i):(a=e.format(a),ws[t]=a,void Ss[t].resolve()):void Ht("No permissions or empty file: "+t,i)}),Ss[t]=new l),Ss[t]},loadProperties:function(t,e){function i(t){var e=t.split(".");2==e.length&&(r[e[0]]=r[e[0]]||[],r[e[0]].push(t))}function a(e,i){var a=n.path.replace(".csv","-"+i+"-properties.csv"),s=new l,r=n.load(a);return r.then(function(){var n={};xt(ws[a],function(t){n[t[i]]=t}),xt(t,function(t,a){xt(e,function(e){n[t[i]]?t[e]=n[t[i]][e]:Ft(t[i]+" is missing from GEO-PROPERTIES.CSV")})}),s.resolve()}),s}var n=this,s=[],r={};return xt(e.select,function(t){i(t)}),xt(e.where,function(t,e){i(e)}),xt(r,function(t,e){t[e]=!0,s.push(a(t,e))}),s.length?l.all(s):new l.resolve},groupData:function(t,e){var i={},a=t.filter(function(t,a){for(var n,s=i,l=Object.keys(e.grouping),r=l.length,o=0;r>o;o++){var c,h=e.grouping[l[o]],d=l[o];if("age"==d||"age_by_1_year"==d){var u=h,m=0,g=Math.floor((t[d]-m)/u),p=g*u+m;p<e.where[d][0][0]&&(p=e.where[d][0][0]),c=p,t[d]=c}r-1>o?(s[t[d]]||(s[t[d]]={}),s=s[t[d]]):s[t[d]]?(s=s[t[d]],xt(e.select,function(e,i){-1==l.indexOf(e)&&-1==e.indexOf(l[0])&&(""===t[e]||+t[e]||0===+t[e])&&(s[e]=s[e]+t[e])}),n=!1):(s[t[d]]=t,n=!0)}return n});return a}}),Es={csv:ks,ddf:Y,ddf1csv:Ms,graph:ps,inline:us,json:ds,waffle:rs},Ts=Object.freeze({csv:ks,ddf:Y,ddf1csv:Ms,graph:ps,inline:us,json:ds,waffle:rs,"default":Es}),Os=function(t){return this.each(function(){it(this,t)})},Cs=function(t){return this.each(function(){it(this,null,t)})},Ls=function(t,e,i){var a=Hi.get(t);if(a){var n=new a(e,i);return Ls._instances[n._id]=n,n}Ht('Tool "'+t+'" was not found.')};Ls._instances={},Ls._globals=at,Ls.clearInstances=function(t){if(t)Ls._instances[t]=void 0;else{for(var e in Ls._instances)Ls._instances[e].clear();Ls._instances={}}},xt(Ts,function(t,e){we.register(e,t)}),xt(kn,function(t,e){ni.register(e,t)}),d3.scale.genericLog=et,d3.selection.prototype.onTap=Os,d3.selection.prototype.onLongTap=Cs,Ls.Tool=Hi,Ls.Component=ni,Ls.Model=Ie,Ls.Reader=we,Ls.Events=Le,Ls.utils=xe;var As=ni.extend({init:function(t,e){this.name="axislabeler",this.template="axislabeler.html",this.model_expects=[{name:"scales"},{name:"show"}];var i=this;this.model_binds={"change:scales":function(t){i.initScales(),i.update()},"change:show":function(t,e){i.initScales(),i.update()}},this._super(t,e),this.xScale=null,this.yScale=null,this.xAxis=L(),this.yAxis=L()},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-al-graph"),this.xAxisEl=this.graph.select(".vzb-al-axis-x"),this.yAxisEl=this.graph.select(".vzb-al-axis-y"),this.xInvert=function(e){return t.xScale(t.xScale.invert(t.xScale(e)))},this.yInvert=function(e){return t.yScale(t.yScale.invert(t.yScale(e)))},this.line=d3.svg.line().x(function(e){return t.xScale(e)}).y(function(e){return t.yScale(e)}),this.lineInvert=d3.svg.line().x(function(e){return t.xInvert(e)}).y(function(e){return t.yInvert(e)}),this.on("resize",function(){t.update()})},ready:function(){console.log("Model ready"),this.initScales(),this.update()},initScales:function(){var t=this.model.scales.domain;this.xScale=d3.scale[this.model.scales.xScaleType](),this.yScale=d3.scale[this.model.scales.yScaleType](),this.xScale.domain(t),this.yScale.domain(t),this.mockData=d3.range(t[0],t[t.length-1],(t[t.length-1]-t[0])/1e4),this.mockData.push(t[t.length-1])},update:function(){var t=this,e=this.model.show.toolMargin.getPlainObject(),i=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,a=parseInt(this.element.style("width"),10)-e.left-e.right||0;if(0>=i||0>=a)return Ft("Axis Labeler update() call interrupted for Vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")");var n=this.xScale.domain().length,s=this.yScale.domain().length;this.xScale.range(d3.range(n).map(function(t){return a/(n-1)*t})),this.yScale.range(d3.range(s).map(function(t){return i/(s-1)*t}).reverse()),this.xAxis.scale(this.xScale).orient("bottom").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.scales.xScaleType,toolMargin:e}),this.yAxis.scale(this.yScale).orient("left").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.scales.yScaleType,toolMargin:e}),this.xAxisEl.attr("transform","translate(0,"+i+")"),this.xAxisEl.call(this.xAxis),this.yAxisEl.call(this.yAxis);var l=this.graph.selectAll(".vzb-al-line").data([0]);l.enter().append("path").attr("class","vzb-al-line"),l.datum(this.mockData).attr("d",this.line);var r=this.graph.selectAll(".vzb-al-line-invert").data([0]);r.enter().append("path").attr("class","vzb-al-line-invert"),r.datum(this.mockData).attr("d",this.lineInvert);var o=d3.format(".4r"),c=this.graph.selectAll(".vzb-al-dots").data(this.mockData);c.enter().append("circle").attr("class","vzb-al-dots").attr("r",5).on("mouseenter",function(e,i){console.log("Point #"+i+": "+e+" x="+o(t.xScale(e))+" y="+o(t.yScale(e)))}),c.exit().remove(),c.attr("cx",function(e){return t.xScale(e)}).attr("cy",function(e){return t.yScale(e)});var h=this.graph.selectAll(".vzb-al-dots-invert").data(this.mockData);h.enter().append("circle").attr("class","vzb-al-dots-invert").attr("r",5).on("mouseenter",function(e,i){console.log("Point #"+i+": "+e+" x="+o(t.xScale(e))+" y="+o(t.yScale(e)))}),h.exit().remove(),h.attr("cx",function(e){return t.xInvert(e)}).attr("cy",function(e){return t.yInvert(e)})}}),Ds=0,Ps=[[-123,123],[1,1e4],[4,123],[6e-4,123],[123,4],[123,6e-4],[-123,-4],[-123,-6e-4],[-4,-123],[-6e-4,-123],[-123,1800],[1800,-123],[123,-18e3],[-18e3,123],[-6e-4,1800],[1800,-6e-4],[6e-4,-1800],[-1800,6e-4],[-12,-2],[-80,40],[5,8],[42,42],[5e-11,4554545484715],[-2611968678575,4554545484715],[-.002,.002],[-123,-.1,.002,1540],[-123,-.001,.5,1540],[123,.1,-.002,-1540],[123,.001,-.5,-1540]],Is=(Hi.extend("AxisLabeler",{init:function(t,e){this.name="axislabeler",this.components=[{component:As,placeholder:".vzb-tool-viz",model:["state.scales","state.show"]}],this._super(t,e)},default_model:{state:{scales:{domain:Ps[Ds],xScaleType:"linear",yScaleType:"genericLog"},show:{labelSize:"16px",labelMargin:{LR:"5px",TB:"5px"},toolMargin:{top:30,right:20,left:40,bottom:40}}},data:{noConceptprops:!0}}}),{id:"en",strings:{}}),Bs=window.location.href.split("/"),Rs=Bs.splice(0,Bs.indexOf("preview")).join("/")+"/preview/";return at.ext_resources=zt({host:Rs,preloadPath:"data/",dataPath:"data/waffles/"},at.ext_resources),En.define("default_model",{state:{time:{start:"1800",end:"2012",value:"2000",step:1},entities:{dim:"geo",show:{_defs_:{geo:["usa","swe","nor"],"geo.cat":["country","unstate"]}}},entities_minimap:{dim:"geo",show:{_defs_:{"geo.cat":["world_4region"]}}},marker:{space:["entities","time"],label:{use:"property",which:"geo.name"},axis_y:{use:"indicator",which:"sg_population",scaleType:"log",allow:{scales:["linear","log"]}},axis_x:{use:"property",which:"geo.name",allow:{scales:["ordinal"],names:["!geo","!_default"]}},color:{use:"property",which:"geo.world_4region",scaleType:"ordinal"}},marker_minimap:{space:["entities_minimap"],type:"geometry",shape:"svg",label:{use:"property",which:"geo.name"},geoshape:{use:"property",which:"shape_lores_svg"}}},data:{reader:"csv",path:at.ext_resources.host+at.ext_resources.dataPath+"dont-panic-poverty.csv"},language:Is,ui:{presentation:!1}}),Cn.define("default_model",{state:{time:{start:"1950",end:"2015",value:"2000",step:1},entities:{dim:"geo",show:{_defs_:{"geo.cat":["country","unstate"]}},opacitySelectDim:.3,opacityRegular:1},entities_minimap:{dim:"geo",show:{_defs_:{"geo.cat":["world_4region"]}}},entities_allpossible:{dim:"geo",show:{_defs_:{geo:["*"],"geo.cat":["country","unstate"]}}},marker_allpossible:{space:["entities_allpossible"],label:{use:"property",which:"geo.name"}},marker:{space:["entities","time"],label:{use:"property",which:"geo.name"},axis_x:{use:"indicator",which:"sg_population",scaleType:"log",allow:{scales:["linear","log"]}},axis_y:{use:"property",which:"geo.name",scaleType:"log",allow:{scales:["ordinal"]}},color:{use:"property",which:"geo.world_4region"}},marker_minimap:{space:["entities_minimap"],type:"geometry",shape:"svg",label:{use:"property",which:"geo.name"},geoshape:{use:"property",which:"shape_lores_svg"}}},language:Is,data:{reader:"csv",path:at.ext_resources.host+at.ext_resources.dataPath+"dont-panic-poverty.csv",splash:!0},ui:{presentation:!1}}),Dn.define("datawarning_content",{title:"",body:"Comparing the size of economy across countries and time is not trivial. The methods vary and the prices change. Gapminder has adjusted the picture for many such differences, but still we recommend you take these numbers with a large grain of salt.<br/><br/> Countries on a lower income levels have lower data quality in general, as less resources are available for compiling statistics. Historic estimates of GDP before 1950 are generally also more rough. <br/><br/> Data for child mortality is more reliable than GDP per capita, as the unit of comparison, dead children, is universally comparable across time and place. This is one of the reasons this indicator has become so useful to measure social progress. But the historic estimates of child mortality are still suffering from large uncertainties.<br/><br/> Learn more about the datasets and methods in this <a href='http://www.gapminder.org/news/data-sources-dont-panic-end-poverty' target='_blank'>blog post</a>",doubtDomain:[1800,1950,2015],doubtRange:[1,.3,.2]}),Dn.define("default_model",{state:{time:{start:"1800",end:"2015",value:"2015",step:1,speed:300},entities:{dim:"geo",opacitySelectDim:.3,opacityRegular:1,show:{_defs_:{"geo.cat":["country","unstate"]}}},entities_minimap:{dim:"geo",show:{_defs_:{"geo.cat":["world_4region"]}}},marker:{space:["entities","time"],label:{use:"property",which:"geo.name"},size:{use:"indicator",which:"population_total",scaleType:"linear",allow:{scales:["linear"]},extent:[.04,.85]},lat:{use:"property",which:"geo.latitude",_important:!0},lng:{use:"property",which:"geo.longitude",_important:!0},color:{use:"property",which:"geo.world_4region",scaleType:"ordinal",allow:{names:["!geo.name"]}}},marker_minimap:{space:["entities_minimap"],type:"geometry",shape:"svg",label:{use:"property",which:"geo.name"},geoshape:{use:"property",which:"shape_lores_svg"}}},data:{reader:"csv",path:at.ext_resources.host+at.ext_resources.dataPath+"dont-panic-poverty.csv",splash:!0},language:Is,ui:{chart:{labels:{dragging:!0}},presentation:!1}}),jn.define("datawarning_content",{title:"Income data has large uncertainty!",body:"There are many different ways to estimate and compare income. Different methods are used in different countries and years. Unfortunately no data source exists that would enable comparisons across all countries, not even for one single year. Gapminder has managed to adjust the picture for some differences in the data, but there are still large issues in comparing individual countries. The precise shape of a country should be taken with a large grain of salt.<br/><br/> Gapminder strongly agrees with <a href='https://twitter.com/brankomilan' target='_blank'>Branko Milanovic</a> about the urgent need for a comparable global income survey, especially for the purpose of monitoring the UN poverty-goal.<br/><br/> We are constantly improving our datasets and methods. Please expect revision of this graph within the coming months. <br/><br/> Learn more about the datasets and methods in this <a href='http://www.gapminder.org/news/data-sources-dont-panic-end-poverty' target='_blank'>blog post</a>",doubtDomain:[1800,1950,2015],doubtRange:[1,.8,.6]}),jn.define("default_model",{state:{time:{start:1800,end:2015,value:2015,step:1,delay:100,delayThresholdX2:50,delayThresholdX4:25},entities:{dim:"geo",opacitySelectDim:.3,opacityRegular:.7,show:{_defs_:{geo:["*"],"geo.cat":["country","unstate"]}}},entities_allpossible:{dim:"geo",show:{_defs_:{geo:["*"],"geo.cat":["country","unstate"]}}},entities_minimap:{dim:"geo",show:{_defs_:{"geo.cat":["world_4region"]}}},marker_allpossible:{space:["entities_allpossible"],label:{use:"property",which:"geo.name"}},marker:{space:["entities","time"],label:{use:"property",which:"geo.name"},axis_y:{use:"indicator",which:"sg_population",scaleType:"linear"},axis_x:{use:"indicator",which:"sg_gdp_p_cap_const_ppp2011_dollar",scaleType:"log",domainMin:.11,domainMax:500,tailFatX:1.85,tailCutX:.2,tailFade:.7,xScaleFactor:1.039781626,xScaleShift:-1.127066411},axis_s:{use:"indicator",which:"sg_gini",scaleType:"linear"},color:{use:"property",which:"geo.world_4region",scaleType:"ordinal",allow:{names:["!geo.name"]}},stack:{use:"constant",which:"all"},group:{use:"property",which:"geo.world_4region",manualSorting:["asia","africa","americas","europe"],merge:!1}},marker_minimap:{space:["entities_minimap"],type:"geometry",shape:"svg",label:{use:"property",which:"geo.name"},geoshape:{use:"property",which:"shape_lores_svg"}}},language:Is,data:{reader:"csv",path:at.ext_resources.host+at.ext_resources.dataPath+"dont-panic-poverty.csv",splash:!0},ui:{chart:{manualSortingEnabled:!0,yMaxMethod:"latest",probeX:1.85,xLogStops:[1,2,5],xPoints:50},presentation:!1}}),Xn.define("default_model",{state:{time:{start:1800,end:2012,value:2012,step:1},entities:{dim:"geo",show:{_defs_:{geo:["usa","swe","chn"],"geo.cat":["country","unstate"]}}},entities_minimap:{dim:"geo",show:{_defs_:{"geo.cat":["world_4region"]}}},marker:{space:["entities","time"],label:{use:"property",which:"geo.name"},axis_y:{use:"indicator",which:"sg_gdp_p_cap_const_ppp2011_dollar",scaleType:"log",allow:{scales:["linear","log","time"]}},axis_x:{use:"indicator",which:"time",scaleType:"time",allow:{scales:["time"]}},color:{use:"property",which:"geo.world_4region",allow:{scales:["ordinal"],names:["!geo.name"]}}},entities_allpossible:{dim:"geo",show:{_defs_:{geo:["*"],"geo.cat":["country","unstate"]}}},marker_allpossible:{space:["entities_allpossible"],label:{use:"property",which:"geo.name"}},marker_minimap:{space:["entities_minimap"],type:"geometry",shape:"svg",label:{use:"property",which:"geo.name"},geoshape:{use:"property",which:"shape_lores_svg"}}},data:{reader:"csv",path:at.ext_resources.host+at.ext_resources.dataPath+"dont-panic-poverty.csv",splash:!1},language:Is,ui:{chart:{labels:{min_number_of_entities_when_values_hide:2},whenHovering:{hideVerticalNow:!1,showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0,showTooltip:!1}},presentation:!1}}),Gn.define("datawarning_content",{title:"",body:"Comparing the size of economy across countries and time is not trivial. The methods vary and the prices change. Gapminder has adjusted the picture for many such differences, but still we recommend you take these numbers with a large grain of salt.<br/><br/> Countries on a lower income levels have lower data quality in general, as less resources are available for compiling statistics. Historic estimates of GDP before 1950 are generally also more rough. <br/><br/> Data for child mortality is more reliable than GDP per capita, as the unit of comparison, dead children, is universally comparable across time and place. This is one of the reasons this indicator has become so useful to measure social progress. But the historic estimates of child mortality are still suffering from large uncertainties.<br/><br/> Learn more about the datasets and methods in this <a href='http://www.gapminder.org/news/data-sources-dont-panic-end-poverty' target='_blank'>blog post</a>",doubtDomain:[1800,1950,2015],doubtRange:[1,.3,.2]}),Gn.define("default_model",{state:{time:{start:"1800",end:"2015",value:"2015",step:1},entities:{dim:"geo",show:{_defs_:{"geo.cat":["country","unstate"]}}},entities_minimap:{dim:"geo",show:{_defs_:{"geo.cat":["world_4region"]}}},marker:{space:["entities","time"],type:"geometry",shape:"circle",label:{use:"property",which:"geo.name"},size_label:{use:"constant",which:"_default",scaleType:"ordinal",_important:!1,extent:[0,.33]},axis_y:{use:"indicator",which:"life_expectancy_years",scaleType:"linear",zoomedMin:15,allow:{scales:["linear","log","time"]}},axis_x:{use:"indicator",which:"income_per_person_gdppercapita_ppp_inflation_adjusted",scaleType:"log",allow:{scales:["linear","log","time"]}},color:{use:"property",which:"geo.world_4region",scaleType:"ordinal",allow:{names:["!geo.name"]}},size:{use:"indicator",which:"population_total",scaleType:"linear",allow:{scales:["linear"]},extent:[0,.85]}},marker_minimap:{space:["entities_minimap"],type:"geometry",shape:"svg",label:{use:"property",which:"geo.name"},geoshape:{use:"property",which:"shape_lores_svg"}}},data:{reader:"csv",path:at.ext_resources.host+at.ext_resources.dataPath+"dont-panic-poverty.csv",splash:!0},language:Is,ui:{chart:{whenHovering:{showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0},labels:{dragging:!0,removeLabelBox:!1},trails:!0,lockNonSelected:0},presentation:!1,cursorMode:"arrow",zoomOnScrolling:!1,adaptMinMaxZoom:!1}}),Zn.define("default_model",{state:{time:{value:"2013",start:"1950",end:"2100"},entities:{dim:"geo",show:{_defs_:{geo:["usa"]}}},entities_minimap:{dim:"geo",show:{_defs_:{"geo.cat":["world_4region"]}}},entities_age:{dim:"age",show:{_defs_:{age:[[0,95]]}},grouping:5},marker:{space:["entities","entities_age","time"],label:{use:"indicator",which:"age"},label_name:{use:"property",which:"geo"},axis_y:{use:"indicator",which:"age",domainMax:100,domainMin:0},axis_x:{use:"indicator",which:"sg_population"},color:{use:"constant",which:"#ffb600",allow:{names:["!geo.name"]}}},marker_minimap:{space:["entities_minimap"],type:"geometry",shape:"svg",label:{use:"property",which:"geo.name"},geoshape:{use:"property",which:"shape_lores_svg"}}},data:{reader:"csv",path:at.ext_resources.host+at.ext_resources.dataPath+"usa.csv",splash:!1},language:Is,ui:{presentation:!1}}),$n.define("default_model",{state:{time:{value:"2011",start:"1950",end:"2100",step:1,delayThresholdX2:0,delayThresholdX4:0,immediatePlay:!0,delay:1500},entities:{dim:"geo",show:{_defs_:{geo:["*"]}}},entities_minimap:{dim:"geo",show:{_defs_:{"geo.cat":["country"]}}},entities_age:{dim:"age",show:{_defs_:{age:[[0,95]]}},grouping:1,_multiple:!0},entities_stack:{space:["entities_age","entities_side"],dim:"education_attainment",_multiple:!0},entities_side:{dim:"population_group"},marker:{space:["entities","entities_side","entities_stack","entities_age","time"],label:{use:"indicator",which:"age"},label_name:{use:"property",which:"population_group"},axis_y:{use:"indicator",which:"age",domainMax:100,domainMin:0},axis_x:{use:"indicator",which:"population"},color:{use:"property",which:"education_attainment"},side:{use:"property",which:"population_group"}},marker_side:{space:["entities","entities_side","time"],hook_total:{use:"indicator",which:"population"}},marker_minimap:{space:["entities_stack"],type:"geometry",shape:"svg",label:{use:"property",which:"education_attainment"},geoshape:{use:"property",which:"shape_lores_svg"
}}},language:Is,ui:{chart:{stacked:!0,inpercent:!1,flipSides:!0},presentation:!1}}),ts.define("default_model",{state:{time:{value:"2011",start:"1996",end:"2011"},entities:{dim:"geo",show:{_defs_:{geo:["*"]}}},entities_age:{dim:"age",show:{_defs_:{age:[[0,95]]}},grouping:5,_multiple:!0},entities_stack:{space:["entities_age","entities_side"],dim:"education",_multiple:!0,select:[]},entities_side:{dim:"sex"},marker_pyramid:{space:["entities","entities_side","entities_stack","entities_age","time"],label:{use:"indicator",which:"age"},label_name:{use:"property",which:"sex"},axis_y:{use:"indicator",which:"age",domainMax:100,domainMin:0},axis_x:{use:"indicator",which:"zaf_population"},color:{use:"property",which:"education"},side:{use:"property",which:"sex"}},marker_line:{space:["entities","time"],label:{use:"property",which:"geo.name"},axis_y:{use:"indicator",which:"tfr",scaleType:"linear",allow:{scales:["linear","log"]}},axis_x:{use:"indicator",which:"time",scaleType:"time",allow:{scales:["time"]}},color:{use:"property",which:"geo.world_4region",allow:{scales:["ordinal"],names:["!geo.name"]}}},marker_side:{space:["entities","entities_side","time"],hook_total:{use:"indicator",which:"zaf_population"}}},language:Is,ui:{chart:{labels:{min_number_of_entities_when_values_hide:2},whenHovering:{hideVerticalNow:!1,showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0,showTooltip:!1},stacked:!0,inpercent:!1},presentation:!1}}),is.define("datawarning_content",{title:"",body:"Comparing the size of economy across countries and time is not trivial. The methods vary and the prices change. Gapminder has adjusted the picture for many such differences, but still we recommend you take these numbers with a large grain of salt.<br/><br/> Countries on a lower income levels have lower data quality in general, as less resources are available for compiling statistics. Historic estimates of GDP before 1950 are generally also more rough. <br/><br/> Data for child mortality is more reliable than GDP per capita, as the unit of comparison, dead children, is universally comparable across time and place. This is one of the reasons this indicator has become so useful to measure social progress. But the historic estimates of child mortality are still suffering from large uncertainties.<br/><br/> Learn more about the datasets and methods in this <a href='http://www.gapminder.org/news/data-sources-dont-panic-end-poverty' target='_blank'>blog post</a>",doubtDomain:[1800,1950,2015],doubtRange:[1,.3,.2]}),is.define("default_model",{state:{time:{value:"2011",start:"1996",end:"2011"},entities:{dim:"geo",opacitySelectDim:.3,opacityRegular:1,show:{_defs_:{geo:["*"]}}},entities_line:{dim:"geo",opacitySelectDim:.3,opacityRegular:1,show:{_defs_:{geo:["zaf"]}}},marker:{space:["entities","time"],size:{use:"constant",which:"_default",scaleType:"ordinal",_important:!0,showArcs:!1,allow:{scales:["linear","ordinal"]},extent:[0,1]},color:{use:"indicator",which:"piped_water_percentage",scaleType:"linear",_important:!0},label:{use:"property",which:"geo.name"}},marker_line:{space:["entities_line","time"],label:{use:"property",which:"geo.name"},axis_y:{use:"indicator",which:"piped_water_percentage",scaleType:"linear",allow:{scales:["linear","log"]}},axis_x:{use:"indicator",which:"time",scaleType:"time",allow:{scales:["time"]}},color:{use:"property",which:"geo.world_4region",allow:{scales:["ordinal"],names:["!geo.name"]}}}},language:Is,ui:{chart:{labels:{min_number_of_entities_when_values_hide:0},hideXAxisValue:!0,whenHovering:{hideVerticalNow:!0,showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0,showTooltip:!1},stacked:!0,inpercent:!1},presentation:!0}}),as.define("default_model",{state:{time:{start:"1990",end:"2012",value:"2000"},entities:{dim:"geo",show:{_defs_:{geo:["usa","bra","chn","ind","idn"],"geo.cat":["country"]}}},marker:{space:["entities","time"],label:{use:"property",which:"geo.name"},axis:{use:"indicator",which:"sg_population"},color:{use:"property",which:"geo.world_4region"}}},data:{reader:"csv",path:at.ext_resources.host+at.ext_resources.dataPath+"basic-indicators.csv",splash:!1},language:Is,ui:{presentation:!1}}),ns.define("datawarning_content",{title:"",body:"Comparing the size of economy across countries and time is not trivial. The methods vary and the prices change. Gapminder has adjusted the picture for many such differences, but still we recommend you take these numbers with a large grain of salt.<br/><br/> Countries on a lower income levels have lower data quality in general, as less resources are available for compiling statistics. Historic estimates of GDP before 1950 are generally also more rough. <br/><br/> Data for child mortality is more reliable than GDP per capita, as the unit of comparison, dead children, is universally comparable across time and place. This is one of the reasons this indicator has become so useful to measure social progress. But the historic estimates of child mortality are still suffering from large uncertainties.<br/><br/> Learn more about the datasets and methods in this <a href='http://www.gapminder.org/news/data-sources-dont-panic-end-poverty' target='_blank'>blog post</a>",doubtDomain:[1800,1950,2015],doubtRange:[1,.3,.2]}),ns.define("default_model",{state:{time:{start:"1800",end:"2015",value:"2015",step:1,speed:300,dim:"year"},entities:{dim:"municipality",opacitySelectDim:.3,opacityRegular:1,show:{_defs_:{"municipality.cat":["province","municipality"]}}},entities_minimap:{dim:"municipality",show:{_defs_:{"municipality.cat":["province","municipality"]}}},marker:{space:["entities","time"],size:{use:"constant",which:"_default",scaleType:"ordinal",_important:!0,showArcs:!1,allow:{scales:["linear","ordinal"]},extent:[0,1]},color:{use:"indicator",which:"piped_water_percentage",scaleType:"linear",_important:!0},label:{use:"property",which:"municipality.name"}},marker_minimap:{space:["entities_minimap"],type:"geometry",shape:"svg",label:{use:"property",which:"municipality.name"},geoshape:{use:"property",which:"shape_lores_svg"}}},language:Is,ui:{chart:{labels:{dragging:!0},lockNonSelected:0,lockActive:0,sizeSelectorActive:0},presentation:!1}}),rs.define("basepath",at.ext_resources.host+at.ext_resources.dataPath),Yn.define("preload",function(t){var e=at.ext_resources.shapePath?at.ext_resources.shapePath:at.ext_resources.host+at.ext_resources.preloadPath+"mc_precomputed_shapes.json";d3.json(e,function(i,a){return i?console.warn("Failed loading json "+e+". "+i):(Yn.define("precomputedShapes",a),void t.resolve())})}),An.define("preload",function(t){var e=at.ext_resources.shapePath?at.ext_resources.shapePath:at.ext_resources.host+at.ext_resources.preloadPath+"world-50m.json";d3.json(e,function(i,a){return i?console.warn("Failed loading json "+e+". "+i):(An.define("world",a),void t.resolve())})}),es.define("preload",function(t){var e=at.ext_resources.shapePath?at.ext_resources.shapePath:at.ext_resources.host+at.ext_resources.preloadPath+"municipalities.json";d3.json(e,function(i,a){return i?console.warn("Failed loading json "+e+". "+i):(es.define("world",a),es.define("geometries",a.objects.topo.geometries),es.define("id_lookup",a.objects.id_lookup),void t.resolve())})}),es.define("preload",function(t){var e=at.ext_resources.shapePath?at.ext_resources.shapePath:at.ext_resources.host+at.ext_resources.preloadPath+"municipalities.json";d3.json(e,function(i,a){return i?console.warn("Failed loading json "+e+". "+i):(es.define("world",a),es.define("geometries",a.objects.topo.geometries),es.define("id_lookup",a.objects.id_lookup),void t.resolve())})}),Hi.define("preload",function(t){function e(t){if(((a.default_model.state||{}).marker||{})[t]){var e=a.default_model.state.marker[t],i=((at.conceptprops.indicatorsDB[e.which]||{}).color||{}).palette||{},n=((at.conceptprops.indicatorsDB[e.which]||{}).color||{}).paletteLabels||{};e.palette=_t({},e.palette,i),e.paletteLabels=wt(n)}}function i(t){if(((a.default_model.state||{}).marker||{})[t]){var e=a.default_model.state.marker[t];if("indicator"===e.use&&at.conceptprops.indicatorsDB[e.which]&&at.conceptprops.indicatorsDB[e.which].domain){var i=at.conceptprops.indicatorsDB[e.which].domain;e.domainMin=e.domainMin||i[0],e.domainMax=e.domainMax||i[1],e.zoomedMin=e.zoomedMin||e.domainMin||i[0],e.zoomedMax=e.zoomedMax||e.domainMax||i[1]}}}var a=this,n=at.ext_resources.conceptpropsPath?at.ext_resources.conceptpropsPath:at.ext_resources.host+at.ext_resources.preloadPath+"metadata.json";this.preloadLanguage().then(function(){return!a.model.data||a.model.data.noConceptprops?void t.resolve():void d3.json(n,function(a){at.conceptprops=a,at.conceptprops.indicatorsDB._default||(at.conceptprops.indicatorsDB._default={use:"constant",scales:["ordinal"]}),-1===at.conceptprops.indicatorsTree.children.map(function(t){return t.id}).indexOf("_default")&&at.conceptprops.indicatorsTree.children.push({id:"_default"}),i("axis_x"),i("axis_y"),i("size"),i("size_label"),e("color"),t.resolve()})})}),Hi.define("preloadLanguage",function(){var t=this,e=new l,i=this.model.language;if(!i)return e.resolve();var a=at.ext_resources.translationPath?at.ext_resources.translationPath:at.ext_resources.host+at.ext_resources.preloadPath+"translation/"+i.id+".json";return i.strings[i.id]?(this.model.language.strings.trigger("change"),e=e.resolve()):d3.json(a,function(a){i.strings[i.id]=a,t.model.language.strings.trigger("change"),e.resolve()}),e}),at.version="0.15.0-35",at.build="1467045950401",at.templates=function(t){return t["bubblesize.html"]='<div class="vzb-bs-holder"> <svg class="vzb-bs-svg"> <g class="vzb-bs-slider-wrap"> <g class="vzb-bs-slider"> </g> </g> </svg> </div> ',t["about.html"]='<div class="vzb-dialog-modal"> <div class="vzb-dialog-title"> <%=t ( "buttons/about") %> </div> <div class="vzb-dialog-content"> <p class="vzb-about-text0"></p> <p class="vzb-about-text1"></p> <br/> <p class="vzb-about-version"></p> <p class="vzb-about-updated"></p> <br/> <p class="vzb-about-text2"></p> <br/> <p class="vzb-about-report"></p> <br/> <p class="vzb-about-credits"></p> </div> <div class="vzb-dialog-buttons"> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"> OK </div> </div> </div> ',t["axes.html"]='<div class="vzb-dialog-modal"> <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axes" data-click="pinDialog"></span> <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axes" data-click="dragDialog"></span> <div class="vzb-dialog-title"> <%=t ( "buttons/axes") %> </div> <div class="vzb-dialog-content"> <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_x") %> <span class="vzb-xaxis-selector"></span> </p> <div class="vzb-xaxis-minmax vzb-dialog-paragraph"></div> <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_y") %> <span class="vzb-yaxis-selector"></span> </p> <div class="vzb-yaxis-minmax vzb-dialog-paragraph"></div> </div> <div class="vzb-dialog-buttons"> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"> OK </div> </div> </div>',t["axesmc.html"]='<div class="vzb-dialog-modal"> <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axesmc" data-click="pinDialog"></span> <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axesmc" data-click="dragDialog"></span> <div class="vzb-dialog-title"> <%=t ( "buttons/axes") %> </div> <div class="vzb-dialog-content"> <div class="vzb-yaxis-container"> <p class="vzb-dialog-sublabel"><%=t ( "hints/mount/maxYvalue") %></p> <form class="vzb-dialog-paragraph"> <label><input type="radio" name="ymax" value="immediate"><%=t ( "mount/maxYmode/immediate") %></label> <label><input type="radio" name="ymax" value="latest"><%=t ( "mount/maxYmode/latest") %></label> </form> </div> <div class="vzb-xaxis-container"> <p class="vzb-dialog-sublabel"> <%=t ( "hints/mount/logXstops") %> </p> <form class="vzb-dialog-paragraph"> <input type="checkbox" name="logstops" value="1">1 <input type="checkbox" name="logstops" value="2">2 <input type="checkbox" name="logstops" value="5">5 </form> </div> <p class="vzb-dialog-sublabel"> <%=t ( "hints/mount/xlimits") %> </p> <div class="vzb-xlimits-container vzb-dialog-paragraph"></div> <div class="vzb-probe-container"> <p class="vzb-dialog-sublabel"> <%=t ( "hints/mount/probe") %> </p> <input type="text" class="vzb-probe-field" name="probe"> </div> </div> <div class="vzb-dialog-buttons"> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"> OK </div> </div> </div>',t["colors.html"]='<div class="vzb-dialog-modal"> <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="colors" data-click="pinDialog"></span> <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="colors" data-click="dragDialog"></span> <div class="vzb-dialog-title"> <%=t ( "buttons/colors") %> <span class="vzb-caxis-selector"></span> </div> <div class="vzb-dialog-content"> <div class="vzb-clegend-container"></div> </div> <div class="vzb-dialog-buttons"> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"> OK </div> </div> </div> ',t["find.html"]='<div class="vzb-dialog-modal"> <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="find" data-click="pinDialog"></span> <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="find" data-click="dragDialog"></span> <div class="vzb-dialog-title"> <%=t ( "dialogs/find") %> <span class="vzb-dialog-content vzb-find-filter"> <input id="vzb-find-search" type="search"/> </span> </div> <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable"> <div class="vzb-find-list">  </div> </div> <div class="vzb-dialog-buttons"> <div class="vzb-dialog-bubbleopacity vzb-dialog-control"></div> <div id="vzb-find-deselect" class="vzb-dialog-button"> <%=t ( "buttons/deselect") %> </div> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"> <%=t ( "buttons/ok") %> </div> </div> </div> ',t["label.html"]='<div class="vzb-dialog-modal"> <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span> <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span> <div class="vzb-dialog-title"> <%=t ( "buttons/label") %> </div> <div class="vzb-dialog-content"> <span class="vzb-saxis-selector"></span> <div class="vzb-dialog-sizeslider"></div> <div class="vzb-removelabelbox-switch"></div> </div> <div class="vzb-dialog-buttons"> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"> OK </div> </div> </div> ',t["moreoptions.html"]='<div class="vzb-dialog-modal"> <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="moreoptions" data-click="pinDialog"></span> <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="moreoptions" data-click="dragDialog"></span> <div class="vzb-dialog-title"> <%=t ("buttons/more_options") %> </div> <div class="vzb-dialog-content vzb-dialog-scrollable"> <div class="vzb-dialog-options-buttonlist"> </div> <div class="vzb-accordion"> </div> </div> <div class="vzb-dialog-buttons"> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"> OK </div> </div> </div>',t["opacity.html"]='<div class="vzb-dialog-modal"> <div class="vzb-dialog-title"> <%=t ( "buttons/opacity") %> </div> <div class="vzb-dialog-content"> <p class="vzb-dialog-sublabel"> <%=t ("buttons/opacityRegular") %> </p> <div class="vzb-dialog-bubbleopacity-regular"></div> <p class="vzb-dialog-sublabel"> <%=t ("buttons/opacityNonselect") %> </p> <div class="vzb-dialog-bubbleopacity-selectdim"></div> </div> </div> </div> ',t["presentation.html"]='<div class="vzb-dialog-modal"> <div class="vzb-dialog-title"> <%=t ( "dialogs/presentation") %> </div> <div class="vzb-dialog-content"> <div class="vzb-presentationmode-switch"></div> </div> </div> ',t["show.html"]='<div class="vzb-dialog-modal"> <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="show" data-click="pinDialog"></span> <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="show" data-click="dragDialog"></span> <div class="vzb-dialog-title"> <%=t ( "buttons/show") %> <span class="vzb-dialog-content vzb-show-filter"> <input id="vzb-show-search" type="search"/> </span> </div> <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable"> <p class="vzb-dialog-sublabel"> <%=t ( "hints/mount/onlyshowthefollowing") %> </p> <div class="vzb-show-list">  </div> </div> <div class="vzb-dialog-buttons"> <div id="vzb-show-deselect" class="vzb-dialog-button"> <%=t ( "buttons/deselect") %> </div> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"> <%=t ( "buttons/ok") %> </div> </div> </div> ',t["size.html"]='<div class="vzb-dialog-modal"> <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="size" data-click="pinDialog"></span> <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="size" data-click="dragDialog"></span> <div class="vzb-dialog-title"> <%=t ( "buttons/size") %> <span class="vzb-saxis-selector"></span> </div> <div class="vzb-dialog-content"> <div class="vzb-dialog-bubblesize"></div> </div> <div class="vzb-dialog-buttons"> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"> OK </div> </div> </div> ',t["speed.html"]='<div class="vzb-dialog-modal"> <div class="vzb-dialog-title"> <%=t ( "buttons/speed") %> </div> <div class="vzb-dialog-content"> <div class="vzb-dialog-placeholder"></div> </div> </div> ',t["stack.html"]='<div class="vzb-dialog-modal"> <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="stack" data-click="pinDialog"></span> <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="stack" data-click="dragDialog"></span> <div class="vzb-dialog-title"> <%=t ( "buttons/stack") %> </div> <div class="vzb-dialog-content vzb-dialog-scrollable">  <form class="vzb-howtostack vzb-dialog-paragraph"> <label> <input type="radio" name="stack" value="none"> <%=t ( "mount/stacking/none") %> </label> <label> <input type="radio" name="stack" value="geo.world_4region"> <%=t ( "mount/stacking/region") %> </label> <label> <input type="radio" name="stack" value="all"> <%=t ( "mount/stacking/world") %> </label> </form> <form class="vzb-howtomerge vzb-dialog-paragraph"> <p class="vzb-dialog-sublabel"> <%=t ( "hints/mount/howtomerge") %> </p> <label> <input type="radio" name="merge" value="none"> <%=t ( "mount/merging/none") %> </label> <label> <input type="radio" name="merge" value="grouped"> <%=t ( "mount/merging/region") %> </label> <label> <input type="radio" name="merge" value="stacked"> <%=t ( "mount/merging/world") %> </label> </form> <form class="vzb-manual-sorting"> <p class="vzb-dialog-sublabel"> <%=t ( "mount/manualSorting") %> </p> <div class="vzb-dialog-draggablelist vzb-dialog-control"></div> </form> </div> <div class="vzb-dialog-buttons"> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">OK</div> </div> </div>',t["zoom.html"]='<div class="vzb-dialog-modal"> <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span> <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span> <div class="vzb-dialog-title"> <%=t ( "buttons/zoom") %> <div class="vzb-dialog-zoom-buttonlist"></div> </div> <div class="vzb-dialog-content"> <div class="vzb-zoomonscrolling-switch"></div> <div class="vzb-adaptminmaxzoom-switch"></div> </div> <div class="vzb-dialog-buttons"> <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"> OK </div> </div> </div> ',t["minmaxinputs.html"]='<div class="vzb-mmi-holder"> <span class="vzb-mmi-domainmin-label"></span> <input type="text" class="vzb-mmi-domainmin" name="min"> <span class="vzb-mmi-domainmax-label"></span> <input type="text" class="vzb-mmi-domainmax" name="max"> <br class="vzb-mmi-break"/> <span class="vzb-mmi-zoomedmin-label"></span> <input type="text" class="vzb-mmi-zoomedmin" name="min"> <span class="vzb-mmi-zoomedmax-label"></span> <input type="text" class="vzb-mmi-zoomedmax" name="max"> </div>',t["sizeslider.html"]='<div class="vzb-szs-holder"> <svg class="vzb-szs-svg"> <g class="vzb-szs-slider-wrap"> <g class="vzb-szs-slider"> </g> </g> </svg> </div> ',t["timeslider.html"]='<div class="vzb-timeslider vzb-ts-loading"> <div class="vzb-ts-slider-wrapper"> <svg class="vzb-ts-slider"> <g> <g class="vzb-ts-slider-axis"></g> <g class="vzb-ts-slider-select"></g> <g class="vzb-ts-slider-slide"> <circle class="vzb-ts-slider-handle"></circle> <text class="vzb-ts-slider-value"></text> </g> </g> </svg> </div>  <div class="vzb-ts-btns"> <button class="vzb-ts-btn-loading vzb-ts-btn"> <div class="vzb-loader"></div> </button> <button class="vzb-ts-btn-play vzb-ts-btn"> <svg class="vzb-icon vzb-icon-play" viewBox="3 3 42 42" xmlns="http://www.w3.org/2000/svg"> <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-4 29V15l12 9-12 9z"/> </svg> </button> <button class="vzb-ts-btn-pause vzb-ts-btn"> <svg class="vzb-icon vzb-icon-pause" viewBox="3 3 42 42" xmlns="http://www.w3.org/2000/svg"> <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-2 28h-4V16h4v16zm8 0h-4V16h4v16z"/> </svg> </button> </div> </div> ',t["agepyramid.html"]=' <svg class="vzb-agepyramid"> <g class="vzb-bc-header"> <text class="vzb-bc-title"></text> <text class="vzb-bc-title vzb-bc-title-right"></text> <text class="vzb-bc-year"></text> </g> <g class="vzb-bc-graph"> <svg class="vzb-bc-bars-crop"> <g class="vzb-bc-bars"></g> <g class="vzb-bc-labels"></g> </svg> <text class="vzb-bc-axis-y-title"></text> <g class="vzb-bc-axis-x"></g> <g class="vzb-bc-axis-x vzb-bc-axis-x-left"></g> <g class="vzb-bc-axis-y"></g> <g class="vzb-bc-axis-labels">  </g> </g> </svg> ',t["axislabeler.html"]=' <svg class="vzb-axislabeler"> <g class="vzb-al-graph"> <g class="vzb-al-axis-x"></g> <g class="vzb-al-axis-y"></g> </g> </svg> ',t["barchart.html"]=' <svg class="vzb-barchart"> <g class="vzb-bc-graph"> <g class="vzb-bc-bars"></g> <g class="vzb-bc-bar-labels"></g> <g class="vzb-bc-axis-y-title"></g> <text class="vzb-bc-year"></text> <g class="vzb-bc-axis-x-title"></g> <g class="vzb-bc-axis-x"></g> <g class="vzb-bc-axis-y"></g> <g class="vzb-bc-axis-labels">  </g> </g> </svg> ',t["barrank.html"]=' <div class="vzb-barrankchart"> <svg class="vzb-br-header"> <text class="vzb-br-title"></text> <text class="vzb-br-total"></text> </svg> <div class="barsviewport"> <svg class="vzb-br-bars-svg"> <g class="vzb-br-bars"></g> </svg> </div> </div> ',t["bubblechart.html"]=' <div class="vzb-bubblechart"> <svg class="vzb-bubblechart-svg vzb-export"> <g class="vzb-bc-graph"> <g class="vzb-bc-year"></g> <svg class="vzb-bc-axis-x"><g></g></svg> <svg class="vzb-bc-axis-y"><g></g></svg> <line class="vzb-bc-projection-x"></line> <line class="vzb-bc-projection-y"></line> <svg class="vzb-bc-bubbles-crop"> <rect class="vzb-bc-eventarea"></rect> <g class="vzb-bc-trails"></g> <g class="vzb-bc-bubbles"></g> <g class="vzb-bc-lines"></g> <g class="vzb-bc-bubble-crown vzb-hidden"> <circle class="vzb-crown-glow"></circle> <circle class="vzb-crown"></circle> </g> </svg> <g class="vzb-bc-axis-y-title"></g> <g class="vzb-bc-axis-x-title"></g> <g class="vzb-bc-axis-s-title"></g> <g class="vzb-bc-axis-c-title"></g> <g class="vzb-bc-axis-y-info vzb-noexport"></g> <g class="vzb-bc-axis-x-info vzb-noexport"></g> <svg class="vzb-bc-labels-crop"> <g class="vzb-bc-labels"></g> </svg> <g class="vzb-data-warning vzb-noexport"> <svg></svg> <text></text> </g> <rect class="vzb-bc-zoom-rect"></rect> <g class="vzb-bc-tooltip vzb-hidden"> <rect class="vzb-tooltip-glow"></rect> <rect class="vzb-tooltip-border"></rect> <text class="vzb-tooltip-text"></text> </g> </g> </svg> <svg> <defs> <filter id="vzb-glow-filter" x="-50%" y="-50%" width="200%" height="200%"> <feGaussianBlur in="SourceGraphic" stdDeviation="2"></feGaussianBlur> </filter> </defs> </svg>  <div class="vzb-tooltip vzb-hidden vzb-tooltip-mobile"></div> </div> ',t["bubblemap.html"]=' <div class="vzb-bubblemap"> <svg class="vzb-bmc-map-background vzb-export"> <g class="vzb-bmc-map-graph"></g> </svg> <svg class="vzb-bubblemap-svg vzb-export"> <g class="vzb-bmc-graph"> <g class="vzb-bmc-year"></g> <g class="vzb-bmc-lines"></g> <g class="vzb-bmc-bubbles"></g> <g class="vzb-bmc-bubble-labels"></g> <g class="vzb-bmc-axis-y-title"> <text></text> </g> <g class="vzb-bmc-axis-c-title"> <text></text> </g> <g class="vzb-bmc-axis-y-info vzb-noexport"> </g> <g class="vzb-bmc-axis-c-info vzb-noexport"> </g> <g class="vzb-data-warning vzb-noexport"> <svg></svg> <text></text> </g> <g class="vzb-bmc-labels"></g> <g class="vzb-bmc-tooltip vzb-hidden"> <rect class="vzb-tooltip-border"></rect> <text class="vzb-tooltip-text"></text> </g> </g> </svg> </div> ',t["cartogram.html"]=' <div class="vzb-cartogram"> <svg class="vzb-cartogram-svg"> <g class="vzb-ct-graph"> <g class="vzb-ct-year"></g> <svg class="vzb-ct-map-background vzb-export"> <g class="vzb-ct-map-graph"></g> </svg> <svg class="vzb-ct-labels-crop"> <g class="vzb-ct-labels"> <line class="vzb-ct-vertical-now"></line> </g> </svg> <g class="vzb-ct-axis-y-title"><text></text></g> <g class="vzb-ct-axis-c-title"><text></text></g> <g class="vzb-ct-axis-y-info"></g> <g class="vzb-ct-axis-c-info"></g> <g class="vzb-ct-tooltip vzb-hidden"> <rect class="vzb-tooltip-border"></rect> <text class="vzb-tooltip-text"></text> </g> <g class="vzb-data-warning vzb-noexport"> <svg></svg> <text></text> </g> </g> </svg> </div> ',t["donutchart.html"]=' <div class="vzb-donutchart"> <svg class="vzb-dc-graph">  </svg> <div class="vzb-tooltip vzb-hidden"></div> </div> ',t["linechart.html"]=' <div class="vzb-linechart"> <svg class="vzb-linechart-svg"> <g class="vzb-lc-graph"> <svg class="vzb-lc-axis-x"><g></g></svg> <svg class="vzb-lc-axis-y"><g></g></svg> <text class="vzb-lc-axis-x-value"></text> <text class="vzb-lc-axis-y-value"></text> <svg class="vzb-lc-lines-crop"> <svg class="vzb-lc-lines"></svg> <line class="vzb-lc-projection-x"></line> <line class="vzb-lc-projection-y"></line> </svg> <svg class="vzb-lc-labels-crop"> <g class="vzb-lc-labels"> <line class="vzb-lc-vertical-now"></line> </g> </svg> <g class="vzb-lc-axis-y-title"></g> <g class="vzb-lc-axis-x-title"></g> <g class="vzb-lc-axis-y-info"></g>  </g> </svg> <div class="vzb-tooltip vzb-hidden"></div> </div> ',t["mountainchart.html"]=' <div class="vzb-mountainchart"> <svg class="vzb-mountainchart-svg"> <g class="vzb-mc-graph"> <rect class="vzb-mc-eventarea"></rect> <g class="vzb-mc-year"></g> <g class="vzb-mc-mountains-mergestacked"></g> <g class="vzb-mc-mountains-mergegrouped"></g> <g class="vzb-mc-mountains"></g> <g class="vzb-mc-mountains-labels"></g> <g class="vzb-mc-axis-y-title"> <text></text> </g> <g class="vzb-mc-axis-x-title"> <text></text> </g> <g class="vzb-mc-axis-info"> </g> <g class="vzb-data-warning"> <svg></svg> <text></text> </g> <g class="vzb-mc-axis-x"></g> <g class="vzb-mc-axis-labels"></g> <g class="vzb-mc-probe"> <text class="vzb-shadow vzb-mc-probe-value-ul"></text> <text class="vzb-shadow vzb-mc-probe-value-ur"></text> <text class="vzb-shadow vzb-mc-probe-value-dl"></text> <text class="vzb-shadow vzb-mc-probe-value-dr"></text> <text class="vzb-mc-probe-value-ul"></text> <text class="vzb-mc-probe-value-ur"></text> <text class="vzb-mc-probe-value-dl"></text> <text class="vzb-mc-probe-value-dr"></text> <text class="vzb-mc-probe-extremepoverty"></text> <line></line> </g> <g class="vzb-mc-tooltip vzb-hidden"> <rect class="vzb-tooltip-border"></rect> <text class="vzb-tooltip-text"></text> </g> </g> </svg> </div> ',t["popbyage.html"]=' <svg class="vzb-popbyage"> <g class="vzb-bc-header"> <text class="vzb-bc-title"></text> <text class="vzb-bc-year"></text> </g> <g class="vzb-bc-graph"> <g class="vzb-bc-bars"></g> <g class="vzb-bc-labels"></g> <text class="vzb-bc-axis-y-title"></text> <g class="vzb-bc-axis-x"></g> <g class="vzb-bc-axis-y"></g> <g class="vzb-bc-axis-labels">  </g> </g> </svg> ',t}({}),Ls});